[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.15.5","content-config-digest","eef1f8c4076f6736","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://astro-paper.pages.dev/\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"layout\":\"constrained\",\"responsiveStyles\":true},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{\"light\":\"min-light\",\"dark\":\"night-owl\"},\"defaultColor\":false,\"wrap\":false,\"transformers\":[{},{\"name\":\"@shikijs/transformers:notation-highlight\"},{\"name\":\"@shikijs/transformers:notation-highlight-word\"},{\"name\":\"@shikijs/transformers:notation-diff\"}]},\"remarkPlugins\":[null,null,[null,{\"test\":\"Table of contents\"}]],\"rehypePlugins\":[null],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{\"PUBLIC_GOOGLE_SITE_VERIFICATION\":{\"access\":\"public\",\"context\":\"client\",\"optional\":true,\"type\":\"string\"}},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":true,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12,63,64,96,97,137,138,173,174,223,224,266,267,356,357,415,416,621,622,680,681,733,734,775,776,853,854,910,911,966,967,1045,1046,1096,1097,1121,1122,1178,1179,1234,1235],"dynamic-og-image-generation-in-astropaper-blog-posts",{"id":11,"data":13,"body":23,"filePath":24,"digest":25,"rendered":26},{"author":14,"pubDatetime":15,"modDatetime":16,"title":17,"featured":18,"draft":18,"tags":19,"description":22},"Sat Naing",["Date","2022-12-28T04:59:04.866Z"],["Date","2025-03-12T13:39:20.763Z"],"Dynamic OG image generation in AstroPaper blog posts",false,[20,21],"docs","release","New feature in AstroPaper v1.4.0, introducing dynamic OG image generation for blog posts.","New feature in AstroPaper v1.4.0, introducing dynamic OG image generation for blog posts.\n\n## Table of contents\n\n## Intro\n\nOG images (aka Social Images) play an important role in social media engagements. In case you don't know what OG image means, it is an image displayed whenever we share our website URL on social media such as Facebook, Discord etc.\n\n> The Social Image used for Twitter is technically not called OG image. However, in this post, I'll be using the term OG image for all types of Social Images.\n\n## Default/Static OG image (the old way)\n\nAstroPaper already provided a way to add an OG image to a blog post. The author can specify the OG image in the frontmatter `ogImage`. Even when the author doesn't define the OG image in the frontmatter, the default OG image will be used as a fallback (in this case `public/astropaper-og.jpg`). But the problem is that the default OG image is static, which means every blog post that does not include an OG image in the frontmatter will always use the same default OG image despite each post title/content being different from others.\n\n## Dynamic OG Image\n\nGenerating a dynamic OG image for each post allows the author to avoid specifying an OG image for every single blog post. Besides, this will prevent the fallback OG image from being identical to all blog posts.\n\nIn AstroPaper v1.4.0, Vercel's [Satori](https://github.com/vercel/satori) package is used for dynamic OG image generation.\n\nDynamic OG images will be generated at build time for blog posts that\n\n- don't include OG image in the frontmatter\n- are not marked as draft.\n\n## Anatomy of AstroPaper dynamic OG image\n\nDynamic OG image of AstroPaper includes _the blog post title_, _author name_ and _site title_. Author name and site title will be retrieved via `SITE.author` and `SITE.title` of **\"src/config.ts\"** file. The title is generated from the blog post frontmatter `title`.  \n![Example Dynamic OG Image link](https://user-images.githubusercontent.com/53733092/209704501-e9c2236a-3f4d-4c67-bab3-025aebd63382.png)\n\n### Issue Non-Latin Characters\n\nTitles with non-latin characters won't display properly out of the box. To resolve this, we have to replace `fontsConfig` inside `loadGoogleFont.ts` with your preferred font.\n\n```ts file=src/utils/loadGoogleFont.ts\nasync function loadGoogleFonts(\n  text: string\n): Promise\u003C\n  Array\u003C{ name: string; data: ArrayBuffer; weight: number; style: string }>\n> {\n  const fontsConfig = [\n    {\n      name: \"Noto Sans JP\",\n      font: \"Noto+Sans+JP\",\n      weight: 400,\n      style: \"normal\",\n    },\n    {\n      name: \"Noto Sans JP\",\n      font: \"Noto+Sans+JP:wght@700\",\n      weight: 700,\n      style: \"normal\",\n    },\n    { name: \"Noto Sans\", font: \"Noto+Sans\", weight: 400, style: \"normal\" },\n    {\n      name: \"Noto Sans\",\n      font: \"Noto+Sans:wght@700\",\n      weight: 700,\n      style: \"normal\",\n    },\n  ];\n  // ...\n}\n```\n\n> Check out [this PR](https://github.com/satnaing/astro-paper/pull/318) for more info.\n\n## Trade-off\n\nWhile this is a nice feature to have, there's a trade-off. Each OG image takes roughly one second to generate. This might not be noticeable at first, but as the number of blog posts grows, you might want to disable this feature. Since every OG image takes time to generate, having many of them will increase the build time linearly.\n\nFor example: If one OG image takes one second to generate, then 60 images will take around one minute, and 600 images will take approximately 10 minutes. This can significantly impact build times as your content scales.\n\nRelated issue: [#428](https://github.com/satnaing/astro-paper/issues/428)\n\n## Limitations\n\nAt the time of writing this, [Satori](https://github.com/vercel/satori) is fairly new and has not reached major release yet. So, there are still some limitations to this dynamic OG image feature.\n\n- Besides, RTL languages are not supported yet.\n- [Using emoji](https://github.com/vercel/satori#emojis) in the title might be a little bit tricky.","src/data/blog/dynamic-og-images.md","da766506cb7517af",{"html":27,"metadata":28},"\u003Cp>New feature in AstroPaper v1.4.0, introducing dynamic OG image generation for blog posts.\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#intro\">Intro\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#defaultstatic-og-image-the-old-way\">Default/Static OG image (the old way)\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#dynamic-og-image\">Dynamic OG Image\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#anatomy-of-astropaper-dynamic-og-image\">Anatomy of AstroPaper dynamic OG image\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#issue-non-latin-characters\">Issue Non-Latin Characters\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#trade-off\">Trade-off\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#limitations\">Limitations\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"intro\">Intro\u003C/h2>\n\u003Cp>OG images (aka Social Images) play an important role in social media engagements. In case you don’t know what OG image means, it is an image displayed whenever we share our website URL on social media such as Facebook, Discord etc.\u003C/p>\n\u003Cblockquote>\n\u003Cp>The Social Image used for Twitter is technically not called OG image. However, in this post, I’ll be using the term OG image for all types of Social Images.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"defaultstatic-og-image-the-old-way\">Default/Static OG image (the old way)\u003C/h2>\n\u003Cp>AstroPaper already provided a way to add an OG image to a blog post. The author can specify the OG image in the frontmatter \u003Ccode>ogImage\u003C/code>. Even when the author doesn’t define the OG image in the frontmatter, the default OG image will be used as a fallback (in this case \u003Ccode>public/astropaper-og.jpg\u003C/code>). But the problem is that the default OG image is static, which means every blog post that does not include an OG image in the frontmatter will always use the same default OG image despite each post title/content being different from others.\u003C/p>\n\u003Ch2 id=\"dynamic-og-image\">Dynamic OG Image\u003C/h2>\n\u003Cp>Generating a dynamic OG image for each post allows the author to avoid specifying an OG image for every single blog post. Besides, this will prevent the fallback OG image from being identical to all blog posts.\u003C/p>\n\u003Cp>In AstroPaper v1.4.0, Vercel’s \u003Ca href=\"https://github.com/vercel/satori\">Satori\u003C/a> package is used for dynamic OG image generation.\u003C/p>\n\u003Cp>Dynamic OG images will be generated at build time for blog posts that\u003C/p>\n\u003Cul>\n\u003Cli>don’t include OG image in the frontmatter\u003C/li>\n\u003Cli>are not marked as draft.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"anatomy-of-astropaper-dynamic-og-image\">Anatomy of AstroPaper dynamic OG image\u003C/h2>\n\u003Cp>Dynamic OG image of AstroPaper includes \u003Cem>the blog post title\u003C/em>, \u003Cem>author name\u003C/em> and \u003Cem>site title\u003C/em>. Author name and site title will be retrieved via \u003Ccode>SITE.author\u003C/code> and \u003Ccode>SITE.title\u003C/code> of \u003Cstrong>“src/config.ts”\u003C/strong> file. The title is generated from the blog post frontmatter \u003Ccode>title\u003C/code>.\u003Cbr>\n\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/209704501-e9c2236a-3f4d-4c67-bab3-025aebd63382.png\" alt=\"Example Dynamic OG Image link\">\u003C/p>\n\u003Ch3 id=\"issue-non-latin-characters\">Issue Non-Latin Characters\u003C/h3>\n\u003Cp>Titles with non-latin characters won’t display properly out of the box. To resolve this, we have to replace \u003Ccode>fontsConfig\u003C/code> inside \u003Ccode>loadGoogleFont.ts\u003C/code> with your preferred font.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">async\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> loadGoogleFonts\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  text\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Promise\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\">  Array\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;{ name\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; data\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> ArrayBuffer\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; weight\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; style\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fontsConfig\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      name\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Noto Sans JP\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      font\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Noto+Sans+JP\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      weight\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 400\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      style\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">normal\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      name\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Noto Sans JP\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      font\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Noto+Sans+JP:wght@700\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      weight\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 700\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      style\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">normal\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    {\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> name\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Noto Sans\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> font\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Noto+Sans\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> weight\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 400\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> style\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">normal\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      name\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Noto Sans\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      font\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Noto+Sans:wght@700\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      weight\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 700\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      style\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">normal\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  ];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/utils/loadGoogleFont.ts\u003C/span>\u003C/pre>\n\u003Cblockquote>\n\u003Cp>Check out \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/318\">this PR\u003C/a> for more info.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"trade-off\">Trade-off\u003C/h2>\n\u003Cp>While this is a nice feature to have, there’s a trade-off. Each OG image takes roughly one second to generate. This might not be noticeable at first, but as the number of blog posts grows, you might want to disable this feature. Since every OG image takes time to generate, having many of them will increase the build time linearly.\u003C/p>\n\u003Cp>For example: If one OG image takes one second to generate, then 60 images will take around one minute, and 600 images will take approximately 10 minutes. This can significantly impact build times as your content scales.\u003C/p>\n\u003Cp>Related issue: \u003Ca href=\"https://github.com/satnaing/astro-paper/issues/428\">#428\u003C/a>\u003C/p>\n\u003Ch2 id=\"limitations\">Limitations\u003C/h2>\n\u003Cp>At the time of writing this, \u003Ca href=\"https://github.com/vercel/satori\">Satori\u003C/a> is fairly new and has not reached major release yet. So, there are still some limitations to this dynamic OG image feature.\u003C/p>\n\u003Cul>\n\u003Cli>Besides, RTL languages are not supported yet.\u003C/li>\n\u003Cli>\u003Ca href=\"https://github.com/vercel/satori#emojis\">Using emoji\u003C/a> in the title might be a little bit tricky.\u003C/li>\n\u003C/ul>",{"headings":29,"localImagePaths":56,"remoteImagePaths":57,"frontmatter":58,"imagePaths":62},[30,34,37,40,43,46,50,53],{"depth":31,"slug":32,"text":33},2,"table-of-contents","Table of contents",{"depth":31,"slug":35,"text":36},"intro","Intro",{"depth":31,"slug":38,"text":39},"defaultstatic-og-image-the-old-way","Default/Static OG image (the old way)",{"depth":31,"slug":41,"text":42},"dynamic-og-image","Dynamic OG Image",{"depth":31,"slug":44,"text":45},"anatomy-of-astropaper-dynamic-og-image","Anatomy of AstroPaper dynamic OG image",{"depth":47,"slug":48,"text":49},3,"issue-non-latin-characters","Issue Non-Latin Characters",{"depth":31,"slug":51,"text":52},"trade-off","Trade-off",{"depth":31,"slug":54,"text":55},"limitations","Limitations",[],[],{"author":14,"pubDatetime":59,"modDatetime":60,"title":17,"slug":11,"featured":18,"draft":18,"tags":61,"description":22},["Date","2022-12-28T04:59:04.866Z"],["Date","2025-03-12T13:39:20.763Z"],[20,21],[],"customizing-astropaper-theme-color-schemes",{"id":63,"data":65,"body":72,"filePath":73,"digest":74,"rendered":75},{"author":14,"pubDatetime":66,"modDatetime":67,"title":68,"featured":18,"draft":18,"tags":69,"description":71},["Date","2022-09-25T15:20:35.000Z"],["Date","2025-06-13T16:46:34.155Z"],"Customizing AstroPaper theme color schemes",[70,20],"color-schemes","How you can enable/disable light & dark mode; and customize color schemes of AstroPaper theme.","This post will explain how you can enable/disable light & dark mode for the website. Moreover, you'll learn how you can customize color schemes of the entire website.\n\n## Table of contents\n\n## Enable/disable light & dark mode\n\nAstroPaper theme will include light and dark mode by default. In other words, there will be two color schemes\\_ one for light mode and another for dark mode. This default behavior can be disabled in `SITE` configuration object.\n\n```js file=\"src/config.ts\"\nexport const SITE = {\n  website: \"https://astro-paper.pages.dev/\", // replace this with your deployed domain\n  author: \"Sat Naing\",\n  profile: \"https://satnaing.dev/\",\n  desc: \"A minimal, responsive and SEO-friendly Astro blog theme.\",\n  title: \"AstroPaper\",\n  ogImage: \"astropaper-og.jpg\",\n  lightAndDarkMode: true, // [!code highlight]\n  postPerIndex: 4,\n  postPerPage: 4,\n  scheduledPostMargin: 15 * 60 * 1000, // 15 minutes\n  showArchives: true,\n  showBackButton: true, // show back button in post detail\n  editPost: {\n    enabled: true,\n    text: \"Suggest Changes\",\n    url: \"https://github.com/satnaing/astro-paper/edit/main/\",\n  },\n  dynamicOgImage: true,\n  lang: \"en\", // html lang code. Set this empty and default will be \"en\"\n  timezone: \"Asia/Bangkok\", // Default global timezone (IANA format) https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\n} as const;\n```\n\nTo disable `light & dark mode` set `SITE.lightAndDarkMode` to `false`.\n\n## Choose primary color scheme\n\nBy default, if we disable `SITE.lightAndDarkMode`, we will only get system's prefers-color-scheme.\n\nThus, to choose primary color scheme instead of prefers-color-scheme, we have to set color scheme in the `primaryColorScheme` variable inside `toggle-theme.js`.\n\n```js file=\"public/toggle-theme.js\"\nconst primaryColorScheme = \"\"; // \"light\" | \"dark\" // [!code hl]\n\n// Get theme data from local storage\nconst currentTheme = localStorage.getItem(\"theme\");\n\n// ...\n```\n\nThe **primaryColorScheme** variable can hold two values\\_ `\"light\"`, `\"dark\"`. You can leave the empty string (default) if you don't want to specify the primary color scheme.\n\n- `\"\"` - system's prefers-color-scheme. (default)\n- `\"light\"` - use light mode as primary color scheme.\n- `\"dark\"` - use dark mode as primary color scheme.\n\n\u003Cdetails>\n\u003Csummary>Why primaryColorScheme' is not inside config.ts?\u003C/summary>\nTo avoid color flickering on page reload, we have to place the toggle-switch JavaScript codes as early as possible when the page loads. It solves the problem of flickering, but as a trade-off, we cannot use ESM imports anymore.\n\u003C/details>\n\n## Customize color schemes\n\nBoth light & dark color schemes of AstroPaper theme can be customized in the `global.css` file.\n\n```css file=\"src/styles/global.css\"\n@import \"tailwindcss\";\n@import \"./typography.css\";\n\n@custom-variant dark (&:where([data-theme=dark], [data-theme=dark] *));\n\n:root,\nhtml[data-theme=\"light\"] {\n  --background: #fdfdfd;\n  --foreground: #282728;\n  --accent: #006cac;\n  --muted: #e6e6e6;\n  --border: #ece9e9;\n}\n\nhtml[data-theme=\"dark\"] {\n  --background: #212737;\n  --foreground: #eaedf3;\n  --accent: #ff6b01;\n  --muted: #343f60bf;\n  --border: #ab4b08;\n}\n/* ... */\n```\n\nIn the AstroPaper theme, the `:root` and `html[data-theme=\"light\"]` selectors define the light color scheme, while `html[data-theme=\"dark\"]` defines the dark color scheme.\n\nTo customize your own color scheme, specify your light colors inside `:root, html[data-theme=\"light\"]`, and your dark colors inside `html[data-theme=\"dark\"]`.\n\nHere is the detail explanation of color properties.\n\n| Color Property | Definition & Usage                                         |\n| -------------- | ---------------------------------------------------------- |\n| `--background` | Primary color of the website. Usually the main background. |\n| `--foreground` | Secondary color of the website. Usually the text color.    |\n| `--accent`     | Accent color of the website. Link color, hover color etc.  |\n| `--muted`      | Card and scrollbar background color for hover state etc.   |\n| `--border`     | Border color. Especially used in horizontal row (hr)       |\n\nHere is an example of changing the light color scheme.\n\n```css file=\"src/styles/global.css\"\n/* ... */\n:root,\nhtml[data-theme=\"light\"] {\n  --background: #f6eee1;\n  --foreground: #012c56;\n  --accent: #e14a39;\n  --muted: #efd8b0;\n  --border: #dc9891;\n}\n/* ... */\n```\n\n> Check out some [predefined color schemes](https://astro-paper.pages.dev/posts/predefined-color-schemes/) AstroPaper has already crafted for you.","src/data/blog/customizing-astropaper-theme-color-schemes.md","e62e8d4fd40b19bd",{"html":76,"metadata":77},"\u003Cp>This post will explain how you can enable/disable light &#x26; dark mode for the website. Moreover, you’ll learn how you can customize color schemes of the entire website.\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#enabledisable-light--dark-mode\">Enable/disable light &#x26; dark mode\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#choose-primary-color-scheme\">Choose primary color scheme\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#customize-color-schemes\">Customize color schemes\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"enabledisable-light--dark-mode\">Enable/disable light &#x26; dark mode\u003C/h2>\n\u003Cp>AstroPaper theme will include light and dark mode by default. In other words, there will be two color schemes_ one for light mode and another for dark mode. This default behavior can be disabled in \u003Ccode>SITE\u003C/code> configuration object.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-highlighted mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> SITE\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  website\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://astro-paper.pages.dev/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // replace this with your deployed domain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  author\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Sat Naing\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  profile\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://satnaing.dev/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  desc\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">A minimal, responsive and SEO-friendly Astro blog theme.\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  title\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">AstroPaper\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  ogImage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">astropaper-og.jpg\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line highlighted\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  lightAndDarkMode\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  postPerIndex\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  postPerPage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  scheduledPostMargin\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 15\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 60\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1000\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 15 minutes\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  showArchives\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  showBackButton\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // show back button in post detail\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  editPost\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    enabled\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    text\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Suggest Changes\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    url\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://github.com/satnaing/astro-paper/edit/main/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  dynamicOgImage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  lang\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">en\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // html lang code. Set this empty and default will be \"en\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  timezone\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Asia/Bangkok\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // Default global timezone (IANA format) https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/config.ts\u003C/span>\u003C/pre>\n\u003Cp>To disable \u003Ccode>light &#x26; dark mode\u003C/code> set \u003Ccode>SITE.lightAndDarkMode\u003C/code> to \u003Ccode>false\u003C/code>.\u003C/p>\n\u003Ch2 id=\"choose-primary-color-scheme\">Choose primary color scheme\u003C/h2>\n\u003Cp>By default, if we disable \u003Ccode>SITE.lightAndDarkMode\u003C/code>, we will only get system’s prefers-color-scheme.\u003C/p>\n\u003Cp>Thus, to choose primary color scheme instead of prefers-color-scheme, we have to set color scheme in the \u003Ccode>primaryColorScheme\u003C/code> variable inside \u003Ccode>toggle-theme.js\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-highlighted mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line highlighted\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> primaryColorScheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// \"light\" | \"dark\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Get theme data from local storage\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> currentTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> localStorage\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getItem\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">theme\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ...\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">public/toggle-theme.js\u003C/span>\u003C/pre>\n\u003Cp>The \u003Cstrong>primaryColorScheme\u003C/strong> variable can hold two values_ \u003Ccode>\"light\"\u003C/code>, \u003Ccode>\"dark\"\u003C/code>. You can leave the empty string (default) if you don’t want to specify the primary color scheme.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ccode>\"\"\u003C/code> - system’s prefers-color-scheme. (default)\u003C/li>\n\u003Cli>\u003Ccode>\"light\"\u003C/code> - use light mode as primary color scheme.\u003C/li>\n\u003Cli>\u003Ccode>\"dark\"\u003C/code> - use dark mode as primary color scheme.\u003C/li>\n\u003C/ul>\n\u003Cdetails>\n\u003Csummary>Why primaryColorScheme' is not inside config.ts?\u003C/summary>\nTo avoid color flickering on page reload, we have to place the toggle-switch JavaScript codes as early as possible when the page loads. It solves the problem of flickering, but as a trade-off, we cannot use ESM imports anymore.\n\u003C/details>\n\u003Ch2 id=\"customize-color-schemes\">Customize color schemes\u003C/h2>\n\u003Cp>Both light &#x26; dark color schemes of AstroPaper theme can be customized in the \u003Ccode>global.css\u003C/code> file.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">@\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">tailwindcss\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">@\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">./typography.css\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">@\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">custom-variant\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> dark (&#x26;:where([data-theme=dark], [data-theme=dark] *));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">root\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">fdfdfd\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">282728\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">006cac\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">e6e6e6\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ece9e9\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">212737\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">eaedf3\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ff6b01\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">343f60bf\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ab4b08\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/* ... */\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/styles/global.css\u003C/span>\u003C/pre>\n\u003Cp>In the AstroPaper theme, the \u003Ccode>:root\u003C/code> and \u003Ccode>html[data-theme=\"light\"]\u003C/code> selectors define the light color scheme, while \u003Ccode>html[data-theme=\"dark\"]\u003C/code> defines the dark color scheme.\u003C/p>\n\u003Cp>To customize your own color scheme, specify your light colors inside \u003Ccode>:root, html[data-theme=\"light\"]\u003C/code>, and your dark colors inside \u003Ccode>html[data-theme=\"dark\"]\u003C/code>.\u003C/p>\n\u003Cp>Here is the detail explanation of color properties.\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Color Property\u003C/th>\u003Cth>Definition &#x26; Usage\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode>--background\u003C/code>\u003C/td>\u003Ctd>Primary color of the website. Usually the main background.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>--foreground\u003C/code>\u003C/td>\u003Ctd>Secondary color of the website. Usually the text color.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>--accent\u003C/code>\u003C/td>\u003Ctd>Accent color of the website. Link color, hover color etc.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>--muted\u003C/code>\u003C/td>\u003Ctd>Card and scrollbar background color for hover state etc.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>--border\u003C/code>\u003C/td>\u003Ctd>Border color. Especially used in horizontal row (hr)\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>Here is an example of changing the light color scheme.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/* ... */\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">root\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">f6eee1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">012c56\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">e14a39\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">efd8b0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">dc9891\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/* ... */\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/styles/global.css\u003C/span>\u003C/pre>\n\u003Cblockquote>\n\u003Cp>Check out some \u003Ca href=\"https://astro-paper.pages.dev/posts/predefined-color-schemes/\">predefined color schemes\u003C/a> AstroPaper has already crafted for you.\u003C/p>\n\u003C/blockquote>",{"headings":78,"localImagePaths":89,"remoteImagePaths":90,"frontmatter":91,"imagePaths":95},[79,80,83,86],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":81,"text":82},"enabledisable-light--dark-mode","Enable/disable light & dark mode",{"depth":31,"slug":84,"text":85},"choose-primary-color-scheme","Choose primary color scheme",{"depth":31,"slug":87,"text":88},"customize-color-schemes","Customize color schemes",[],[],{"author":14,"pubDatetime":92,"modDatetime":93,"title":68,"featured":18,"draft":18,"tags":94,"description":71},["Date","2022-09-25T15:20:35.000Z"],["Date","2025-06-13T16:46:34.155Z"],[70,20],[],"how-to-update-dependencies",{"id":96,"data":98,"body":105,"filePath":106,"assetImports":107,"digest":110,"rendered":111},{"author":14,"pubDatetime":99,"title":100,"featured":18,"draft":18,"tags":101,"ogImage":103,"description":104},["Date","2023-07-20T15:33:05.569Z"],"How to update dependencies of AstroPaper",[102],"FAQ","__ASTRO_IMAGE_../../assets/images/forrest-gump-quote.png","How to update project dependencies and AstroPaper template.","Updating the dependencies of a project can be tedious. However, neglecting to update project dependencies is not a good idea either 😬. In this post, I will share how I usually update my projects, focusing on AstroPaper as an example. Nonetheless, these steps can be applied to other js/node projects as well.\n\n![Forrest Gump Fake Quote](@/assets/images/forrest-gump-quote.png)\n\n## Table of contents\n\n## Updating Package Dependencies\n\nThere are several ways to update dependencies, and I've tried various methods to find the easiest path. One way to do it is by manually updating each package using `npm install package-name@latest`. This method is the most straightforward way of updating. However, it may not be the most efficient option.\n\nMy recommended way of updating dependencies is by using the [npm-check-updates package](https://www.npmjs.com/package/npm-check-updates). There's a good [article](https://www.freecodecamp.org/news/how-to-update-npm-dependencies/) from freeCodeCamp about that, so I won't be explaining the details of what it is and how to use that package. Instead, I'll show you my typical approach.\n\nFirst, install `npm-check-updates` package globally.\n\n```bash\nnpm install -g npm-check-updates\n```\n\nBefore making any updates, it’s a good idea to check all new dependencies that can be updated.\n\n```bash\nncu\n```\n\nMost of the time, patch dependencies can be updated without affecting the project at all. So, I usually update patch dependencies by running either `ncu -i --target patch` or `ncu -u --target patch`. The difference is that `ncu -u --target patch` will update all the patches, while `ncu -i --target patch` will give an option to toggle which package to update. It’s up to you to decide which approach to take.\n\nThe next part involves updating minor dependencies. Minor package updates usually won't break the project, but it is always good to check the release notes of the respective packages. These minor updates often include some cool features that can be applied to our projects.\n\n```bash\nncu -i --target minor\n```\n\nLast but not least, there might be some major package updates in the dependencies. So, check the rest of the dependency updates by running\n\n```bash\nncu -i\n```\n\nIf there are any major updates (or some updates you still have to make), the above command will output those remaining packages. If the package is a major version update, you have to be very careful since this will likely break the whole project. Therefore, please read the respective release note (or) docs very carefully and make changes accordingly.\n\nIf you run `ncu -i` and found no more packages to be updated, _**Congrats!!!**_ you have successfully updated all the dependencies in your project.\n\n## Updating AstroPaper template\n\nLike other open-source projects, AstroPaper is evolving with bug fixes, feature updates, and so on. So if you’re someone who is using AstroPaper as a template, you might also want to update the template when there’s a new release.\n\nThe thing is, you might already have updated the template according to your flavor. Therefore, I can’t exactly show **\"the one-size-fits-all perfect way\"** to update the template to the most recent release. However, here are some tips to update the template without breaking your repo. Keep in mind that, most of the time, updating the package dependencies might be sufficient for you.\n\n### Files and Directories to keep in mind\n\nIn most cases, the files and directories you might not want to override (as you've likely updated those files) are `src/content/blog/`, `src/config.ts`, `src/pages/about.md`, and other assets & styles like `public/` and `src/styles/base.css`.\n\nIf you’re someone who only updates the bare minimum of the template, it should be okay to replace everything with the latest AstroPaper except the above files and directories. It’s like pure Android OS and other vendor-specific OSes like OneUI. The less you modify the base, the less you have to update.\n\nYou can manually replace every file one by one, or you can use the magic of git to update everything. I won’t show you the manual replacement process since it is very straightforward. If you’re not interested in that straightforward and inefficient method, bear with me 🐻.\n\n### Updating AstroPaper using Git\n\n**IMPORTANT!!!**\n\n> Only do the following if you know how to resolve merge conflicts. Otherwise, you’d better replace files manually or update dependencies only.\n\nFirst, add astro-paper as the remote in your project.\n\n```bash\ngit remote add astro-paper https://github.com/satnaing/astro-paper.git\n```\n\nCheckout to a new branch in order to update the template. If you know what you’re doing and you’re confident with your git skill, you can omit this step.\n\n```bash\ngit checkout -b build/update-astro-paper\n```\n\nThen, pull the changes from astro-paper by running\n\n```bash\ngit pull astro-paper main\n```\n\nIf you face `fatal: refusing to merge unrelated histories` error, you can resolve that by running the following command\n\n```bash\ngit pull astro-paper main --allow-unrelated-histories\n```\n\nAfter running the above command, you’re likely to encounter conflicts in your project. You'll need to resolve these conflicts manually and make the necessary adjustments according to your needs.\n\nAfter resolving the conflicts, test your blog thoroughly to ensure everything is working as expected. Check your articles, components, and any customizations you made.\n\nOnce you're satisfied with the result, it's time to merge the update branch into your main branch (only if you are updating the template in another branch). Congratulations! You've successfully updated your template to the latest version. Your blog is now up-to-date and ready to shine! 🎉\n\n## Conclusion\n\nIn this article, I've shared some of my insights and processes for updating dependencies and the AstroPaper template. I genuinely hope this article proves valuable and assists you in managing your projects more efficiently.\n\nIf you have any alternative or improved approaches for updating dependencies/AstroPaper, I would love to hear from you. Thus, don't hesitate to start a discussion in the repository, email me, or open an issue. Your input and ideas are highly appreciated!\n\nPlease understand that my schedule is quite busy these days, and I may not be able to respond quickly. However, I promise to get back to you as soon as possible. 😬\n\nThank you for taking the time to read this article, and I wish you all the best with your projects!","src/data/blog/how-to-update-dependencies.md",[108,109],"@/assets/images/forrest-gump-quote.png","../../assets/images/forrest-gump-quote.png","9d03bdf5536443d4",{"html":112,"metadata":113},"\u003Cp>Updating the dependencies of a project can be tedious. However, neglecting to update project dependencies is not a good idea either 😬. In this post, I will share how I usually update my projects, focusing on AstroPaper as an example. Nonetheless, these steps can be applied to other js/node projects as well.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;@/assets/images/forrest-gump-quote.png&#x22;,&#x22;alt&#x22;:&#x22;Forrest Gump Fake Quote&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#updating-package-dependencies\">Updating Package Dependencies\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#updating-astropaper-template\">Updating AstroPaper template\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#files-and-directories-to-keep-in-mind\">Files and Directories to keep in mind\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#updating-astropaper-using-git\">Updating AstroPaper using Git\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#conclusion\">Conclusion\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"updating-package-dependencies\">Updating Package Dependencies\u003C/h2>\n\u003Cp>There are several ways to update dependencies, and I’ve tried various methods to find the easiest path. One way to do it is by manually updating each package using \u003Ccode>npm install package-name@latest\u003C/code>. This method is the most straightforward way of updating. However, it may not be the most efficient option.\u003C/p>\n\u003Cp>My recommended way of updating dependencies is by using the \u003Ca href=\"https://www.npmjs.com/package/npm-check-updates\">npm-check-updates package\u003C/a>. There’s a good \u003Ca href=\"https://www.freecodecamp.org/news/how-to-update-npm-dependencies/\">article\u003C/a> from freeCodeCamp about that, so I won’t be explaining the details of what it is and how to use that package. Instead, I’ll show you my typical approach.\u003C/p>\n\u003Cp>First, install \u003Ccode>npm-check-updates\u003C/code> package globally.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">npm\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> install\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -g\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> npm-check-updates\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Before making any updates, it’s a good idea to check all new dependencies that can be updated.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ncu\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Most of the time, patch dependencies can be updated without affecting the project at all. So, I usually update patch dependencies by running either \u003Ccode>ncu -i --target patch\u003C/code> or \u003Ccode>ncu -u --target patch\u003C/code>. The difference is that \u003Ccode>ncu -u --target patch\u003C/code> will update all the patches, while \u003Ccode>ncu -i --target patch\u003C/code> will give an option to toggle which package to update. It’s up to you to decide which approach to take.\u003C/p>\n\u003Cp>The next part involves updating minor dependencies. Minor package updates usually won’t break the project, but it is always good to check the release notes of the respective packages. These minor updates often include some cool features that can be applied to our projects.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ncu\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -i\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --target\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> minor\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Last but not least, there might be some major package updates in the dependencies. So, check the rest of the dependency updates by running\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ncu\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -i\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>If there are any major updates (or some updates you still have to make), the above command will output those remaining packages. If the package is a major version update, you have to be very careful since this will likely break the whole project. Therefore, please read the respective release note (or) docs very carefully and make changes accordingly.\u003C/p>\n\u003Cp>If you run \u003Ccode>ncu -i\u003C/code> and found no more packages to be updated, \u003Cem>\u003Cstrong>Congrats!!!\u003C/strong>\u003C/em> you have successfully updated all the dependencies in your project.\u003C/p>\n\u003Ch2 id=\"updating-astropaper-template\">Updating AstroPaper template\u003C/h2>\n\u003Cp>Like other open-source projects, AstroPaper is evolving with bug fixes, feature updates, and so on. So if you’re someone who is using AstroPaper as a template, you might also want to update the template when there’s a new release.\u003C/p>\n\u003Cp>The thing is, you might already have updated the template according to your flavor. Therefore, I can’t exactly show \u003Cstrong>“the one-size-fits-all perfect way”\u003C/strong> to update the template to the most recent release. However, here are some tips to update the template without breaking your repo. Keep in mind that, most of the time, updating the package dependencies might be sufficient for you.\u003C/p>\n\u003Ch3 id=\"files-and-directories-to-keep-in-mind\">Files and Directories to keep in mind\u003C/h3>\n\u003Cp>In most cases, the files and directories you might not want to override (as you’ve likely updated those files) are \u003Ccode>src/content/blog/\u003C/code>, \u003Ccode>src/config.ts\u003C/code>, \u003Ccode>src/pages/about.md\u003C/code>, and other assets &#x26; styles like \u003Ccode>public/\u003C/code> and \u003Ccode>src/styles/base.css\u003C/code>.\u003C/p>\n\u003Cp>If you’re someone who only updates the bare minimum of the template, it should be okay to replace everything with the latest AstroPaper except the above files and directories. It’s like pure Android OS and other vendor-specific OSes like OneUI. The less you modify the base, the less you have to update.\u003C/p>\n\u003Cp>You can manually replace every file one by one, or you can use the magic of git to update everything. I won’t show you the manual replacement process since it is very straightforward. If you’re not interested in that straightforward and inefficient method, bear with me 🐻.\u003C/p>\n\u003Ch3 id=\"updating-astropaper-using-git\">Updating AstroPaper using Git\u003C/h3>\n\u003Cp>\u003Cstrong>IMPORTANT!!!\u003C/strong>\u003C/p>\n\u003Cblockquote>\n\u003Cp>Only do the following if you know how to resolve merge conflicts. Otherwise, you’d better replace files manually or update dependencies only.\u003C/p>\n\u003C/blockquote>\n\u003Cp>First, add astro-paper as the remote in your project.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> remote\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> add\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> astro-paper\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> https://github.com/satnaing/astro-paper.git\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Checkout to a new branch in order to update the template. If you know what you’re doing and you’re confident with your git skill, you can omit this step.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> checkout\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -b\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> build/update-astro-paper\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Then, pull the changes from astro-paper by running\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> pull\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> astro-paper\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> main\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>If you face \u003Ccode>fatal: refusing to merge unrelated histories\u003C/code> error, you can resolve that by running the following command\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> pull\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> astro-paper\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> main\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --allow-unrelated-histories\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>After running the above command, you’re likely to encounter conflicts in your project. You’ll need to resolve these conflicts manually and make the necessary adjustments according to your needs.\u003C/p>\n\u003Cp>After resolving the conflicts, test your blog thoroughly to ensure everything is working as expected. Check your articles, components, and any customizations you made.\u003C/p>\n\u003Cp>Once you’re satisfied with the result, it’s time to merge the update branch into your main branch (only if you are updating the template in another branch). Congratulations! You’ve successfully updated your template to the latest version. Your blog is now up-to-date and ready to shine! 🎉\u003C/p>\n\u003Ch2 id=\"conclusion\">Conclusion\u003C/h2>\n\u003Cp>In this article, I’ve shared some of my insights and processes for updating dependencies and the AstroPaper template. I genuinely hope this article proves valuable and assists you in managing your projects more efficiently.\u003C/p>\n\u003Cp>If you have any alternative or improved approaches for updating dependencies/AstroPaper, I would love to hear from you. Thus, don’t hesitate to start a discussion in the repository, email me, or open an issue. Your input and ideas are highly appreciated!\u003C/p>\n\u003Cp>Please understand that my schedule is quite busy these days, and I may not be able to respond quickly. However, I promise to get back to you as soon as possible. 😬\u003C/p>\n\u003Cp>Thank you for taking the time to read this article, and I wish you all the best with your projects!\u003C/p>",{"headings":114,"localImagePaths":131,"remoteImagePaths":132,"frontmatter":133,"imagePaths":136},[115,116,119,122,125,128],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":117,"text":118},"updating-package-dependencies","Updating Package Dependencies",{"depth":31,"slug":120,"text":121},"updating-astropaper-template","Updating AstroPaper template",{"depth":47,"slug":123,"text":124},"files-and-directories-to-keep-in-mind","Files and Directories to keep in mind",{"depth":47,"slug":126,"text":127},"updating-astropaper-using-git","Updating AstroPaper using Git",{"depth":31,"slug":129,"text":130},"conclusion","Conclusion",[108],[],{"title":100,"author":14,"pubDatetime":134,"slug":96,"featured":18,"draft":18,"ogImage":109,"tags":135,"description":104},["Date","2023-07-20T15:33:05.569Z"],[102],[108],"how-to-add-latex-equations-in-blog-posts",{"id":137,"data":139,"body":146,"filePath":147,"digest":148,"rendered":149},{"author":140,"pubDatetime":141,"modDatetime":142,"title":143,"tags":144,"description":145},"Alberto Perdomo",["Date","2024-09-08T20:58:52.737Z"],["Date","2025-03-22T09:25:46.734Z"],"How to add LaTeX Equations in Astro blog posts",[20],"Learn how to add LaTeX equations in Astro blog posts using Markdown, KaTeX, and remark/rehype plugins.","This document demonstrates how to use LaTeX equations in your Markdown files for AstroPaper. LaTeX is a powerful typesetting system often used for mathematical and scientific documents.\n\n\u003Cfigure>\n  \u003Cimg\n    src=\"https://images.pexels.com/photos/22690748/pexels-photo-22690748/free-photo-of-close-up-of-complicated-equations-written-on-a-blackboard.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2\"\n    alt=\"Free Close-up of complex equations on a chalkboard, showcasing chemistry and math symbols. Stock Photo\"\n  />\n  \u003Cfigcaption class=\"text-center\">\n    Photo by \u003Ca href=\"https://www.pexels.com/photo/close-up-of-complicated-equations-written-on-a-blackboard-22690748/\">Vitaly Gariev\u003C/a>\n  \u003C/figcaption>\n\u003C/figure>\n\n## Table of contents\n\n## Instructions\n\nIn this section, you will find instructions on how to add support for LaTeX in your Markdown files for AstroPaper.\n\n1. Install the necessary remark and rehype plugins by running:\n\n   ```bash\n   pnpm install rehype-katex remark-math katex\n   ```\n\n2. Update the Astro configuration to use the these plugins:\n\n   ```ts file=astro.config.ts\n   // ...\n   import remarkMath from \"remark-math\";\n   import rehypeKatex from \"rehype-katex\";\n\n   export default defineConfig({\n     // ...\n     markdown: {\n       remarkPlugins: [\n         remarkMath, // [!code ++]\n         remarkToc,\n         [remarkCollapse, { test: \"Table of contents\" }],\n       ],\n       rehypePlugins: [rehypeKatex], // [!code ++]\n       shikiConfig: {\n         // For more themes, visit https://shiki.style/themes\n         themes: { light: \"min-light\", dark: \"night-owl\" },\n         wrap: false,\n       },\n     },\n     // ...\n   });\n   ```\n\n3. Import KaTeX CSS in the main layout file\n\n   ```astro file=src/layouts/Layout.astro\n   ---\n   import { SITE } from \"@config\";\n\n   // astro code\n   ---\n\n   \u003C!doctype html>\n   \u003C!-- others... -->\n   \u003Cscript is:inline src=\"/toggle-theme.js\">\u003C/script>\n\n   \u003C!-- [!code highlight:4] -->\n   \u003Clink\n     rel=\"stylesheet\"\n     href=\"https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css\"\n   />\n\n   \u003Cbody>\n     \u003Cslot />\n   \u003C/body>\n   ```\n\n4. As the last step, add a text-color for `katex` in `typography.css`.\n\n   ```css file=src/styles/typography.css\n   @plugin '@tailwindcss/typography';\n\n   @layer base {\n     /* other classes */\n\n     /* Katex text color */\n     /* [!code highlight:3] */\n     .prose .katex-display {\n       @apply text-foreground;\n     }\n\n     /* ===== Code Blocks & Syntax Highlighting ===== */\n     /* other classes */\n   }\n   ```\n\nAnd _voilà_, this setup allows you to write LaTeX equations in your Markdown files, which will be rendered properly when the site is built. Once you do it, the rest of the document will appear rendered correctly.\n\n---\n\n## Inline Equations\n\nInline equations are written between single dollar signs `$...$`. Here are some examples:\n\n1. The famous mass-energy equivalence formula: `$E = mc^2$`\n2. The quadratic formula: `$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$`\n3. Euler's identity: `$e^{i\\pi} + 1 = 0$`\n\n---\n\n## Block Equations\n\nFor more complex equations or when you want the equation to be displayed on its own line, use double dollar signs `$$...$$`:\n\nThe Gaussian integral:\n\n```bash\n$$ \\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi} $$\n```\n\nThe definition of the Riemann zeta function:\n\n```bash\n$$ \\zeta(s) = \\sum_{n=1}^{\\infty} \\frac{1}{n^s} $$\n```\n\nMaxwell's equations in differential form:\n\n```bash\n$$\n\\begin{aligned}\n\\nabla \\cdot \\mathbf{E} &= \\frac{\\rho}{\\varepsilon_0} \\\\\n\\nabla \\cdot \\mathbf{B} &= 0 \\\\\n\\nabla \\times \\mathbf{E} &= -\\frac{\\partial \\mathbf{B}}{\\partial t} \\\\\n\\nabla \\times \\mathbf{B} &= \\mu_0\\left(\\mathbf{J} + \\varepsilon_0 \\frac{\\partial \\mathbf{E}}{\\partial t}\\right)\n\\end{aligned}\n$$\n```\n\n---\n\n## Using Mathematical Symbols\n\nLaTeX provides a wide range of mathematical symbols:\n\n- Greek letters: `$\\alpha$`, `$\\beta$`, `$\\gamma$`, `$\\delta$`, `$\\epsilon$`, `$\\pi$`\n- Operators: `$\\sum$`, `$\\prod$`, `$\\int$`, `$\\partial$`, `$\\nabla$`\n- Relations: `$\\leq$`, `$\\geq$`, `$\\approx$`, `$\\sim$`, `$\\propto$`\n- Logical symbols: `$\\forall$`, `$\\exists$`, `$\\neg$`, `$\\wedge$`, `$\\vee$`","src/data/blog/how-to-add-latex-equations-in-blog-posts.md","7f34f16693d476e9",{"html":150,"metadata":151},"\u003Cp>This document demonstrates how to use LaTeX equations in your Markdown files for AstroPaper. LaTeX is a powerful typesetting system often used for mathematical and scientific documents.\u003C/p>\n\u003Cfigure>\n  \u003Cimg src=\"https://images.pexels.com/photos/22690748/pexels-photo-22690748/free-photo-of-close-up-of-complicated-equations-written-on-a-blackboard.jpeg?auto=compress&#x26;cs=tinysrgb&#x26;w=1260&#x26;h=750&#x26;dpr=2\" alt=\"Free Close-up of complex equations on a chalkboard, showcasing chemistry and math symbols. Stock Photo\">\n  \u003Cfigcaption class=\"text-center\">\n    Photo by \u003Ca href=\"https://www.pexels.com/photo/close-up-of-complicated-equations-written-on-a-blackboard-22690748/\">Vitaly Gariev\u003C/a>\n  \u003C/figcaption>\n\u003C/figure>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#instructions\">Instructions\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#inline-equations\">Inline Equations\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#block-equations\">Block Equations\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#using-mathematical-symbols\">Using Mathematical Symbols\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"instructions\">Instructions\u003C/h2>\n\u003Cp>In this section, you will find instructions on how to add support for LaTeX in your Markdown files for AstroPaper.\u003C/p>\n\u003Col>\n\u003Cli>\n\u003Cp>Install the necessary remark and rehype plugins by running:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">pnpm\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> install\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> rehype-katex\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> remark-math\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> katex\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003Cli>\n\u003Cp>Update the Astro configuration to use the these plugins:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-diff mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> remarkMath \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">remark-math\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> rehypeKatex \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">rehype-katex\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> default\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> defineConfig\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  markdown\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    remarkPlugins\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      remarkMath\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      remarkToc\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      [remarkCollapse\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { test\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Table of contents\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }]\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ]\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    rehypePlugins\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [rehypeKatex]\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    shikiConfig\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">      // For more themes, visit https://shiki.style/themes\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      themes\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { light\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">min-light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> dark\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">night-owl\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      wrap\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">astro.config.ts\u003C/span>\u003C/pre>\n\u003C/li>\n\u003Cli>\n\u003Cp>Import KaTeX CSS in the main layout file\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-highlighted mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"astro\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { SITE } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@config\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// astro code\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;!\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">doctype\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">&#x3C;!-- others... -->\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">script\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> is:inline\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> src\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/toggle-theme.js\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>&#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">script\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line highlighted\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">link\u003C/span>\u003C/span>\n\u003Cspan class=\"line highlighted\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  rel\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">stylesheet\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line highlighted\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  href\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line highlighted\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">/>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">body\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">slot\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">body\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/layouts/Layout.astro\u003C/span>\u003C/pre>\n\u003C/li>\n\u003Cli>\n\u003Cp>As the last step, add a text-color for \u003Ccode>katex\u003C/code> in \u003Ccode>typography.css\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-highlighted mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">@\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">plugin\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> '@tailwindcss/typography';\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">@\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">layer\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> base {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /* other classes */\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /* Katex text color */\u003C/span>\u003C/span>\n\u003Cspan class=\"line highlighted\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">  .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">prose\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">katex-display\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line highlighted\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    @\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#80CBC4\">apply\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#80CBC4\"> text-foreground\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line highlighted\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /* ===== Code Blocks &#x26; Syntax Highlighting ===== */\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /* other classes */\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/styles/typography.css\u003C/span>\u003C/pre>\n\u003C/li>\n\u003C/ol>\n\u003Cp>And \u003Cem>voilà\u003C/em>, this setup allows you to write LaTeX equations in your Markdown files, which will be rendered properly when the site is built. Once you do it, the rest of the document will appear rendered correctly.\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"inline-equations\">Inline Equations\u003C/h2>\n\u003Cp>Inline equations are written between single dollar signs \u003Ccode>$...$\u003C/code>. Here are some examples:\u003C/p>\n\u003Col>\n\u003Cli>The famous mass-energy equivalence formula: \u003Ccode>$E = mc^2$\u003C/code>\u003C/li>\n\u003Cli>The quadratic formula: \u003Ccode>$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$\u003C/code>\u003C/li>\n\u003Cli>Euler’s identity: \u003Ccode>$e^{i\\pi} + 1 = 0$\u003C/code>\u003C/li>\n\u003C/ol>\n\u003Chr>\n\u003Ch2 id=\"block-equations\">Block Equations\u003C/h2>\n\u003Cp>For more complex equations or when you want the equation to be displayed on its own line, use double dollar signs \u003Ccode>$$...$$\u003C/code>:\u003C/p>\n\u003Cp>The Gaussian integral:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">$$\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">nt_{\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">-\\infty}^\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">\\\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">infty}\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> e^{-x^2}\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> dx\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\s\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">qrt{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\p\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">i}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> $$\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The definition of the Riemann zeta function:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">$$\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\z\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">eta(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">s\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) = \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\s\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">um_{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">n\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}^{\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\infty}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\f\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">rac{\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">}{n^s}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> $$\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Maxwell’s equations in differential form:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">$$\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\begin\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">{aligned}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\nabla\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\c\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">dot\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">athbf{E}\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\f\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">rac{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\r\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">ho}{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\v\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">arepsilon_0}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\\\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">abla \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\c\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">dot\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">athbf{B}\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\\\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">abla \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\t\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">imes\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">athbf{E}\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">=\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#F78C6C\">\\f\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\">rac\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\partial\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">athbf{B}}{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\p\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">artial\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> t}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\\\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">abla \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\t\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">imes\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">athbf{B}\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">u_0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\l\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">eft\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\mathbf\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">{J}\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\v\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">arepsilon_0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\f\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">rac{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\p\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">artial\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">athbf{E}}{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\p\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">artial\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> t}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\r\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">ight\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\end\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">{aligned}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">$$\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Chr>\n\u003Ch2 id=\"using-mathematical-symbols\">Using Mathematical Symbols\u003C/h2>\n\u003Cp>LaTeX provides a wide range of mathematical symbols:\u003C/p>\n\u003Cul>\n\u003Cli>Greek letters: \u003Ccode>$\\alpha$\u003C/code>, \u003Ccode>$\\beta$\u003C/code>, \u003Ccode>$\\gamma$\u003C/code>, \u003Ccode>$\\delta$\u003C/code>, \u003Ccode>$\\epsilon$\u003C/code>, \u003Ccode>$\\pi$\u003C/code>\u003C/li>\n\u003Cli>Operators: \u003Ccode>$\\sum$\u003C/code>, \u003Ccode>$\\prod$\u003C/code>, \u003Ccode>$\\int$\u003C/code>, \u003Ccode>$\\partial$\u003C/code>, \u003Ccode>$\\nabla$\u003C/code>\u003C/li>\n\u003Cli>Relations: \u003Ccode>$\\leq$\u003C/code>, \u003Ccode>$\\geq$\u003C/code>, \u003Ccode>$\\approx$\u003C/code>, \u003Ccode>$\\sim$\u003C/code>, \u003Ccode>$\\propto$\u003C/code>\u003C/li>\n\u003Cli>Logical symbols: \u003Ccode>$\\forall$\u003C/code>, \u003Ccode>$\\exists$\u003C/code>, \u003Ccode>$\\neg$\u003C/code>, \u003Ccode>$\\wedge$\u003C/code>, \u003Ccode>$\\vee$\u003C/code>\u003C/li>\n\u003C/ul>",{"headings":152,"localImagePaths":166,"remoteImagePaths":167,"frontmatter":168,"imagePaths":172},[153,154,157,160,163],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":155,"text":156},"instructions","Instructions",{"depth":31,"slug":158,"text":159},"inline-equations","Inline Equations",{"depth":31,"slug":161,"text":162},"block-equations","Block Equations",{"depth":31,"slug":164,"text":165},"using-mathematical-symbols","Using Mathematical Symbols",[],[],{"author":140,"pubDatetime":169,"modDatetime":170,"title":143,"tags":171,"description":145},["Date","2024-09-08T20:58:52.737Z"],["Date","2025-03-22T09:25:46.734Z"],[20],[],"how-to-configure-astropaper-theme",{"id":173,"data":175,"body":183,"filePath":184,"digest":185,"rendered":186},{"author":14,"pubDatetime":176,"modDatetime":177,"title":178,"featured":179,"draft":18,"tags":180,"description":182},["Date","2022-09-23T04:58:53.000Z"],["Date","2025-03-20T03:15:57.792Z"],"How to configure AstroPaper theme",true,[181,20],"configuration","How you can make AstroPaper theme absolutely yours.","AstroPaper is a highly customizable Astro blog theme. With AstroPaper, you can customize everything according to your personal taste. This article will explain how you can make some customizations easily in the config file.\n\n## Table of contents\n\n## Configuring SITE\n\nThe important configurations resides in `src/config.ts` file. Within that file, you'll see the `SITE` object where you can specify your website's main configurations.\n\nDuring development, it's okay to leave `SITE.website` empty. But in production mode, you should specify your deployed url in `SITE.website` option since this will be used for canonical URL, social card URL etc.. which are important for SEO.\n\n```js file=src/config.ts\nexport const SITE = {\n  website: \"https://astro-paper.pages.dev/\", // replace this with your deployed domain\n  author: \"Sat Naing\",\n  profile: \"https://satnaing.dev/\",\n  desc: \"A minimal, responsive and SEO-friendly Astro blog theme.\",\n  title: \"AstroPaper\",\n  ogImage: \"astropaper-og.jpg\",\n  lightAndDarkMode: true,\n  postPerIndex: 4,\n  postPerPage: 4,\n  scheduledPostMargin: 15 * 60 * 1000, // 15 minutes\n  showArchives: true,\n  showBackButton: true, // show back button in post detail\n  editPost: {\n    enabled: true,\n    text: \"Suggest Changes\",\n    url: \"https://github.com/satnaing/astro-paper/edit/main/\",\n  },\n  dynamicOgImage: true, // enable automatic dynamic og-image generation\n  dir: \"ltr\", // \"rtl\" | \"auto\"\n  lang: \"en\", // html lang code. Set this empty and default will be \"en\"\n  timezone: \"Asia/Bangkok\", // Default global timezone (IANA format) https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\n} as const;\n```\n\nHere are SITE configuration options\n\n| Options               | Description                                                                                                                                                                                                                                                                                                                                                                                                                       |\n| --------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `website`             | Your deployed website URL                                                                                                                                                                                                                                                                                                                                                                                                         |\n| `author`              | Your name                                                                                                                                                                                                                                                                                                                                                                                                                         |\n| `profile`             | Your personal/portfolio website URL which is used for better SEO. Put `null` or empty string `\"\"` if you don't have any.                                                                                                                                                                                                                                                                                                          |\n| `desc`                | Your site description. Useful for SEO and social media sharing.                                                                                                                                                                                                                                                                                                                                                                   |\n| `title`               | Your site name                                                                                                                                                                                                                                                                                                                                                                                                                    |\n| `ogImage`             | Your default OG image for the site. Useful for social media sharing. OG images can be an external image URL or they can be placed under `/public` directory.                                                                                                                                                                                                                                                                      |\n| `lightAndDarkMode`    | Enable or disable `light & dark mode` for the website. If disabled, primary color scheme will be used. This option is enabled by default.                                                                                                                                                                                                                                                                                         |\n| `postPerIndex`        | The number of posts to be displayed at the home page under `Recent` section.                                                                                                                                                                                                                                                                                                                                                      |\n| `postPerPage`         | You can specify how many posts will be displayed in each posts page. (eg: if you set `SITE.postPerPage` to 3, each page will only show 3 posts per page)                                                                                                                                                                                                                                                                          |\n| `scheduledPostMargin` | In Production mode, posts with a future `pubDatetime` will not be visible. However, if a post's `pubDatetime` is within the next 15 minutes, it will be visible. You can set `scheduledPostMargin` if you don't like the default 15 minutes margin.                                                                                                                                                                               |\n| `showArchives`        | Determines whether to display the `Archives` menu (positioned between the `About` and `Search` menus) and its corresponding page on the site. This option is set to `true` by default.                                                                                                                                                                                                                                            |\n| `showBackButton`      | Determines whether to display the `Go back` button in each blog post.                                                                                                                                                                                                                                                                                                                                                             |\n| `editPost`            | This option allows users to suggest changes to a blog post by providing an edit link under blog post titles. This feature can be disabled by setting `SITE.editPost.enabled` to `false`.                                                                                                                                                                                                                                          |\n| `dynamicOgImage`      | This option controls whether to [generate dynamic og-image](https://astro-paper.pages.dev/posts/dynamic-og-image-generation-in-astropaper-blog-posts/) if no `ogImage` is specified in the blog post frontmatter. If you have many blog posts, you might want to disable this feature. See the [trade-off](https://astro-paper.pages.dev/posts/dynamic-og-image-generation-in-astropaper-blog-posts/#trade-off) for more details. |\n| `dir`                 | Specifies the text direction of the entire blog. Used as [HTML dir attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Global_attributes/dir) in `\u003Chtml dir=\"ltr\">`. Supported values: `ltr` \\| `rtl` \\| `auto`                                                                                                                                                                                                |\n| `lang`                | Used as HTML ISO Language code in `\u003Chtml lang\"en\">`. Default is `en`.                                                                                                                                                                                                                                                                                                                                                             |\n| `timezone`            | This option allows you to specify your timezone using the [IANA format](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones). Setting this ensures consistent timestamps across your localhost and deployed site, eliminating time differences.                                                                                                                                                                          |\n\n## Update layout width\n\nThe default `max-width` for the entire blog is `768px` (`max-w-3xl`). If you'd like to change it, you can easily update the `max-w-app` utility in your `global.css`. For instance:\n\n```css file=src/styles/global.css\n@utility max-w-app {\n  /* [!code --:1] */\n  @apply max-w-3xl;\n  /* [!code ++:1] */\n  @apply max-w-4xl xl:max-w-5xl;\n}\n```\n\nYou can explore more `max-width` values in the [Tailwind CSS docs](https://tailwindcss.com/docs/max-width).\n\n## Configuring logo or title\n\nPrior to AstroPaper v5, you can update your site name/logo in `LOGO_IMAGE` object inside `src/config.ts` file. However, in AstroPaper v5, this option has been removed in favor of Astro's built-in SVG and Image components.\n\n![An arrow pointing at the website logo](https://res.cloudinary.com/noezectz/v1663911318/astro-paper/AstroPaper-logo-config_goff5l.png)\n\nThere are 3 options you can do:\n\n### Option 1: SITE title text\n\nThis is the easiest option. You just have to update `SITE.title` in `src/config.ts` file.\n\n### Option 2: Astro's SVG component\n\nYou might want to use this option if you want to use an SVG logo.\n\n- First add an SVG inside `src/assets` directory. (eg: `src/assets/dummy-logo.svg`)\n- Then import that SVG inside `Header.astro`\n\n  ```astro file=src/components/Header.astro\n  ---\n  // ...\n  import DummyLogo from \"@/assets/dummy-logo.svg\";\n  ---\n  ```\n\n- Finally, replace `{SITE.title}` with imported logo.\n\n  ```html\n  \u003Ca\n    href=\"/\"\n    class=\"absolute py-1 text-left text-2xl leading-7 font-semibold whitespace-nowrap sm:static\"\n  >\n    \u003CDummyLogo class=\"scale-75 dark:invert\" />\n    \u003C!-- {SITE.title} -->\n  \u003C/a>\n  ```\n\nThe best part of this approach is that you can customize your SVG styles as needed. In the example above, you can see how the SVG logo color can be inverted in dark mode.\n\n### Option 3: Astro's Image component\n\nIf your logo is an image but not SVG, you can use Astro's Image component.\n\n- Add your logo inside `src/assets` directory. (eg: `src/assets/dummy-logo.png`)\n- Import `Image` and your logo in `Header.astro`\n\n  ```astro file=src/components/Header.astro\n  ---\n  // ...\n  import { Image } from \"astro:assets\";\n  import dummyLogo from \"@/assets/dummy-logo.png\";\n  ---\n  ```\n\n- Then, replace `{SITE.title}` with imported logo.\n\n  ```html\n  \u003Ca\n    href=\"/\"\n    class=\"absolute py-1 text-left text-2xl leading-7 font-semibold whitespace-nowrap sm:static\"\n  >\n    \u003Cimage src=\"{dummyLogo}\" alt=\"Dummy Blog\" class=\"dark:invert\" />\n    \u003C!-- {SITE.title} -->\n  \u003C/a>\n  ```\n\nWith this approach, you can still adjust your image's appearance using CSS classes. However, this might not always fit what you want. If you need to display different logo images based on light or dark mode, check how light/dark icons are handled inside the `Header.astro` component.\n\n## Configuring social links\n\n![An arrow pointing at social link icons](https://github.com/user-attachments/assets/8b895400-d088-442f-881b-02d2443e00cf)\n\nYou can configure social links in `SOCIALS` object inside `constants.ts`.\n\n```ts file=src/constants.ts\nexport const SOCIALS = [\n  {\n    name: \"GitHub\",\n    href: \"https://github.com/satnaing/astro-paper\",\n    linkTitle: ` ${SITE.title} on GitHub`,\n    icon: IconGitHub,\n  },\n  {\n    name: \"X\",\n    href: \"https://x.com/username\",\n    linkTitle: `${SITE.title} on X`,\n    icon: IconBrandX,\n  },\n  {\n    name: \"LinkedIn\",\n    href: \"https://www.linkedin.com/in/username/\",\n    linkTitle: `${SITE.title} on LinkedIn`,\n    icon: IconLinkedin,\n  },\n  {\n    name: \"Mail\",\n    href: \"mailto:yourmail@gmail.com\",\n    linkTitle: `Send an email to ${SITE.title}`,\n    icon: IconMail,\n  },\n] as const;\n```\n\n## Configuring share links\n\nYou can configure share links in `SHARE_LINKS` object inside `src/constants.ts`.\n\n![An arrow pointing at share link icons](https://github.com/user-attachments/assets/4f930b68-b625-45df-8c41-e076dd2b838e)\n\n## Conclusion\n\nThis is the brief specification of how you can customize this theme. You can customize more if you know some coding. For customizing styles, please read [this article](https://astro-paper.pages.dev/posts/customizing-astropaper-theme-color-schemes/). Thanks for reading.✌🏻","src/data/blog/how-to-configure-astropaper-theme.md","b90cca129f3a63f0",{"html":187,"metadata":188},"\u003Cp>AstroPaper is a highly customizable Astro blog theme. With AstroPaper, you can customize everything according to your personal taste. This article will explain how you can make some customizations easily in the config file.\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#configuring-site\">Configuring SITE\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#update-layout-width\">Update layout width\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#configuring-logo-or-title\">Configuring logo or title\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#option-1-site-title-text\">Option 1: SITE title text\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#option-2-astros-svg-component\">Option 2: Astro’s SVG component\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#option-3-astros-image-component\">Option 3: Astro’s Image component\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#configuring-social-links\">Configuring social links\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#configuring-share-links\">Configuring share links\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#conclusion\">Conclusion\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"configuring-site\">Configuring SITE\u003C/h2>\n\u003Cp>The important configurations resides in \u003Ccode>src/config.ts\u003C/code> file. Within that file, you’ll see the \u003Ccode>SITE\u003C/code> object where you can specify your website’s main configurations.\u003C/p>\n\u003Cp>During development, it’s okay to leave \u003Ccode>SITE.website\u003C/code> empty. But in production mode, you should specify your deployed url in \u003Ccode>SITE.website\u003C/code> option since this will be used for canonical URL, social card URL etc.. which are important for SEO.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> SITE\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  website\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://astro-paper.pages.dev/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // replace this with your deployed domain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  author\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Sat Naing\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  profile\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://satnaing.dev/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  desc\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">A minimal, responsive and SEO-friendly Astro blog theme.\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  title\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">AstroPaper\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  ogImage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">astropaper-og.jpg\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  lightAndDarkMode\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  postPerIndex\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  postPerPage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  scheduledPostMargin\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 15\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 60\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1000\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 15 minutes\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  showArchives\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  showBackButton\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // show back button in post detail\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  editPost\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    enabled\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    text\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Suggest Changes\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    url\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://github.com/satnaing/astro-paper/edit/main/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  dynamicOgImage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // enable automatic dynamic og-image generation\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  dir\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">ltr\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // \"rtl\" | \"auto\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  lang\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">en\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // html lang code. Set this empty and default will be \"en\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  timezone\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Asia/Bangkok\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // Default global timezone (IANA format) https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/config.ts\u003C/span>\u003C/pre>\n\u003Cp>Here are SITE configuration options\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Options\u003C/th>\u003Cth>Description\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode>website\u003C/code>\u003C/td>\u003Ctd>Your deployed website URL\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>author\u003C/code>\u003C/td>\u003Ctd>Your name\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>profile\u003C/code>\u003C/td>\u003Ctd>Your personal/portfolio website URL which is used for better SEO. Put \u003Ccode>null\u003C/code> or empty string \u003Ccode>\"\"\u003C/code> if you don’t have any.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>desc\u003C/code>\u003C/td>\u003Ctd>Your site description. Useful for SEO and social media sharing.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>title\u003C/code>\u003C/td>\u003Ctd>Your site name\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>ogImage\u003C/code>\u003C/td>\u003Ctd>Your default OG image for the site. Useful for social media sharing. OG images can be an external image URL or they can be placed under \u003Ccode>/public\u003C/code> directory.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>lightAndDarkMode\u003C/code>\u003C/td>\u003Ctd>Enable or disable \u003Ccode>light &#x26; dark mode\u003C/code> for the website. If disabled, primary color scheme will be used. This option is enabled by default.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>postPerIndex\u003C/code>\u003C/td>\u003Ctd>The number of posts to be displayed at the home page under \u003Ccode>Recent\u003C/code> section.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>postPerPage\u003C/code>\u003C/td>\u003Ctd>You can specify how many posts will be displayed in each posts page. (eg: if you set \u003Ccode>SITE.postPerPage\u003C/code> to 3, each page will only show 3 posts per page)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>scheduledPostMargin\u003C/code>\u003C/td>\u003Ctd>In Production mode, posts with a future \u003Ccode>pubDatetime\u003C/code> will not be visible. However, if a post’s \u003Ccode>pubDatetime\u003C/code> is within the next 15 minutes, it will be visible. You can set \u003Ccode>scheduledPostMargin\u003C/code> if you don’t like the default 15 minutes margin.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>showArchives\u003C/code>\u003C/td>\u003Ctd>Determines whether to display the \u003Ccode>Archives\u003C/code> menu (positioned between the \u003Ccode>About\u003C/code> and \u003Ccode>Search\u003C/code> menus) and its corresponding page on the site. This option is set to \u003Ccode>true\u003C/code> by default.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>showBackButton\u003C/code>\u003C/td>\u003Ctd>Determines whether to display the \u003Ccode>Go back\u003C/code> button in each blog post.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>editPost\u003C/code>\u003C/td>\u003Ctd>This option allows users to suggest changes to a blog post by providing an edit link under blog post titles. This feature can be disabled by setting \u003Ccode>SITE.editPost.enabled\u003C/code> to \u003Ccode>false\u003C/code>.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>dynamicOgImage\u003C/code>\u003C/td>\u003Ctd>This option controls whether to \u003Ca href=\"https://astro-paper.pages.dev/posts/dynamic-og-image-generation-in-astropaper-blog-posts/\">generate dynamic og-image\u003C/a> if no \u003Ccode>ogImage\u003C/code> is specified in the blog post frontmatter. If you have many blog posts, you might want to disable this feature. See the \u003Ca href=\"https://astro-paper.pages.dev/posts/dynamic-og-image-generation-in-astropaper-blog-posts/#trade-off\">trade-off\u003C/a> for more details.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>dir\u003C/code>\u003C/td>\u003Ctd>Specifies the text direction of the entire blog. Used as \u003Ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Global_attributes/dir\">HTML dir attribute\u003C/a> in \u003Ccode>&#x3C;html dir=\"ltr\">\u003C/code>. Supported values: \u003Ccode>ltr\u003C/code> | \u003Ccode>rtl\u003C/code> | \u003Ccode>auto\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>lang\u003C/code>\u003C/td>\u003Ctd>Used as HTML ISO Language code in \u003Ccode>&#x3C;html lang\"en\">\u003C/code>. Default is \u003Ccode>en\u003C/code>.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>timezone\u003C/code>\u003C/td>\u003Ctd>This option allows you to specify your timezone using the \u003Ca href=\"https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\">IANA format\u003C/a>. Setting this ensures consistent timestamps across your localhost and deployed site, eliminating time differences.\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch2 id=\"update-layout-width\">Update layout width\u003C/h2>\n\u003Cp>The default \u003Ccode>max-width\u003C/code> for the entire blog is \u003Ccode>768px\u003C/code> (\u003Ccode>max-w-3xl\u003C/code>). If you’d like to change it, you can easily update the \u003Ccode>max-w-app\u003C/code> utility in your \u003Ccode>global.css\u003C/code>. For instance:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-diff mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">@\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">utility\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> max-w-app {\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff remove\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  @\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">apply\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> max-w-3xl;\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  @\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">apply\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> max-w-4xl xl:max-w-5xl;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/styles/global.css\u003C/span>\u003C/pre>\n\u003Cp>You can explore more \u003Ccode>max-width\u003C/code> values in the \u003Ca href=\"https://tailwindcss.com/docs/max-width\">Tailwind CSS docs\u003C/a>.\u003C/p>\n\u003Ch2 id=\"configuring-logo-or-title\">Configuring logo or title\u003C/h2>\n\u003Cp>Prior to AstroPaper v5, you can update your site name/logo in \u003Ccode>LOGO_IMAGE\u003C/code> object inside \u003Ccode>src/config.ts\u003C/code> file. However, in AstroPaper v5, this option has been removed in favor of Astro’s built-in SVG and Image components.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://res.cloudinary.com/noezectz/v1663911318/astro-paper/AstroPaper-logo-config_goff5l.png\" alt=\"An arrow pointing at the website logo\">\u003C/p>\n\u003Cp>There are 3 options you can do:\u003C/p>\n\u003Ch3 id=\"option-1-site-title-text\">Option 1: SITE title text\u003C/h3>\n\u003Cp>This is the easiest option. You just have to update \u003Ccode>SITE.title\u003C/code> in \u003Ccode>src/config.ts\u003C/code> file.\u003C/p>\n\u003Ch3 id=\"option-2-astros-svg-component\">Option 2: Astro’s SVG component\u003C/h3>\n\u003Cp>You might want to use this option if you want to use an SVG logo.\u003C/p>\n\u003Cul>\n\u003Cli>\n\u003Cp>First add an SVG inside \u003Ccode>src/assets\u003C/code> directory. (eg: \u003Ccode>src/assets/dummy-logo.svg\u003C/code>)\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Then import that SVG inside \u003Ccode>Header.astro\u003C/code>\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"astro\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> DummyLogo \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@/assets/dummy-logo.svg\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/components/Header.astro\u003C/span>\u003C/pre>\n\u003C/li>\n\u003Cli>\n\u003Cp>Finally, replace \u003Ccode>{SITE.title}\u003C/code> with imported logo.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"html\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">a\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  href\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  class\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">absolute py-1 text-left text-2xl leading-7 font-semibold whitespace-nowrap sm:static\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FFFFFF\">DummyLogo\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> class\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">scale-75 dark:invert\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  &#x3C;!-- {SITE.title} -->\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003C/ul>\n\u003Cp>The best part of this approach is that you can customize your SVG styles as needed. In the example above, you can see how the SVG logo color can be inverted in dark mode.\u003C/p>\n\u003Ch3 id=\"option-3-astros-image-component\">Option 3: Astro’s Image component\u003C/h3>\n\u003Cp>If your logo is an image but not SVG, you can use Astro’s Image component.\u003C/p>\n\u003Cul>\n\u003Cli>\n\u003Cp>Add your logo inside \u003Ccode>src/assets\u003C/code> directory. (eg: \u003Ccode>src/assets/dummy-logo.png\u003C/code>)\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Import \u003Ccode>Image\u003C/code> and your logo in \u003Ccode>Header.astro\u003C/code>\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"astro\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { Image } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">astro:assets\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> dummyLogo \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@/assets/dummy-logo.png\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/components/Header.astro\u003C/span>\u003C/pre>\n\u003C/li>\n\u003Cli>\n\u003Cp>Then, replace \u003Ccode>{SITE.title}\u003C/code> with imported logo.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"html\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">a\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  href\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  class\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">absolute py-1 text-left text-2xl leading-7 font-semibold whitespace-nowrap sm:static\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FFFFFF\">image\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> src\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">{dummyLogo}\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> alt\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Dummy Blog\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> class\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark:invert\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  &#x3C;!-- {SITE.title} -->\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003C/ul>\n\u003Cp>With this approach, you can still adjust your image’s appearance using CSS classes. However, this might not always fit what you want. If you need to display different logo images based on light or dark mode, check how light/dark icons are handled inside the \u003Ccode>Header.astro\u003C/code> component.\u003C/p>\n\u003Ch2 id=\"configuring-social-links\">Configuring social links\u003C/h2>\n\u003Cp>\u003Cimg src=\"https://github.com/user-attachments/assets/8b895400-d088-442f-881b-02d2443e00cf\" alt=\"An arrow pointing at social link icons\">\u003C/p>\n\u003Cp>You can configure social links in \u003Ccode>SOCIALS\u003C/code> object inside \u003Ccode>constants.ts\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> SOCIALS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    name\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">GitHub\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    href\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://github.com/satnaing/astro-paper\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    linkTitle\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\"> ${\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">SITE\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">title\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\"> on GitHub\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    icon\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> IconGitHub\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    name\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">X\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    href\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://x.com/username\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    linkTitle\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">SITE\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">title\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\"> on X\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    icon\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> IconBrandX\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    name\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">LinkedIn\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    href\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://www.linkedin.com/in/username/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    linkTitle\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">SITE\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">title\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\"> on LinkedIn\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    icon\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> IconLinkedin\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    name\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Mail\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    href\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">mailto:yourmail@gmail.com\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    linkTitle\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">Send an email to \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">SITE\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">title\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    icon\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> IconMail\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/constants.ts\u003C/span>\u003C/pre>\n\u003Ch2 id=\"configuring-share-links\">Configuring share links\u003C/h2>\n\u003Cp>You can configure share links in \u003Ccode>SHARE_LINKS\u003C/code> object inside \u003Ccode>src/constants.ts\u003C/code>.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://github.com/user-attachments/assets/4f930b68-b625-45df-8c41-e076dd2b838e\" alt=\"An arrow pointing at share link icons\">\u003C/p>\n\u003Ch2 id=\"conclusion\">Conclusion\u003C/h2>\n\u003Cp>This is the brief specification of how you can customize this theme. You can customize more if you know some coding. For customizing styles, please read \u003Ca href=\"https://astro-paper.pages.dev/posts/customizing-astropaper-theme-color-schemes/\">this article\u003C/a>. Thanks for reading.✌🏻\u003C/p>",{"headings":189,"localImagePaths":216,"remoteImagePaths":217,"frontmatter":218,"imagePaths":222},[190,191,194,197,200,203,206,209,212,215],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":192,"text":193},"configuring-site","Configuring SITE",{"depth":31,"slug":195,"text":196},"update-layout-width","Update layout width",{"depth":31,"slug":198,"text":199},"configuring-logo-or-title","Configuring logo or title",{"depth":47,"slug":201,"text":202},"option-1-site-title-text","Option 1: SITE title text",{"depth":47,"slug":204,"text":205},"option-2-astros-svg-component","Option 2: Astro’s SVG component",{"depth":47,"slug":207,"text":208},"option-3-astros-image-component","Option 3: Astro’s Image component",{"depth":31,"slug":210,"text":211},"configuring-social-links","Configuring social links",{"depth":31,"slug":213,"text":214},"configuring-share-links","Configuring share links",{"depth":31,"slug":129,"text":130},[],[],{"author":14,"pubDatetime":219,"modDatetime":220,"title":178,"slug":173,"featured":179,"draft":18,"tags":221,"description":182},["Date","2022-09-23T04:58:53.000Z"],["Date","2025-03-20T03:15:57.792Z"],[181,20],[],"how-to-integrate-giscus-comments",{"id":223,"data":225,"body":233,"filePath":234,"digest":235,"rendered":236},{"author":226,"pubDatetime":227,"modDatetime":228,"title":229,"featured":18,"draft":18,"tags":230,"description":232},"FjellOverflow",["Date","2024-07-25T11:11:53.000Z"],["Date","2025-03-12T12:28:53.000Z"],"How to integrate Giscus comments into AstroPaper",[231,9,20],"astro","Comment function on a static blog hosted on GitHub Pages with Giscus.","Hosting a thin static blog on a platform like [GitHub Pages](https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site) has numerous advantages, but also takes away some interactivity. Fortunately, [Giscus](https://giscus.app/) exists and offers a way to embed user comments on static sites.\n\n## Table of contents\n\n## How _Giscus_ works\n\n[Giscus uses the GitHub API](https://github.com/giscus/giscus?tab=readme-ov-file#how-it-works) to read and store comments made by _GitHub_ users in the `Discussions` associated with a repository.\n\nEmbed the _Giscus_ client-side script bundle on your site, configure it with the correct repository URL, and users can view and write comments (when logged into _GitHub_).\n\nThe approach is serverless, as the comments are stored on _GitHub_ and dynamically loaded from there on client side, hence perfect for a static blog, like _AstroPaper_.\n\n## Setting up _Giscus_\n\n_Giscus_ can be set up easily on [giscus.app](https://giscus.app/), but I will outline the process shortly still.\n\n### Prerequisites\n\nPrerequisites to get _Giscus_ working are\n\n- the repository is [public](https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/managing-repository-settings/setting-repository-visibility#making-a-repository-public)\n- the [Giscus app](https://github.com/apps/giscus) is installed\n- the [Discussions](https://docs.github.com/en/github/administering-a-repository/managing-repository-settings/enabling-or-disabling-github-discussions-for-a-repository) feature is turned on for your repository\n\nIf any of these conditions cannot be fulfilled for any reason, unfortunately, _Giscus_ cannot be integrated.\n\n### Configuring _Giscus_\n\nNext, configuring _Giscus_ is necessary. In most cases, the preselected defaults are suitable, and you should only modify them if you have a specific reason and know what you are doing. Don't worry too much about making the wrong choices; you can always adjust the configuration later on.\n\nHowever you need to\n\n- select the right language for the UI\n- specify the _GitHub_ repository you want to connect, typically the repository containing your statically hosted _AstroPaper_ blog on _GitHub Pages_\n- create and set an `Announcement` type discussion on _GitHub_ if you want to ensure nobody can create random comments directly on _GitHub_\n- define the color scheme\n\nAfter configuring the settings, _Giscus_ provides you with a generated `\u003Cscript>` tag, which you will need in the next steps.\n\n## Simple script tag\n\nYou should now have a script tag that looks like this:\n\n```html\n\u003Cscript\n  src=\"https://giscus.app/client.js\"\n  data-repo=\"[ENTER REPO HERE]\"\n  data-repo-id=\"[ENTER REPO ID HERE]\"\n  data-category=\"[ENTER CATEGORY NAME HERE]\"\n  data-category-id=\"[ENTER CATEGORY ID HERE]\"\n  data-mapping=\"pathname\"\n  data-strict=\"0\"\n  data-reactions-enabled=\"1\"\n  data-emit-metadata=\"0\"\n  data-input-position=\"bottom\"\n  data-theme=\"preferred_color_scheme\"\n  data-lang=\"en\"\n  crossorigin=\"anonymous\"\n  async\n>\u003C/script>\n```\n\nSimply add that to the source code of the site. Most likely, if you're using _AstroPaper_ and want to enable comments on posts, navigate to `PostDetails.astro` and paste it into the desired location where you want the comments to appear, perhaps underneath the `Share this post on:` buttons.\n\n```astro file=src/layouts/PostDetails.astro\n\u003CLayout {...layoutProps}>\n  \u003Cmain>\n    \u003CShareLinks />\n\n    \u003C!-- [!code ++:6] -->\n    \u003Cscript\n      src=\"https://giscus.app/client.js\"\n      data-repo=\"[ENTER REPO HERE]\"\n      data-repo-id=\"[ENTER REPO ID HERE]\"\n      data-category=\"[ENTER CATEGORY NAME HERE]\"\n      data-category-id=\"[ENTER CATEGORY ID HERE]\">\u003C/script>\n  \u003C/main>\n  \u003CFooter />\n\u003C/Layout>\n```\n\nAnd it's done! You have successfully integrated comments in _AstroPaper_!\n\n## React component with light/dark theme\n\nThe embedded script tag in the layout is quite static, with the _Giscus_ configuration, including `theme`, hardcoded into the layout. Given that _AstroPaper_ features a light/dark theme toggle, it would be nice for the comments to seamlessly transition between light and dark themes along with the rest of the site. To achieve this, a more sophisticated approach to embedding _Giscus_ is required.\n\nFirstly, we are going to install the [React component](https://www.npmjs.com/package/@giscus/react) for _Giscus_:\n\n```bash\nnpm i @giscus/react && npx astro add react\n```\n\nThen we create a new `Comments.tsx` React component in `src/components`:\n\n```tsx file=src/components/Comments.tsx\nimport Giscus, { type Theme } from \"@giscus/react\";\nimport { GISCUS } from \"@/constants\";\nimport { useEffect, useState } from \"react\";\n\ninterface CommentsProps {\n  lightTheme?: Theme;\n  darkTheme?: Theme;\n}\n\nexport default function Comments({\n  lightTheme = \"light\",\n  darkTheme = \"dark\",\n}: CommentsProps) {\n  const [theme, setTheme] = useState(() => {\n    const currentTheme = localStorage.getItem(\"theme\");\n    const browserTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n      .matches\n      ? \"dark\"\n      : \"light\";\n\n    return currentTheme || browserTheme;\n  });\n\n  useEffect(() => {\n    const mediaQuery = window.matchMedia(\"(prefers-color-scheme: dark)\");\n    const handleChange = ({ matches }: MediaQueryListEvent) => {\n      setTheme(matches ? \"dark\" : \"light\");\n    };\n\n    mediaQuery.addEventListener(\"change\", handleChange);\n\n    return () => mediaQuery.removeEventListener(\"change\", handleChange);\n  }, []);\n\n  useEffect(() => {\n    const themeButton = document.querySelector(\"#theme-btn\");\n    const handleClick = () => {\n      setTheme(prevTheme => (prevTheme === \"dark\" ? \"light\" : \"dark\"));\n    };\n\n    themeButton?.addEventListener(\"click\", handleClick);\n\n    return () => themeButton?.removeEventListener(\"click\", handleClick);\n  }, []);\n\n  return (\n    \u003Cdiv className=\"mt-8\">\n      \u003CGiscus theme={theme === \"light\" ? lightTheme : darkTheme} {...GISCUS} />\n    \u003C/div>\n  );\n}\n```\n\nThis _React_ component not only wraps the native _Giscus_ component, but also introduces additional props, namely `lightTheme` and `darkTheme`. Leveraging two event listeners, the _Giscus_ comments will align with the site's theme, dynamically switching between dark and light themes whenever the site or browser theme is changed.\n\nWe also need to define the `GISCUS` config, for which the optimal location is in `constants.ts`:\n\n```ts file=src/constants.ts\nimport type { GiscusProps } from \"@giscus/react\";\n\n...\n\nexport const GISCUS: GiscusProps = {\n  repo: \"[ENTER REPO HERE]\",\n  repoId: \"[ENTER REPO ID HERE]\",\n  category: \"[ENTER CATEGORY NAME HERE]\",\n  categoryId: \"[ENTER CATEGORY ID HERE]\",\n  mapping: \"pathname\",\n  reactionsEnabled: \"0\",\n  emitMetadata: \"0\",\n  inputPosition: \"bottom\",\n  lang: \"en\",\n  loading: \"lazy\",\n};\n```\n\nNote that specifying a `theme` here will override the `lightTheme` and `darkTheme` props, resulting in a static theme setting, similar to the previous approach of embedding _Giscus_ with the `\u003Cscript>` tag.\n\nTo complete the process, add the new Comments component to `PostDetails.astro` (replacing the `script` tag from the previous step).\n\n```jsx file=src/layouts/PostDetails.astro\n// [!code ++:1]\nimport Comments from \"@/components/Comments\";\n\n\u003CShareLinks />\n\n// [!code ++:1]\n\u003CComments client:only=\"react\" />\n\n\u003Chr class=\"my-6 border-dashed\" />\n\n\u003CFooter />\n```\n\nAnd that's it!","src/data/blog/how-to-integrate-giscus-comments.md","341b98bca44bc4f9",{"html":237,"metadata":238},"\u003Cp>Hosting a thin static blog on a platform like \u003Ca href=\"https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site\">GitHub Pages\u003C/a> has numerous advantages, but also takes away some interactivity. Fortunately, \u003Ca href=\"https://giscus.app/\">Giscus\u003C/a> exists and offers a way to embed user comments on static sites.\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#how-giscus-works\">How \u003Cem>Giscus\u003C/em> works\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#setting-up-giscus\">Setting up \u003Cem>Giscus\u003C/em>\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#prerequisites\">Prerequisites\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#configuring-giscus\">Configuring \u003Cem>Giscus\u003C/em>\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#simple-script-tag\">Simple script tag\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#react-component-with-lightdark-theme\">React component with light/dark theme\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"how-giscus-works\">How \u003Cem>Giscus\u003C/em> works\u003C/h2>\n\u003Cp>\u003Ca href=\"https://github.com/giscus/giscus?tab=readme-ov-file#how-it-works\">Giscus uses the GitHub API\u003C/a> to read and store comments made by \u003Cem>GitHub\u003C/em> users in the \u003Ccode>Discussions\u003C/code> associated with a repository.\u003C/p>\n\u003Cp>Embed the \u003Cem>Giscus\u003C/em> client-side script bundle on your site, configure it with the correct repository URL, and users can view and write comments (when logged into \u003Cem>GitHub\u003C/em>).\u003C/p>\n\u003Cp>The approach is serverless, as the comments are stored on \u003Cem>GitHub\u003C/em> and dynamically loaded from there on client side, hence perfect for a static blog, like \u003Cem>AstroPaper\u003C/em>.\u003C/p>\n\u003Ch2 id=\"setting-up-giscus\">Setting up \u003Cem>Giscus\u003C/em>\u003C/h2>\n\u003Cp>\u003Cem>Giscus\u003C/em> can be set up easily on \u003Ca href=\"https://giscus.app/\">giscus.app\u003C/a>, but I will outline the process shortly still.\u003C/p>\n\u003Ch3 id=\"prerequisites\">Prerequisites\u003C/h3>\n\u003Cp>Prerequisites to get \u003Cem>Giscus\u003C/em> working are\u003C/p>\n\u003Cul>\n\u003Cli>the repository is \u003Ca href=\"https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/managing-repository-settings/setting-repository-visibility#making-a-repository-public\">public\u003C/a>\u003C/li>\n\u003Cli>the \u003Ca href=\"https://github.com/apps/giscus\">Giscus app\u003C/a> is installed\u003C/li>\n\u003Cli>the \u003Ca href=\"https://docs.github.com/en/github/administering-a-repository/managing-repository-settings/enabling-or-disabling-github-discussions-for-a-repository\">Discussions\u003C/a> feature is turned on for your repository\u003C/li>\n\u003C/ul>\n\u003Cp>If any of these conditions cannot be fulfilled for any reason, unfortunately, \u003Cem>Giscus\u003C/em> cannot be integrated.\u003C/p>\n\u003Ch3 id=\"configuring-giscus\">Configuring \u003Cem>Giscus\u003C/em>\u003C/h3>\n\u003Cp>Next, configuring \u003Cem>Giscus\u003C/em> is necessary. In most cases, the preselected defaults are suitable, and you should only modify them if you have a specific reason and know what you are doing. Don’t worry too much about making the wrong choices; you can always adjust the configuration later on.\u003C/p>\n\u003Cp>However you need to\u003C/p>\n\u003Cul>\n\u003Cli>select the right language for the UI\u003C/li>\n\u003Cli>specify the \u003Cem>GitHub\u003C/em> repository you want to connect, typically the repository containing your statically hosted \u003Cem>AstroPaper\u003C/em> blog on \u003Cem>GitHub Pages\u003C/em>\u003C/li>\n\u003Cli>create and set an \u003Ccode>Announcement\u003C/code> type discussion on \u003Cem>GitHub\u003C/em> if you want to ensure nobody can create random comments directly on \u003Cem>GitHub\u003C/em>\u003C/li>\n\u003Cli>define the color scheme\u003C/li>\n\u003C/ul>\n\u003Cp>After configuring the settings, \u003Cem>Giscus\u003C/em> provides you with a generated \u003Ccode>&#x3C;script>\u003C/code> tag, which you will need in the next steps.\u003C/p>\n\u003Ch2 id=\"simple-script-tag\">Simple script tag\u003C/h2>\n\u003Cp>You should now have a script tag that looks like this:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"html\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">script\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  src\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://giscus.app/client.js\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-repo\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER REPO HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-repo-id\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER REPO ID HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-category\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER CATEGORY NAME HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-category-id\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER CATEGORY ID HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-mapping\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">pathname\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-strict\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">0\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-reactions-enabled\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">1\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-emit-metadata\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">0\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-input-position\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">bottom\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">preferred_color_scheme\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  data-lang\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">en\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  crossorigin\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">anonymous\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  async\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>&#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">script\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Simply add that to the source code of the site. Most likely, if you’re using \u003Cem>AstroPaper\u003C/em> and want to enable comments on posts, navigate to \u003Ccode>PostDetails.astro\u003C/code> and paste it into the desired location where you want the comments to appear, perhaps underneath the \u003Ccode>Share this post on:\u003C/code> buttons.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-diff mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"astro\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">Layout\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> {\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">...\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">layoutProps\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">}>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">main\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">ShareLinks\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">script\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">      src\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">https://giscus.app/client.js\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">      data-repo\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER REPO HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">      data-repo-id\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER REPO ID HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">      data-category\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER CATEGORY NAME HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">      data-category-id\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER CATEGORY ID HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>&#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">script\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">main\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">Footer\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">Layout\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/layouts/PostDetails.astro\u003C/span>\u003C/pre>\n\u003Cp>And it’s done! You have successfully integrated comments in \u003Cem>AstroPaper\u003C/em>!\u003C/p>\n\u003Ch2 id=\"react-component-with-lightdark-theme\">React component with light/dark theme\u003C/h2>\n\u003Cp>The embedded script tag in the layout is quite static, with the \u003Cem>Giscus\u003C/em> configuration, including \u003Ccode>theme\u003C/code>, hardcoded into the layout. Given that \u003Cem>AstroPaper\u003C/em> features a light/dark theme toggle, it would be nice for the comments to seamlessly transition between light and dark themes along with the rest of the site. To achieve this, a more sophisticated approach to embedding \u003Cem>Giscus\u003C/em> is required.\u003C/p>\n\u003Cp>Firstly, we are going to install the \u003Ca href=\"https://www.npmjs.com/package/@giscus/react\">React component\u003C/a> for \u003Cem>Giscus\u003C/em>:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">npm\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> i\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> @giscus/react\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> npx\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> astro\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> add\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> react\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Then we create a new \u003Ccode>Comments.tsx\u003C/code> React component in \u003Ccode>src/components\u003C/code>:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"tsx\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Giscus\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">type\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Theme } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@giscus/react\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { GISCUS } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@/constants\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { useEffect\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> useState } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">react\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">interface\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> CommentsProps\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  lightTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Theme\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  darkTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Theme\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> default\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Comments\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  lightTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  darkTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> CommentsProps\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">theme\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> setTheme\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> useState\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> currentTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> localStorage\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getItem\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">theme\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> browserTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> window\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">matchMedia\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">(prefers-color-scheme: dark)\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      .\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">matches\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      ?\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      :\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> currentTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ||\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> browserTheme\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  useEffect\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> mediaQuery\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> window\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">matchMedia\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">(prefers-color-scheme: dark)\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> handleChange\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\"> matches\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic\"> MediaQueryListEvent\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      setTheme\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">matches\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">    }\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">    mediaQuery\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">addEventListener\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">change\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> handleChange);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> mediaQuery\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">removeEventListener\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">change\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> handleChange);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> []);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  useEffect\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> themeButton\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> document\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">querySelector\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">#theme-btn\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> handleClick\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      setTheme\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">prevTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">prevTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">    }\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">    themeButton\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">?.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">addEventListener\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">click\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> handleClick);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> themeButton\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">?.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">removeEventListener\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">click\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> handleClick);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> []);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> className\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">mt-8\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">Giscus\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> lightTheme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> darkTheme\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\"> {\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">...\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">GISCUS\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    &#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/components/Comments.tsx\u003C/span>\u003C/pre>\n\u003Cp>This \u003Cem>React\u003C/em> component not only wraps the native \u003Cem>Giscus\u003C/em> component, but also introduces additional props, namely \u003Ccode>lightTheme\u003C/code> and \u003Ccode>darkTheme\u003C/code>. Leveraging two event listeners, the \u003Cem>Giscus\u003C/em> comments will align with the site’s theme, dynamically switching between dark and light themes whenever the site or browser theme is changed.\u003C/p>\n\u003Cp>We also need to define the \u003Ccode>GISCUS\u003C/code> config, for which the optimal location is in \u003Ccode>constants.ts\u003C/code>:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> type\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { GiscusProps } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@giscus/react\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> GISCUS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic\"> GiscusProps\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  repo\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER REPO HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  repoId\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER REPO ID HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  category\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER CATEGORY NAME HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  categoryId\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[ENTER CATEGORY ID HERE]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  mapping\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">pathname\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  reactionsEnabled\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">0\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  emitMetadata\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">0\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  inputPosition\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">bottom\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  lang\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">en\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  loading\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">lazy\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/constants.ts\u003C/span>\u003C/pre>\n\u003Cp>Note that specifying a \u003Ccode>theme\u003C/code> here will override the \u003Ccode>lightTheme\u003C/code> and \u003Ccode>darkTheme\u003C/code> props, resulting in a static theme setting, similar to the previous approach of embedding \u003Cem>Giscus\u003C/em> with the \u003Ccode>&#x3C;script>\u003C/code> tag.\u003C/p>\n\u003Cp>To complete the process, add the new Comments component to \u003Ccode>PostDetails.astro\u003C/code> (replacing the \u003Ccode>script\u003C/code> tag from the previous step).\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-diff mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"jsx\">\u003Ccode>\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Comments \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@/components/Comments\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">ShareLinks\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">Comments\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> client\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">only\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">react\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">hr\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> class\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">my-6 border-dashed\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">Footer\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/layouts/PostDetails.astro\u003C/span>\u003C/pre>\n\u003Cp>And that’s it!\u003C/p>",{"headings":239,"localImagePaths":259,"remoteImagePaths":260,"frontmatter":261,"imagePaths":265},[240,241,244,247,250,253,256],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":242,"text":243},"how-giscus-works","How Giscus works",{"depth":31,"slug":245,"text":246},"setting-up-giscus","Setting up Giscus",{"depth":47,"slug":248,"text":249},"prerequisites","Prerequisites",{"depth":47,"slug":251,"text":252},"configuring-giscus","Configuring Giscus",{"depth":31,"slug":254,"text":255},"simple-script-tag","Simple script tag",{"depth":31,"slug":257,"text":258},"react-component-with-lightdark-theme","React component with light/dark theme",[],[],{"author":226,"pubDatetime":262,"modDatetime":263,"title":229,"slug":223,"featured":18,"draft":18,"tags":264,"description":232},["Date","2024-07-25T11:11:53.000Z"],["Date","2025-03-12T12:28:53.000Z"],[231,9,20],[],"compressed-fixedvec",{"id":266,"data":268,"body":276,"filePath":277,"digest":278,"rendered":279},{"author":269,"pubDatetime":270,"title":271,"featured":179,"draft":18,"tags":272,"description":275},"Luca Lombardo",["Date","2025-09-24T00:00:00.000Z"],"Engineering a fixed-width bit-packed Integer Vector in Rust",[273,274],"Rust","Succinct Data Structures","Design and implementation of a memory-efficient, fixed-width bit-packed integer vector in Rust, with extremely fast random access.","If you've ever worked with massive datasets, you know that memory usage can quickly become a bottleneck. While developing succinct data structures, I found myself needing to store large arrays of integers—values with no monotonicity or other exploitable patterns, that I knew came from a universe much smaller than their type's theoretical capacity.\n\nIn this post, we will explore the engineering challenges involved in implementing an efficient vector-like data structure in Rust that stores integers in a compressed, bit-packed format. We will focus on achieving O(1) random access performance while minimizing memory usage. We will try to mimic the ergonomics of Rust's standard `Vec\u003CT>` as closely as possible, including support for mutable access and zero-copy slicing.\n\n\n* All the code can be found on github: [compressed-intvec](https://github.com/lukefleed/compressed-intvec)\n* This is also published as a crate on crates.io: [compressed-intvec](https://crates.io/crates/compressed-intvec)\n\nYou can discuss this post on [Hacker News](https://news.ycombinator.com/item?id=45361578), [Lobsters](https://lobste.rs/s/u1rffj/engineering_fixed_width_bit_packed) or [Reddit](https://www.reddit.com/r/rust/comments/1npf41d/engineering_a_fixedwidth_bitpacked_integer_vector/).\n\n---\n\n# Memory Waste in Standard Vectors\n\nIn Rust, the contract of a `Vec\u003CT>` (where `T` is a primitive integer type like `u64` or `i32`) is simple: O(1) random access in exchange for a memory layout that is tied to the static size of `T`. This is a good trade-off, until it isn't. When the dynamic range of the stored values is significantly smaller than the type's capacity, this memory layout leads to substantial waste.\n\nConsider storing the value `5` within a `Vec\u003Cu64>`. Its 8-byte in-memory representation is:\n\n\u003Cdiv align=\"center\">\n\n`00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000101`\n\n\u003C/div>\n\nOnly 3 bits are necessary to represent the value, leaving 61 bits as zero-padding. The same principle applies, albeit less dramatically, when storing `5` in a `u32` or `u16`. At scale, this overhead becomes prohibitive. A vector of one billion `u64` elements consumes `10^9 * std::mem::size_of::\u003Cu64>()`, or approximately 8 GB of memory, even if every element could fit within a single byte.\n\nThe canonical solution is bit packing, which aligns data end-to-end in a contiguous bitvector. However, this optimization has historically come at the cost of random access performance. The O(1) access guarantee of `Vec\u003CT>` is predicated on simple pointer arithmetic: `address = base_address + index * std::mem::size_of::\u003CT>()`. Tightly packing the bits invalidates this direct address calculation, seemingly forcing a trade-off between memory footprint and access latency.\n\nThis raises the central question that with this post we aim to answer: is it possible to design a data structure that decouples its memory layout from the static size of `T`, adapting instead to the data's true dynamic range, without sacrificing the O(1) random access that makes `Vec\u003CT>` so effective?\n\n# Packing and Accessing Bits\n\nIf the dynamic range of our data is known, we can define a fixed `bit_width` for every integer. For instance, if the maximum value in a dataset is `1000`, we know every number can be represented in 10 bits, since `2^10 = 1024`. Instead of allocating 64 bits per element, we can store them back-to-back in a contiguous bitvector, forming the core of what from now on we'll refer as `FixedVec`. We can immagine such data strucutre as a logical array of `N` integers, each `bit_width` bits wide, stored in a backing buffer of `u64` words.\n\n```rust\nstruct FixedVec {\n    limbs: Vec\u003Cu64>, // Backing storage\n    bit_width: usize, // Number of bits per element\n    len: usize, // Number of elements\n    mask: u64, // Precomputed mask for extraction\n}\n```\n\nWhere the role of the `mask` field is to isolate the relevant bits during extraction. For a `bit_width` of 10, the mask would be `0b1111111111`.\n\nThis immediately solves the space problem, but how can we find the `i`-th element in O(1) time if it doesn't align to a byte boundary? The answer lies in simple arithmetic. The starting bit position of any element is a direct function of its index. Given a backing store of `u64` words, we can locate any value by calculating its absolute bit position and then mapping that to a specific word and an offset within that word.\n\n```rust\nlet bit_pos = index * bit_width; // Absolute bit position of the value\nlet word_index = bit_pos / 64; // Which u64 word to read\nlet bit_offset = bit_pos % 64; // Where the value starts in that word\n```\n\nWith these values, the implementation of `get_unchecked` becomes straightforward. It's a two-step process: fetch the correct word from our backing `Vec\u003Cu64>`, then use bitwise operations to isolate the specific bits we need.\n\n```rust\n// A simplified look at the core get_unchecked logic\nunsafe fn get_unchecked(&self, index: usize) -> u64 {\n    let bit_width = self.bit_width();\n    let bit_pos = index * bit_width;\n    let word_index = bit_pos / 64;\n    let bit_offset = bit_pos % 64;\n\n    // 1. Fetch the word from the backing store\n    let word = *self.limbs.get_unchecked(word_index);\n\n    // 2. Shift and mask to extract the value\n    (word >> bit_offset) & self.mask\n}\n```\n\nLet's trace an access with `bit_width = 10` for the element at `index = 7`. The starting bit position is `7 * 10 = 70`. This maps to `word_index = 1` and `bit_offset = 6`. Our 10-bit integer begins at the 6th bit of the *second* `u64` word in our storage.\n\nThe right-shift `>>` operation moves the bits of the entire `u64` word to the right by `bit_offset` positions. This aligns the start of our desired 10-bit value with the least significant bit (LSB) of the word. The final step is to isolate our value. A pre-calculated `mask` (e.g., `0b1111111111` for 10 bits) is applied with a bitwise AND `&`. This zeroes out any high-order bits from the word, leaving just our target integer.\n\n\n## Crossing Word Boundaries\n\nThe single-word access logic is fast, but it only works as long as `bit_offset + bit_width \u003C= 64`. This assumption breaks down as soon as an integer's bit representation needs to cross the boundary from one `u64` word into the next. This is guaranteed to happen for any `bit_width` that is not a power of two. For example, with a 10-bit width, the element at `index = 6` starts at bit position 60. Its 10 bits will occupy bits 60-63 of the first word and bits 0-5 of the second. The simple right-shift-and-mask trick fails here.\n\n![crossing word boundaries](/assets/fixedvec.svg)\n\nTo correctly decode the value, we must read *two* consecutive `u64` words and combine their bits. This splits our `get_unchecked` implementation into two paths. The first is the fast path we've already seen. The second is a new path for spanning values.\n\nTo get the lower bits of the value, we read the first word and shift right, just as before. This leaves the upper bits of the word as garbage.\n\n```rust\nlet low_part = *limbs.get_unchecked(word_index) >> bit_offset;\n```\n\nTo get the upper bits of the value, we read the *next* word. The bits we need are at the beginning of this word, so we shift them left to align them correctly.\n\n```rust\nlet high_part = *limbs.get_unchecked(word_index + 1) \u003C\u003C (64 - bit_offset);\n```\n\nFinally, we combine the two parts with a bitwise OR and apply the mask to discard any remaining high-order bits from the `high_part`.\n\n```rust\n(low_part | high_part) & self.mask\n```\n\nThe line `limbs.get_unchecked(word_index + 1)` introduces a safety concern: if we are reading the last element of the vector, `word_index + 1` could point past the end of our buffer, leading to undefined behavior. To prevent this, our builder must always allocate one extra padding word at the end of the storage.\n\nIntegrating these two paths gives us our final `get_unchecked` implementation:\n\n```rust\npub unsafe fn get_unchecked(&self, index: usize) -> u64 {\n    let bit_width = self.bit_width;\n    let bit_pos = index * bit_width;\n    let word_index = bit_pos / 64;\n    let bit_offset = bit_pos % 64;\n\n    let limbs = self.bits.as_ref();\n\n    if bit_offset + bit_width \u003C= 64 {\n        // Fast path: value is fully within one word\n        (*limbs.get_unchecked(word_index) >> bit_offset) & self.mask\n    } else {\n        // Slow path: value spans two words.\n        let low_part = *limbs.get_unchecked(word_index) >> bit_offset;\n        let high_part = *limbs.get_unchecked(word_index + 1) \u003C\u003C (64 - bit_offset);\n        (low_part | high_part) & self.mask\n    }\n}\n```\n\n## Faster Reads: Unaligned Access\n\nOur `get_unchecked` implementation is correct, but the slow path for spanning values requires two separate, aligned memory reads. The instruction sequence for this method involves at least two load instructions, multiple shifts, and a bitwise OR. These instructions have data dependencies: the shifts cannot execute until the loads complete, and the OR cannot execute until both shifts are done. This dependency chain can limit the CPU's instruction-level parallelism and create pipeline stalls if the memory accesses miss the L1 cache.\n\nLet's have a look at the machine code generated by this method. We can create a minimal binary with an `#[inline(never)]` function that calls `get_unchecked` on a known spanning index, then use [`cargo asm`](https://crates.io/crates/cargo-asm) to inspect the disassembly.\n\n```asm\n; asm_test::aligned::get_aligned (spanning path)\n.LBB14_2:\n        ; let low = *limbs.get_unchecked(word_index) >> bit_offset;\n        mov rsi, qword ptr [r8 + 8*rdx]      ; \u003C\u003C\u003C LOAD #1 (low_part)\n\n        ; let high = *limbs.get_unchecked(word_index + 1) \u003C\u003C (64 - bit_offset);\n        mov rdx, qword ptr [r8 + 8*rdx + 8]  ; \u003C\u003C\u003C LOAD #2 (high_part)\n\n        shr rsi, cl                          ; shift right of low_part\n        shl rdx, cl                          ; shift left of high_part\n        or rdx, rsi                          ; combine results\n```\n\nThe instruction `mov rsi, qword ptr [r8 + 8*rdx]` is our first memory access. It loads a 64-bit value (`qword`) into the `rsi` register. The address is calculated using base-plus-index addressing: `r8` holds the base address of our `limbs` buffer, and `rdx` holds the `word_index`. This corresponds directly to `limbs[word_index]`.\n\nImmediately following is `mov rdx, qword ptr [r8 + 8*rdx + 8]`. This is our second, distinct memory access. It loads the *next* 64-bit word from memory by adding an 8-byte offset to the previous address. This corresponds to `limbs[word_index + 1]`.\n\nOnly after both of these `mov` instructions complete can the CPU proceed. The `shr rsi, cl` instruction (shift right `rsi` by the count in `cl`) cannot execute until the first `mov` has placed a value in `rsi`. Similarly, `shl rdx, cl` depends on the second `mov`. Finally, `or rdx, rsi` depends on both shifts.\n\nThis sequence of operations—loading two adjacent 64-bit words, shifting each, and combining them is a software implementation of what is, conceptually, a [128-bit barrel shifter](https://en.wikipedia.org/wiki/Barrel_shifter). We are selecting a 64-bit window from a virtual 128-bit integer formed by concatenating the two words from memory.\n\n**Can we do better then this?** Potentially, yes. We can replace this multi-instruction sequence with something more direct by delegating the complexity to the hardware and performing a single unaligned memory read. Modern x86-64 CPUs handle this directly: when an unaligned load instruction is issued, the CPU's memory controller fetches the necessary cache lines and the load/store unit reassembles the bytes into the target register. This entire process is a single, optimized micro-operation.\n\nWe can try to implement a more aggressive access method. The strategy is to calculate the exact *byte* address where our data begins and perform a single, unaligned read of a full `W` word from that position.\n\nThe implementation first translates the absolute bit position into a byte address and a residual bit offset within that byte.\n\n```rust\nlet bit_pos = index * self.bit_width;\nlet byte_pos = bit_pos / 8;\nlet bit_rem = bit_pos % 8;\n```\n\nWith the byte-level address, we get a raw `*const u8` pointer to our storage and perform the unaligned read. The [read_unaligned](https://doc.rust-lang.org/std/ptr/fn.read_unaligned.html) intrinsic in Rust compiles down to a single machine instruction that the hardware can execute efficiently.\n\n```rust\nlet limbs_ptr = self.as_limbs().as_ptr() as *const u8;\n// This read may cross hardware word boundaries, but the CPU handles it.\nlet word: W = (limbs_ptr.add(byte_pos) as *const W).read_unaligned();\n```\n\nOn a Little-Endian system, the loaded `word` now contains our target integer, but it's shifted by `bit_rem` positions. A simple right shift aligns our value to the LSB, and applying the mask isolates it.\n\n```rust\nlet extracted_word = word >> bit_rem;\nlet final_value = extracted_word & self.mask;\n```\n\nThis operation is safe only because, as said before, we are supposing that our builder guarantees a padding word at the end of the storage buffer. Combining all these steps, we get our final implementation:\n\n```rust\npub unsafe fn get_unaligned_unchecked(&self, index: usize) -> u64 {\n    let bit_pos = index * self.bit_width;\n    let byte_pos = bit_pos / 8;\n    let bit_rem = bit_pos % 8;\n\n    let limbs_ptr = self.as_limbs().as_ptr() as *const u8;\n    // SAFETY: The builder guarantees an extra padding word at the end.\n    let word = (limbs_ptr.add(byte_pos) as *const W).read_unaligned();\n    let extracted_word = word >> bit_rem;\n    extracted_word & self.mask\n}\n```\n\nLet's have a look at the generated machine code for this new method when accessing an index that spans words:\n\n```asm\n; asm_test::unaligned::get_unaligned\n.LBB15_1:\n        ; let bit_pos = index * self.bit_width;\n        imul rcx, rax\n        ; let byte_pos = bit_pos / 8;\n        mov rax, rcx\n        shr rax, 3\n        ; self.bits.as_ref()\n        mov rdx, qword ptr [rdi + 8]\n        ; unsafe { crate::intrinsics::copy_nonoverlapping(src, dst, count) }\n        mov rax, qword ptr [rdx + rax]       ; \u003C\u003C\u003C SINGLE UNALIGNED LOAD\n        ; self >> other\n        and cl, 7\n        shr rax, cl\n        ; fn bitand(self, rhs: $t) -> $t { self & rhs }\n        and rax, qword ptr [rdi + 32]\n```\n\nThe initial `imul` and `shr rax, 3` (a fast division by 8) correspond to the calculation of `byte_pos`. The instruction `mov rdx, qword ptr [rdi + 8]` loads the base address of our `limbs` buffer into the `rdx` register.\n\nThe instruction `mov rax, qword ptr [rdx + rax]` is our single unaligned load. The address `[rdx + rax]` is the sum of the buffer's base address and our calculated `byte_pos`. This `mov` instruction reads 8 bytes (a `qword`) directly from this potentially unaligned memory location into the `rax` register. We can see that as we hoped, the [read_unaligned](https://doc.rust-lang.org/std/ptr/fn.read_unaligned.html) intrinsic has been compiled down to a single hardware instruction.\n\nThe next instructions handle the extraction. The `and cl, 7` and `shr rax, cl` sequence corresponds to our `>> bit_rem`. `cl` holds the lower bits of the original `bit_pos` (our `bit_rem`), and the shift aligns our desired value to the LSB of the `rax` register. Finally, `and rax, qword ptr [rdi + 32]` applies the pre-calculated mask, which is stored at an offset from the `self` pointer in `rdi`.\n\n## Random Access Performance\n\nWe can now benchmark the latency of 1 million random access operations on a vector containing 10 million elements. For each `bit_width`, we generate data with a uniform random distribution in the range `[0, 2^bit_width)`. The code for the benchmark is available here: [`bench-intvec`]\n\nOur baseline is the smallest standard `Vec\u003CT>` capable of holding the data (`Vec\u003Cu8>` for `bit_width \u003C= 8`, etc.). We also include results from [`sux`], [`succinct`], and [`simple-sds-sbwt`] for context. I am not aware of any other Rust crates that implement fixed-width bit-packed integer vectors, so if you know of any, please let me know!\n\n\u003Ciframe src=\"/bench-intvec/fixed_random_access_performance.html\" width=\"100%\" height=\"550px\" style=\"border: none;\">\u003C/iframe>\n\nWe can see that for `bit_width` values below 32, the `get_unaligned_unchecked` of our `FixedVec` is almost always faster than the corresponding `Vec\u003CT>` baseline. This is a result of improved cache locality. A 64-byte L1 cache line can hold 64 elements from a `Vec\u003Cu8>`. With a `bit_width` of 4, the same cache line holds `(64 * 8) / 4 = 128` elements from our `FixedVec`. This increased density improves the cache hit rate for random access patterns, and the latency reduction from avoiding DRAM access outweighs the instruction cost of the bitwise extraction. For values of `bit_width` above 32, the performance of `FixedVec` are *very slightly* worse than the `Vec\u003CT>` baseline, as the cache locality advantage diminishes. However, the memory savings remain.\n\nThe performance delta between `get_unaligned_unchecked` and `get_unchecked` confirms the unaligned access strategy discussed before: a single `read_unaligned` instruction is more efficient than the two dependent aligned reads required by the logic for spanning words.\n\nWe can see that the implementation of [`sux`] is almost on par with ours. The other two crates, [`succinct`] and [`simple-sds-sbwt`], are significantly slower (note that the Y-axis is logarithmic). Tho, it's worth noting that neither of these last two crates provides unchecked or unaligned access methods, so their implementations are inherently more conservative.\n\n[`sux`]: https://docs.rs/sux/latest/sux/bits/bit_field_vec/index.html\n[`succinct`]: https://docs.rs/succinct/latest/succinct/trait.IntVec.html\n[`simple-sds-sbwt`]: https://docs.rs/simple-sds-sbwt/latest/simple_sds_sbwt/int_vector/struct.IntVector.html\n[`bench-intvec`]: https://github.com/lukefleed/compressed-intvec/blob/master/benches/fixed/bench_random_access.rs\n\n## Iterating Over Values\n\nThe most common operation on any `Vec`-like structure is, after all, a simple `for` loop. The simplest way to implement `iter()` would be to just wrap `get()` in a loop:\n\n```rust\n// A naive, inefficient iterator\nfor i in 0..vec.len() {\n    let value = vec.get(i);\n    // ... do something with value\n}\n```\n\nThis works, but it's terribly inefficient. Every single call to `get(i)` independently recalculates the `word_index` and `bit_offset` from scratch. We're throwing away valuable state, our current position in the bitstream, on every iteration, forcing the CPU to perform redundant multiplications and divisions.\n\nWe can think then about a *stateful* iterator. It should operate directly on the bitvector, maintaining its own position. Instead of thinking in terms of logical indices, it should think in terms of a \"bit window\", a local `u64` register that holds the current chunk of bits being processed.\n\nThe idea is simple: the iterator loads one `u64` word from the backing store into its window. It then satisfies `next()` calls by decoding values directly from this in-register window. Only when the window runs out of bits does it need to go back to memory for the next `u64` word. This amortizes the cost of memory access over many `next()` calls.\n\nFor forward iteration, the state is minimal:\n\n```rust\nstruct FixedVecIter\u003C'a, ...> {\n    // ...\n    front_window: u64,\n    front_bits_in_window: usize,\n    front_word_index: usize,\n    // ...\n}\n```\n\nThe `next()` method first checks if the current `front_window` has enough bits to satisfy the request. If `self.front_bits_in_window >= bit_width`, it's the fast path: a simple shift and mask on a register, which is incredibly fast.\n\n```rust\n// Inside next(), fast path:\nif self.front_bits_in_window >= bit_width {\n    let value = self.front_window & self.mask;\n    self.front_window >>= bit_width;\n    self.front_bits_in_window -= bit_width;\n    return Some(value);\n}\n```\n\nIf the window is running low on bits, we hit the slower path. The next value spans the boundary between our current window and the next `u64` word in memory. We must read the next word, combine its bits with the remaining bits in our current window, and then extract the value. This is the same logic as the spanning-word `get()`, but it's performed incrementally.\n\n### Double-Ended Iteration\n\nBut I want my iterator to be bidirectional! Well, then we need to ensure it implements [`DoubleEndedIterator`](https://doc.rust-lang.org/std/iter/trait.DoubleEndedIterator.html) and supports [`next_back()`](https://doc.rust-lang.org/std/iter/trait.DoubleEndedIterator.html#tymethod.next_back). This throws a wrench in our simple stateful model. A single window and cursor can only move in one direction.\n\nThe solution is to maintain two independent sets of state: one for the front and one for the back. The `FixedVecIter` needs to track two windows, two bit counters, and two word indices.\n\n```rust\nstruct FixedVecIter\u003C'a, ...> {\n    // ...\n    front_index: usize,\n    back_index: usize,\n\n    // State for forward iteration\n    front_window: u64,\n    front_bits_in_window: usize,\n    front_word_index: usize,\n\n    // State for backward iteration\n    back_window: u64,\n    back_bits_in_window: usize,\n    back_word_index: usize,\n    // ...\n}\n```\n\nInitializing the front is easy: we load `limbs[0]` into `front_window`. The back is more complex. We must calculate the exact word index and the number of valid bits in the *last* word that contains data. This requires a bit of arithmetic to handle cases where the data doesn't perfectly fill the final word.\n\nThe `next()` method consumes from the `front_window`, advancing the front state. The `next_back()` method consumes from the `back_window`, advancing the back state. The iterator is exhausted when `front_index` meets `back_index`.\n\n> The full implementation can be found in the iter module of the [library](https://github.com/lukefleed/compressed-intvec/blob/master/src/fixed/iter.rs)\n\n# Writing bits\n\nWe have solved the read problem, but we may also want to modify values in place. A method like `set(index, value)` seems simple, but it opens up the same can of worms as `get`, just in reverse. We can't just write the new value; we have to do so without clobbering the adjacent, unrelated data packed into the same `u64` word.\n\nJust like with reading, the logic splits into two paths. The \"fast path\" handles values that are fully contained within a single `u64`. Here, we can't just overwrite the word. We first need to clear out the bits for the element we're replacing and then merge in the new value.\n\n## In-Word Write\n\nOur goal here is to update a `bit_width`-sized slice of a `u64` word while leaving the other bits untouched. This operation must be a read-modify-write sequence to avoid corrupting adjacent elements. The most efficient way to implement this is to load the entire word into a register, perform all bitwise modifications locally, and then write the final result back to memory in a single store operation.\n\nFirst, we load the word from our backing `limbs` slice.\n\n```rust\nlet mut word = *limbs.get_unchecked(word_index);\n```\n\nNext, we need to create a \"hole\" in our local copy where the new value will go. We do this by creating a mask that has ones *only* in the bit positions we want to modify, and then inverting it to create a clearing mask.\n\n```rust\n// For a value at bit_offset, the mask must also be shifted.\nlet clear_mask = !(self.mask \u003C\u003C bit_offset);\n// Applying this mask zeroes out the target bits in our register copy.\nword &= clear_mask;\n```\n\nWith the target bits zeroed, we can merge our new value. The value is first shifted left by `bit_offset` to align it correctly within the 64-bit word. Then, a bitwise OR merges it into the \"hole\" we just created.\n\n```rust\n// Shift the new value into position and merge it.\nword |= value_w \u003C\u003C bit_offset;\n```\n\nFinally, with the modifications complete, we write the updated word from the register back to memory in a single operation.\n\n```rust\n*limbs.get_unchecked_mut(word_index) = word;\n```\nThis entire sequence of one read, two bitwise operations in-register, one write is the canonical and most efficient way to perform a sub-word update.\n\n## Spanning Write\n\nNow for the hard part: writing a value that crosses a word boundary. This operation must modify two separate `u64` words in our backing store. It's the inverse of the spanning read. We need to split our `value_w` into a low part and a high part and write each to the correct word, minimizing memory accesses.\n\nTo operate on two distinct memory locations, `limbs[word_index]` and `limbs[word_index + 1]`, we first need mutable access to both. In a safe, hot path like this, we can use `split_at_mut_unchecked` to bypass Rust's borrow checker bounds checks, as we have already guaranteed through our logic that both indices are valid.\n\n```rust\n// SAFETY: We know word_index and word_index + 1 are valid.\nlet (left, right) = limbs.split_at_mut_unchecked(word_index + 1);\n```\n\nOur strategy is to read both words into registers, perform all bitwise logic locally, and then write both modified words back to memory. This minimizes the time we hold mutable references and can improve performance.\n\nFirst, we handle the `low_word`. We need to replace its high bits (from `bit_offset` onwards) with the low bits of our new value. The most direct way is to create a mask for the bits we want to *keep*. The expression `(1 \u003C\u003C bit_offset) - 1` is a bit-twiddling trick to generate a mask with `bit_offset` ones at the least significant end.\n\n```rust\nlet mut low_word_val = *left.get_unchecked(word_index);\n\n// Create a mask to preserve the low `bit_offset` bits of the word.\nlet low_mask = (1u64 \u003C\u003C bit_offset).wrapping_sub(1);\nlow_word_val &= low_mask;\n```\n\nWith the target bits zeroed out, we merge in the low part of our new value. A left shift aligns it correctly, and the high bits of `value_w` are naturally shifted out of the register.\n\n```rust\n// Merge in the low part of our new value.\nlow_word_val |= value_w \u003C\u003C bit_offset;\n*left.get_unchecked_mut(word_index) = low_word_val;\n```\n\nNext, we handle the `high_word` in a symmetrical fashion. We need to write the remaining high bits of `value_w` into the low-order bits of this second word. First, we calculate how many bits of our value actually belong in the first word:\n\n```rust\nlet remaining_bits_in_first_word = 64 - bit_offset;\n```\n\nNow, we read the second word and create a mask to clear the low-order bits where our data will be written. With the operation `self.mask >> remaining_bits_in_first_word` we can determine how many bits of our value spill into the second word, creating a mask for them. Inverting this gives us a mask to *preserve* the existing high-order bits of the `high_word`.\n\n```rust\nlet mut high_word_val = *right.get_unchecked(0);\n\n// Clear the low bits of the second word that will be overwritten.\nhigh_word_val &= !(self.mask >> remaining_bits_in_first_word);\n```\n\nFinally, we isolate the high part of `value_w` by right-shifting it by the number of bits we already wrote, and merge it into the cleared space.\n\n```rust\n// Merge in the high part of our new value.\nhigh_word_val |= value_w >> remaining_bits_in_first_word;\n*right.get_unchecked_mut(0) = high_word_val;\n```\n\n## Random Write Performance\n\nAs with reads, we can benchmark the latency of 1 million random write operations on a vector containing 10 million elements. The code for the benchmark is available here: [`bench-intvec-writes`].\n\n\u003Ciframe src=\"/bench-intvec/random_write_performance.html\" width=\"100%\" height=\"550px\" style=\"border: none;\">\u003C/iframe>\n\nHere, the `Vec\u003CT>` baseline is the clear winner across almost all bit-widths. This isn't surprising. A `set` operation in a `Vec\u003CT>` compiles down to a single `MOV` instruction with a simple addressing mode (`[base + index * element_size]`). It's about as fast as the hardware allows.\n\nAs for the reads, the performance of our `FixedVec` is almost identical to that of [`sux`]. The other two crates, [`succinct`] and [`simple-sds-sbwt`], are again slower. It's worth noting that also for the writes, neither of these last two crates provides unchecked methods.\n\n> For the 64-bit width case, I honestly have no idea what is going on with [`sux`] being so much faster than everything else, even then `Vec\u003Cu64>`! Mybe some weird compiler optimization? If you have any insight, please let me know.\n\n# Architecture\n\nWith the access patterns defined, we need to think about the overall architecture of this data structure. A solution hardcoded to `u64` would lack the flexibility to adapt to different use cases. We need a structure that is generic over the its principal components: the logical type, the physical storage type, the bit-level ordering, and ownership. We can define a struct that is generic over these four parameters:\n\n```rust\npub struct FixedVec\u003CT: Storable\u003CW>, W: Word, E: Endianness, B: AsRef\u003C[W]> = Vec\u003CW>> {\n    bits: B,\n    bit_width: usize,\n    mask: W,\n    len: usize,\n}\n```\n\nWhere:\n\n* `T` is the **logical element type**, the type as seen by the user of the API (e.g., `i16`, `u32`). By abstracting `T`, we divide the user-facing type from the internal storage representation.\n\n* `W` is the **physical storage word**, which must implement our `Word` trait. It defines the primitive unsigned integer (`u32`, `u64`, `usize`) of the backing buffer and sets the granularity for all bitwise operations.\n\n* `E` requires the `dsi-bitstream::Endianness` trait, allowing us to specify either Little-Endian (`LE`) or Big-Endian (`BE`) byte order.\n\n* `B`, which must implement `AsRef\u003C[W]>`, represents the **backing storage**. This abstraction over ownership allows `FixedVec` to be either an owned container where `B = Vec\u003CW>`, or a zero-copy, borrowed view where `B = &[W]`. This makes it possible to, for example, construct a `FixedVec` directly over a memory-mapped slice without any heap allocation.\n\nIn this way, the compiler monomorphizes the struct and its methods for each concrete instantiation (e.g., `FixedVec\u003Ci16, u64, LE, Vec\u003Cu64>>`), resulting in specialized code with no runtime overhead from the generic abstractions.\n\n## `Word` Trait: The Physical Storage Layer\n\nThe first step is to abstract the physical storage layer. The `W` parameter must be a primitive unsigned integer type that supports bitwise operations. We can define a `Word` trait that captures these requirements:\n\n```rust\npub trait Word:\n    UnsignedInt + Bounded + ToPrimitive + dsi_bitstream::traits::Word\n    + NumCast + Copy + Send + Sync + Debug + IntoAtomic + 'static\n{\n    const BITS: usize = std::mem::size_of::\u003CSelf>() * 8;\n}\n```\n\nThe numeric traits (`UnsignedInt`, `Bounded`, `NumCast`, `ToPrimitive`) are necessary for the arithmetic of offset and mask calculations. The `dsi_bitstream::traits::Word` bound allows us to integrate with its `BitReader` and `BitWriter` implementations, offloading the bitstream logic. `Send` and `Sync` are non-negotiable requirements for any data structure that might be used in a concurrent context. The `IntoAtomic` bound is particularly forward-looking: it establishes a compile-time link between a storage word like `u64` and its atomic counterpart, `AtomicU64`. We will use it later to build a thread safe, atomic version of `FixedVec`. Finally, the `const BITS` associated constant lets us write architecture-agnostic code that correctly adapts to `u32`, `u64`, or `usize` words without `cfg` flags.\n\n## `Storable` Trait: The Logical Type Layer\n\nWith the physical storage layer defined, we need a formal contract to connect it to the user's logical type `T`. We can do this by creating the `Storable` trait, which defines a bidirectional, lossless conversion.\n\n```rust\npub trait Storable\u003CW: Word>: Sized + Copy {\n    fn into_word(self) -> W;\n    fn from_word(word: W) -> Self;\n}\n```\n\nFor unsigned types, the implementation is a direct cast. For signed types, however, we must map the `iN` domain to the `uN` domain required for bit-packing. A simple two's complement bitcast is unsuitable, as `i64(-1)` would become `u64::MAX`, a value requiring the maximum number of bits. We need a better mapping that preserves small absolute values.\n\nWe can use **ZigZag encoding**, which maps integers with small absolute values to small unsigned integers. This is implemented via the `ToNat` and `ToInt` traits from `dsi-bitstream`. The core encoding logic in `to_nat` is:\n\n```rust\n// From dsi_bitstream::traits::ToNat\nfn to_nat(self) -> Self::UnsignedInt {\n    (self \u003C\u003C 1).to_unsigned() ^ (self >> (Self::BITS - 1)).to_unsigned()\n}\n```\n\nThis operation works as follows: `(self \u003C\u003C 1)` creates a space at the LSB. The term `(self >> (Self::BITS - 1))` is an arithmetic right shift, which generates a sign mask—all zeros for non-negative numbers, all ones for negative numbers. The final XOR uses this mask to interleave positive and negative integers: 0 becomes 0, -1 becomes 1, 1 becomes 2, -2 becomes 3, and so on.\n\nThe decoding reverses this transformation:\n\n```rust\n// From dsi_bitstream::traits::ToInt\nfn to_int(self) -> Self::SignedInt {\n    (self >> 1).to_signed() ^ (-(self & 1).to_signed())\n}\n```\n\nHere, `(self >> 1)` shifts the value back. The term `-(self & 1)` creates a mask from the LSB (the original sign bit). In two's complement, this becomes `0` for even numbers (originally positive) and `-1` (all ones) for odd numbers (originally negative). The final XOR with this mask correctly restores the original two's complement representation.\n\n\nWe might ask ourselves: why not just a direct bitcast for signed types, perhaps via a `uN -> iN` chain. Well, while a direct [transmute](https://doc.rust-lang.org/std/mem/fn.transmute.html) between same-sized integer types is a no-op, the approach fails when the logical `bit_width` is smaller than the physical type size. `FixedVec`'s core logic extracts a `bit_width`-sized unsigned integer from its storage. For example, when reading a 4-bit representation of `-1` (binary `1111`), the `from_word` function receives the value `15u64`. At this point, the context that those four bits represented a negative number is lost. A cast chain like `15u64 as u8 as i8` would simply yield `15i8`, not `-1i8`.\n\nTo correctly reconstruct the signed value, one would need to manually perform sign extension based on the known `bit_width`. This involves checking the most significant bit of the extracted value and, if set, filling the higher-order bits of the word with ones. This logic requires a conditional branch, which can introduce pipeline stalls and degrade performance in tight loops. ZigZag decoding, by contrast, is a purely arithmetic, branch-free transformation. Its reconstruction logic is a simple sequence of bitwise shifts and XORs, making it a faster and more consistent choice for the hot path of data access.\n\nWith this logic within the trait system, the main `FixedVec` implementation remains clean and agnostic to the signedness of the data it stores.\n\n## Builder Pattern\n\nOnce the structure logic is in place, we have to design an ergonomic way to construct it. A simple `new()` function isn't sufficient because the vector's memory layout depends on parameters that must be determined *before* allocation, most critically the `bit_width`. This is a classic scenario for a builder pattern.\n\n\nThe central problem is that the optimal `bit_width` often depends on the data itself. We need a mechanism to specify the *strategy* for determining this width. We can create the `BitWidth` enum:\n\n```rust\npub enum BitWidth {\n    Minimal,\n    PowerOfTwo,\n    Explicit(usize),\n}\n```\n\n\n\nWith this enum, the user can choose between three strategies:\n\n- `Minimal`: The builder scans the input data to find the maximum value, then calculates the minimum number of bits required to represent it. This is the most space-efficient option but requires a full pass over the data.\n- `PowerOfTwo`: Similar to `Minimal`, but rounds the bit width up to the next power of two. This can simplify certain bitwise operations and align better with hardware word sizes, at the cost of some additional space.\n- `Explicit(n)`: The user provides a fixed bit width. This avoids the data scan but requires the user to ensure that all values fit within the specified width.\n\n> **Note:** Yes, I could have also made three different build functions: `new_with_minimal_bit_width()`, `new_with_power_of_two_bit_width()`, and `new_with_explicit_bit_width(n)`. However, this would lead to a combinatorial explosion if we later wanted to add more configuration options. The builder pattern scales better.\n\nWith this, the `FixedVecBuilder` could be designed as a state machine. It holds the chosen `BitWidth` strategy. The final `build()` method takes the input slice and executes the appropriate logic.\n\n```rust\n// A look at the builder's logic flow\npub fn build(self, input: &[T]) -> Result\u003CFixedVec\u003C...>, Error> {\n\n    let final_bit_width = match self.bit_width_strategy {\n        BitWidth::Explicit(n) => n,\n        _ => {\n            // For Minimal or PowerOfTwo, we first find the max value.\n            let max_val = input.iter().map(|v| v.into_word()).max().unwrap_or(0);\n            let min_bits = (64 - max_val.leading_zeros()).max(1) as usize;\n\n            match self.bit_width_strategy {\n                BitWidth::Minimal => min_bits,\n                BitWidth::PowerOfTwo => min_bits.next_power_of_two(),\n                _ => unreachable!(),\n            }\n        }\n    };\n\n    // ... (rest of the logic: allocate buffer, write data) ...\n}\n```\n\nThis design cleanly separates the configuration phase from the execution phase. The user can declaratively state their requirements, and the builder handles the implementation details, whether that involves a full data scan or a direct construction. For example:\n\n```rust\nuse compressed_intvec::prelude::*;\n\nlet data: &[u32] = &[100, 200, 500]; // Max value 500 requires 9 bits\n\n// The builder will scan the data, find max=500, calculate min_bits=9,\n// and then round up to the next power of two.\nlet vec_pow2: UFixedVec\u003Cu32> = FixedVec::builder()\n    .bit_width(BitWidth::PowerOfTwo)\n    .build(data)\n    .unwrap();\n\nassert_eq!(vec_pow2.bit_width(), 16);\n```\n\n> `UFixedVec\u003CT>` is a type alias for `FixedVec\u003CT, u64, LE, Vec\u003Cu64>>`, the most common instantiation.\n\n\n# Doing more than just reading\n\nThe design of `FixedVec` allows for more than just efficient reads. We can extend it to support mutation and even thread-safe (almost atomic) concurrent access.\n\n## Mutability: Proxy Objects\n\nA core feature of `std::vec::Vec` is mutable, index-based access via `&mut T`. This is fundamentally impossible for `FixedVec`. An element, such as a 10-bit integer, is not a discrete, byte-aligned entity in memory. It is a virtual value extracted from a bitstream, potentially spanning the boundary of two different `u64` words. It has no stable memory address, so a direct mutable reference cannot be formed.\n\nTo provide an ergonomic mutable API, we must emulate the behavior of a mutable reference. We achieve this through a proxy object pattern, implemented in a struct named `MutProxy`.\n\n```rust\npub struct MutProxy\u003C'a, T, W, E, B>\nwhere\n    T: Storable\u003CW>,\n    W: Word,\n    E: Endianness,\n    B: AsRef\u003C[W]> + AsMut\u003C[W]>,\n{\n    vec: &'a mut FixedVec\u003CT, W, E, B>,\n    index: usize,\n    value: T, // A temporary, decoded copy of the element's value.\n}\n```\n\nWhen we call a method like `at_mut(index)`, it does not return a reference. Instead, it constructs and returns a `MutProxy` instance. The proxy's lifecycle manages the entire modification process:\n\n1.  **Construction:** The proxy is created. Its first action is to call the parent `FixedVec`'s internal `get` logic to read and decode the value at the specified `index`. This decoded value is stored as a temporary copy inside the proxy object itself.\n2.  **Modification:** The `MutProxy` implements `Deref` and `DerefMut`, allowing the user to interact with the temporary copy as if it were the real value. Any modifications (`*proxy = new_value`, `*proxy += 1`) are applied to this local copy, not to the underlying bitstream.\n3.  **Destruction:** When the `MutProxy` goes out of scope, its `Drop` implementation is executed. This is the critical step where the potentially modified value from the temporary copy is taken, re-encoded, and written back into the correct bit position in the parent `FixedVec`'s storage.\n\nThis is a classic copy-on-read, write-on-drop mechanism. It provides a safe and ergonomic abstraction for mutating non-addressable data, preserving the feel of direct manipulation while correctly handling the bit-level operations under the hood. The overhead is a single read at the start of the proxy's life and a single write at the end.\n\n```rust\nuse compressed_intvec::fixed::{FixedVec, UFixedVec, BitWidth};\n\nlet data: &[u32] = &[10, 20, 30];\nlet mut vec: UFixedVec\u003Cu32> = FixedVec::builder()\n    .bit_width(BitWidth::Explicit(7))\n    .build(data)\n    .unwrap();\n\n// vec.at_mut(1) returns an Option\u003CMutProxy\u003C...>>\nif let Some(mut proxy) = vec.at_mut(1) {\n    // The DerefMut trait allows us to modify the proxy's internal copy.\n    *proxy = 99;\n} // The proxy is dropped here. Its Drop impl writes 99 back to the vec.\n\nassert_eq!(vec.get(1), Some(99));\n```\n\nThe overhead of this approach is a single read on the proxy's construction and a single write on its destruction, which is an acceptable trade-off for an ergonomic and safe mutable API.\n\n### Zero-Copy Views\n\nA `Vec`-like API needs to support slicing. Creating a `FixedVec` that borrows its data (`B = &[W]`) is the first step for this, but we also need a dedicated slice type to represent a sub-region of another `FixedVec` without copying data. For this we can create `FixedVecSlice`.\n\nWe can implement this as a classic \"fat pointer\" struct. It holds a reference to the parent `FixedVec` and a `Range\u003Cusize>` that defines the logical boundaries of the view.\n\n```rust\n// A zero-copy view into a contiguous portion of a FixedVec.\n#[derive(Debug)]\npub struct FixedVecSlice\u003CV> {\n    pub(super) parent: V,\n    pub(super) range: Range\u003Cusize>,\n}\n```\n\nThe generic parameter `V` is a reference to the parent vector. This allows the same `FixedVecSlice` struct to represent both immutable (`V = &FixedVec\u003C...>`) and mutable (`V = &mut FixedVec\u003C...>`) views.\n\nWe can implement all the operations on the slice by translating the slice-relative index into an absolute index in the parent vector. For example, we can easily implement `get_unchecked` with this delegation:\n\n```rust\n// Index translation within the slice's get_unchecked\npub unsafe fn get_unchecked(&self, index: usize) -> T {\n    debug_assert!(index \u003C self.len());\n    // The index is relative to the slice, so we add the slice's start\n    // offset to get the correct index in the parent vector.\n    self.parent.get_unchecked(self.range.start + index)\n}\n```\n\nIn this way there is no code duplication; the slice re-uses the access logic of the parent `FixedVec`.\n\n## Mutable Slices\n\nFor mutable slices (`V = &mut FixedVec\u003C...>` ), we can provide mutable access to the slice's elements. We can easily implement the `at_mut` method on `FixedVecSlice` using the same principle of index translation:\n\n```rust\npub fn at_mut(&mut self, index: usize) -> Option\u003CMutProxy\u003C'_, T, W, E, B>> {\n    if index >= self.len() {\n        return None;\n    }\n    // The index is translated to the parent vector's coordinate space.\n    Some(MutProxy::new(&mut self.parent, self.range.start + index))\n}\n```\n\nA mutable slice borrows the parent `FixedVec` mutably. This means that while the slice exists, the parent vector cannot be accessed directly due to Rust's borrowing rules. Let's consider the following situation: we may need to split a mutable slice into two non-overlapping mutable slices. This is common for example in algorithms that operate on sub-regions of an array. However, implementing such a method requires to use some unsafe code. The method, let's say `split_at_mut`, must produce two `&mut` references from a single one. In order to be safe, we must prove to the compiler that the logical ranges they represent (`0..mid` and `mid..len`) are disjoint.\n\n```rust\npub fn split_at_mut(&mut self, mid: usize) -> (FixedVecSlice\u003C&mut Self>, FixedVecSlice\u003C&mut Self>) {\n    assert!(mid \u003C= self.len, \"mid > len in split_at_mut\");\n    // SAFETY: The two slices are guaranteed not to overlap.\n    unsafe {\n        let ptr = self as *mut Self;\n        let left = FixedVecSlice::new(&mut *ptr, 0..mid);\n        let right = FixedVecSlice::new(&mut *ptr, mid..self.len());\n        (left, right)\n    }\n}\n```\n\nThis combination of a generic slice struct and careful pointer manipulation allows us to build a rich, safe, and zero-copy API for both immutable and mutable views, mirroring Rust's native slice\n\n# Next Steps\n\nOur `FixedVec` works pretty well at the current state, but its strengths are tied to two key assumptions: a single thread of execution and uniformly bounded data. Real-world systems often challenge both. This opens up two distinct paths for us to extend our design: one to handle concurrency, and another to adapt to more complex data distributions.\n\n## Concurrent Access\n\nThe design of `FixedVec` is fundamentally single-threaded. Its mutable access relies on direct writes to the underlying bit buffer, a model that offers no guarantees in a concurrent setting. The core conflict lies between our data layout and the hardware's atomic primitives. CPU instructions like compare-and-swap operate on aligned machine words, typically `u64`. Our elements, however, are packed at arbitrary bit offsets and can span the boundary between two words.\n\nThis means a single logical update—modifying one element—might require writing to two separate `u64` words. Performing this as two distinct atomic writes would create a race condition, leaving the data in a corrupt state if another thread reads between them. A single atomic write to one of the underlying `u64` words would be equally disastrous, as it could simultaneously alter parts of two different elements. The problem then is how to build atomic semantics on top of a non-atomic memory layout. In the next post, we will construct a solution that provides thread-safe, atomic operations for our bit-packed vector.\n\n## Variable Length Encoding\n\nLet's consider the following scenario: we have a large collection of integers, all of which are small, say in the range `[0, 255]`, but with a few outliers that are much larger, perhaps up to `u64::MAX`. If we were to use our `FixedVec` with a `bit_width` of 64 to accommodate the outliers, we would waste a significant amount of memory on the small integers. Conversely, if we chose a smaller `bit_width`, we would be unable to represent the outliers at all.\n\nThe fixed-width model rests on that critical assumption of uniformly bounded data. Its performance comes from this predictability, but this rigid structure is also its main weakness.\n\nFor skewed data distributions, we need a different model. Instead of a fixed number of bits per element, we can use variable-length instantaneous codes, where smaller numbers are represented by shorter bit sequences. This gives us excellent compression, but it breaks our O(1) random access guarantee. We can no longer compute the location of the i-th element with a simple multiplication. The solution is to trade a small amount of space for a speedup in access time. We can build a secondary index that stores the bit-offset of every k-th element. This sampling allows us to seek to a nearby checkpoint and decode sequentially from there, restoring amortized O(1) access. In a future article, we'll explore this second vector type, its own set of performance trade-offs, and how we can choose the best encoding for our data.\n\n---\n\nWe will explore this two paths in future articles. In the meantime, if you want to try them out, they are both already implemented in the library. You can find the atomic version in the [atomic](https://docs.rs/compressed-intvec/latest/compressed_intvec/fixed/atomic/index.html) module and the variable-length version in the [variable](https://docs.rs/compressed-intvec/latest/compressed_intvec/variable/struct.IntVec.html) module.","src/data/blog/compressed-fixedvec.md","4d49b2df88c30bdb",{"html":280,"metadata":281},"\u003Cp>If you’ve ever worked with massive datasets, you know that memory usage can quickly become a bottleneck. While developing succinct data structures, I found myself needing to store large arrays of integers—values with no monotonicity or other exploitable patterns, that I knew came from a universe much smaller than their type’s theoretical capacity.\u003C/p>\n\u003Cp>In this post, we will explore the engineering challenges involved in implementing an efficient vector-like data structure in Rust that stores integers in a compressed, bit-packed format. We will focus on achieving O(1) random access performance while minimizing memory usage. We will try to mimic the ergonomics of Rust’s standard \u003Ccode>Vec&#x3C;T>\u003C/code> as closely as possible, including support for mutable access and zero-copy slicing.\u003C/p>\n\u003Cul>\n\u003Cli>All the code can be found on github: \u003Ca href=\"https://github.com/lukefleed/compressed-intvec\">compressed-intvec\u003C/a>\u003C/li>\n\u003Cli>This is also published as a crate on crates.io: \u003Ca href=\"https://crates.io/crates/compressed-intvec\">compressed-intvec\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>You can discuss this post on \u003Ca href=\"https://news.ycombinator.com/item?id=45361578\">Hacker News\u003C/a>, \u003Ca href=\"https://lobste.rs/s/u1rffj/engineering_fixed_width_bit_packed\">Lobsters\u003C/a> or \u003Ca href=\"https://www.reddit.com/r/rust/comments/1npf41d/engineering_a_fixedwidth_bitpacked_integer_vector/\">Reddit\u003C/a>.\u003C/p>\n\u003Chr>\n\u003Ch1 id=\"memory-waste-in-standard-vectors\">Memory Waste in Standard Vectors\u003C/h1>\n\u003Cp>In Rust, the contract of a \u003Ccode>Vec&#x3C;T>\u003C/code> (where \u003Ccode>T\u003C/code> is a primitive integer type like \u003Ccode>u64\u003C/code> or \u003Ccode>i32\u003C/code>) is simple: O(1) random access in exchange for a memory layout that is tied to the static size of \u003Ccode>T\u003C/code>. This is a good trade-off, until it isn’t. When the dynamic range of the stored values is significantly smaller than the type’s capacity, this memory layout leads to substantial waste.\u003C/p>\n\u003Cp>Consider storing the value \u003Ccode>5\u003C/code> within a \u003Ccode>Vec&#x3C;u64>\u003C/code>. Its 8-byte in-memory representation is:\u003C/p>\n\u003Cdiv align=\"center\">\n\u003Cp>\u003Ccode>00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000101\u003C/code>\u003C/p>\n\u003C/div>\n\u003Cp>Only 3 bits are necessary to represent the value, leaving 61 bits as zero-padding. The same principle applies, albeit less dramatically, when storing \u003Ccode>5\u003C/code> in a \u003Ccode>u32\u003C/code> or \u003Ccode>u16\u003C/code>. At scale, this overhead becomes prohibitive. A vector of one billion \u003Ccode>u64\u003C/code> elements consumes \u003Ccode>10^9 * std::mem::size_of::&#x3C;u64>()\u003C/code>, or approximately 8 GB of memory, even if every element could fit within a single byte.\u003C/p>\n\u003Cp>The canonical solution is bit packing, which aligns data end-to-end in a contiguous bitvector. However, this optimization has historically come at the cost of random access performance. The O(1) access guarantee of \u003Ccode>Vec&#x3C;T>\u003C/code> is predicated on simple pointer arithmetic: \u003Ccode>address = base_address + index * std::mem::size_of::&#x3C;T>()\u003C/code>. Tightly packing the bits invalidates this direct address calculation, seemingly forcing a trade-off between memory footprint and access latency.\u003C/p>\n\u003Cp>This raises the central question that with this post we aim to answer: is it possible to design a data structure that decouples its memory layout from the static size of \u003Ccode>T\u003C/code>, adapting instead to the data’s true dynamic range, without sacrificing the O(1) random access that makes \u003Ccode>Vec&#x3C;T>\u003C/code> so effective?\u003C/p>\n\u003Ch1 id=\"packing-and-accessing-bits\">Packing and Accessing Bits\u003C/h1>\n\u003Cp>If the dynamic range of our data is known, we can define a fixed \u003Ccode>bit_width\u003C/code> for every integer. For instance, if the maximum value in a dataset is \u003Ccode>1000\u003C/code>, we know every number can be represented in 10 bits, since \u003Ccode>2^10 = 1024\u003C/code>. Instead of allocating 64 bits per element, we can store them back-to-back in a contiguous bitvector, forming the core of what from now on we’ll refer as \u003Ccode>FixedVec\u003C/code>. We can immagine such data strucutre as a logical array of \u003Ccode>N\u003C/code> integers, each \u003Ccode>bit_width\u003C/code> bits wide, stored in a backing buffer of \u003Ccode>u64\u003C/code> words.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">struct\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> FixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Vec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>, \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Backing storage\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Number of bits per element\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    len\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Number of elements\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Precomputed mask for extraction\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Where the role of the \u003Ccode>mask\u003C/code> field is to isolate the relevant bits during extraction. For a \u003Ccode>bit_width\u003C/code> of 10, the mask would be \u003Ccode>0b1111111111\u003C/code>.\u003C/p>\n\u003Cp>This immediately solves the space problem, but how can we find the \u003Ccode>i\u003C/code>-th element in O(1) time if it doesn’t align to a byte boundary? The answer lies in simple arithmetic. The starting bit position of any element is a direct function of its index. Given a backing store of \u003Ccode>u64\u003C/code> words, we can locate any value by calculating its absolute bit position and then mapping that to a specific word and an offset within that word.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Absolute bit position of the value\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> /\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Which u64 word to read\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> %\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Where the value starts in that word\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>With these values, the implementation of \u003Ccode>get_unchecked\u003C/code> becomes straightforward. It’s a two-step process: fetch the correct word from our backing \u003Ccode>Vec&#x3C;u64>\u003C/code>, then use bitwise operations to isolate the specific bits we need.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// A simplified look at the core get_unchecked logic\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">unsafe\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> /\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> %\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 1. Fetch the word from the backing store\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 2. Shift and mask to extract the value\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Let’s trace an access with \u003Ccode>bit_width = 10\u003C/code> for the element at \u003Ccode>index = 7\u003C/code>. The starting bit position is \u003Ccode>7 * 10 = 70\u003C/code>. This maps to \u003Ccode>word_index = 1\u003C/code> and \u003Ccode>bit_offset = 6\u003C/code>. Our 10-bit integer begins at the 6th bit of the \u003Cem>second\u003C/em> \u003Ccode>u64\u003C/code> word in our storage.\u003C/p>\n\u003Cp>The right-shift \u003Ccode>>>\u003C/code> operation moves the bits of the entire \u003Ccode>u64\u003C/code> word to the right by \u003Ccode>bit_offset\u003C/code> positions. This aligns the start of our desired 10-bit value with the least significant bit (LSB) of the word. The final step is to isolate our value. A pre-calculated \u003Ccode>mask\u003C/code> (e.g., \u003Ccode>0b1111111111\u003C/code> for 10 bits) is applied with a bitwise AND \u003Ccode>&#x26;\u003C/code>. This zeroes out any high-order bits from the word, leaving just our target integer.\u003C/p>\n\u003Ch2 id=\"crossing-word-boundaries\">Crossing Word Boundaries\u003C/h2>\n\u003Cp>The single-word access logic is fast, but it only works as long as \u003Ccode>bit_offset + bit_width &#x3C;= 64\u003C/code>. This assumption breaks down as soon as an integer’s bit representation needs to cross the boundary from one \u003Ccode>u64\u003C/code> word into the next. This is guaranteed to happen for any \u003Ccode>bit_width\u003C/code> that is not a power of two. For example, with a 10-bit width, the element at \u003Ccode>index = 6\u003C/code> starts at bit position 60. Its 10 bits will occupy bits 60-63 of the first word and bits 0-5 of the second. The simple right-shift-and-mask trick fails here.\u003C/p>\n\u003Cp>\u003Cimg src=\"/assets/fixedvec.svg\" alt=\"crossing word boundaries\">\u003C/p>\n\u003Cp>To correctly decode the value, we must read \u003Cem>two\u003C/em> consecutive \u003Ccode>u64\u003C/code> words and combine their bits. This splits our \u003Ccode>get_unchecked\u003C/code> implementation into two paths. The first is the fast path we’ve already seen. The second is a new path for spanning values.\u003C/p>\n\u003Cp>To get the lower bits of the value, we read the first word and shift right, just as before. This leaves the upper bits of the word as garbage.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> low_part\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">>>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>To get the upper bits of the value, we read the \u003Cem>next\u003C/em> word. The bits we need are at the beginning of this word, so we shift them left to align them correctly.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> high_part\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Finally, we combine the two parts with a bitwise OR and apply the mask to discard any remaining high-order bits from the \u003Ccode>high_part\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">low_part\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> high_part\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The line \u003Ccode>limbs.get_unchecked(word_index + 1)\u003C/code> introduces a safety concern: if we are reading the last element of the vector, \u003Ccode>word_index + 1\u003C/code> could point past the end of our buffer, leading to undefined behavior. To prevent this, our builder must always allocate one extra padding word at the end of the storage.\u003C/p>\n\u003Cp>Integrating these two paths gives us our final \u003Ccode>get_unchecked\u003C/code> implementation:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> unsafe\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> /\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> %\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bits\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_ref\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // Fast path: value is fully within one word\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        (\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">>>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">else\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // Slow path: value spans two words.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> low_part\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">>>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> high_part\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">low_part\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> high_part\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"faster-reads-unaligned-access\">Faster Reads: Unaligned Access\u003C/h2>\n\u003Cp>Our \u003Ccode>get_unchecked\u003C/code> implementation is correct, but the slow path for spanning values requires two separate, aligned memory reads. The instruction sequence for this method involves at least two load instructions, multiple shifts, and a bitwise OR. These instructions have data dependencies: the shifts cannot execute until the loads complete, and the OR cannot execute until both shifts are done. This dependency chain can limit the CPU’s instruction-level parallelism and create pipeline stalls if the memory accesses miss the L1 cache.\u003C/p>\n\u003Cp>Let’s have a look at the machine code generated by this method. We can create a minimal binary with an \u003Ccode>#[inline(never)]\u003C/code> function that calls \u003Ccode>get_unchecked\u003C/code> on a known spanning index, then use \u003Ca href=\"https://crates.io/crates/cargo-asm\">\u003Ccode>cargo asm\u003C/code>\u003C/a> to inspect the disassembly.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"asm\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">; asm_test::aligned::get_aligned (spanning path)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">LBB14_2\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        ; let low = *limbs.get_unchecked(word_index) >> bit_offset;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        mov\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rsi\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">qword\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ptr [\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">r8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> + \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">*\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">rdx\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]      \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">; &#x3C;&#x3C;&#x3C; LOAD #1 (low_part)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        ; let high = *limbs.get_unchecked(word_index + 1) &#x3C;&#x3C; (64 - bit_offset);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        mov\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rdx\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">qword\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ptr [\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">r8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> + \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">*\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">rdx\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> + \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]  \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">; &#x3C;&#x3C;&#x3C; LOAD #2 (high_part)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        shr\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rsi\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">cl\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">                          ; shift right of low_part\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        shl\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rdx\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">cl\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">                          ; shift left of high_part\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        or\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rdx\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">rsi\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">                          ; combine results\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The instruction \u003Ccode>mov rsi, qword ptr [r8 + 8*rdx]\u003C/code> is our first memory access. It loads a 64-bit value (\u003Ccode>qword\u003C/code>) into the \u003Ccode>rsi\u003C/code> register. The address is calculated using base-plus-index addressing: \u003Ccode>r8\u003C/code> holds the base address of our \u003Ccode>limbs\u003C/code> buffer, and \u003Ccode>rdx\u003C/code> holds the \u003Ccode>word_index\u003C/code>. This corresponds directly to \u003Ccode>limbs[word_index]\u003C/code>.\u003C/p>\n\u003Cp>Immediately following is \u003Ccode>mov rdx, qword ptr [r8 + 8*rdx + 8]\u003C/code>. This is our second, distinct memory access. It loads the \u003Cem>next\u003C/em> 64-bit word from memory by adding an 8-byte offset to the previous address. This corresponds to \u003Ccode>limbs[word_index + 1]\u003C/code>.\u003C/p>\n\u003Cp>Only after both of these \u003Ccode>mov\u003C/code> instructions complete can the CPU proceed. The \u003Ccode>shr rsi, cl\u003C/code> instruction (shift right \u003Ccode>rsi\u003C/code> by the count in \u003Ccode>cl\u003C/code>) cannot execute until the first \u003Ccode>mov\u003C/code> has placed a value in \u003Ccode>rsi\u003C/code>. Similarly, \u003Ccode>shl rdx, cl\u003C/code> depends on the second \u003Ccode>mov\u003C/code>. Finally, \u003Ccode>or rdx, rsi\u003C/code> depends on both shifts.\u003C/p>\n\u003Cp>This sequence of operations—loading two adjacent 64-bit words, shifting each, and combining them is a software implementation of what is, conceptually, a \u003Ca href=\"https://en.wikipedia.org/wiki/Barrel_shifter\">128-bit barrel shifter\u003C/a>. We are selecting a 64-bit window from a virtual 128-bit integer formed by concatenating the two words from memory.\u003C/p>\n\u003Cp>\u003Cstrong>Can we do better then this?\u003C/strong> Potentially, yes. We can replace this multi-instruction sequence with something more direct by delegating the complexity to the hardware and performing a single unaligned memory read. Modern x86-64 CPUs handle this directly: when an unaligned load instruction is issued, the CPU’s memory controller fetches the necessary cache lines and the load/store unit reassembles the bytes into the target register. This entire process is a single, optimized micro-operation.\u003C/p>\n\u003Cp>We can try to implement a more aggressive access method. The strategy is to calculate the exact \u003Cem>byte\u003C/em> address where our data begins and perform a single, unaligned read of a full \u003Ccode>W\u003C/code> word from that position.\u003C/p>\n\u003Cp>The implementation first translates the absolute bit position into a byte address and a residual bit offset within that byte.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> byte_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> /\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_rem\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> %\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>With the byte-level address, we get a raw \u003Ccode>*const u8\u003C/code> pointer to our storage and perform the unaligned read. The \u003Ca href=\"https://doc.rust-lang.org/std/ptr/fn.read_unaligned.html\">read_unaligned\u003C/a> intrinsic in Rust compiles down to a single machine instruction that the hardware can execute efficiently.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> limbs_ptr\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_limbs\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_ptr\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">as\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">const\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// This read may cross hardware word boundaries, but the CPU handles it.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> W\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">limbs_ptr\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">add\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">byte_pos\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">as\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\"> W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">read_unaligned\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>On a Little-Endian system, the loaded \u003Ccode>word\u003C/code> now contains our target integer, but it’s shifted by \u003Ccode>bit_rem\u003C/code> positions. A simple right shift aligns our value to the LSB, and applying the mask isolates it.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> extracted_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_rem\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> final_value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> extracted_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This operation is safe only because, as said before, we are supposing that our builder guarantees a padding word at the end of the storage buffer. Combining all these steps, we get our final implementation:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> unsafe\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> get_unaligned_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> byte_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> /\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_rem\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> %\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> limbs_ptr\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_limbs\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_ptr\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">as\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">const\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // SAFETY: The builder guarantees an extra padding word at the end.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">limbs_ptr\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">add\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">byte_pos\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">as\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\"> W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">read_unaligned\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> extracted_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_rem\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    extracted_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Let’s have a look at the generated machine code for this new method when accessing an index that spans words:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"asm\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">; asm_test::unaligned::get_unaligned\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">LBB15_1\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        ; let bit_pos = index * self.bit_width;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        imul\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rcx\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">rax\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        ; let byte_pos = bit_pos / 8;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        mov\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rax\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">rcx\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        shr\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rax\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">3\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        ; self.bits.as_ref()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        mov\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rdx\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">qword\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ptr [\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">rdi\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> + \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        ; unsafe { crate::intrinsics::copy_nonoverlapping(src, dst, count) }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        mov\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rax\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">qword\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ptr [\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">rdx\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> + \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">rax\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]       \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">; &#x3C;&#x3C;&#x3C; SINGLE UNALIGNED LOAD\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        ; self >> other\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        and\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> cl\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">7\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        shr\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rax\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">cl\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        ; fn bitand(self, rhs: $t) -> $t { self &#x26; rhs }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        and\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> rax\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">qword\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ptr [\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">rdi\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> + \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">32\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The initial \u003Ccode>imul\u003C/code> and \u003Ccode>shr rax, 3\u003C/code> (a fast division by 8) correspond to the calculation of \u003Ccode>byte_pos\u003C/code>. The instruction \u003Ccode>mov rdx, qword ptr [rdi + 8]\u003C/code> loads the base address of our \u003Ccode>limbs\u003C/code> buffer into the \u003Ccode>rdx\u003C/code> register.\u003C/p>\n\u003Cp>The instruction \u003Ccode>mov rax, qword ptr [rdx + rax]\u003C/code> is our single unaligned load. The address \u003Ccode>[rdx + rax]\u003C/code> is the sum of the buffer’s base address and our calculated \u003Ccode>byte_pos\u003C/code>. This \u003Ccode>mov\u003C/code> instruction reads 8 bytes (a \u003Ccode>qword\u003C/code>) directly from this potentially unaligned memory location into the \u003Ccode>rax\u003C/code> register. We can see that as we hoped, the \u003Ca href=\"https://doc.rust-lang.org/std/ptr/fn.read_unaligned.html\">read_unaligned\u003C/a> intrinsic has been compiled down to a single hardware instruction.\u003C/p>\n\u003Cp>The next instructions handle the extraction. The \u003Ccode>and cl, 7\u003C/code> and \u003Ccode>shr rax, cl\u003C/code> sequence corresponds to our \u003Ccode>>> bit_rem\u003C/code>. \u003Ccode>cl\u003C/code> holds the lower bits of the original \u003Ccode>bit_pos\u003C/code> (our \u003Ccode>bit_rem\u003C/code>), and the shift aligns our desired value to the LSB of the \u003Ccode>rax\u003C/code> register. Finally, \u003Ccode>and rax, qword ptr [rdi + 32]\u003C/code> applies the pre-calculated mask, which is stored at an offset from the \u003Ccode>self\u003C/code> pointer in \u003Ccode>rdi\u003C/code>.\u003C/p>\n\u003Ch2 id=\"random-access-performance\">Random Access Performance\u003C/h2>\n\u003Cp>We can now benchmark the latency of 1 million random access operations on a vector containing 10 million elements. For each \u003Ccode>bit_width\u003C/code>, we generate data with a uniform random distribution in the range \u003Ccode>[0, 2^bit_width)\u003C/code>. The code for the benchmark is available here: \u003Ca href=\"https://github.com/lukefleed/compressed-intvec/blob/master/benches/fixed/bench_random_access.rs\">\u003Ccode>bench-intvec\u003C/code>\u003C/a>\u003C/p>\n\u003Cp>Our baseline is the smallest standard \u003Ccode>Vec&#x3C;T>\u003C/code> capable of holding the data (\u003Ccode>Vec&#x3C;u8>\u003C/code> for \u003Ccode>bit_width &#x3C;= 8\u003C/code>, etc.). We also include results from \u003Ca href=\"https://docs.rs/sux/latest/sux/bits/bit_field_vec/index.html\">\u003Ccode>sux\u003C/code>\u003C/a>, \u003Ca href=\"https://docs.rs/succinct/latest/succinct/trait.IntVec.html\">\u003Ccode>succinct\u003C/code>\u003C/a>, and \u003Ca href=\"https://docs.rs/simple-sds-sbwt/latest/simple_sds_sbwt/int_vector/struct.IntVector.html\">\u003Ccode>simple-sds-sbwt\u003C/code>\u003C/a> for context. I am not aware of any other Rust crates that implement fixed-width bit-packed integer vectors, so if you know of any, please let me know!\u003C/p>\n\u003Ciframe src=\"/bench-intvec/fixed_random_access_performance.html\" width=\"100%\" height=\"550px\" style=\"border: none;\">\u003C/iframe>\n\u003Cp>We can see that for \u003Ccode>bit_width\u003C/code> values below 32, the \u003Ccode>get_unaligned_unchecked\u003C/code> of our \u003Ccode>FixedVec\u003C/code> is almost always faster than the corresponding \u003Ccode>Vec&#x3C;T>\u003C/code> baseline. This is a result of improved cache locality. A 64-byte L1 cache line can hold 64 elements from a \u003Ccode>Vec&#x3C;u8>\u003C/code>. With a \u003Ccode>bit_width\u003C/code> of 4, the same cache line holds \u003Ccode>(64 * 8) / 4 = 128\u003C/code> elements from our \u003Ccode>FixedVec\u003C/code>. This increased density improves the cache hit rate for random access patterns, and the latency reduction from avoiding DRAM access outweighs the instruction cost of the bitwise extraction. For values of \u003Ccode>bit_width\u003C/code> above 32, the performance of \u003Ccode>FixedVec\u003C/code> are \u003Cem>very slightly\u003C/em> worse than the \u003Ccode>Vec&#x3C;T>\u003C/code> baseline, as the cache locality advantage diminishes. However, the memory savings remain.\u003C/p>\n\u003Cp>The performance delta between \u003Ccode>get_unaligned_unchecked\u003C/code> and \u003Ccode>get_unchecked\u003C/code> confirms the unaligned access strategy discussed before: a single \u003Ccode>read_unaligned\u003C/code> instruction is more efficient than the two dependent aligned reads required by the logic for spanning words.\u003C/p>\n\u003Cp>We can see that the implementation of \u003Ca href=\"https://docs.rs/sux/latest/sux/bits/bit_field_vec/index.html\">\u003Ccode>sux\u003C/code>\u003C/a> is almost on par with ours. The other two crates, \u003Ca href=\"https://docs.rs/succinct/latest/succinct/trait.IntVec.html\">\u003Ccode>succinct\u003C/code>\u003C/a> and \u003Ca href=\"https://docs.rs/simple-sds-sbwt/latest/simple_sds_sbwt/int_vector/struct.IntVector.html\">\u003Ccode>simple-sds-sbwt\u003C/code>\u003C/a>, are significantly slower (note that the Y-axis is logarithmic). Tho, it’s worth noting that neither of these last two crates provides unchecked or unaligned access methods, so their implementations are inherently more conservative.\u003C/p>\n\u003Ch2 id=\"iterating-over-values\">Iterating Over Values\u003C/h2>\n\u003Cp>The most common operation on any \u003Ccode>Vec\u003C/code>-like structure is, after all, a simple \u003Ccode>for\u003C/code> loop. The simplest way to implement \u003Ccode>iter()\u003C/code> would be to just wrap \u003Ccode>get()\u003C/code> in a loop:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// A naive, inefficient iterator\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> in\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">..\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">vec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">len\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> vec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ... do something with value\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This works, but it’s terribly inefficient. Every single call to \u003Ccode>get(i)\u003C/code> independently recalculates the \u003Ccode>word_index\u003C/code> and \u003Ccode>bit_offset\u003C/code> from scratch. We’re throwing away valuable state, our current position in the bitstream, on every iteration, forcing the CPU to perform redundant multiplications and divisions.\u003C/p>\n\u003Cp>We can think then about a \u003Cem>stateful\u003C/em> iterator. It should operate directly on the bitvector, maintaining its own position. Instead of thinking in terms of logical indices, it should think in terms of a “bit window”, a local \u003Ccode>u64\u003C/code> register that holds the current chunk of bits being processed.\u003C/p>\n\u003Cp>The idea is simple: the iterator loads one \u003Ccode>u64\u003C/code> word from the backing store into its window. It then satisfies \u003Ccode>next()\u003C/code> calls by decoding values directly from this in-register window. Only when the window runs out of bits does it need to go back to memory for the next \u003Ccode>u64\u003C/code> word. This amortizes the cost of memory access over many \u003Ccode>next()\u003C/code> calls.\u003C/p>\n\u003Cp>For forward iteration, the state is minimal:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">struct\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> FixedVecIter\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">...\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    front_window\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    front_bits_in_window\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    front_word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The \u003Ccode>next()\u003C/code> method first checks if the current \u003Ccode>front_window\u003C/code> has enough bits to satisfy the request. If \u003Ccode>self.front_bits_in_window >= bit_width\u003C/code>, it’s the fast path: a simple shift and mask on a register, which is incredibly fast.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Inside next(), fast path:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">front_bits_in_window \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">>=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">front_window \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">front_window \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">>>=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">front_bits_in_window \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Some\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">value\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>If the window is running low on bits, we hit the slower path. The next value spans the boundary between our current window and the next \u003Ccode>u64\u003C/code> word in memory. We must read the next word, combine its bits with the remaining bits in our current window, and then extract the value. This is the same logic as the spanning-word \u003Ccode>get()\u003C/code>, but it’s performed incrementally.\u003C/p>\n\u003Ch3 id=\"double-ended-iteration\">Double-Ended Iteration\u003C/h3>\n\u003Cp>But I want my iterator to be bidirectional! Well, then we need to ensure it implements \u003Ca href=\"https://doc.rust-lang.org/std/iter/trait.DoubleEndedIterator.html\">\u003Ccode>DoubleEndedIterator\u003C/code>\u003C/a> and supports \u003Ca href=\"https://doc.rust-lang.org/std/iter/trait.DoubleEndedIterator.html#tymethod.next_back\">\u003Ccode>next_back()\u003C/code>\u003C/a>. This throws a wrench in our simple stateful model. A single window and cursor can only move in one direction.\u003C/p>\n\u003Cp>The solution is to maintain two independent sets of state: one for the front and one for the back. The \u003Ccode>FixedVecIter\u003C/code> needs to track two windows, two bit counters, and two word indices.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">struct\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> FixedVecIter\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">...\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    front_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    back_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // State for forward iteration\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    front_window\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    front_bits_in_window\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    front_word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // State for backward iteration\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    back_window\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    back_bits_in_window\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    back_word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Initializing the front is easy: we load \u003Ccode>limbs[0]\u003C/code> into \u003Ccode>front_window\u003C/code>. The back is more complex. We must calculate the exact word index and the number of valid bits in the \u003Cem>last\u003C/em> word that contains data. This requires a bit of arithmetic to handle cases where the data doesn’t perfectly fill the final word.\u003C/p>\n\u003Cp>The \u003Ccode>next()\u003C/code> method consumes from the \u003Ccode>front_window\u003C/code>, advancing the front state. The \u003Ccode>next_back()\u003C/code> method consumes from the \u003Ccode>back_window\u003C/code>, advancing the back state. The iterator is exhausted when \u003Ccode>front_index\u003C/code> meets \u003Ccode>back_index\u003C/code>.\u003C/p>\n\u003Cblockquote>\n\u003Cp>The full implementation can be found in the iter module of the \u003Ca href=\"https://github.com/lukefleed/compressed-intvec/blob/master/src/fixed/iter.rs\">library\u003C/a>\u003C/p>\n\u003C/blockquote>\n\u003Ch1 id=\"writing-bits\">Writing bits\u003C/h1>\n\u003Cp>We have solved the read problem, but we may also want to modify values in place. A method like \u003Ccode>set(index, value)\u003C/code> seems simple, but it opens up the same can of worms as \u003Ccode>get\u003C/code>, just in reverse. We can’t just write the new value; we have to do so without clobbering the adjacent, unrelated data packed into the same \u003Ccode>u64\u003C/code> word.\u003C/p>\n\u003Cp>Just like with reading, the logic splits into two paths. The “fast path” handles values that are fully contained within a single \u003Ccode>u64\u003C/code>. Here, we can’t just overwrite the word. We first need to clear out the bits for the element we’re replacing and then merge in the new value.\u003C/p>\n\u003Ch2 id=\"in-word-write\">In-Word Write\u003C/h2>\n\u003Cp>Our goal here is to update a \u003Ccode>bit_width\u003C/code>-sized slice of a \u003Ccode>u64\u003C/code> word while leaving the other bits untouched. This operation must be a read-modify-write sequence to avoid corrupting adjacent elements. The most efficient way to implement this is to load the entire word into a register, perform all bitwise modifications locally, and then write the final result back to memory in a single store operation.\u003C/p>\n\u003Cp>First, we load the word from our backing \u003Ccode>limbs\u003C/code> slice.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Next, we need to create a “hole” in our local copy where the new value will go. We do this by creating a mask that has ones \u003Cem>only\u003C/em> in the bit positions we want to modify, and then inverting it to create a clearing mask.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// For a value at bit_offset, the mask must also be shifted.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> clear_mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Applying this mask zeroes out the target bits in our register copy.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x26;=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> clear_mask\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>With the target bits zeroed, we can merge our new value. The value is first shifted left by \u003Ccode>bit_offset\u003C/code> to align it correctly within the 64-bit word. Then, a bitwise OR merges it into the “hole” we just created.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Shift the new value into position and merge it.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value_w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Finally, with the modifications complete, we write the updated word from the register back to memory in a single operation.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This entire sequence of one read, two bitwise operations in-register, one write is the canonical and most efficient way to perform a sub-word update.\u003C/p>\n\u003Ch2 id=\"spanning-write\">Spanning Write\u003C/h2>\n\u003Cp>Now for the hard part: writing a value that crosses a word boundary. This operation must modify two separate \u003Ccode>u64\u003C/code> words in our backing store. It’s the inverse of the spanning read. We need to split our \u003Ccode>value_w\u003C/code> into a low part and a high part and write each to the correct word, minimizing memory accesses.\u003C/p>\n\u003Cp>To operate on two distinct memory locations, \u003Ccode>limbs[word_index]\u003C/code> and \u003Ccode>limbs[word_index + 1]\u003C/code>, we first need mutable access to both. In a safe, hot path like this, we can use \u003Ccode>split_at_mut_unchecked\u003C/code> to bypass Rust’s borrow checker bounds checks, as we have already guaranteed through our logic that both indices are valid.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// SAFETY: We know word_index and word_index + 1 are valid.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">left\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">right\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> limbs\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">split_at_mut_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Our strategy is to read both words into registers, perform all bitwise logic locally, and then write both modified words back to memory. This minimizes the time we hold mutable references and can improve performance.\u003C/p>\n\u003Cp>First, we handle the \u003Ccode>low_word\u003C/code>. We need to replace its high bits (from \u003Ccode>bit_offset\u003C/code> onwards) with the low bits of our new value. The most direct way is to create a mask for the bits we want to \u003Cem>keep\u003C/em>. The expression \u003Ccode>(1 &#x3C;&#x3C; bit_offset) - 1\u003C/code> is a bit-twiddling trick to generate a mask with \u003Ccode>bit_offset\u003C/code> ones at the least significant end.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> low_word_val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">left\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Create a mask to preserve the low `bit_offset` bits of the word.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> low_mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#F78C6C\">u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">wrapping_sub\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">low_word_val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x26;=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> low_mask\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>With the target bits zeroed out, we merge in the low part of our new value. A left shift aligns it correctly, and the high bits of \u003Ccode>value_w\u003C/code> are naturally shifted out of the register.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Merge in the low part of our new value.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">low_word_val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value_w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">left\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> low_word_val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Next, we handle the \u003Ccode>high_word\u003C/code> in a symmetrical fashion. We need to write the remaining high bits of \u003Ccode>value_w\u003C/code> into the low-order bits of this second word. First, we calculate how many bits of our value actually belong in the first word:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> remaining_bits_in_first_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now, we read the second word and create a mask to clear the low-order bits where our data will be written. With the operation \u003Ccode>self.mask >> remaining_bits_in_first_word\u003C/code> we can determine how many bits of our value spill into the second word, creating a mask for them. Inverting this gives us a mask to \u003Cem>preserve\u003C/em> the existing high-order bits of the \u003Ccode>high_word\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> high_word_val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">right\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Clear the low bits of the second word that will be overwritten.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">high_word_val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x26;=\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">>>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> remaining_bits_in_first_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Finally, we isolate the high part of \u003Ccode>value_w\u003C/code> by right-shifting it by the number of bits we already wrote, and merge it into the cleared space.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Merge in the high part of our new value.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">high_word_val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value_w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> remaining_bits_in_first_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">right\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> high_word_val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"random-write-performance\">Random Write Performance\u003C/h2>\n\u003Cp>As with reads, we can benchmark the latency of 1 million random write operations on a vector containing 10 million elements. The code for the benchmark is available here: [\u003Ccode>bench-intvec-writes\u003C/code>].\u003C/p>\n\u003Ciframe src=\"/bench-intvec/random_write_performance.html\" width=\"100%\" height=\"550px\" style=\"border: none;\">\u003C/iframe>\n\u003Cp>Here, the \u003Ccode>Vec&#x3C;T>\u003C/code> baseline is the clear winner across almost all bit-widths. This isn’t surprising. A \u003Ccode>set\u003C/code> operation in a \u003Ccode>Vec&#x3C;T>\u003C/code> compiles down to a single \u003Ccode>MOV\u003C/code> instruction with a simple addressing mode (\u003Ccode>[base + index * element_size]\u003C/code>). It’s about as fast as the hardware allows.\u003C/p>\n\u003Cp>As for the reads, the performance of our \u003Ccode>FixedVec\u003C/code> is almost identical to that of \u003Ca href=\"https://docs.rs/sux/latest/sux/bits/bit_field_vec/index.html\">\u003Ccode>sux\u003C/code>\u003C/a>. The other two crates, \u003Ca href=\"https://docs.rs/succinct/latest/succinct/trait.IntVec.html\">\u003Ccode>succinct\u003C/code>\u003C/a> and \u003Ca href=\"https://docs.rs/simple-sds-sbwt/latest/simple_sds_sbwt/int_vector/struct.IntVector.html\">\u003Ccode>simple-sds-sbwt\u003C/code>\u003C/a>, are again slower. It’s worth noting that also for the writes, neither of these last two crates provides unchecked methods.\u003C/p>\n\u003Cblockquote>\n\u003Cp>For the 64-bit width case, I honestly have no idea what is going on with \u003Ca href=\"https://docs.rs/sux/latest/sux/bits/bit_field_vec/index.html\">\u003Ccode>sux\u003C/code>\u003C/a> being so much faster than everything else, even then \u003Ccode>Vec&#x3C;u64>\u003C/code>! Mybe some weird compiler optimization? If you have any insight, please let me know.\u003C/p>\n\u003C/blockquote>\n\u003Ch1 id=\"architecture\">Architecture\u003C/h1>\n\u003Cp>With the access patterns defined, we need to think about the overall architecture of this data structure. A solution hardcoded to \u003Ccode>u64\u003C/code> would lack the flexibility to adapt to different use cases. We need a structure that is generic over the its principal components: the logical type, the physical storage type, the bit-level ordering, and ownership. We can define a struct that is generic over these four parameters:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> struct\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> FixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Storable\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">E\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Endianness\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">B\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> AsRef\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]> \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Vec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    bits\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> B\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    len\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Where:\u003C/p>\n\u003Cul>\n\u003Cli>\n\u003Cp>\u003Ccode>T\u003C/code> is the \u003Cstrong>logical element type\u003C/strong>, the type as seen by the user of the API (e.g., \u003Ccode>i16\u003C/code>, \u003Ccode>u32\u003C/code>). By abstracting \u003Ccode>T\u003C/code>, we divide the user-facing type from the internal storage representation.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>\u003Ccode>W\u003C/code> is the \u003Cstrong>physical storage word\u003C/strong>, which must implement our \u003Ccode>Word\u003C/code> trait. It defines the primitive unsigned integer (\u003Ccode>u32\u003C/code>, \u003Ccode>u64\u003C/code>, \u003Ccode>usize\u003C/code>) of the backing buffer and sets the granularity for all bitwise operations.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>\u003Ccode>E\u003C/code> requires the \u003Ccode>dsi-bitstream::Endianness\u003C/code> trait, allowing us to specify either Little-Endian (\u003Ccode>LE\u003C/code>) or Big-Endian (\u003Ccode>BE\u003C/code>) byte order.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>\u003Ccode>B\u003C/code>, which must implement \u003Ccode>AsRef&#x3C;[W]>\u003C/code>, represents the \u003Cstrong>backing storage\u003C/strong>. This abstraction over ownership allows \u003Ccode>FixedVec\u003C/code> to be either an owned container where \u003Ccode>B = Vec&#x3C;W>\u003C/code>, or a zero-copy, borrowed view where \u003Ccode>B = &#x26;[W]\u003C/code>. This makes it possible to, for example, construct a \u003Ccode>FixedVec\u003C/code> directly over a memory-mapped slice without any heap allocation.\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003Cp>In this way, the compiler monomorphizes the struct and its methods for each concrete instantiation (e.g., \u003Ccode>FixedVec&#x3C;i16, u64, LE, Vec&#x3C;u64>>\u003C/code>), resulting in specialized code with no runtime overhead from the generic abstractions.\u003C/p>\n\u003Ch2 id=\"word-trait-the-physical-storage-layer\">\u003Ccode>Word\u003C/code> Trait: The Physical Storage Layer\u003C/h2>\n\u003Cp>The first step is to abstract the physical storage layer. The \u003Ccode>W\u003C/code> parameter must be a primitive unsigned integer type that supports bitwise operations. We can define a \u003Ccode>Word\u003C/code> trait that captures these requirements:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> trait\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    UnsignedInt\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Bounded\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> ToPrimitive\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> dsi_bitstream\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">traits\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Word\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    +\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> NumCast\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Copy\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Send\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Sync\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Debug\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> IntoAtomic\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> '\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">static\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\"> BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> std\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mem\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">size_of\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">Self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>() \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The numeric traits (\u003Ccode>UnsignedInt\u003C/code>, \u003Ccode>Bounded\u003C/code>, \u003Ccode>NumCast\u003C/code>, \u003Ccode>ToPrimitive\u003C/code>) are necessary for the arithmetic of offset and mask calculations. The \u003Ccode>dsi_bitstream::traits::Word\u003C/code> bound allows us to integrate with its \u003Ccode>BitReader\u003C/code> and \u003Ccode>BitWriter\u003C/code> implementations, offloading the bitstream logic. \u003Ccode>Send\u003C/code> and \u003Ccode>Sync\u003C/code> are non-negotiable requirements for any data structure that might be used in a concurrent context. The \u003Ccode>IntoAtomic\u003C/code> bound is particularly forward-looking: it establishes a compile-time link between a storage word like \u003Ccode>u64\u003C/code> and its atomic counterpart, \u003Ccode>AtomicU64\u003C/code>. We will use it later to build a thread safe, atomic version of \u003Ccode>FixedVec\u003C/code>. Finally, the \u003Ccode>const BITS\u003C/code> associated constant lets us write architecture-agnostic code that correctly adapts to \u003Ccode>u32\u003C/code>, \u003Ccode>u64\u003C/code>, or \u003Ccode>usize\u003C/code> words without \u003Ccode>cfg\u003C/code> flags.\u003C/p>\n\u003Ch2 id=\"storable-trait-the-logical-type-layer\">\u003Ccode>Storable\u003C/code> Trait: The Logical Type Layer\u003C/h2>\n\u003Cp>With the physical storage layer defined, we need a formal contract to connect it to the user’s logical type \u003Ccode>T\u003C/code>. We can do this by creating the \u003Ccode>Storable\u003C/code> trait, which defines a bidirectional, lossless conversion.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> trait\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Storable\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Sized\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Copy\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> into_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> from_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> Self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>For unsigned types, the implementation is a direct cast. For signed types, however, we must map the \u003Ccode>iN\u003C/code> domain to the \u003Ccode>uN\u003C/code> domain required for bit-packing. A simple two’s complement bitcast is unsuitable, as \u003Ccode>i64(-1)\u003C/code> would become \u003Ccode>u64::MAX\u003C/code>, a value requiring the maximum number of bits. We need a better mapping that preserves small absolute values.\u003C/p>\n\u003Cp>We can use \u003Cstrong>ZigZag encoding\u003C/strong>, which maps integers with small absolute values to small unsigned integers. This is implemented via the \u003Ccode>ToNat\u003C/code> and \u003Ccode>ToInt\u003C/code> traits from \u003Ccode>dsi-bitstream\u003C/code>. The core encoding logic in \u003Ccode>to_nat\u003C/code> is:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// From dsi_bitstream::traits::ToNat\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> to_nat\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> Self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">UnsignedInt\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">to_unsigned\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">^\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">Self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">to_unsigned\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This operation works as follows: \u003Ccode>(self &#x3C;&#x3C; 1)\u003C/code> creates a space at the LSB. The term \u003Ccode>(self >> (Self::BITS - 1))\u003C/code> is an arithmetic right shift, which generates a sign mask—all zeros for non-negative numbers, all ones for negative numbers. The final XOR uses this mask to interleave positive and negative integers: 0 becomes 0, -1 becomes 1, 1 becomes 2, -2 becomes 3, and so on.\u003C/p>\n\u003Cp>The decoding reverses this transformation:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// From dsi_bitstream::traits::ToInt\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> to_int\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> Self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">SignedInt\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">to_signed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">^\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">to_signed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Here, \u003Ccode>(self >> 1)\u003C/code> shifts the value back. The term \u003Ccode>-(self &#x26; 1)\u003C/code> creates a mask from the LSB (the original sign bit). In two’s complement, this becomes \u003Ccode>0\u003C/code> for even numbers (originally positive) and \u003Ccode>-1\u003C/code> (all ones) for odd numbers (originally negative). The final XOR with this mask correctly restores the original two’s complement representation.\u003C/p>\n\u003Cp>We might ask ourselves: why not just a direct bitcast for signed types, perhaps via a \u003Ccode>uN -> iN\u003C/code> chain. Well, while a direct \u003Ca href=\"https://doc.rust-lang.org/std/mem/fn.transmute.html\">transmute\u003C/a> between same-sized integer types is a no-op, the approach fails when the logical \u003Ccode>bit_width\u003C/code> is smaller than the physical type size. \u003Ccode>FixedVec\u003C/code>’s core logic extracts a \u003Ccode>bit_width\u003C/code>-sized unsigned integer from its storage. For example, when reading a 4-bit representation of \u003Ccode>-1\u003C/code> (binary \u003Ccode>1111\u003C/code>), the \u003Ccode>from_word\u003C/code> function receives the value \u003Ccode>15u64\u003C/code>. At this point, the context that those four bits represented a negative number is lost. A cast chain like \u003Ccode>15u64 as u8 as i8\u003C/code> would simply yield \u003Ccode>15i8\u003C/code>, not \u003Ccode>-1i8\u003C/code>.\u003C/p>\n\u003Cp>To correctly reconstruct the signed value, one would need to manually perform sign extension based on the known \u003Ccode>bit_width\u003C/code>. This involves checking the most significant bit of the extracted value and, if set, filling the higher-order bits of the word with ones. This logic requires a conditional branch, which can introduce pipeline stalls and degrade performance in tight loops. ZigZag decoding, by contrast, is a purely arithmetic, branch-free transformation. Its reconstruction logic is a simple sequence of bitwise shifts and XORs, making it a faster and more consistent choice for the hot path of data access.\u003C/p>\n\u003Cp>With this logic within the trait system, the main \u003Ccode>FixedVec\u003C/code> implementation remains clean and agnostic to the signedness of the data it stores.\u003C/p>\n\u003Ch2 id=\"builder-pattern\">Builder Pattern\u003C/h2>\n\u003Cp>Once the structure logic is in place, we have to design an ergonomic way to construct it. A simple \u003Ccode>new()\u003C/code> function isn’t sufficient because the vector’s memory layout depends on parameters that must be determined \u003Cem>before\u003C/em> allocation, most critically the \u003Ccode>bit_width\u003C/code>. This is a classic scenario for a builder pattern.\u003C/p>\n\u003Cp>The central problem is that the optimal \u003Ccode>bit_width\u003C/code> often depends on the data itself. We need a mechanism to specify the \u003Cem>strategy\u003C/em> for determining this width. We can create the \u003Ccode>BitWidth\u003C/code> enum:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> enum\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> BitWidth\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    Minimal\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    PowerOfTwo\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    Explicit\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>With this enum, the user can choose between three strategies:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ccode>Minimal\u003C/code>: The builder scans the input data to find the maximum value, then calculates the minimum number of bits required to represent it. This is the most space-efficient option but requires a full pass over the data.\u003C/li>\n\u003Cli>\u003Ccode>PowerOfTwo\u003C/code>: Similar to \u003Ccode>Minimal\u003C/code>, but rounds the bit width up to the next power of two. This can simplify certain bitwise operations and align better with hardware word sizes, at the cost of some additional space.\u003C/li>\n\u003Cli>\u003Ccode>Explicit(n)\u003C/code>: The user provides a fixed bit width. This avoids the data scan but requires the user to ensure that all values fit within the specified width.\u003C/li>\n\u003C/ul>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Note:\u003C/strong> Yes, I could have also made three different build functions: \u003Ccode>new_with_minimal_bit_width()\u003C/code>, \u003Ccode>new_with_power_of_two_bit_width()\u003C/code>, and \u003Ccode>new_with_explicit_bit_width(n)\u003C/code>. However, this would lead to a combinatorial explosion if we later wanted to add more configuration options. The builder pattern scales better.\u003C/p>\n\u003C/blockquote>\n\u003Cp>With this, the \u003Ccode>FixedVecBuilder\u003C/code> could be designed as a state machine. It holds the chosen \u003Ccode>BitWidth\u003C/code> strategy. The final \u003Ccode>build()\u003C/code> method takes the input slice and executes the appropriate logic.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// A look at the builder's logic flow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> build\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">input\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Result\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">FixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">...\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Error\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> final_bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> match\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width_strategy {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">        BitWidth\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Explicit\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">n\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> n\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        _\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">            // For Minimal or PowerOfTwo, we first find the max value.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">            let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> max_val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> input\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">iter\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">map\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> v\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">into_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">max\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unwrap_or\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">            let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> min_bits\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> max_val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">leading_zeros\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">max\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            match\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width_strategy {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">                BitWidth\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Minimal\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> min_bits\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">                BitWidth\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">PowerOfTwo\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> min_bits\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">next_power_of_two\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">                _\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> unreachable!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ... (rest of the logic: allocate buffer, write data) ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This design cleanly separates the configuration phase from the execution phase. The user can declaratively state their requirements, and the builder handles the implementation details, whether that involves a full data scan or a direct construction. For example:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">use\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> compressed_intvec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">prelude\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::*\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">u32\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">100\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">200\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">500\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]; \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Max value 500 requires 9 bits\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// The builder will scan the data, find max=500, calculate min_bits=9,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// and then round up to the next power of two.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> vec_pow2\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> UFixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">u32\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> FixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">builder\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(BitWidth\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">PowerOfTwo\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">build\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unwrap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">assert_eq!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">vec_pow2\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(), \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">16\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cblockquote>\n\u003Cp>\u003Ccode>UFixedVec&#x3C;T>\u003C/code> is a type alias for \u003Ccode>FixedVec&#x3C;T, u64, LE, Vec&#x3C;u64>>\u003C/code>, the most common instantiation.\u003C/p>\n\u003C/blockquote>\n\u003Ch1 id=\"doing-more-than-just-reading\">Doing more than just reading\u003C/h1>\n\u003Cp>The design of \u003Ccode>FixedVec\u003C/code> allows for more than just efficient reads. We can extend it to support mutation and even thread-safe (almost atomic) concurrent access.\u003C/p>\n\u003Ch2 id=\"mutability-proxy-objects\">Mutability: Proxy Objects\u003C/h2>\n\u003Cp>A core feature of \u003Ccode>std::vec::Vec\u003C/code> is mutable, index-based access via \u003Ccode>&#x26;mut T\u003C/code>. This is fundamentally impossible for \u003Ccode>FixedVec\u003C/code>. An element, such as a 10-bit integer, is not a discrete, byte-aligned entity in memory. It is a virtual value extracted from a bitstream, potentially spanning the boundary of two different \u003Ccode>u64\u003C/code> words. It has no stable memory address, so a direct mutable reference cannot be formed.\u003C/p>\n\u003Cp>To provide an ergonomic mutable API, we must emulate the behavior of a mutable reference. We achieve this through a proxy object pattern, implemented in a struct named \u003Ccode>MutProxy\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> struct\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> MutProxy\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">E\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">B\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">where\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Storable\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    W\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    E\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Endianness\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    B\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> AsRef\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]> \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> AsMut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    vec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">a\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> FixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">E\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">B\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// A temporary, decoded copy of the element's value.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>When we call a method like \u003Ccode>at_mut(index)\u003C/code>, it does not return a reference. Instead, it constructs and returns a \u003Ccode>MutProxy\u003C/code> instance. The proxy’s lifecycle manages the entire modification process:\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Construction:\u003C/strong> The proxy is created. Its first action is to call the parent \u003Ccode>FixedVec\u003C/code>’s internal \u003Ccode>get\u003C/code> logic to read and decode the value at the specified \u003Ccode>index\u003C/code>. This decoded value is stored as a temporary copy inside the proxy object itself.\u003C/li>\n\u003Cli>\u003Cstrong>Modification:\u003C/strong> The \u003Ccode>MutProxy\u003C/code> implements \u003Ccode>Deref\u003C/code> and \u003Ccode>DerefMut\u003C/code>, allowing the user to interact with the temporary copy as if it were the real value. Any modifications (\u003Ccode>*proxy = new_value\u003C/code>, \u003Ccode>*proxy += 1\u003C/code>) are applied to this local copy, not to the underlying bitstream.\u003C/li>\n\u003Cli>\u003Cstrong>Destruction:\u003C/strong> When the \u003Ccode>MutProxy\u003C/code> goes out of scope, its \u003Ccode>Drop\u003C/code> implementation is executed. This is the critical step where the potentially modified value from the temporary copy is taken, re-encoded, and written back into the correct bit position in the parent \u003Ccode>FixedVec\u003C/code>’s storage.\u003C/li>\n\u003C/ol>\n\u003Cp>This is a classic copy-on-read, write-on-drop mechanism. It provides a safe and ergonomic abstraction for mutating non-addressable data, preserving the feel of direct manipulation while correctly handling the bit-level operations under the hood. The overhead is a single read at the start of the proxy’s life and a single write at the end.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">use\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> compressed_intvec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">fixed\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">FixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">UFixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">BitWidth\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">u32\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">10\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">20\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">30\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> vec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> UFixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">u32\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> FixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">builder\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(BitWidth\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Explicit\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">7\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">build\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unwrap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// vec.at_mut(1) returns an Option&#x3C;MutProxy&#x3C;...>>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">if\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> let\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Some\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> proxy\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> vec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">at_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // The DerefMut trait allows us to modify the proxy's internal copy.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">proxy\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 99\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">} \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// The proxy is dropped here. Its Drop impl writes 99 back to the vec.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">assert_eq!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">vec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">), \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Some\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">99\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The overhead of this approach is a single read on the proxy’s construction and a single write on its destruction, which is an acceptable trade-off for an ergonomic and safe mutable API.\u003C/p>\n\u003Ch3 id=\"zero-copy-views\">Zero-Copy Views\u003C/h3>\n\u003Cp>A \u003Ccode>Vec\u003C/code>-like API needs to support slicing. Creating a \u003Ccode>FixedVec\u003C/code> that borrows its data (\u003Ccode>B = &#x26;[W]\u003C/code>) is the first step for this, but we also need a dedicated slice type to represent a sub-region of another \u003Ccode>FixedVec\u003C/code> without copying data. For this we can create \u003Ccode>FixedVecSlice\u003C/code>.\u003C/p>\n\u003Cp>We can implement this as a classic “fat pointer” struct. It holds a reference to the parent \u003Ccode>FixedVec\u003C/code> and a \u003Ccode>Range&#x3C;usize>\u003C/code> that defines the logical boundaries of the view.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// A zero-copy view into a contiguous portion of a FixedVec.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">#[derive(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Debug\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> struct\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> FixedVecSlice\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">V\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    pub\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">super\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">parent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> V\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    pub\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">super\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">range\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Range\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The generic parameter \u003Ccode>V\u003C/code> is a reference to the parent vector. This allows the same \u003Ccode>FixedVecSlice\u003C/code> struct to represent both immutable (\u003Ccode>V = &#x26;FixedVec&#x3C;...>\u003C/code>) and mutable (\u003Ccode>V = &#x26;mut FixedVec&#x3C;...>\u003C/code>) views.\u003C/p>\n\u003Cp>We can implement all the operations on the slice by translating the slice-relative index into an absolute index in the parent vector. For example, we can easily implement \u003Ccode>get_unchecked\u003C/code> with this delegation:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Index translation within the slice's get_unchecked\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> unsafe\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    debug_assert!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">len\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // The index is relative to the slice, so we add the slice's start\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // offset to get the correct index in the parent vector.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">parent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get_unchecked\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">range\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">start \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>In this way there is no code duplication; the slice re-uses the access logic of the parent \u003Ccode>FixedVec\u003C/code>.\u003C/p>\n\u003Ch2 id=\"mutable-slices\">Mutable Slices\u003C/h2>\n\u003Cp>For mutable slices (\u003Ccode>V = &#x26;mut FixedVec&#x3C;...>\u003C/code> ), we can provide mutable access to the slice’s elements. We can easily implement the \u003Ccode>at_mut\u003C/code> method on \u003Ccode>FixedVecSlice\u003C/code> using the same principle of index translation:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> at_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Option\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">MutProxy\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">W\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">E\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">B\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">len\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> None\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // The index is translated to the parent vector's coordinate space.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    Some\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">MutProxy\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">new\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">parent, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">range\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">start \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>A mutable slice borrows the parent \u003Ccode>FixedVec\u003C/code> mutably. This means that while the slice exists, the parent vector cannot be accessed directly due to Rust’s borrowing rules. Let’s consider the following situation: we may need to split a mutable slice into two non-overlapping mutable slices. This is common for example in algorithms that operate on sub-regions of an array. However, implementing such a method requires to use some unsafe code. The method, let’s say \u003Ccode>split_at_mut\u003C/code>, must produce two \u003Ccode>&#x26;mut\u003C/code> references from a single one. In order to be safe, we must prove to the compiler that the logical ranges they represent (\u003Ccode>0..mid\u003C/code> and \u003Ccode>mid..len\u003C/code>) are disjoint.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> split_at_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">mid\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">FixedVecSlice\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> Self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">FixedVecSlice\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> Self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    assert!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">mid\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">len, \u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">mid > len in split_at_mut\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // SAFETY: The two slices are guaranteed not to overlap.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    unsafe\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> ptr\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> Self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> left\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> FixedVecSlice\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">new\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">ptr\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">..\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">mid\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> right\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> FixedVecSlice\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">new\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">ptr\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">mid\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">..\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">len\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">left\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">right\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This combination of a generic slice struct and careful pointer manipulation allows us to build a rich, safe, and zero-copy API for both immutable and mutable views, mirroring Rust’s native slice\u003C/p>\n\u003Ch1 id=\"next-steps\">Next Steps\u003C/h1>\n\u003Cp>Our \u003Ccode>FixedVec\u003C/code> works pretty well at the current state, but its strengths are tied to two key assumptions: a single thread of execution and uniformly bounded data. Real-world systems often challenge both. This opens up two distinct paths for us to extend our design: one to handle concurrency, and another to adapt to more complex data distributions.\u003C/p>\n\u003Ch2 id=\"concurrent-access\">Concurrent Access\u003C/h2>\n\u003Cp>The design of \u003Ccode>FixedVec\u003C/code> is fundamentally single-threaded. Its mutable access relies on direct writes to the underlying bit buffer, a model that offers no guarantees in a concurrent setting. The core conflict lies between our data layout and the hardware’s atomic primitives. CPU instructions like compare-and-swap operate on aligned machine words, typically \u003Ccode>u64\u003C/code>. Our elements, however, are packed at arbitrary bit offsets and can span the boundary between two words.\u003C/p>\n\u003Cp>This means a single logical update—modifying one element—might require writing to two separate \u003Ccode>u64\u003C/code> words. Performing this as two distinct atomic writes would create a race condition, leaving the data in a corrupt state if another thread reads between them. A single atomic write to one of the underlying \u003Ccode>u64\u003C/code> words would be equally disastrous, as it could simultaneously alter parts of two different elements. The problem then is how to build atomic semantics on top of a non-atomic memory layout. In the next post, we will construct a solution that provides thread-safe, atomic operations for our bit-packed vector.\u003C/p>\n\u003Ch2 id=\"variable-length-encoding\">Variable Length Encoding\u003C/h2>\n\u003Cp>Let’s consider the following scenario: we have a large collection of integers, all of which are small, say in the range \u003Ccode>[0, 255]\u003C/code>, but with a few outliers that are much larger, perhaps up to \u003Ccode>u64::MAX\u003C/code>. If we were to use our \u003Ccode>FixedVec\u003C/code> with a \u003Ccode>bit_width\u003C/code> of 64 to accommodate the outliers, we would waste a significant amount of memory on the small integers. Conversely, if we chose a smaller \u003Ccode>bit_width\u003C/code>, we would be unable to represent the outliers at all.\u003C/p>\n\u003Cp>The fixed-width model rests on that critical assumption of uniformly bounded data. Its performance comes from this predictability, but this rigid structure is also its main weakness.\u003C/p>\n\u003Cp>For skewed data distributions, we need a different model. Instead of a fixed number of bits per element, we can use variable-length instantaneous codes, where smaller numbers are represented by shorter bit sequences. This gives us excellent compression, but it breaks our O(1) random access guarantee. We can no longer compute the location of the i-th element with a simple multiplication. The solution is to trade a small amount of space for a speedup in access time. We can build a secondary index that stores the bit-offset of every k-th element. This sampling allows us to seek to a nearby checkpoint and decode sequentially from there, restoring amortized O(1) access. In a future article, we’ll explore this second vector type, its own set of performance trade-offs, and how we can choose the best encoding for our data.\u003C/p>\n\u003Chr>\n\u003Cp>We will explore this two paths in future articles. In the meantime, if you want to try them out, they are both already implemented in the library. You can find the atomic version in the \u003Ca href=\"https://docs.rs/compressed-intvec/latest/compressed_intvec/fixed/atomic/index.html\">atomic\u003C/a> module and the variable-length version in the \u003Ca href=\"https://docs.rs/compressed-intvec/latest/compressed_intvec/variable/struct.IntVec.html\">variable\u003C/a> module.\u003C/p>",{"headings":282,"localImagePaths":350,"remoteImagePaths":351,"frontmatter":352,"imagePaths":355},[283,287,290,293,296,299,302,305,308,311,314,317,320,323,326,329,332,335,338,341,344,347],{"depth":284,"slug":285,"text":286},1,"memory-waste-in-standard-vectors","Memory Waste in Standard Vectors",{"depth":284,"slug":288,"text":289},"packing-and-accessing-bits","Packing and Accessing Bits",{"depth":31,"slug":291,"text":292},"crossing-word-boundaries","Crossing Word Boundaries",{"depth":31,"slug":294,"text":295},"faster-reads-unaligned-access","Faster Reads: Unaligned Access",{"depth":31,"slug":297,"text":298},"random-access-performance","Random Access Performance",{"depth":31,"slug":300,"text":301},"iterating-over-values","Iterating Over Values",{"depth":47,"slug":303,"text":304},"double-ended-iteration","Double-Ended Iteration",{"depth":284,"slug":306,"text":307},"writing-bits","Writing bits",{"depth":31,"slug":309,"text":310},"in-word-write","In-Word Write",{"depth":31,"slug":312,"text":313},"spanning-write","Spanning Write",{"depth":31,"slug":315,"text":316},"random-write-performance","Random Write Performance",{"depth":284,"slug":318,"text":319},"architecture","Architecture",{"depth":31,"slug":321,"text":322},"word-trait-the-physical-storage-layer","Word Trait: The Physical Storage Layer",{"depth":31,"slug":324,"text":325},"storable-trait-the-logical-type-layer","Storable Trait: The Logical Type Layer",{"depth":31,"slug":327,"text":328},"builder-pattern","Builder Pattern",{"depth":284,"slug":330,"text":331},"doing-more-than-just-reading","Doing more than just reading",{"depth":31,"slug":333,"text":334},"mutability-proxy-objects","Mutability: Proxy Objects",{"depth":47,"slug":336,"text":337},"zero-copy-views","Zero-Copy Views",{"depth":31,"slug":339,"text":340},"mutable-slices","Mutable Slices",{"depth":284,"slug":342,"text":343},"next-steps","Next Steps",{"depth":31,"slug":345,"text":346},"concurrent-access","Concurrent Access",{"depth":31,"slug":348,"text":349},"variable-length-encoding","Variable Length Encoding",[],[],{"author":269,"pubDatetime":353,"title":271,"slug":266,"featured":179,"draft":18,"tags":354,"description":275},["Date","2025-09-24T00:00:00.000Z"],[273,274],[],"predefined-color-schemes",{"id":356,"data":358,"body":364,"filePath":365,"digest":366,"rendered":367},{"author":14,"pubDatetime":359,"modDatetime":360,"title":361,"featured":18,"draft":18,"tags":362,"description":363},["Date","2022-09-26T12:13:24.000Z"],["Date","2024-01-04T09:09:06.000Z"],"Predefined color schemes",[70],"Some of the well-crafted, predefined color schemes for AstroPaper blog theme.","I've crafted some predefined color schemes for this AstroPaper blog theme. You can replace these color schemes with the original ones.\n\nIf you don't know how you can configure color schemes, check [this blog post](https://astro-paper.pages.dev/posts/customizing-astropaper-theme-color-schemes/).\n\n## Table of contents\n\n## Light color schemes\n\nLight color scheme has to be defined using the css selector `:root` and `html[data-theme=\"light\"]`.\n\n### Lobster\n\n![lobster-color-scheme](https://user-images.githubusercontent.com/53733092/192282447-1d222faf-a3ce-44a9-9cfe-ac873155e5a9.png)\n\n```css\n:root,\nhtml[data-theme=\"light\"] {\n  --background: #f6eee1;\n  --foreground: #012c56;\n  --accent: #e14a39;\n  --muted: #efd8b0;\n  --border: #dc9891;\n}\n```\n\n### Leaf Blue\n\n![leaf-blue-color-scheme](https://user-images.githubusercontent.com/53733092/192318782-e80e3c39-54b5-423e-8f4b-9ae60402fc8d.png)\n\n```css\n:root,\nhtml[data-theme=\"light\"] {\n  --background: #f2f5ec;\n  --foreground: #353538;\n  --accent: #1158d1;\n  --muted: #bbc789;\n  --border: #7cadff;\n}\n```\n\n### Pinky light\n\n![pinky-color-scheme](https://user-images.githubusercontent.com/53733092/192286510-892d0042-2d6d-471e-bb72-954221ae2d17.png)\n\n```css\n:root,\nhtml[data-theme=\"light\"] {\n  --background: #fafcfc;\n  --foreground: #222e36;\n  --accent: #d3006a;\n  --muted: #f1bad4;\n  --border: #e3a9c6;\n}\n```\n\n## Dark color schemes\n\nDark color scheme has to be defined as `html[data-theme=\"dark\"]`.\n\n### AstroPaper 1 original Dark Theme\n\n![AstroPaper 1 default dark theme](https://user-images.githubusercontent.com/53733092/215769153-13b0ad8d-5ba2-44b1-af06-e5ae61293f62.png)\n\n```css\nhtml[data-theme=\"dark\"] {\n  --background: #2f3741;\n  --foreground: #e6e6e6;\n  --accent: #1ad9d9;\n  --muted: #596b81;\n  --border: #3b4655;\n}\n```\n\n### Deep Oyster\n\n![deep-oyster-color-scheme](https://user-images.githubusercontent.com/53733092/192314524-45ec5904-3d8f-450a-9edf-1e32c5e11d6c.png)\n\n```css\nhtml[data-theme=\"dark\"] {\n  --background: #21233d;\n  --foreground: #f4f7f5;\n  --accent: #ff5256;\n  --muted: #4a4e86;\n  --border: #b12f32;\n}\n```\n\n### Pikky dark\n\n![pinky-dark-color-scheme](https://user-images.githubusercontent.com/53733092/192307050-fbd55326-911c-4001-87c6-a8ad9378ac2e.png)\n\n```css\nhtml[data-theme=\"dark\"] {\n  --background: #353640;\n  --foreground: #e9edf1;\n  --accent: #ff78c8;\n  --muted: #715566;\n  --border: #86436b;\n}\n```\n\n### Astro dark (High Contrast)\n\n![astro-dark-color-scheme](https://user-images.githubusercontent.com/53733092/215680520-59427bb0-f4cb-48c0-bccc-f182a428d72d.svg)\n\n```css\nhtml[data-theme=\"dark\"] {\n  --background: #212737;\n  --foreground: #eaedf3;\n  --accent: #ff6b01;\n  --muted: #8a3302;\n  --border: #ab4b08;\n}\n```\n\n### Astro dark (New default dark theme in AstroPaper 2)\n\n![new dark color scheme - low contrast](https://user-images.githubusercontent.com/53733092/215772856-d5b7ae35-ddaa-4ed6-b0bf-3fa5dbcf834c.png)\n\n```css\nhtml[data-theme=\"dark\"] {\n  --background: #212737; /* lower contrast background */\n  --foreground: #eaedf3;\n  --accent: #ff6b01;\n  --muted: #8a3302;\n  --border: #ab4b08;\n}\n```\n\n### Astro Deep Purple (New dark theme in AstroPaper 3)\n\n![AstroPaper v3 new theme](https://github.com/satnaing/astro-paper/assets/53733092/c8b5d7e1-a3bc-4852-a5ad-4abf7b3cec79)\n\n```css\nhtml[data-theme=\"dark\"] {\n  --background: #212737;\n  --foreground: #eaedf3;\n  --accent: #eb3fd3;\n  --muted: #7d4f7c;\n  --border: #642451;\n}\n```\n\n### AstroPaper v4 Special (New dark theme in AstroPaper 4)\n\n![AstroPaper v4 new theme](https://github.com/satnaing/astro-paper/assets/53733092/66eb74dc-7a0e-4f2e-982d-25f5c443b25a)\n\n```css\nhtml[data-theme=\"dark\"] {\n  --background: #000123;\n  --accent: #617bff;\n  --foreground: #eaedf3;\n  --muted: #0c0e4f;\n  --border: #303f8a;\n}\n```","src/data/blog/predefined-color-schemes.md","f9434f62ad912006",{"html":368,"metadata":369},"\u003Cp>I’ve crafted some predefined color schemes for this AstroPaper blog theme. You can replace these color schemes with the original ones.\u003C/p>\n\u003Cp>If you don’t know how you can configure color schemes, check \u003Ca href=\"https://astro-paper.pages.dev/posts/customizing-astropaper-theme-color-schemes/\">this blog post\u003C/a>.\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#light-color-schemes\">Light color schemes\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#lobster\">Lobster\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#leaf-blue\">Leaf Blue\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#pinky-light\">Pinky light\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#dark-color-schemes\">Dark color schemes\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#astropaper-1-original-dark-theme\">AstroPaper 1 original Dark Theme\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#deep-oyster\">Deep Oyster\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#pikky-dark\">Pikky dark\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#astro-dark-high-contrast\">Astro dark (High Contrast)\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#astro-dark-new-default-dark-theme-in-astropaper-2\">Astro dark (New default dark theme in AstroPaper 2)\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#astro-deep-purple-new-dark-theme-in-astropaper-3\">Astro Deep Purple (New dark theme in AstroPaper 3)\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#astropaper-v4-special-new-dark-theme-in-astropaper-4\">AstroPaper v4 Special (New dark theme in AstroPaper 4)\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"light-color-schemes\">Light color schemes\u003C/h2>\n\u003Cp>Light color scheme has to be defined using the css selector \u003Ccode>:root\u003C/code> and \u003Ccode>html[data-theme=\"light\"]\u003C/code>.\u003C/p>\n\u003Ch3 id=\"lobster\">Lobster\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/192282447-1d222faf-a3ce-44a9-9cfe-ac873155e5a9.png\" alt=\"lobster-color-scheme\">\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">root\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">f6eee1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">012c56\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">e14a39\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">efd8b0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">dc9891\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"leaf-blue\">Leaf Blue\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/192318782-e80e3c39-54b5-423e-8f4b-9ae60402fc8d.png\" alt=\"leaf-blue-color-scheme\">\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">root\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">f2f5ec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">353538\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">1158d1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">bbc789\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">7cadff\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"pinky-light\">Pinky light\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/192286510-892d0042-2d6d-471e-bb72-954221ae2d17.png\" alt=\"pinky-color-scheme\">\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">root\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">fafcfc\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">222e36\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">d3006a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">f1bad4\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">e3a9c6\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"dark-color-schemes\">Dark color schemes\u003C/h2>\n\u003Cp>Dark color scheme has to be defined as \u003Ccode>html[data-theme=\"dark\"]\u003C/code>.\u003C/p>\n\u003Ch3 id=\"astropaper-1-original-dark-theme\">AstroPaper 1 original Dark Theme\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/215769153-13b0ad8d-5ba2-44b1-af06-e5ae61293f62.png\" alt=\"AstroPaper 1 default dark theme\">\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">2f3741\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">e6e6e6\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">1ad9d9\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">596b81\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">3b4655\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"deep-oyster\">Deep Oyster\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/192314524-45ec5904-3d8f-450a-9edf-1e32c5e11d6c.png\" alt=\"deep-oyster-color-scheme\">\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">21233d\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">f4f7f5\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ff5256\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">4a4e86\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">b12f32\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"pikky-dark\">Pikky dark\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/192307050-fbd55326-911c-4001-87c6-a8ad9378ac2e.png\" alt=\"pinky-dark-color-scheme\">\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">353640\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">e9edf1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ff78c8\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">715566\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">86436b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"astro-dark-high-contrast\">Astro dark (High Contrast)\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/215680520-59427bb0-f4cb-48c0-bccc-f182a428d72d.svg\" alt=\"astro-dark-color-scheme\">\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">212737\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">eaedf3\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ff6b01\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">8a3302\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ab4b08\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"astro-dark-new-default-dark-theme-in-astropaper-2\">Astro dark (New default dark theme in AstroPaper 2)\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/215772856-d5b7ae35-ddaa-4ed6-b0bf-3fa5dbcf834c.png\" alt=\"new dark color scheme - low contrast\">\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">212737\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/* lower contrast background */\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">eaedf3\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ff6b01\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">8a3302\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ab4b08\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"astro-deep-purple-new-dark-theme-in-astropaper-3\">Astro Deep Purple (New dark theme in AstroPaper 3)\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://github.com/satnaing/astro-paper/assets/53733092/c8b5d7e1-a3bc-4852-a5ad-4abf7b3cec79\" alt=\"AstroPaper v3 new theme\">\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">212737\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">eaedf3\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">eb3fd3\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">7d4f7c\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">642451\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"astropaper-v4-special-new-dark-theme-in-astropaper-4\">AstroPaper v4 Special (New dark theme in AstroPaper 4)\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://github.com/satnaing/astro-paper/assets/53733092/66eb74dc-7a0e-4f2e-982d-25f5c443b25a\" alt=\"AstroPaper v4 new theme\">\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">000123\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">617bff\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">eaedf3\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">0c0e4f\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">303f8a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>",{"headings":370,"localImagePaths":408,"remoteImagePaths":409,"frontmatter":410,"imagePaths":414},[371,372,375,378,381,384,387,390,393,396,399,402,405],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":373,"text":374},"light-color-schemes","Light color schemes",{"depth":47,"slug":376,"text":377},"lobster","Lobster",{"depth":47,"slug":379,"text":380},"leaf-blue","Leaf Blue",{"depth":47,"slug":382,"text":383},"pinky-light","Pinky light",{"depth":31,"slug":385,"text":386},"dark-color-schemes","Dark color schemes",{"depth":47,"slug":388,"text":389},"astropaper-1-original-dark-theme","AstroPaper 1 original Dark Theme",{"depth":47,"slug":391,"text":392},"deep-oyster","Deep Oyster",{"depth":47,"slug":394,"text":395},"pikky-dark","Pikky dark",{"depth":47,"slug":397,"text":398},"astro-dark-high-contrast","Astro dark (High Contrast)",{"depth":47,"slug":400,"text":401},"astro-dark-new-default-dark-theme-in-astropaper-2","Astro dark (New default dark theme in AstroPaper 2)",{"depth":47,"slug":403,"text":404},"astro-deep-purple-new-dark-theme-in-astropaper-3","Astro Deep Purple (New dark theme in AstroPaper 3)",{"depth":47,"slug":406,"text":407},"astropaper-v4-special-new-dark-theme-in-astropaper-4","AstroPaper v4 Special (New dark theme in AstroPaper 4)",[],[],{"author":14,"pubDatetime":411,"modDatetime":412,"title":361,"slug":356,"featured":18,"draft":18,"tags":413,"description":363},["Date","2022-09-26T12:13:24.000Z"],["Date","2024-01-04T09:09:06.000Z"],[70],[],"competitive-programming-reminders",{"id":415,"data":417,"body":425,"filePath":426,"digest":427,"rendered":428},{"author":269,"pubDatetime":418,"title":419,"featured":18,"draft":179,"tags":420,"description":424},["Date","2022-12-01T00:00:00.000Z"],"Competitive Programming Friendly reminders",[421,422,423],"Competitive Programming","Algorithms and Data Structures","Python","An incomplete summary of the most important algorithms and data structures to remember before a coding interview","## Arrays\n\nArrays are a collection of values. They are ordered and can be accessed by index. Arrays are zero-indexed, meaning the first element is at index 0. Arrays can be of any type, including other arrays.\n\n## HashTable\n\nAn HashTable is a data structure that maps keys to values for highly efficient lookup. It is a structure that can be implemented with arrays, linked lists, binary search trees (in this case we would have $O(n \\log n)$ lookup time. The advantage of this is potentially using less space, since we no longer allocate a large array. We can also iterate through the keys i order, which can be useful sometimes), or hash tables.\n\n```python\nHashTable = dict()\n```\n\nor if we want to use defaultdict\n\n```python\nfrom collections import defaultdict\n\nHashTable = defaultdict(int)\n# a default value of 0 is assigned to all keys\n```\n\n## ArrayList & ResizableArray\n\nWhen you need an array-like data structure that offers dynamic resizing, you would usually use an Arraylist. An Arraylist is an array that resizes itself as needed while still providing $O(1)$ access.\n\n```python\nArray = [None] * 1000\n# array of 1000 elements, all None\n```\n\n# Binary Search\n\nBinary search is a search algorithm that finds the position of a target value within a sorted array. Binary search compares the target value to the middle element of the array. If they are not equal, the half in which the target cannot lie is eliminated and the search continues on the remaining half, again taking the middle element to compare to the target value, and repeating this until the target value is found. If the search ends with the remaining half being empty, the target is not in the array.\n\n```python\ndef binary_search(arr, target):\n    left = 0\n    right = len(arr) - 1\n\n    while left \u003C= right:\n        mid = (left + right) // 2\n        if arr[mid] == target:\n            return mid\n        elif arr[mid] \u003C target:\n            left = mid + 1\n        else:\n            right = mid - 1\n\n    return -1\n```\n\n## Algorithms\n\n### QuickSelect\n\nQuickSelect is a selection algorithm to find the k-th smallest/largest element in an unordered list. It is related to the quick sort sorting algorithm.\n\n```python\ndef quick_select(arr, k):\n    if len(arr) == 1:\n        return arr[0]\n\n    pivot = random.choice(arr)\n    left = [x for x in arr if x \u003C pivot]\n    middle = [x for x in arr if x == pivot]\n    right = [x for x in arr if x > pivot]\n\n    if k \u003C= len(left):\n        return quick_select(left, k)\n    elif k \u003C= len(left) + len(middle):\n        return middle[0]\n    else:\n        return quick_select(right, k - len(left) - len(middle))\n```\n\n# Stack\n\nThe stack data structure is precisely what it sounds like: a stack of data. In certain types of problems, it can be favorable to store data in a stack rather than in an array.\n\nA stack uses LIFO (last-in first-out) ordering. That is, as in a stack of dinner plates, the most recent item added to the stack is the first item to be removed.\n\nIt uses the following operations:\n\n- `push(item)`: adds an item to the top of the stack\n- `pop()`: removes the top item from the stack\n- `peek()`: returns the top of the stack without removing it\n- `isEmpty()`: returns true if and only if the stack is empty\n\nUnlike an array, a stack does not offer constant-time access to the ith item. However, it does allow constant-time adds and removes, as it doesn't require shifting elements around.\n\n```python\nstack = []\n\n# add to the top of the stack\nstack.append(1)\nstack.append(2)\n\n# remove from the top of the stack\nstack.pop()\n```\n\nOne case where stacks are often useful is in certain recursive algorithms. Sometimes you need to push temporary data onto a stack as you recurse, but then remove them as you backtrack (for example, because the recursive check failed). A stack offers an intuitive way to do this.\n\nA stack can also be used to implement a recursive algorithm iteratively.\n\n## Queue\n\nA queue is an ordered collection of items where the addition of new items happens at one end, called the \"rear,\" and the removal of existing items occurs at the other end, commonly called the \"front.\" As an element enters the queue it starts at the rear and makes its way toward the front, waiting until that time when it is the next element to be removed.\n\nIt uses the following operations:\n\n- `add(item)`: adds an item to the rear of the queue\n- `remove()`: removes the front item from the queue\n- `peek()`: returns the front of the queue without removing it\n- `isEmpty()`: returns true if and only if the queue is empty\n\n```python\nfrom collections import deque\n\nqueue = deque() # double-ended queue\n```\n\nA queue can also be implemented with a linked list. In fact, they are essentially the same thing, as long as items are added and removed from opposite sides.\n\nOne place where queues are often used is in breadth-first search or in implementing a cache. In breadth-first search, for example, we used a queue to store a list of the nodes that we need to process. Each time we process a node, we add its adjacent nodes to the back of the queue. This allows us to process nodes in the order in which they are viewed.\n\n# Linked List\n\nA Linked list is a data structure that represents a sequence of nodes. In as singly linked list, each node points to the next node in the linked list. In a doubly linked list, each node points to the next node and the previous node. In a circular linked list, the tail node points to the head node.\n\nUnlike an array, a linked list does not provide costant access time to a particolar index within the list. This means, that if you'd like to find the kth element in a linked list, you'd have to traverse the list from the head node to the kth node. This is because the nodes in a linked list are not stored in contiguous memory locations.\n\n## Singly Linked List\n\n```python\n# Definition for singly-linked list.\nclass ListNode:\n    def __init__(self, x):\n        self.val = x\n        self.next = None\n```\n\nIn this implementation, the head node is the first node in the linked list. The tail node is the last node in the linked list. The tail node's next pointer points to None.\n\n## Techniques\n\n- Slow and Fast Pointer\n\n_This is a technique that is used to solve problems that involve linked list traversal. The slow pointer moves one node at a time, while the fast pointer moves two nodes at a time. This technique is used to find the middle node of a linked list, or to determine if a linked list has a cycle._\n\n- Dummy linked list\n\n```python\ndummy = ListNode()\n```\n\n- Check if has a cycle\n\n```python\ndef hasCycle(self, head: ListNode) -> bool:\n    slow = fast = head\n    while fast and fast.next:\n        slow = slow.next\n        fast = fast.next.next\n        if slow == fast:\n            return True\n    return False\n```\n\n- Reverse a linked list\n\n```python\ndef reverseList(self, head: ListNode) -> ListNode:\n    prev, curr = None, head\n\n    while curr:\n        temp = curr.next\n        curr.next = prev\n        prev = curr\n        curr = temp\n    return prev\n```\n\n- Sometimes it's useful to split a linked list into two parts\n\n# Trees\n\nA nice way to understand a tree is with a recursive explanation. A tree is a data structure composed of nodes.\n\n- Each tree has a root node. (Actually, this isn't strictly necessary in graph theory, but it's usually how we use trees in programming)\n\n- The root node has zero or more child nodes.\n\n- Each child node has zero or more child nodes, and so on.\n\nThe tree cannot contain cycles. The nodes may or may not be in a particular order, they could have any data type as values, and they may or may not have links back to their parent nodes.\n\n```python\nclass TreeNode:\n    def __init__(self, val):\n        self.val = val\n        self.children = []\n```\n\n## Binary Tree\n\nA binary tree is a tree in which each node has up to two children. Not all trees are binary trees. There are occasions when you might have a tree that is not a binary tree. For example, suppose you were using a tree to represent a bunch of phone numbers. In this case, you might use a 10-ary tree, with each node having up to 10 children (one for each digit}.\nA node is called a \"leaf\" node if it has no children.\n\n```python\nclass BinaryTreeNode:\n    def __init__(self, val):\n        self.val = val\n        self.left = None\n        self.right = None\n```\n\n## Binary Search Tree\n\nA binary search tree is a binary tree in which every node fits a specific ordering property: _all left descendents_ $\\leq n \u003C$ _all right descendents_. This must be true for each node $n$. Note that this inequality must be true for all of a node's descendents, not just its immediate children\n\n> The definition of a binary search tree can vary slightly with respect to equality. Under some definitions, the tree cannot have duplicate values. In others, the duplicate values will be on the right or can be on either side. All are valid definitions, but you should clarify this with your interviewer.\n\n### Balanced vs Unbalanced\n\nWhile many trees are balanced, not all are. Note that balancing a tree does not mean the left and right subtrees are exactly the same size (like you see under \"perfect binary trees\")\n\nOne way to think about it is that a \"balanced\" tree really means something more like \"not terribly imbalanced:' It's balanced enough to ensure $O(\\log n)$ times for insert and find, but it's not necessarily as balanced as it could be.\n\n### Complete Binary Tree\n\nA complete binary tree is a binary tree in which every level of the tree is fully filled, except for perhaps the last level. lo the extent that the last level is filled, it is filled left to right.\n\n### Full Binary Tree\n\nA full binary tree is a binary tree in which every node has either zero or two children. That is, no nodes have only one child.\n\n### Perfect Binary Tree\n\nA perfect binary tree is one that is both full and complete. All leaf nodes will be at the same level, and this level has the maximum number of nodes.\n\n## Binary Tree Traversal\n\n### In-order Traversal\n\nIn-order traversal means to \"visit\" (often, print) the left branch, then the current node, and finally, the right branch.\n\n```python\ndef inOrderTraversal(self, root):\n    if root:\n        self.inOrderTraversal(root.left)\n        print(root.val)\n        self.inOrderTraversal(root.right)\n```\n\n### Pre-order Traversal\n\nPre-order traversal visits the current node before its child nodes (hence the name \"pre-order\").\n\n```python\ndef preOrderTraversal(self, root):\n    if root:\n        print(root.val)\n        self.preOrderTraversal(root.left)\n        self.preOrderTraversal(root.right)\n```\n\n### Post-order Traversal\n\nPost-order traversal visits the current node after its child nodes (hence the name \"post-order\").\n\n```python\ndef postOrderTraversal(self, root):\n    if root:\n        self.postOrderTraversal(root.left)\n        self.postOrderTraversal(root.right)\n        print(root.val)\n```\n\n### Level-order Traversal\n\nLevel-order traversal visits the nodes level by level. You'll often see this done with a queue.\n\n```python\ndef levelOrderTraversal(self, root):\n    if not root:\n        return\n    queue = [root]\n    while queue:\n        node = queue.pop(0)\n        print(node.val)\n        if node.left:\n            queue.append(node.left)\n        if node.right:\n            queue.append(node.right)\n```\n\n## Binary Heaps (min-heap and max-heap)\n\nWe'll just discuss min-heaps here. Max-heaps are essentially equivalent, but the elements are in descending order rather than ascending order\n\nA min-heap is a complete binary tree (that is, totally filled other than the rightmost elements on the last level) where each node is smaller than its children. The root, therefore, is the minimum element in the tree.\n\nWe have two key operations on a min-heap: `insert` and `extract_min`.\n\n### Insert\n\nWhen we insert into a min-heap, we always start by inserting the element at the bottom. We insert at the rightmost spot so as to maintain the complete tree property.\n\nThen, we \"fix\" the tree by swapping the new element with its parent, until we find an appropriate spot for the element We essentially bubble up the minimum element.\n\nThis takes $O(\\log n)$ time, where $n$ is the number of elements in the heap.\n\n### Extract Min\n\nFinding the minimum element of a min-heap is easy: it's always at the top. The trickier part is how to remove it. (In fact, this isn't that tricky.)\n\nFirst, we remove the minimum element and swap it with the last element in the heap (the bottommost, rightmost element). Then, we bubble down this element, swapping it with one of its children until the min-heap property is restored.\n\nDo we swap it with the left child or the right child? That depends on their values. There's no inherent ordering between the left and right element, but you'll need to take the smaller one in order to maintain the min-heap ordering.\n\nThis takes $O(\\log n)$ time.\n\n# Tries\n\nA trie (sometimes called a prefix tree} is a funny data structure. It comes up a lot in interview questions, but algorithm textbooks don't spend much time on this data structure.\n\nA trie is a variant of an n-ary tree in which characters are stored at each node. Each path down the tree may represent a word.\n\n```python\nclass TrieNode:\n    def __init__(self):\n        self.children = {}\n        self.is_word = False\n```\n\nThe `* nodes` (sometimes called \"null nodes\") are often used to indicate complete words. For example, the fact that there is a `* node` under `MANY` indicates that `MANY` is a complete word. The existence of the `MA` path\nindicates there are words that start with `MA`.\n\nThe actual implementation of these `* nodes` might be a special type of child (such as a `TerminatingTrieNode`, which inherits from `TrieNode`. Or, we could use just a boolean flag terminates within the \"parent\" node.\n\nA node in a trie could have anywhere from 1 through `ALPHABET_SIZE + 1` children (or, `O` through `ALPHABET_SIZE` if a boolean flag is used instead of a `* node`).\n\nVery commonly, a trie is used to store the entire (English) language for quick prefix lookups. While a hash table can quickly look up whether a string is a valid word, it cannot tell us if a string is a prefix of any valid words. A trie can do this very quickly.\n\n> How quickly? A trie can check if a string is a valid prefix in $O(K)$ time, where K is the length of the string. This is actually the same runtime as a hash table will take. Although we often refer to hash table lookups as being $O(1)$ time, this isn't entirely true. A hash table must read through all the characters in the input which takes $O(K)$ time in the case of a word lookup\n\nMany problems involving lists of valid words leverage a trie as an optimization. In situations when we search through the tree on related prefixes repeatedly\n\n# Backtracking\n\nBacktracking is a general algorithm for finding all (or some) solutions to some computational problems, notably constraint satisfaction problems, that incrementally builds candidates to the solutions, and abandons each partial candidate (\"backtracks\") as soon as it determines that the candidate cannot possibly be completed to a valid solution.\n\n- Sometimes is useful to think of backtracking as an intelligent \"brute force\" approach.\n- Recursive DFS is often a good way to implement backtracking\n- It's usually a good idea to start by writing a recursive backtracking every time you see a subset, combination, permutation, or partition problem.\n\n# Graphs\n\nMany programming problems can be solved by modeling the problem as a graph\nproblem and using an appropriate graph algorithm.\n\nAtree is actually a type of graph, but not all graphs are trees. Simply put, a tree isa connected graph without cycles. A graph is simply a collection d nodes with edges between (some of) them.\n\n- Graphs can be either **directed** or **undirected**. While directed edges are like a one-way street, undirected edges are like a two-way street.\n- The graph might consist of multiple isolated subgraphs. If there is a path between every pair of vertices, it is called a \"**connected graph**\".\n- The graph can also have cycles (or not). An \"**acyclic graph**\" is one without cycles\n\n## Adjacency Lists\n\nThis is the most common way to represent a graph. Every vertex (or node) stores a list of adjacent vertices. In an undirected graph, an edge like `(a, b)` would be stored twice: once in `a`'s adjacent vertices and once in `b`'s adjacent vertices.\n\nA simple class definition for a graph node could look essentially the same as a tree node.\n\n```python\nclass Graph:\n    def __init__(self):\n        self.nodes = {}\n```\n\n```python\nclass Node:\n    def __init__(self, val = 0, neighbors = None):\n        self.val = val\n        self.neighbors = neighbors if neighbors is not None else []\n```\n\nYou don't necessarily need any additional classes to represent a graph. An array (or a hash table) of lists (arrays, arraylists, linked lists, etc.) can store the adjacency list.\n\n## Adjacency Matrix\n\nAn adjacency matrix is an `NxN` boolean matrix (where `N` is the number of nodes), where a true value at `matrix[i][j]` indicates an edge from node `i` to node `j`. (You can also use an integer matrix with Os and 1s.)\n\nNote that in an undirected graph, an adjacency matrix will be symmetric. In a directed graph, it will not (necessarily) be.\n\nThe same graph algorithms that are used on adjacency lists (breadth-first search, etc.) can be performed with adjacency matrices, but they may be somewhat less efficient. In the adjacency list representation, you can easily iterate through the neighbors of a node. In the adjacency matrix representation, you will need to iterate through all the nodes to identify a node's neighbors.\n\n## Graph Search\n\nThe two most common ways to search a graph are **depth-first search** and **breadth-first search**.\n\n- In depth-first search (DFS), we start at the root (or another arbitrarily selected node) and explore each branch completely before moving on to the next branch. That is. we go deep first (hence the name depth-first search) before we go wide.\n\n- In breadth-first search (BFS), we start at the root (or another arbitrarily selected node) and explore each neighbor before going on to any of their children. That is, we go wide (hence breadth-first search) before\n  we go deep.\n\nBreadth-first search and depth-first search tend to be used in different scenarios. DFS is often preferred if we want to visit every node in the graph. Both will work just fine, but depth-first search is a bit simpler. However, if we want to find the shortest path (or just any path) between two nodes, BFS is generally better.\n\n### DFS\n\nIn DFS, we visit a node a and then iterate through each of a's neighbors. When visiting `a` node `b` that is a neighbor of `a`, we visit all of `b`'s neighbors before going on to `a`'s other neighbors. That is, a exhaustively\nsearches `b`'s branch before any of its other neighbors.\n\nNote that pre-order and other forms of tree traversal are a form of DFS. The key difference is that when implementing this algorithm for a graph, we must check if the node has been visited. If we don't, we risk getting stuck in an infinite loop.\n\n```python\ndef dfs(node):\n    if node is None:\n        return\n    visit(node)\n    node.visited = True\n    for next in node.adjacent:\n        if next.visited == False:\n            dfs(next)\n```\n\n### BFS\n\nBFS is a bit less intuitive. The main tripping point is the (false) assumption that BFS is recursive. It's not. Instead, it uses a queue.\n\nIn BFS, node a visits each of a's neighbors before visiting any of their neighbors. You can think of this as searching level by level out from a. An iterative solution involving a queue usually works best.\n\n```python\ndef bfs(graph, start):\n    queue = []\n    queue.append(start)\n    start.visited = True\n    while queue:\n        r = queue.pop(0)\n        visit(r)\n        for n in r.adjacent:\n            if n.visited == False:\n                n.visited = True\n                queue.append(n)\n```\n\nIf you are asked to implement BFS, the key thing to remember is the use of the queue. The rest of the algorithm flows from this fact.\n\n### Bidirectional Search\n\nBidirectional search is used to find the shortest path between a source and destination node. It operates by essentially running two simultaneous breadth-first searches, one from each node. When their searches collide, we have found a path.\n\n![](https://i.imgur.com/AQTtl8H.png)\n\nTo see why this is faster, consider a graph where every node has at most k adjacent nodes and the shortest path from node s to node t has length d.\n\n- In traditional breadth-first search, we would search up to `k` nodes in the first \"level\" of the search. In the second level, we would search up to `k` nodes for each of those first `k` nodes, so $k^2$ nodes total (thus far).\n  We would do this $d$ times, so that's $O(k^d)$ nodes.\n\n- In bidirectional search, we have two searches that collide after approximately $d/2$ levels (the midpoint of the path). The search from `s` visits approximately $2k^{d/2}$, as does the search from `t`. That's approximately $O(k^{d/2})$ nodes total.\n\nSo the the bidirectional search is actually faster by a factor of $k^{d/2}$.\n\n### Topological Sort\n\n## Shortest Path\n\nFinding a shortest path between two nodes of a graph is an important problem\nthat has many practical applications. For example, a natural problem related to a road network is to calculate the shortest possible length of a route between two cities, given the lengths of the roads.\n\nIn an unweighted graph, the length of a path equals the number of its edges,\nand we can simply use breadth-first search to find a shortest path. However, we focus on weighted graphs where more sophisticated algorithms are needed for finding shortest paths\n\n### Bellman-Ford\n\nThe Bellman–Ford algorithm finds shortest paths from a starting node to all\nnodes of the graph. The algorithm can process all kinds of graphs, provided that the graph does not contain a cycle with negative length. If the graph contains a negative cycle, the algorithm can detect this.\n\nThe algorithm keeps track of distances from the starting node to all nodes\nof the graph. Initially, the distance to the starting node is 0 and the distance to all other nodes in infinite. The algorithm reduces the distances by finding edges that shorten the paths until it is not possible to reduce any distance\n\nThe algorithm is based on the following observation: if we know the shortest path from the starting node to all nodes except one, we can find the shortest path to all nodes by adding one edge to the shortest path. The algorithm iterates through all edges of the graph and relaxes each edge. The relaxation of an edge means that we try to find a shorter path to the destination node of the edge by going through the source node of the edge. The algorithm repeats this process for a number of iterations, which is equal to the number of nodes in the graph. If the algorithm finds a shorter path to a node, it means that the graph contains a negative cycle. The algorithm can detect this by keeping track of the number of iterations. If the number of iterations is equal to the number of nodes in the graph, the graph contains a negative cycle.\n\n```python\ndef bellman_ford(graph, source):\n    distance, predecessor = dict(), dict()\n    for node in graph:\n        distance[node] = float('inf')\n        predecessor[node] = None\n    distance[source] = 0\n    for _ in range(len(graph) - 1):\n        for u, v in graph.edges:\n            if distance[u] + graph.edges[u, v] \u003C distance[v]:\n                distance[v] = distance[u] + graph.edges[u, v]\n                predecessor[v] = u\n    for u, v in graph.edges:\n        assert distance[u] + graph.edges[u, v] >= distance[v]\n    return distance, predecessor\n```\n\nThe time complexity of the algorithm is $O(nm)$, because the algorithm consists of `n − 1` rounds and iterates through all `m` edges during a round. If there are no negative cycles in the graph, all distances are final after `n − 1` rounds, because each shortest path can contain at most `n − 1` edges.\n\nIn practice, the final distances can usually be found faster than in `n − 1` rounds. Thus, a possible way to make the algorithm more efficient is to stop the algorithm if no distance can be reduced during a round.\n\n> **Note:** We need to use this algorithm when the graph contains negative edges. If the graph contains only positive edges, we can use Dijkstra's algorithm, which is more efficient.\n\n### Dijkstra's Algorithm\n\nDijkstra’s algorithm finds shortest paths from the starting node to all nodes of the graph, like the Bellman–Ford algorithm. The benefit of Dijkstra's algorithm is that it is more efficient and can be used for processing large graphs. However, the algorithm requires that there are no negative weight edges in the graph.\n\nLike the Bellman–Ford algorithm, Dijkstra’s algorithm maintains distances\nto the nodes and reduces them during the search. Dijkstra’s algorithm is efficient, because it only processes each edge in the graph once, using the fact that there are no negative edges.\n\nAn efficient implementation of Dijkstra’s algorithm requires that it is possible to efficiently find the minimum distance node that has not been processed. An appropriate data structure for this is a priority queue that contains the nodes ordered by their distances. Using a priority queue, the next node to be processed can be retrieved in logarithmic time\n\n```python\ndef dijkstra(graph, source):\n    distance, predecessor = dict(), dict()\n    for node in graph:\n        distance[node] = float('inf')\n        predecessor[node] = None\n    distance[source] = 0\n    queue = PriorityQueue()\n    queue.put((0, source))\n    while not queue.empty():\n        _, u = queue.get()\n        for v in graph[u]:\n            alt = distance[u] + graph.edges[u, v]\n            if alt \u003C distance[v]:\n                distance[v] = alt\n                predecessor[v] = u\n                queue.put((alt, v))\n    return distance, predecessor\n```\n\nThe time complexity of the above implementation is $O(n + m \\log m)$, because\nthe algorithm goes through all nodes of the graph and adds for each edge at most one distance to the priority queue.\n\n### Floyd-Warshall\n\nThe Floyd–Warshall algorithm provides an alternative way to approach the\nproblem of finding shortest paths. Unlike the other algorithms of this chapter, it finds all shortest paths between the nodes in a single run.\n\nThe algorithm maintains a two-dimensional array that contains distances\nbetween the nodes. First, distances are calculated only using direct edges between the nodes, and after this, the algorithm reduces distances by using intermediate nodes in paths.\n\nThe advantage of the Floyd–Warshall algorithm that it is easy to implement. The following code constructs a distance matrix where `distance[a][b]` is the shortest distance between nodes a and b. First, the algorithm initializes distance using the adjacency matrix adj of the graph:\n\n```python\ndef floyd_warshall(graph):\n    distance = {u: {v: float('inf') for v in graph} for u in graph}\n    for u in graph:\n        distance[u][u] = 0\n    for u, v in graph.edges:\n        distance[u][v] = graph.edges[u, v]\n    for k in graph:\n        for i in graph:\n            for j in graph:\n                distance[i][j] = min(distance[i][j], distance[i][k] + distance[k][j])\n    return distance\n```\n\nThe time complexity of the algorithm is $O(n^3)$, because it contains three\nnested loops that go through the nodes of the graph. Since the implementation of the Floyd–Warshall algorithm is simple, the algorithm can be a good choice even if it is only needed to find a single shortest path in the graph. However, the algorithm can only be used when the graph is so\nsmall that a cubic time complexity is fast enough.\n\n# Recursion\n\nWhile there are a large number of recursive problems, many follows similar patterns. A good hint that a problem is recursive is that it can be built of sub-problems of the same type.\n\nWhen you hear a problem beginning with the following statements, it's often (though not always) a good candidate for recursion:\n\n- _Design an algorithm to compute the nth ..._\n- _Write code to list the first n ..._\n- _Implement a method to compute all ..,_\n\nRecursive solutions, by definition, are built off of solutions to subproblems. Many times, this will mean simply to compute $f(n)$ by adding something, removing something, or otherwise changing the solution\nfor $f(n-1)$. In other cases, you might solve the problem for the first half of the data set, then the second half, and then merge those results.\nThere are many ways you might divide a problem into subproblems.Three of the most common approaches to develop an algorithm are bottom-up, top-down, and half-and-half.\n\n## Bottom-Up\n\nThe bottom-up approach is often the most intuitive. We start with knowing how to solve the problem for a simple case, like a list with only one element. Then we figure out how to solve the problem for two\nelements, then for three elements, and so on. The key here is to think about how you can build the solution for one case off of the previous case (or multiple previous cases).\n\n## Top-Down\n\nThe top-down approach can be more complex since it's less concrete. But sometimes, it's the best way to think about the problem.\n\nIn these problems, we think about how we can divide the problem for case `N` into subproblems. Be careful of overlap between the cases.\n\n## Half-and-Half\n\nIn addition to top-down and bottom-up approaches, it's often effective to divide the data set in half.\n\nFor example, binary search works with a \"half-and-half\" approach. When we look for an element in a sorted array, we first figure out which half of the array contains the value. Then we recurse and search for it in that half.\n\nMerge sort is also a \"half-and-half\" approach. We sort each half of the array and then merge together the\nsorted halves.\n\n## Recursion vs. Iteration\n\nRecursive algorithms can be very space inefficient. Each recursive call adds a new layer to the stack, which means that if your algorithm recurses to a depth of `n`, it uses at least $O(n)$ memory.\n\nFor this reason, it's often better to implement a recursive algorithm iteratively. All recursive algorithms can be implemented iteratively, although sometimes the code to do so is much more complex. Before diving\ninto recursive code, ask yourself how hard it would be to implement it iteratively,\n\n# Dynamic Programming\n\nDynamic programming is a technique that combines the correctness of complete search and the efficiency of greedy algorithms. Dynamic programming can be applied if the problem can be divided into overlapping subproblems that can be solved independently.\n\nThere are two uses for dynamic programming:\n\n- **Finding an optimal solution**: We want to find a solution that is as large as possible or as small as possible.\n- **Counting the number of solutions:** We want to calculate the total number of possible solutions.\n\n\u003C!-- # Greedy\n\n# Intervals -->\n\n# Bit Manipulation\n\nAll data in computer programs is internally stored as bits, i.e., as numbers 0 and 1. In programming, an n bit integer is internally stored as a binary number that consists of `n` bits. For example, the `C++` type int is a `32-bit` type, which means that every `int` number consists of 32 bits.\n\nThe bits in the representation are indexed from right to left. To convert a bit representation $b_k · · · b_2 b_1 b_0 into a number, we can use the formula\n\n$$ \\sum\\_{i=0}^k b_i 2^i $$\n\nFor example, the number 13 is represented as 1101 in binary. To convert it to a decimal number, we can use the formula:\n\n$$ 1 \\cdot 2^3 + 1 \\cdot 2^2 + 0 \\cdot 2^1 + 1 \\cdot 2^0 = 8 + 4 + 0 + 1 = 13 $$\n\nThe following code converts a binary number to a decimal number:\n\n```python\ndef binary_to_decimal(binary):\n    decimal = 0\n    for digit in binary:\n        decimal = decimal * 2 + int(digit)\n    return decimal\n```\n\nThe time complexity of the above implementation is $O(n)$, where $n$ is the length of the binary number.\n\nThe bit representation of a number is either signed or unsigned. Usually a signed representation is used, which means that both negative and positive numbers can be represented. signed variable of n bits can contain any integer\nbetween $-2^{n-1}$ and $2^{n-1} - 1$. For example, the `C++` type `int` is a signed `32-bit` type, which means that it can contain any integer between $-2^{31}$ and $2^{31} - 1$.\n\nThe first bit in a signed representation is the sign of the number (`0` for nonnegative numbers and `1` for negative numbers), and the remaining `n−1` bits contain the magnitude of the number. Two’s complement is used, which means that the opposite number of a number is calculated by first inverting all the bits in the number, and then increasing the number by one.\n\nFor example, the number 13 is represented as 1101 in binary. To convert it to a two’s complement representation, we first invert all the bits:\n\n$$ \\overline{1101} = 0010 $$\n\nThen we increase the number by one:\n\n$$ 0010 + 1 = 0011 $$\n\nThe result is the two’s complement representation of the number 13, which is 0011. The number -13 is represented as 1101 in binary. To\n\nIn an unsigned representation, only nonnegative numbers can be used, but the upper bound for the values is larger. An unsigned variable of `n` bits can contain any integer between 0 and $2^n - 1$. For example, the `C++` type `unsigned int` is an unsigned `32-bit` type, which means that it can contain any integer between 0 and $2^{32} - 1$.\n\n## Bitwise Operators\n\n### Bitwise AND\n\nThe bitwise AND operator `&` compares two numbers on a bit level and returns a number where the bits of that number are turned on if the corresponding bits of both numbers are `1`.\n\nFor example, the number 13 is represented as 1101 in binary. The number 7 is represented as 0111 in binary. The bitwise AND of 13 and 7 is 0101, which is the number 5.\n\n```python\ndef bitwise_and(a, b):\n    return a & b\n```\n\n### Bitwise OR\n\nThe bitwise OR operator `|` compares two numbers on a bit level and returns a number where the bits of that number are turned on if the corresponding bits of either of the two numbers are `1`.\n\nFor example, the number 13 is represented as 1101 in binary. The number 7 is represented as 0111 in binary. The bitwise OR of 13 and 7 is 1111, which is the number 15.\n\n```python\ndef bitwise_or(a, b):\n    return a | b\n```\n\n### Bitwise XOR\n\nThe bitwise XOR operator `^` compares two numbers on a bit level and returns a number where the bits of that number are turned on if the corresponding bits of either of the two numbers are `1`, but not both.\n\nFor example, the number 13 is represented as 1101 in binary. The number 7 is represented as 0111 in binary. The bitwise XOR of 13 and 7 is 1010, which is the number 10.\n\n```python\ndef bitwise_xor(a, b):\n    return a ^ b\n```\n\n### Bitwise NOT\n\nThe bitwise NOT operator `~` inverts all the bits of its operand.\n\nFor example, the number 13 is represented as 1101 in binary. The bitwise NOT of 13 is 0010, which is the number 2.\n\n```python\ndef bitwise_not(a):\n    return ~a\n```\n\n### Bitwise Shifts\n\nThe bitwise left shift operator `\u003C\u003C` shifts the bits of its first operand the specified number of positions to the left. The bits shifted off the left end are discarded. The bits on the right end are filled with zeros.\n\nFor example, the number 13 is represented as 1101 in binary. The bitwise left shift of 13 by 1 is 1010, which is the number 10.\n\n```python\ndef bitwise_left_shift(a, b):\n    return a \u003C\u003C b\n```\n\nThe bitwise right shift operator `>>` shifts the bits of its first operand the specified number of positions to the right. The bits shifted off the right end are discarded. The bits on the left end are filled with zeros.\n\nFor example, the number 13 is represented as 1101 in binary. The bitwise right shift of 13 by 1 is 0110, which is the number 6.\n\n```python\ndef bitwise_right_shift(a, b):\n    return a >> b\n```\n\n## Bitwise Tricks\n\n### Check if a number is even or odd\n\nA number is even if the last bit is `0` and odd if the last bit is `1`. We can check if a number is even or odd by checking the last bit of the number. If the last bit is `0`, the number is even, otherwise, it is odd.\n\n```python\ndef is_even(a):\n    return a & 1 == 0\n```\n\n### Check if a number is a power of two\n\nA number is a power of two if it has only one bit set to `1`. We can check if a number is a power of two by checking if the number has only one bit set to `1`.\n\n```python\ndef is_power_of_two(a):\n    return a & (a - 1) == 0\n```\n\n### Swap two numbers\n\nWe can swap two numbers by using the bitwise XOR operator `^`. The bitwise XOR of two numbers is `0` if the two numbers are the same, and it is `1` if the two numbers are different. We can use this property to swap two numbers.\n\n```python\ndef swap(a, b):\n    a ^= b\n    b ^= a\n    a ^= b\n    return a, b\n```\n\n### Get the last set bit\n\nWe can get the last set bit of a number by using the bitwise AND operator `&` with the two’s complement of the number.\n\n```python\ndef get_last_set_bit(a):\n    return a & -a\n```\n\n### Hamming distance\n\nThe Hamming distance between two integers is the number of positions at which the corresponding bits are different.\n\nGiven two integers `x` and `y`, calculate the Hamming distance.\n\n```python\ndef hamming_distance(x, y):\n    return bin(x ^ y).count('1')\n```\n\n### Count the number of set bits\n\nWe can count the number of set bits in a number by repeatedly clearing the last set bit of the number until the number becomes `0`.\n\n```python\ndef count_set_bits(a):\n    count = 0\n    while a:\n        a &= a - 1\n        count += 1\n    return count\n```\n\n### Reverse bits\n\nWe can reverse the bits of a number by repeatedly shifting the number to the right and appending the last bit to the result.\n\n```python\ndef reverse_bits(a):\n    result = 0\n    for _ in range(32):\n        result = (result \u003C\u003C 1) | (a & 1)\n        a >>= 1\n    return result\n```","src/data/blog/howtoasd.md","883c08f7bfd8cf6d",{"html":429,"metadata":430},"\u003Ch2 id=\"arrays\">Arrays\u003C/h2>\n\u003Cp>Arrays are a collection of values. They are ordered and can be accessed by index. Arrays are zero-indexed, meaning the first element is at index 0. Arrays can be of any type, including other arrays.\u003C/p>\n\u003Ch2 id=\"hashtable\">HashTable\u003C/h2>\n\u003Cp>An HashTable is a data structure that maps keys to values for highly efficient lookup. It is a structure that can be implemented with arrays, linked lists, binary search trees (in this case we would have \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmi>log\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n \\log n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mop\">lo\u003Cspan style=\"margin-right:0.01389em;\">g\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> lookup time. The advantage of this is potentially using less space, since we no longer allocate a large array. We can also iterate through the keys i order, which can be useful sometimes), or hash tables.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">HashTable \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> dict\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>or if we want to use defaultdict\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> collections \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> defaultdict\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">HashTable \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> defaultdict\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">int\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># a default value of 0 is assigned to all keys\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"arraylist--resizablearray\">ArrayList &#x26; ResizableArray\u003C/h2>\n\u003Cp>When you need an array-like data structure that offers dynamic resizing, you would usually use an Arraylist. An Arraylist is an array that resizes itself as needed while still providing \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(1)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> access.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">Array \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">None\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1000\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># array of 1000 elements, all None\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch1 id=\"binary-search\">Binary Search\u003C/h1>\n\u003Cp>Binary search is a search algorithm that finds the position of a target value within a sorted array. Binary search compares the target value to the middle element of the array. If they are not equal, the half in which the target cannot lie is eliminated and the search continues on the remaining half, again taking the middle element to compare to the target value, and repeating this until the target value is found. If the search ends with the remaining half being empty, the target is not in the array.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> binary_search\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">arr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> target\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    left \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    right \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> len\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">arr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> left \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> right\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        mid \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (left \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> right) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">//\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> arr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mid\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> target\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> mid\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        elif\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> arr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mid\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> target\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            left \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> mid \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        else\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            right \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> mid \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"algorithms\">Algorithms\u003C/h2>\n\u003Ch3 id=\"quickselect\">QuickSelect\u003C/h3>\n\u003Cp>QuickSelect is a selection algorithm to find the k-th smallest/largest element in an unordered list. It is related to the quick sort sorting algorithm.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> quick_select\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">arr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> k\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> len\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">arr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> arr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    pivot \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> random\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">choice\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">arr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    left \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">x \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> x \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> arr \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> x \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> pivot\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    middle \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">x \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> x \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> arr \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> x \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> pivot\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    right \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">x \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> x \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> arr \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> x \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> pivot\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> k \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> len\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">left\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">):\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> quick_select\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">left\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\"> k\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    elif\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> k \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> len\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">left\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> len\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">middle\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">):\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> middle\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    else\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> quick_select\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">right\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\"> k \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> len\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">left\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> len\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">middle\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch1 id=\"stack\">Stack\u003C/h1>\n\u003Cp>The stack data structure is precisely what it sounds like: a stack of data. In certain types of problems, it can be favorable to store data in a stack rather than in an array.\u003C/p>\n\u003Cp>A stack uses LIFO (last-in first-out) ordering. That is, as in a stack of dinner plates, the most recent item added to the stack is the first item to be removed.\u003C/p>\n\u003Cp>It uses the following operations:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ccode>push(item)\u003C/code>: adds an item to the top of the stack\u003C/li>\n\u003Cli>\u003Ccode>pop()\u003C/code>: removes the top item from the stack\u003C/li>\n\u003Cli>\u003Ccode>peek()\u003C/code>: returns the top of the stack without removing it\u003C/li>\n\u003Cli>\u003Ccode>isEmpty()\u003C/code>: returns true if and only if the stack is empty\u003C/li>\n\u003C/ul>\n\u003Cp>Unlike an array, a stack does not offer constant-time access to the ith item. However, it does allow constant-time adds and removes, as it doesn’t require shifting elements around.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">stack \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> []\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># add to the top of the stack\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">stack\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">append\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">stack\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">append\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">2\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># remove from the top of the stack\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">stack\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">pop\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>One case where stacks are often useful is in certain recursive algorithms. Sometimes you need to push temporary data onto a stack as you recurse, but then remove them as you backtrack (for example, because the recursive check failed). A stack offers an intuitive way to do this.\u003C/p>\n\u003Cp>A stack can also be used to implement a recursive algorithm iteratively.\u003C/p>\n\u003Ch2 id=\"queue\">Queue\u003C/h2>\n\u003Cp>A queue is an ordered collection of items where the addition of new items happens at one end, called the “rear,” and the removal of existing items occurs at the other end, commonly called the “front.” As an element enters the queue it starts at the rear and makes its way toward the front, waiting until that time when it is the next element to be removed.\u003C/p>\n\u003Cp>It uses the following operations:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ccode>add(item)\u003C/code>: adds an item to the rear of the queue\u003C/li>\n\u003Cli>\u003Ccode>remove()\u003C/code>: removes the front item from the queue\u003C/li>\n\u003Cli>\u003Ccode>peek()\u003C/code>: returns the front of the queue without removing it\u003C/li>\n\u003Cli>\u003Ccode>isEmpty()\u003C/code>: returns true if and only if the queue is empty\u003C/li>\n\u003C/ul>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> collections \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> deque\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">queue \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> deque\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> # double-ended queue\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>A queue can also be implemented with a linked list. In fact, they are essentially the same thing, as long as items are added and removed from opposite sides.\u003C/p>\n\u003Cp>One place where queues are often used is in breadth-first search or in implementing a cache. In breadth-first search, for example, we used a queue to store a list of the nodes that we need to process. Each time we process a node, we add its adjacent nodes to the back of the queue. This allows us to process nodes in the order in which they are viewed.\u003C/p>\n\u003Ch1 id=\"linked-list\">Linked List\u003C/h1>\n\u003Cp>A Linked list is a data structure that represents a sequence of nodes. In as singly linked list, each node points to the next node in the linked list. In a doubly linked list, each node points to the next node and the previous node. In a circular linked list, the tail node points to the head node.\u003C/p>\n\u003Cp>Unlike an array, a linked list does not provide costant access time to a particolar index within the list. This means, that if you’d like to find the kth element in a linked list, you’d have to traverse the list from the head node to the kth node. This is because the nodes in a linked list are not stored in contiguous memory locations.\u003C/p>\n\u003Ch2 id=\"singly-linked-list\">Singly Linked List\u003C/h2>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># Definition for singly-linked list.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">class\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> ListNode\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> __init__\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">val \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> x\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">next \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> None\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>In this implementation, the head node is the first node in the linked list. The tail node is the last node in the linked list. The tail node’s next pointer points to None.\u003C/p>\n\u003Ch2 id=\"techniques\">Techniques\u003C/h2>\n\u003Cul>\n\u003Cli>Slow and Fast Pointer\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cem>This is a technique that is used to solve problems that involve linked list traversal. The slow pointer moves one node at a time, while the fast pointer moves two nodes at a time. This technique is used to find the middle node of a linked list, or to determine if a linked list has a cycle.\u003C/em>\u003C/p>\n\u003Cul>\n\u003Cli>Dummy linked list\u003C/li>\n\u003C/ul>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">dummy \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> ListNode\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cul>\n\u003Cli>Check if has a cycle\u003C/li>\n\u003C/ul>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> hasCycle\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> head\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ListNode\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> ->\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> bool\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    slow \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> fast \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> head\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> fast \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">and\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> fast\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">next\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        slow \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> slow\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">next\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        fast \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> fast\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">next\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">next\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> slow \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> fast\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            return\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> True\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> False\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cul>\n\u003Cli>Reverse a linked list\u003C/li>\n\u003C/ul>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> reverseList\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> head\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ListNode\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> ->\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ListNode:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    prev\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> curr \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> None\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> head\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> curr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        temp \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> curr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">next\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        curr\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">next \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> prev\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        prev \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> curr\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        curr \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> temp\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> prev\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cul>\n\u003Cli>Sometimes it’s useful to split a linked list into two parts\u003C/li>\n\u003C/ul>\n\u003Ch1 id=\"trees\">Trees\u003C/h1>\n\u003Cp>A nice way to understand a tree is with a recursive explanation. A tree is a data structure composed of nodes.\u003C/p>\n\u003Cul>\n\u003Cli>\n\u003Cp>Each tree has a root node. (Actually, this isn’t strictly necessary in graph theory, but it’s usually how we use trees in programming)\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>The root node has zero or more child nodes.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Each child node has zero or more child nodes, and so on.\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003Cp>The tree cannot contain cycles. The nodes may or may not be in a particular order, they could have any data type as values, and they may or may not have links back to their parent nodes.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">class\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> TreeNode\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> __init__\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">val \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> val\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">children \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> []\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"binary-tree\">Binary Tree\u003C/h2>\n\u003Cp>A binary tree is a tree in which each node has up to two children. Not all trees are binary trees. There are occasions when you might have a tree that is not a binary tree. For example, suppose you were using a tree to represent a bunch of phone numbers. In this case, you might use a 10-ary tree, with each node having up to 10 children (one for each digit}.\nA node is called a “leaf” node if it has no children.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">class\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> BinaryTreeNode\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> __init__\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">val \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> val\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">left \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> None\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">right \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> None\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"binary-search-tree\">Binary Search Tree\u003C/h2>\n\u003Cp>A binary search tree is a binary tree in which every node fits a specific ordering property: \u003Cem>all left descendents\u003C/em> \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmo>≤\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo>&#x3C;\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\leq n &#x3C;\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\">\u003C/span>\u003Cspan class=\"mrel\">≤\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">&#x3C;\u003C/span>\u003C/span>\u003C/span>\u003C/span> \u003Cem>all right descendents\u003C/em>. This must be true for each node \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span>. Note that this inequality must be true for all of a node’s descendents, not just its immediate children\u003C/p>\n\u003Cblockquote>\n\u003Cp>The definition of a binary search tree can vary slightly with respect to equality. Under some definitions, the tree cannot have duplicate values. In others, the duplicate values will be on the right or can be on either side. All are valid definitions, but you should clarify this with your interviewer.\u003C/p>\n\u003C/blockquote>\n\u003Ch3 id=\"balanced-vs-unbalanced\">Balanced vs Unbalanced\u003C/h3>\n\u003Cp>While many trees are balanced, not all are. Note that balancing a tree does not mean the left and right subtrees are exactly the same size (like you see under “perfect binary trees”)\u003C/p>\n\u003Cp>One way to think about it is that a “balanced” tree really means something more like “not terribly imbalanced:’ It’s balanced enough to ensure \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>log\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(\\log n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mop\">lo\u003Cspan style=\"margin-right:0.01389em;\">g\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> times for insert and find, but it’s not necessarily as balanced as it could be.\u003C/p>\n\u003Ch3 id=\"complete-binary-tree\">Complete Binary Tree\u003C/h3>\n\u003Cp>A complete binary tree is a binary tree in which every level of the tree is fully filled, except for perhaps the last level. lo the extent that the last level is filled, it is filled left to right.\u003C/p>\n\u003Ch3 id=\"full-binary-tree\">Full Binary Tree\u003C/h3>\n\u003Cp>A full binary tree is a binary tree in which every node has either zero or two children. That is, no nodes have only one child.\u003C/p>\n\u003Ch3 id=\"perfect-binary-tree\">Perfect Binary Tree\u003C/h3>\n\u003Cp>A perfect binary tree is one that is both full and complete. All leaf nodes will be at the same level, and this level has the maximum number of nodes.\u003C/p>\n\u003Ch2 id=\"binary-tree-traversal\">Binary Tree Traversal\u003C/h2>\n\u003Ch3 id=\"in-order-traversal\">In-order Traversal\u003C/h3>\n\u003Cp>In-order traversal means to “visit” (often, print) the left branch, then the current node, and finally, the right branch.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> inOrderTraversal\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> root\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> root\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">inOrderTraversal\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">root.left\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">        print\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">root.val\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">inOrderTraversal\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">root.right\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"pre-order-traversal\">Pre-order Traversal\u003C/h3>\n\u003Cp>Pre-order traversal visits the current node before its child nodes (hence the name “pre-order”).\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> preOrderTraversal\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> root\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> root\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">        print\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">root.val\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">preOrderTraversal\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">root.left\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">preOrderTraversal\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">root.right\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"post-order-traversal\">Post-order Traversal\u003C/h3>\n\u003Cp>Post-order traversal visits the current node after its child nodes (hence the name “post-order”).\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> postOrderTraversal\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> root\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> root\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">postOrderTraversal\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">root.left\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">postOrderTraversal\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">root.right\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">        print\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">root.val\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"level-order-traversal\">Level-order Traversal\u003C/h3>\n\u003Cp>Level-order traversal visits the nodes level by level. You’ll often see this done with a queue.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> levelOrderTraversal\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> root\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> not\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> root\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    queue \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">root\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        node \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">pop\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">        print\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">node.val\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> node\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">left\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">append\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">node.left\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> node\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">right\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">append\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">node.right\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"binary-heaps-min-heap-and-max-heap\">Binary Heaps (min-heap and max-heap)\u003C/h2>\n\u003Cp>We’ll just discuss min-heaps here. Max-heaps are essentially equivalent, but the elements are in descending order rather than ascending order\u003C/p>\n\u003Cp>A min-heap is a complete binary tree (that is, totally filled other than the rightmost elements on the last level) where each node is smaller than its children. The root, therefore, is the minimum element in the tree.\u003C/p>\n\u003Cp>We have two key operations on a min-heap: \u003Ccode>insert\u003C/code> and \u003Ccode>extract_min\u003C/code>.\u003C/p>\n\u003Ch3 id=\"insert\">Insert\u003C/h3>\n\u003Cp>When we insert into a min-heap, we always start by inserting the element at the bottom. We insert at the rightmost spot so as to maintain the complete tree property.\u003C/p>\n\u003Cp>Then, we “fix” the tree by swapping the new element with its parent, until we find an appropriate spot for the element We essentially bubble up the minimum element.\u003C/p>\n\u003Cp>This takes \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>log\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(\\log n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mop\">lo\u003Cspan style=\"margin-right:0.01389em;\">g\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> time, where \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span> is the number of elements in the heap.\u003C/p>\n\u003Ch3 id=\"extract-min\">Extract Min\u003C/h3>\n\u003Cp>Finding the minimum element of a min-heap is easy: it’s always at the top. The trickier part is how to remove it. (In fact, this isn’t that tricky.)\u003C/p>\n\u003Cp>First, we remove the minimum element and swap it with the last element in the heap (the bottommost, rightmost element). Then, we bubble down this element, swapping it with one of its children until the min-heap property is restored.\u003C/p>\n\u003Cp>Do we swap it with the left child or the right child? That depends on their values. There’s no inherent ordering between the left and right element, but you’ll need to take the smaller one in order to maintain the min-heap ordering.\u003C/p>\n\u003Cp>This takes \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>log\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(\\log n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mop\">lo\u003Cspan style=\"margin-right:0.01389em;\">g\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> time.\u003C/p>\n\u003Ch1 id=\"tries\">Tries\u003C/h1>\n\u003Cp>A trie (sometimes called a prefix tree} is a funny data structure. It comes up a lot in interview questions, but algorithm textbooks don’t spend much time on this data structure.\u003C/p>\n\u003Cp>A trie is a variant of an n-ary tree in which characters are stored at each node. Each path down the tree may represent a word.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">class\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> TrieNode\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> __init__\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">children \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> {}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">is_word \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> False\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The \u003Ccode>* nodes\u003C/code> (sometimes called “null nodes”) are often used to indicate complete words. For example, the fact that there is a \u003Ccode>* node\u003C/code> under \u003Ccode>MANY\u003C/code> indicates that \u003Ccode>MANY\u003C/code> is a complete word. The existence of the \u003Ccode>MA\u003C/code> path\nindicates there are words that start with \u003Ccode>MA\u003C/code>.\u003C/p>\n\u003Cp>The actual implementation of these \u003Ccode>* nodes\u003C/code> might be a special type of child (such as a \u003Ccode>TerminatingTrieNode\u003C/code>, which inherits from \u003Ccode>TrieNode\u003C/code>. Or, we could use just a boolean flag terminates within the “parent” node.\u003C/p>\n\u003Cp>A node in a trie could have anywhere from 1 through \u003Ccode>ALPHABET_SIZE + 1\u003C/code> children (or, \u003Ccode>O\u003C/code> through \u003Ccode>ALPHABET_SIZE\u003C/code> if a boolean flag is used instead of a \u003Ccode>* node\u003C/code>).\u003C/p>\n\u003Cp>Very commonly, a trie is used to store the entire (English) language for quick prefix lookups. While a hash table can quickly look up whether a string is a valid word, it cannot tell us if a string is a prefix of any valid words. A trie can do this very quickly.\u003C/p>\n\u003Cblockquote>\n\u003Cp>How quickly? A trie can check if a string is a valid prefix in \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>K\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(K)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> time, where K is the length of the string. This is actually the same runtime as a hash table will take. Although we often refer to hash table lookups as being \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(1)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> time, this isn’t entirely true. A hash table must read through all the characters in the input which takes \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>K\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(K)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> time in the case of a word lookup\u003C/p>\n\u003C/blockquote>\n\u003Cp>Many problems involving lists of valid words leverage a trie as an optimization. In situations when we search through the tree on related prefixes repeatedly\u003C/p>\n\u003Ch1 id=\"backtracking\">Backtracking\u003C/h1>\n\u003Cp>Backtracking is a general algorithm for finding all (or some) solutions to some computational problems, notably constraint satisfaction problems, that incrementally builds candidates to the solutions, and abandons each partial candidate (“backtracks”) as soon as it determines that the candidate cannot possibly be completed to a valid solution.\u003C/p>\n\u003Cul>\n\u003Cli>Sometimes is useful to think of backtracking as an intelligent “brute force” approach.\u003C/li>\n\u003Cli>Recursive DFS is often a good way to implement backtracking\u003C/li>\n\u003Cli>It’s usually a good idea to start by writing a recursive backtracking every time you see a subset, combination, permutation, or partition problem.\u003C/li>\n\u003C/ul>\n\u003Ch1 id=\"graphs\">Graphs\u003C/h1>\n\u003Cp>Many programming problems can be solved by modeling the problem as a graph\nproblem and using an appropriate graph algorithm.\u003C/p>\n\u003Cp>Atree is actually a type of graph, but not all graphs are trees. Simply put, a tree isa connected graph without cycles. A graph is simply a collection d nodes with edges between (some of) them.\u003C/p>\n\u003Cul>\n\u003Cli>Graphs can be either \u003Cstrong>directed\u003C/strong> or \u003Cstrong>undirected\u003C/strong>. While directed edges are like a one-way street, undirected edges are like a two-way street.\u003C/li>\n\u003Cli>The graph might consist of multiple isolated subgraphs. If there is a path between every pair of vertices, it is called a “\u003Cstrong>connected graph\u003C/strong>”.\u003C/li>\n\u003Cli>The graph can also have cycles (or not). An “\u003Cstrong>acyclic graph\u003C/strong>” is one without cycles\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"adjacency-lists\">Adjacency Lists\u003C/h2>\n\u003Cp>This is the most common way to represent a graph. Every vertex (or node) stores a list of adjacent vertices. In an undirected graph, an edge like \u003Ccode>(a, b)\u003C/code> would be stored twice: once in \u003Ccode>a\u003C/code>’s adjacent vertices and once in \u003Ccode>b\u003C/code>’s adjacent vertices.\u003C/p>\n\u003Cp>A simple class definition for a graph node could look essentially the same as a tree node.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">class\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Graph\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> __init__\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">nodes \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> {}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">class\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Node\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> __init__\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> neighbors\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> None\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">val \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> val\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#8EACE3\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">neighbors \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> neighbors \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> neighbors \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">is\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> not\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> None\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> else\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> []\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>You don’t necessarily need any additional classes to represent a graph. An array (or a hash table) of lists (arrays, arraylists, linked lists, etc.) can store the adjacency list.\u003C/p>\n\u003Ch2 id=\"adjacency-matrix\">Adjacency Matrix\u003C/h2>\n\u003Cp>An adjacency matrix is an \u003Ccode>NxN\u003C/code> boolean matrix (where \u003Ccode>N\u003C/code> is the number of nodes), where a true value at \u003Ccode>matrix[i][j]\u003C/code> indicates an edge from node \u003Ccode>i\u003C/code> to node \u003Ccode>j\u003C/code>. (You can also use an integer matrix with Os and 1s.)\u003C/p>\n\u003Cp>Note that in an undirected graph, an adjacency matrix will be symmetric. In a directed graph, it will not (necessarily) be.\u003C/p>\n\u003Cp>The same graph algorithms that are used on adjacency lists (breadth-first search, etc.) can be performed with adjacency matrices, but they may be somewhat less efficient. In the adjacency list representation, you can easily iterate through the neighbors of a node. In the adjacency matrix representation, you will need to iterate through all the nodes to identify a node’s neighbors.\u003C/p>\n\u003Ch2 id=\"graph-search\">Graph Search\u003C/h2>\n\u003Cp>The two most common ways to search a graph are \u003Cstrong>depth-first search\u003C/strong> and \u003Cstrong>breadth-first search\u003C/strong>.\u003C/p>\n\u003Cul>\n\u003Cli>\n\u003Cp>In depth-first search (DFS), we start at the root (or another arbitrarily selected node) and explore each branch completely before moving on to the next branch. That is. we go deep first (hence the name depth-first search) before we go wide.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>In breadth-first search (BFS), we start at the root (or another arbitrarily selected node) and explore each neighbor before going on to any of their children. That is, we go wide (hence breadth-first search) before\nwe go deep.\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003Cp>Breadth-first search and depth-first search tend to be used in different scenarios. DFS is often preferred if we want to visit every node in the graph. Both will work just fine, but depth-first search is a bit simpler. However, if we want to find the shortest path (or just any path) between two nodes, BFS is generally better.\u003C/p>\n\u003Ch3 id=\"dfs\">DFS\u003C/h3>\n\u003Cp>In DFS, we visit a node a and then iterate through each of a’s neighbors. When visiting \u003Ccode>a\u003C/code> node \u003Ccode>b\u003C/code> that is a neighbor of \u003Ccode>a\u003C/code>, we visit all of \u003Ccode>b\u003C/code>’s neighbors before going on to \u003Ccode>a\u003C/code>’s other neighbors. That is, a exhaustively\nsearches \u003Ccode>b\u003C/code>’s branch before any of its other neighbors.\u003C/p>\n\u003Cp>Note that pre-order and other forms of tree traversal are a form of DFS. The key difference is that when implementing this algorithm for a graph, we must check if the node has been visited. If we don’t, we risk getting stuck in an infinite loop.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> dfs\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">node\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> node \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">is\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> None\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">    visit\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">node\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    node\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">visited \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> True\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> next\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> node\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">adjacent\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> next\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">visited \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> False\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">            dfs\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">next\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"bfs\">BFS\u003C/h3>\n\u003Cp>BFS is a bit less intuitive. The main tripping point is the (false) assumption that BFS is recursive. It’s not. Instead, it uses a queue.\u003C/p>\n\u003Cp>In BFS, node a visits each of a’s neighbors before visiting any of their neighbors. You can think of this as searching level by level out from a. An iterative solution involving a queue usually works best.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bfs\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> start\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    queue \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> []\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">append\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">start\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    start\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">visited \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> True\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        r \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">pop\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">        visit\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">r\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> n \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> r\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">adjacent\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> n\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">visited \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> False\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">                n\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">visited \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> True\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">                queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">append\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">n\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>If you are asked to implement BFS, the key thing to remember is the use of the queue. The rest of the algorithm flows from this fact.\u003C/p>\n\u003Ch3 id=\"bidirectional-search\">Bidirectional Search\u003C/h3>\n\u003Cp>Bidirectional search is used to find the shortest path between a source and destination node. It operates by essentially running two simultaneous breadth-first searches, one from each node. When their searches collide, we have found a path.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://i.imgur.com/AQTtl8H.png\" alt=\"\">\u003C/p>\n\u003Cp>To see why this is faster, consider a graph where every node has at most k adjacent nodes and the shortest path from node s to node t has length d.\u003C/p>\n\u003Cul>\n\u003Cli>\n\u003Cp>In traditional breadth-first search, we would search up to \u003Ccode>k\u003C/code> nodes in the first “level” of the search. In the second level, we would search up to \u003Ccode>k\u003C/code> nodes for each of those first \u003Ccode>k\u003C/code> nodes, so \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsup>\u003Cmi>k\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k^2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8141em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> nodes total (thus far).\nWe would do this \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>d\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">d\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">d\u003C/span>\u003C/span>\u003C/span>\u003C/span> times, so that’s \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsup>\u003Cmi>k\u003C/mi>\u003Cmi>d\u003C/mi>\u003C/msup>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(k^d)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0991em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8491em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">d\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> nodes.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>In bidirectional search, we have two searches that collide after approximately \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>d\u003C/mi>\u003Cmi mathvariant=\"normal\">/\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">d/2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">d\u003C/span>\u003Cspan class=\"mord\">/2\u003C/span>\u003C/span>\u003C/span>\u003C/span> levels (the midpoint of the path). The search from \u003Ccode>s\u003C/code> visits approximately \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmn>2\u003C/mn>\u003Cmsup>\u003Cmi>k\u003C/mi>\u003Cmrow>\u003Cmi>d\u003C/mi>\u003Cmi mathvariant=\"normal\">/\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/mrow>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">2k^{d/2}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.888em;\">\u003C/span>\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.888em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">d\u003C/span>\u003Cspan class=\"mord mtight\">/2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, as does the search from \u003Ccode>t\u003C/code>. That’s approximately \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsup>\u003Cmi>k\u003C/mi>\u003Cmrow>\u003Cmi>d\u003C/mi>\u003Cmi mathvariant=\"normal\">/\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/mrow>\u003C/msup>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(k^{d/2})\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.138em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.888em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">d\u003C/span>\u003Cspan class=\"mord mtight\">/2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> nodes total.\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003Cp>So the the bidirectional search is actually faster by a factor of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsup>\u003Cmi>k\u003C/mi>\u003Cmrow>\u003Cmi>d\u003C/mi>\u003Cmi mathvariant=\"normal\">/\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/mrow>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k^{d/2}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.888em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.888em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">d\u003C/span>\u003Cspan class=\"mord mtight\">/2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Ch3 id=\"topological-sort\">Topological Sort\u003C/h3>\n\u003Ch2 id=\"shortest-path\">Shortest Path\u003C/h2>\n\u003Cp>Finding a shortest path between two nodes of a graph is an important problem\nthat has many practical applications. For example, a natural problem related to a road network is to calculate the shortest possible length of a route between two cities, given the lengths of the roads.\u003C/p>\n\u003Cp>In an unweighted graph, the length of a path equals the number of its edges,\nand we can simply use breadth-first search to find a shortest path. However, we focus on weighted graphs where more sophisticated algorithms are needed for finding shortest paths\u003C/p>\n\u003Ch3 id=\"bellman-ford\">Bellman-Ford\u003C/h3>\n\u003Cp>The Bellman–Ford algorithm finds shortest paths from a starting node to all\nnodes of the graph. The algorithm can process all kinds of graphs, provided that the graph does not contain a cycle with negative length. If the graph contains a negative cycle, the algorithm can detect this.\u003C/p>\n\u003Cp>The algorithm keeps track of distances from the starting node to all nodes\nof the graph. Initially, the distance to the starting node is 0 and the distance to all other nodes in infinite. The algorithm reduces the distances by finding edges that shorten the paths until it is not possible to reduce any distance\u003C/p>\n\u003Cp>The algorithm is based on the following observation: if we know the shortest path from the starting node to all nodes except one, we can find the shortest path to all nodes by adding one edge to the shortest path. The algorithm iterates through all edges of the graph and relaxes each edge. The relaxation of an edge means that we try to find a shorter path to the destination node of the edge by going through the source node of the edge. The algorithm repeats this process for a number of iterations, which is equal to the number of nodes in the graph. If the algorithm finds a shorter path to a node, it means that the graph contains a negative cycle. The algorithm can detect this by keeping track of the number of iterations. If the number of iterations is equal to the number of nodes in the graph, the graph contains a negative cycle.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bellman_ford\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> source\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> predecessor \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> dict\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(),\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> dict\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> node \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">node\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> float\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">inf\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        predecessor\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">node\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> None\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">source\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> _ \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> range\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">len\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">):\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> v \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">edges\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">edges\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">                distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">edges\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">                predecessor\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> u\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> v \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">edges\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        assert\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">edges\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> predecessor\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The time complexity of the algorithm is \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmi>m\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(nm)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">nm\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, because the algorithm consists of \u003Ccode>n − 1\u003C/code> rounds and iterates through all \u003Ccode>m\u003C/code> edges during a round. If there are no negative cycles in the graph, all distances are final after \u003Ccode>n − 1\u003C/code> rounds, because each shortest path can contain at most \u003Ccode>n − 1\u003C/code> edges.\u003C/p>\n\u003Cp>In practice, the final distances can usually be found faster than in \u003Ccode>n − 1\u003C/code> rounds. Thus, a possible way to make the algorithm more efficient is to stop the algorithm if no distance can be reduced during a round.\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Note:\u003C/strong> We need to use this algorithm when the graph contains negative edges. If the graph contains only positive edges, we can use Dijkstra’s algorithm, which is more efficient.\u003C/p>\n\u003C/blockquote>\n\u003Ch3 id=\"dijkstras-algorithm\">Dijkstra’s Algorithm\u003C/h3>\n\u003Cp>Dijkstra’s algorithm finds shortest paths from the starting node to all nodes of the graph, like the Bellman–Ford algorithm. The benefit of Dijkstra’s algorithm is that it is more efficient and can be used for processing large graphs. However, the algorithm requires that there are no negative weight edges in the graph.\u003C/p>\n\u003Cp>Like the Bellman–Ford algorithm, Dijkstra’s algorithm maintains distances\nto the nodes and reduces them during the search. Dijkstra’s algorithm is efficient, because it only processes each edge in the graph once, using the fact that there are no negative edges.\u003C/p>\n\u003Cp>An efficient implementation of Dijkstra’s algorithm requires that it is possible to efficiently find the minimum distance node that has not been processed. An appropriate data structure for this is a priority queue that contains the nodes ordered by their distances. Using a priority queue, the next node to be processed can be retrieved in logarithmic time\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> dijkstra\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> source\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> predecessor \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> dict\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(),\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> dict\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> node \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">node\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> float\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">inf\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        predecessor\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">node\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> None\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">source\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    queue \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> PriorityQueue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">put\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">, source)\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> not\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">empty\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">():\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        _\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> u \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">get\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> v \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            alt \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">edges\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> alt \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">                distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> alt\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">                predecessor\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> u\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">                queue\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">put\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">(alt, v)\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> predecessor\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The time complexity of the above implementation is \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmi>m\u003C/mi>\u003Cmi>log\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmi>m\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n + m \\log m)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">m\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mop\">lo\u003Cspan style=\"margin-right:0.01389em;\">g\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">m\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, because\nthe algorithm goes through all nodes of the graph and adds for each edge at most one distance to the priority queue.\u003C/p>\n\u003Ch3 id=\"floyd-warshall\">Floyd-Warshall\u003C/h3>\n\u003Cp>The Floyd–Warshall algorithm provides an alternative way to approach the\nproblem of finding shortest paths. Unlike the other algorithms of this chapter, it finds all shortest paths between the nodes in a single run.\u003C/p>\n\u003Cp>The algorithm maintains a two-dimensional array that contains distances\nbetween the nodes. First, distances are calculated only using direct edges between the nodes, and after this, the algorithm reduces distances by using intermediate nodes in paths.\u003C/p>\n\u003Cp>The advantage of the Floyd–Warshall algorithm that it is easy to implement. The following code constructs a distance matrix where \u003Ccode>distance[a][b]\u003C/code> is the shortest distance between nodes a and b. First, the algorithm initializes distance using the adjacency matrix adj of the graph:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> floyd_warshall\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">graph\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    distance \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> float\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">inf\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> v \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">}\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> u \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> u \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> v \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">edges\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">edges\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">u\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> v\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> k \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> i \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> j \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> graph\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">                distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">i\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">j\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> min\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">i\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">[\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">j\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">],\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">i\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">[\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">k\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\"> distance\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">k\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">[\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">j\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">]\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> distance\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The time complexity of the algorithm is \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsup>\u003Cmi>n\u003C/mi>\u003Cmn>3\u003C/mn>\u003C/msup>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n^3)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">3\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, because it contains three\nnested loops that go through the nodes of the graph. Since the implementation of the Floyd–Warshall algorithm is simple, the algorithm can be a good choice even if it is only needed to find a single shortest path in the graph. However, the algorithm can only be used when the graph is so\nsmall that a cubic time complexity is fast enough.\u003C/p>\n\u003Ch1 id=\"recursion\">Recursion\u003C/h1>\n\u003Cp>While there are a large number of recursive problems, many follows similar patterns. A good hint that a problem is recursive is that it can be built of sub-problems of the same type.\u003C/p>\n\u003Cp>When you hear a problem beginning with the following statements, it’s often (though not always) a good candidate for recursion:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cem>Design an algorithm to compute the nth …\u003C/em>\u003C/li>\n\u003Cli>\u003Cem>Write code to list the first n …\u003C/em>\u003C/li>\n\u003Cli>\u003Cem>Implement a method to compute all ..,\u003C/em>\u003C/li>\n\u003C/ul>\n\u003Cp>Recursive solutions, by definition, are built off of solutions to subproblems. Many times, this will mean simply to compute \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> by adding something, removing something, or otherwise changing the solution\nfor \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(n-1)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>. In other cases, you might solve the problem for the first half of the data set, then the second half, and then merge those results.\nThere are many ways you might divide a problem into subproblems.Three of the most common approaches to develop an algorithm are bottom-up, top-down, and half-and-half.\u003C/p>\n\u003Ch2 id=\"bottom-up\">Bottom-Up\u003C/h2>\n\u003Cp>The bottom-up approach is often the most intuitive. We start with knowing how to solve the problem for a simple case, like a list with only one element. Then we figure out how to solve the problem for two\nelements, then for three elements, and so on. The key here is to think about how you can build the solution for one case off of the previous case (or multiple previous cases).\u003C/p>\n\u003Ch2 id=\"top-down\">Top-Down\u003C/h2>\n\u003Cp>The top-down approach can be more complex since it’s less concrete. But sometimes, it’s the best way to think about the problem.\u003C/p>\n\u003Cp>In these problems, we think about how we can divide the problem for case \u003Ccode>N\u003C/code> into subproblems. Be careful of overlap between the cases.\u003C/p>\n\u003Ch2 id=\"half-and-half\">Half-and-Half\u003C/h2>\n\u003Cp>In addition to top-down and bottom-up approaches, it’s often effective to divide the data set in half.\u003C/p>\n\u003Cp>For example, binary search works with a “half-and-half” approach. When we look for an element in a sorted array, we first figure out which half of the array contains the value. Then we recurse and search for it in that half.\u003C/p>\n\u003Cp>Merge sort is also a “half-and-half” approach. We sort each half of the array and then merge together the\nsorted halves.\u003C/p>\n\u003Ch2 id=\"recursion-vs-iteration\">Recursion vs. Iteration\u003C/h2>\n\u003Cp>Recursive algorithms can be very space inefficient. Each recursive call adds a new layer to the stack, which means that if your algorithm recurses to a depth of \u003Ccode>n\u003C/code>, it uses at least \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> memory.\u003C/p>\n\u003Cp>For this reason, it’s often better to implement a recursive algorithm iteratively. All recursive algorithms can be implemented iteratively, although sometimes the code to do so is much more complex. Before diving\ninto recursive code, ask yourself how hard it would be to implement it iteratively,\u003C/p>\n\u003Ch1 id=\"dynamic-programming\">Dynamic Programming\u003C/h1>\n\u003Cp>Dynamic programming is a technique that combines the correctness of complete search and the efficiency of greedy algorithms. Dynamic programming can be applied if the problem can be divided into overlapping subproblems that can be solved independently.\u003C/p>\n\u003Cp>There are two uses for dynamic programming:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Finding an optimal solution\u003C/strong>: We want to find a solution that is as large as possible or as small as possible.\u003C/li>\n\u003Cli>\u003Cstrong>Counting the number of solutions:\u003C/strong> We want to calculate the total number of possible solutions.\u003C/li>\n\u003C/ul>\n\u003C!-- # Greedy\n\n# Intervals -->\n\u003Ch1 id=\"bit-manipulation\">Bit Manipulation\u003C/h1>\n\u003Cp>All data in computer programs is internally stored as bits, i.e., as numbers 0 and 1. In programming, an n bit integer is internally stored as a binary number that consists of \u003Ccode>n\u003C/code> bits. For example, the \u003Ccode>C++\u003C/code> type int is a \u003Ccode>32-bit\u003C/code> type, which means that every \u003Ccode>int\u003C/code> number consists of 32 bits.\u003C/p>\n\u003Cp>The bits in the representation are indexed from right to left. To convert a bit representation $b_k · · · b_2 b_1 b_0 into a number, we can use the formula\u003C/p>\n\u003Cp>\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmo>∑\u003C/mo>\u003Cmi mathvariant=\"normal\">_\u003C/mi>\u003Cmsup>\u003Cmrow>\u003Cmi>i\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>0\u003C/mn>\u003C/mrow>\u003Cmi>k\u003C/mi>\u003C/msup>\u003Cmsub>\u003Cmi>b\u003C/mi>\u003Cmi>i\u003C/mi>\u003C/msub>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmi>i\u003C/mi>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\sum\\_{i=0}^k b_i 2^i\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.2085em;vertical-align:-0.31em;\">\u003C/span>\u003Cspan class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\" style=\"margin-right:0.02778em;\">_\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">i\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mord\">0\u003C/span>\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8985em;\">\u003Cspan style=\"top:-3.1124em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">b\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8247em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/p>\n\u003Cp>For example, the number 13 is represented as 1101 in binary. To convert it to a decimal number, we can use the formula:\u003C/p>\n\u003Cp>\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmn>1\u003C/mn>\u003Cmo>⋅\u003C/mo>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmn>3\u003C/mn>\u003C/msup>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo>⋅\u003C/mo>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmn>2\u003C/mn>\u003C/msup>\u003Cmo>+\u003C/mo>\u003Cmn>0\u003C/mn>\u003Cmo>⋅\u003C/mo>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmn>1\u003C/mn>\u003C/msup>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo>⋅\u003C/mo>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmn>0\u003C/mn>\u003C/msup>\u003Cmo>=\u003C/mo>\u003Cmn>8\u003C/mn>\u003Cmo>+\u003C/mo>\u003Cmn>4\u003C/mn>\u003Cmo>+\u003C/mo>\u003Cmn>0\u003C/mn>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo>=\u003C/mo>\u003Cmn>13\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">1 \\cdot 2^3 + 1 \\cdot 2^2 + 0 \\cdot 2^1 + 1 \\cdot 2^0 = 8 + 4 + 0 + 1 = 13\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">⋅\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">3\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">⋅\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">0\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">⋅\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">⋅\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8141em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">0\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">8\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">4\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">0\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">13\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/p>\n\u003Cp>The following code converts a binary number to a decimal number:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> binary_to_decimal\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">binary\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    decimal \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> digit \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> binary\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        decimal \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> decimal \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">*\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> int\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">digit\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> decimal\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The time complexity of the above implementation is \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, where \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span> is the length of the binary number.\u003C/p>\n\u003Cp>The bit representation of a number is either signed or unsigned. Usually a signed representation is used, which means that both negative and positive numbers can be represented. signed variable of n bits can contain any integer\nbetween \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmo>−\u003C/mo>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">-2^{n-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">−\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">n\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msup>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">2^{n-1} - 1\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">n\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>. For example, the \u003Ccode>C++\u003C/code> type \u003Ccode>int\u003C/code> is a signed \u003Ccode>32-bit\u003C/code> type, which means that it can contain any integer between \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmo>−\u003C/mo>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmn>31\u003C/mn>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">-2^{31}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">−\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">31\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmn>31\u003C/mn>\u003C/msup>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">2^{31} - 1\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">31\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cp>The first bit in a signed representation is the sign of the number (\u003Ccode>0\u003C/code> for nonnegative numbers and \u003Ccode>1\u003C/code> for negative numbers), and the remaining \u003Ccode>n−1\u003C/code> bits contain the magnitude of the number. Two’s complement is used, which means that the opposite number of a number is calculated by first inverting all the bits in the number, and then increasing the number by one.\u003C/p>\n\u003Cp>For example, the number 13 is represented as 1101 in binary. To convert it to a two’s complement representation, we first invert all the bits:\u003C/p>\n\u003Cp>\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmover accent=\"true\">\u003Cmn>1101\u003C/mn>\u003Cmo stretchy=\"true\">‾\u003C/mo>\u003C/mover>\u003Cmo>=\u003C/mo>\u003Cmn>0010\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\overline{1101} = 0010\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8444em;\">\u003C/span>\u003Cspan class=\"mord overline\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8444em;\">\u003Cspan style=\"top:-3em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">1101\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.7644em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"overline-line\" style=\"border-bottom-width:0.04em;\">\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">0010\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/p>\n\u003Cp>Then we increase the number by one:\u003C/p>\n\u003Cp>\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmn>0010\u003C/mn>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo>=\u003C/mo>\u003Cmn>0011\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">0010 + 1 = 0011\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">0010\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">0011\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/p>\n\u003Cp>The result is the two’s complement representation of the number 13, which is 0011. The number -13 is represented as 1101 in binary. To\u003C/p>\n\u003Cp>In an unsigned representation, only nonnegative numbers can be used, but the upper bound for the values is larger. An unsigned variable of \u003Ccode>n\u003C/code> bits can contain any integer between 0 and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmi>n\u003C/mi>\u003C/msup>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">2^n - 1\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7477em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.6644em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>. For example, the \u003Ccode>C++\u003C/code> type \u003Ccode>unsigned int\u003C/code> is an unsigned \u003Ccode>32-bit\u003C/code> type, which means that it can contain any integer between 0 and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsup>\u003Cmn>2\u003C/mn>\u003Cmn>32\u003C/mn>\u003C/msup>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">2^{32} - 1\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">2\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">32\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Ch2 id=\"bitwise-operators\">Bitwise Operators\u003C/h2>\n\u003Ch3 id=\"bitwise-and\">Bitwise AND\u003C/h3>\n\u003Cp>The bitwise AND operator \u003Ccode>&#x26;\u003C/code> compares two numbers on a bit level and returns a number where the bits of that number are turned on if the corresponding bits of both numbers are \u003Ccode>1\u003C/code>.\u003C/p>\n\u003Cp>For example, the number 13 is represented as 1101 in binary. The number 7 is represented as 0111 in binary. The bitwise AND of 13 and 7 is 0101, which is the number 5.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bitwise_and\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> b\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"bitwise-or\">Bitwise OR\u003C/h3>\n\u003Cp>The bitwise OR operator \u003Ccode>|\u003C/code> compares two numbers on a bit level and returns a number where the bits of that number are turned on if the corresponding bits of either of the two numbers are \u003Ccode>1\u003C/code>.\u003C/p>\n\u003Cp>For example, the number 13 is represented as 1101 in binary. The number 7 is represented as 0111 in binary. The bitwise OR of 13 and 7 is 1111, which is the number 15.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bitwise_or\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> b\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"bitwise-xor\">Bitwise XOR\u003C/h3>\n\u003Cp>The bitwise XOR operator \u003Ccode>^\u003C/code> compares two numbers on a bit level and returns a number where the bits of that number are turned on if the corresponding bits of either of the two numbers are \u003Ccode>1\u003C/code>, but not both.\u003C/p>\n\u003Cp>For example, the number 13 is represented as 1101 in binary. The number 7 is represented as 0111 in binary. The bitwise XOR of 13 and 7 is 1010, which is the number 10.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bitwise_xor\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">^\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> b\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"bitwise-not\">Bitwise NOT\u003C/h3>\n\u003Cp>The bitwise NOT operator \u003Ccode>~\u003C/code> inverts all the bits of its operand.\u003C/p>\n\u003Cp>For example, the number 13 is represented as 1101 in binary. The bitwise NOT of 13 is 0010, which is the number 2.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bitwise_not\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ~\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">a\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"bitwise-shifts\">Bitwise Shifts\u003C/h3>\n\u003Cp>The bitwise left shift operator \u003Ccode>&#x3C;&#x3C;\u003C/code> shifts the bits of its first operand the specified number of positions to the left. The bits shifted off the left end are discarded. The bits on the right end are filled with zeros.\u003C/p>\n\u003Cp>For example, the number 13 is represented as 1101 in binary. The bitwise left shift of 13 by 1 is 1010, which is the number 10.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bitwise_left_shift\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> b\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The bitwise right shift operator \u003Ccode>>>\u003C/code> shifts the bits of its first operand the specified number of positions to the right. The bits shifted off the right end are discarded. The bits on the left end are filled with zeros.\u003C/p>\n\u003Cp>For example, the number 13 is represented as 1101 in binary. The bitwise right shift of 13 by 1 is 0110, which is the number 6.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bitwise_right_shift\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">>>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> b\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"bitwise-tricks\">Bitwise Tricks\u003C/h2>\n\u003Ch3 id=\"check-if-a-number-is-even-or-odd\">Check if a number is even or odd\u003C/h3>\n\u003Cp>A number is even if the last bit is \u003Ccode>0\u003C/code> and odd if the last bit is \u003Ccode>1\u003C/code>. We can check if a number is even or odd by checking the last bit of the number. If the last bit is \u003Ccode>0\u003C/code>, the number is even, otherwise, it is odd.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> is_even\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"check-if-a-number-is-a-power-of-two\">Check if a number is a power of two\u003C/h3>\n\u003Cp>A number is a power of two if it has only one bit set to \u003Ccode>1\u003C/code>. We can check if a number is a power of two by checking if the number has only one bit set to \u003Ccode>1\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> is_power_of_two\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"swap-two-numbers\">Swap two numbers\u003C/h3>\n\u003Cp>We can swap two numbers by using the bitwise XOR operator \u003Ccode>^\u003C/code>. The bitwise XOR of two numbers is \u003Ccode>0\u003C/code> if the two numbers are the same, and it is \u003Ccode>1\u003C/code> if the two numbers are different. We can use this property to swap two numbers.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> swap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">^=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> b\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    b \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">^=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">^=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> b\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> b\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"get-the-last-set-bit\">Get the last set bit\u003C/h3>\n\u003Cp>We can get the last set bit of a number by using the bitwise AND operator \u003Ccode>&#x26;\u003C/code> with the two’s complement of the number.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> get_last_set_bit\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">a\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"hamming-distance\">Hamming distance\u003C/h3>\n\u003Cp>The Hamming distance between two integers is the number of positions at which the corresponding bits are different.\u003C/p>\n\u003Cp>Given two integers \u003Ccode>x\u003C/code> and \u003Ccode>y\u003C/code>, calculate the Hamming distance.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> hamming_distance\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">x\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\"> y\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> bin\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">x \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">^\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\"> y\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">).\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">count\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">1\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"count-the-number-of-set-bits\">Count the number of set bits\u003C/h3>\n\u003Cp>We can count the number of set bits in a number by repeatedly clearing the last set bit of the number until the number becomes \u003Ccode>0\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> count_set_bits\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    count \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x26;=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        count \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> count\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"reverse-bits\">Reverse bits\u003C/h3>\n\u003Cp>We can reverse the bits of a number by repeatedly shifting the number to the right and appending the last bit to the result.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">def\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> reverse_bits\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(\u003C/span>\u003Cspan style=\"--shiki-light:#FF9800;--shiki-dark:#7FDBCA\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    result \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> _ \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">in\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\"> range\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">32\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">):\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        result \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (result \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        a \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">>>=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> result\u003C/span>\u003C/span>\u003C/code>\u003C/pre>",{"headings":431,"localImagePaths":615,"remoteImagePaths":616,"frontmatter":617,"imagePaths":620},[432,435,438,441,444,447,450,453,456,459,462,465,468,471,474,477,480,483,486,489,492,495,498,501,504,507,510,513,516,519,522,525,528,531,534,537,540,543,546,549,552,555,558,561,564,567,570,573,576,579,582,585,588,591,594,597,600,603,606,609,612],{"depth":31,"slug":433,"text":434},"arrays","Arrays",{"depth":31,"slug":436,"text":437},"hashtable","HashTable",{"depth":31,"slug":439,"text":440},"arraylist--resizablearray","ArrayList & ResizableArray",{"depth":284,"slug":442,"text":443},"binary-search","Binary Search",{"depth":31,"slug":445,"text":446},"algorithms","Algorithms",{"depth":47,"slug":448,"text":449},"quickselect","QuickSelect",{"depth":284,"slug":451,"text":452},"stack","Stack",{"depth":31,"slug":454,"text":455},"queue","Queue",{"depth":284,"slug":457,"text":458},"linked-list","Linked List",{"depth":31,"slug":460,"text":461},"singly-linked-list","Singly Linked List",{"depth":31,"slug":463,"text":464},"techniques","Techniques",{"depth":284,"slug":466,"text":467},"trees","Trees",{"depth":31,"slug":469,"text":470},"binary-tree","Binary Tree",{"depth":31,"slug":472,"text":473},"binary-search-tree","Binary Search Tree",{"depth":47,"slug":475,"text":476},"balanced-vs-unbalanced","Balanced vs Unbalanced",{"depth":47,"slug":478,"text":479},"complete-binary-tree","Complete Binary Tree",{"depth":47,"slug":481,"text":482},"full-binary-tree","Full Binary Tree",{"depth":47,"slug":484,"text":485},"perfect-binary-tree","Perfect Binary Tree",{"depth":31,"slug":487,"text":488},"binary-tree-traversal","Binary Tree Traversal",{"depth":47,"slug":490,"text":491},"in-order-traversal","In-order Traversal",{"depth":47,"slug":493,"text":494},"pre-order-traversal","Pre-order Traversal",{"depth":47,"slug":496,"text":497},"post-order-traversal","Post-order Traversal",{"depth":47,"slug":499,"text":500},"level-order-traversal","Level-order Traversal",{"depth":31,"slug":502,"text":503},"binary-heaps-min-heap-and-max-heap","Binary Heaps (min-heap and max-heap)",{"depth":47,"slug":505,"text":506},"insert","Insert",{"depth":47,"slug":508,"text":509},"extract-min","Extract Min",{"depth":284,"slug":511,"text":512},"tries","Tries",{"depth":284,"slug":514,"text":515},"backtracking","Backtracking",{"depth":284,"slug":517,"text":518},"graphs","Graphs",{"depth":31,"slug":520,"text":521},"adjacency-lists","Adjacency Lists",{"depth":31,"slug":523,"text":524},"adjacency-matrix","Adjacency Matrix",{"depth":31,"slug":526,"text":527},"graph-search","Graph Search",{"depth":47,"slug":529,"text":530},"dfs","DFS",{"depth":47,"slug":532,"text":533},"bfs","BFS",{"depth":47,"slug":535,"text":536},"bidirectional-search","Bidirectional Search",{"depth":47,"slug":538,"text":539},"topological-sort","Topological Sort",{"depth":31,"slug":541,"text":542},"shortest-path","Shortest Path",{"depth":47,"slug":544,"text":545},"bellman-ford","Bellman-Ford",{"depth":47,"slug":547,"text":548},"dijkstras-algorithm","Dijkstra’s Algorithm",{"depth":47,"slug":550,"text":551},"floyd-warshall","Floyd-Warshall",{"depth":284,"slug":553,"text":554},"recursion","Recursion",{"depth":31,"slug":556,"text":557},"bottom-up","Bottom-Up",{"depth":31,"slug":559,"text":560},"top-down","Top-Down",{"depth":31,"slug":562,"text":563},"half-and-half","Half-and-Half",{"depth":31,"slug":565,"text":566},"recursion-vs-iteration","Recursion vs. Iteration",{"depth":284,"slug":568,"text":569},"dynamic-programming","Dynamic Programming",{"depth":284,"slug":571,"text":572},"bit-manipulation","Bit Manipulation",{"depth":31,"slug":574,"text":575},"bitwise-operators","Bitwise Operators",{"depth":47,"slug":577,"text":578},"bitwise-and","Bitwise AND",{"depth":47,"slug":580,"text":581},"bitwise-or","Bitwise OR",{"depth":47,"slug":583,"text":584},"bitwise-xor","Bitwise XOR",{"depth":47,"slug":586,"text":587},"bitwise-not","Bitwise NOT",{"depth":47,"slug":589,"text":590},"bitwise-shifts","Bitwise Shifts",{"depth":31,"slug":592,"text":593},"bitwise-tricks","Bitwise Tricks",{"depth":47,"slug":595,"text":596},"check-if-a-number-is-even-or-odd","Check if a number is even or odd",{"depth":47,"slug":598,"text":599},"check-if-a-number-is-a-power-of-two","Check if a number is a power of two",{"depth":47,"slug":601,"text":602},"swap-two-numbers","Swap two numbers",{"depth":47,"slug":604,"text":605},"get-the-last-set-bit","Get the last set bit",{"depth":47,"slug":607,"text":608},"hamming-distance","Hamming distance",{"depth":47,"slug":610,"text":611},"count-the-number-of-set-bits","Count the number of set bits",{"depth":47,"slug":613,"text":614},"reverse-bits","Reverse bits",[],[],{"author":269,"pubDatetime":618,"title":419,"slug":415,"featured":18,"draft":179,"tags":619,"description":424},["Date","2022-12-01T00:00:00.000Z"],[421,422,423],[],"adding-new-posts-in-astropaper-theme",{"id":621,"data":623,"body":629,"filePath":630,"digest":631,"rendered":632},{"author":14,"pubDatetime":624,"modDatetime":625,"title":626,"featured":179,"draft":18,"tags":627,"description":628},["Date","2022-09-23T15:22:00.000Z"],["Date","2025-06-13T16:52:45.934Z"],"Adding new posts in AstroPaper theme",[20],"Some rules & recommendations for creating or adding new posts using AstroPaperr theme.","Here are some rules/recommendations, tips & ticks for creating new posts in AstroPaper blog theme.\n\n\u003Cfigure>\n  \u003Cimg\n    src=\"https://images.pexels.com/photos/159618/still-life-school-retro-ink-159618.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1\"\n    alt=\"Free Classic wooden desk with writing materials, vintage clock, and a leather bag. Stock Photo\"\n  />\n    \u003Cfigcaption class=\"text-center\">\n    Photo by \u003Ca href=\"https://www.pexels.com/photo/brown-wooden-desk-159618/\">Pixabay\u003C/a>\n  \u003C/figcaption>\n\u003C/figure>\n\n## Table of contents\n\n## Creating a Blog Post\n\nTo write a new blog post, create a markdown file inside the `src/data/blog/` directory.\n\n> Prior to AstroPaper v5.1.0, all blog posts had to be in `src/data/blog/`, meaning you couldn't organize them into subdirectories.\n\nStarting from AstroPaper v5.1.0, you can now organize blog posts into subdirectories, making it easier to manage your content.\n\nFor example, if you want to group posts under `2025`, you can place them in `src/data/blog/2025/`. This also affects the post URL, so `src/data/blog/2025/example-post.md` will be available at `/posts/2025/example-post`.\n\nIf you don’t want subdirectories to affect the post URL, just prefix the folder name with an underscore `_`.\n\n```bash\n# Example: blog post structure and URLs\nsrc/data/blog/very-first-post.md          -> mysite.com/posts/very-first-post\nsrc/data/blog/2025/example-post.md        -> mysite.com/posts/2025/example-post\nsrc/data/blog/_2026/another-post.md       -> mysite.com/posts/another-post\nsrc/data/blog/docs/_legacy/how-to.md      -> mysite.com/posts/docs/how-to\nsrc/data/blog/Example Dir/Dummy Post.md   -> mysite.com/posts/example-dir/dummy-post\n```\n\n> 💡 Tip: You can override a blog post’s slug in the frontmatter as well. See the next section for more details.\n\nIf the subdirectory URL doesn’t appear in the build output, remove node_modules, reinstall packages, and then rebuild.\n\n## Frontmatter\n\nFrontmatter is the main place to store some important information about the blog post (article). Frontmatter lies at the top of the article and is written in YAML format. Read more about frontmatter and its usage in [astro documentation](https://docs.astro.build/en/guides/markdown-content/).\n\nHere is the list of frontmatter property for each post.\n\n| Property           | Description                                                                                                                           | Remark                                         |\n| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------- |\n| **_title_**        | Title of the post. (h1)                                                                                                               | required\u003Csup>\\*\u003C/sup>                          |\n| **_description_**  | Description of the post. Used in post excerpt and site description of the post.                                                       | required\u003Csup>\\*\u003C/sup>                          |\n| **_pubDatetime_**  | Published datetime in ISO 8601 format.                                                                                                | required\u003Csup>\\*\u003C/sup>                          |\n| **_modDatetime_**  | Modified datetime in ISO 8601 format. (only add this property when a blog post is modified)                                           | optional                                       |\n| **_author_**       | Author of the post.                                                                                                                   | default = SITE.author                          |\n| **_slug_**         | Slug for the post. This field is optional.                                                                                            | default = slugified file name                  |\n| **_featured_**     | Whether or not display this post in featured section of home page                                                                     | default = false                                |\n| **_draft_**        | Mark this post 'unpublished'.                                                                                                         | default = false                                |\n| **_tags_**         | Related keywords for this post. Written in array yaml format.                                                                         | default = others                               |\n| **_ogImage_**      | OG image of the post. Useful for social media sharing and SEO. This can be a remote URL or an image path relative to current folder.  | default = `SITE.ogImage` or generated OG image |\n| **_canonicalURL_** | Canonical URL (absolute), in case the article already exists on other source.                                                         | default = `Astro.site` + `Astro.url.pathname`  |\n| **_hideEditPost_** | Hide editPost button under blog title. This applies only to the current blog post.                                                    | default = false                                |\n| **_timezone_**     | Specify a timezone in IANA format for the current blog post. This will override the `SITE.timezone` config for the current blog post. | default = `SITE.timezone`                      |\n\n> Tip! You can get ISO 8601 datetime by running `new Date().toISOString()` in the console. Make sure you remove quotes though.\n\nOnly `title`, `description` and `pubDatetime` fields in frontmatter must be specified.\n\nTitle and description (excerpt) are important for search engine optimization (SEO) and thus AstroPaper encourages to include these in blog posts.\n\n`slug` is the unique identifier of the url. Thus, `slug` must be unique and different from other posts. The whitespace of `slug` should to be separated with `-` or `_` but `-` is recommended. Slug is automatically generated using the blog post file name. However, you can define your `slug` as a frontmatter in your blog post.\n\nFor example, if the blog file name is `adding-new-post.md` and you don't specify the slug in your frontmatter, Astro will automatically create a slug for the blog post using the file name. Thus, the slug will be `adding-new-post`. But if you specify the `slug` in the frontmatter, this will override the default slug. You can read more about this in [Astro Docs](https://docs.astro.build/en/guides/content-collections/#defining-custom-slugs).\n\nIf you omit `tags` in a blog post (in other words, if no tag is specified), the default tag `others` will be used as a tag for that post. You can set the default tag in the `content.config.ts` file.\n\n```ts file=\"src/content.config.ts\"\nexport const blogSchema = z.object({\n  // ...\n  draft: z.boolean().optional(),\n  // [!code highlight:1]\n  tags: z.array(z.string()).default([\"others\"]), // replace \"others\" with whatever you want\n  // ...\n});\n```\n\n### Sample Frontmatter\n\nHere is the sample frontmatter for a post.\n\n```yaml file=\"src/data/blog/sample-post.md\"\n---\ntitle: The title of the post\nauthor: your name\npubDatetime: 2022-09-21T05:17:19Z\nslug: the-title-of-the-post\nfeatured: true\ndraft: false\ntags:\n  - some\n  - example\n  - tags\nogImage: ../../assets/images/example.png # src/assets/images/example.png\n# ogImage: \"https://example.org/remote-image.png\" # remote URL\ndescription: This is the example description of the example post.\ncanonicalURL: https://example.org/my-article-was-already-posted-here\n---\n```\n\n## Adding table of contents\n\nBy default, a post (article) does not include any table of contents (toc). To include toc, you have to specify it in a specific way.\n\nWrite `Table of contents` in h2 format (## in markdown) and place it where you want it to be appeared on the post.\n\nFor instance, if you want to place your table of contents just under the intro paragraph (like I usually do), you can do that in the following way.\n\n\u003C!-- prettier-ignore-start -->\n```md\n---\n# frontmatter\n---\n\nHere are some recommendations, tips & ticks for creating new posts in AstroPaper blog theme.\n\n\u003C!-- [!code ++] -->\n## Table of contents\n\n\u003C!-- the rest of the post -->\n```\n\u003C!-- prettier-ignore-end -->\n\n## Headings\n\nThere's one thing to note about headings. The AstroPaper blog posts use title (title in the frontmatter) as the main heading of the post. Therefore, the rest of the heading in the post should be using h2 \\~ h6.\n\nThis rule is not mandatory, but highly recommended for visual, accessibility and SEO purposes.\n\n## Syntax Highlighting\n\nAstroPaper uses [Shiki](https://shiki.style/) as the default syntax highlighting. Starting from AstroPaper v5.4, [@shikijs/transformers](https://shiki.style/packages/transformers) is used to enhance better fenced code blocks. If you don't want to use it, you can simply remove it like this\n\n```bash\npnpm remove @shikijs/transformers\n```\n\n```js file=\"astro.config.ts\"\n// ...\n// [!code --:5]\nimport {\n  transformerNotationDiff,\n  transformerNotationHighlight,\n  transformerNotationWordHighlight,\n} from \"@shikijs/transformers\";\n\nexport default defineConfig({\n  // ...\n  markdown: {\n    remarkPlugins: [remarkToc, [remarkCollapse, { test: \"Table of contents\" }]],\n    shikiConfig: {\n      // For more themes, visit https://shiki.style/themes\n      themes: { light: \"min-light\", dark: \"night-owl\" },\n      defaultColor: false,\n      wrap: false,\n      transformers: [\n        transformerFileName(),\n      // [!code --:3]\n        transformerNotationHighlight(),\n        transformerNotationWordHighlight(),\n        transformerNotationDiff({ matchAlgorithm: \"v3\" }),\n      ],\n    },\n  },\n  // ...\n}\n```\n\n## Storing Images for Blog Content\n\nHere are two methods for storing images and displaying them inside a markdown file.\n\n> Note! If it's a requirement to style optimized images in markdown you should [use MDX](https://docs.astro.build/en/guides/images/#images-in-mdx-files).\n\n### Inside `src/assets/` directory (recommended)\n\nYou can store images inside `src/assets/` directory. These images will be automatically optimized by Astro through [Image Service API](https://docs.astro.build/en/reference/image-service-reference/).\n\nYou can use relative path or alias path (`@/assets/`) to serve these images.\n\nExample: Suppose you want to display `example.jpg` whose path is `/src/assets/images/example.jpg`.\n\n```md\n![something](@/assets/images/example.jpg)\n\n\u003C!-- OR -->\n\n![something](../../assets/images/example.jpg)\n\n\u003C!-- Using img tag or Image component won't work ❌ -->\n\u003Cimg src=\"@/assets/images/example.jpg\" alt=\"something\">\n\u003C!-- ^^ This is wrong -->\n```\n\n> Technically, you can store images inside any directory under `src`. In here, `src/assets` is just a recommendation.\n\n### Inside `public` directory\n\nYou can store images inside the `public` directory. Keep in mind that images stored in the `public` directory remain untouched by Astro, meaning they will be unoptimized and you need to handle image optimization by yourself.\n\nFor these images, you should use an absolute path; and these images can be displayed using [markdown annotation](https://www.markdownguide.org/basic-syntax/#images-1) or [HTML img tag](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img).\n\nExample: Assume `example.jpg` is located at `/public/assets/images/example.jpg`.\n\n```md\n![something](/assets/images/example.jpg)\n\n\u003C!-- OR -->\n\n\u003Cimg src=\"/assets/images/example.jpg\" alt=\"something\">\n```\n\n## Bonus\n\n### Image compression\n\nWhen you put images in the blog post (especially for images under `public` directory), it is recommended that the image is compressed. This will affect the overall performance of the website.\n\nMy recommendation for image compression sites.\n\n- [TinyPng](https://tinypng.com/)\n- [TinyJPG](https://tinyjpg.com/)\n\n### OG Image\n\nThe default OG image will be placed if a post does not specify the OG image. Though not required, OG image related to the post should be specify in the frontmatter. The recommended size for OG image is **_1200 X 640_** px.\n\n> Since AstroPaper v1.4.0, OG images will be generated automatically if not specified. Check out [the announcement](https://astro-paper.pages.dev/posts/dynamic-og-image-generation-in-astropaper-blog-posts/).","src/data/blog/adding-new-post.md","3ff138fb1dfb4167",{"html":633,"metadata":634},"\u003Cp>Here are some rules/recommendations, tips &#x26; ticks for creating new posts in AstroPaper blog theme.\u003C/p>\n\u003Cfigure>\n  \u003Cimg src=\"https://images.pexels.com/photos/159618/still-life-school-retro-ink-159618.jpeg?auto=compress&#x26;cs=tinysrgb&#x26;w=1260&#x26;h=750&#x26;dpr=1\" alt=\"Free Classic wooden desk with writing materials, vintage clock, and a leather bag. Stock Photo\">\n    \u003Cfigcaption class=\"text-center\">\n    Photo by \u003Ca href=\"https://www.pexels.com/photo/brown-wooden-desk-159618/\">Pixabay\u003C/a>\n  \u003C/figcaption>\n\u003C/figure>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#creating-a-blog-post\">Creating a Blog Post\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#frontmatter\">Frontmatter\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#sample-frontmatter\">Sample Frontmatter\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#adding-table-of-contents\">Adding table of contents\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#headings\">Headings\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#syntax-highlighting\">Syntax Highlighting\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#storing-images-for-blog-content\">Storing Images for Blog Content\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#inside-srcassets-directory-recommended\">Inside \u003Ccode>src/assets/\u003C/code> directory (recommended)\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#inside-public-directory\">Inside \u003Ccode>public\u003C/code> directory\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#bonus\">Bonus\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#image-compression\">Image compression\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#og-image\">OG Image\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"creating-a-blog-post\">Creating a Blog Post\u003C/h2>\n\u003Cp>To write a new blog post, create a markdown file inside the \u003Ccode>src/data/blog/\u003C/code> directory.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Prior to AstroPaper v5.1.0, all blog posts had to be in \u003Ccode>src/data/blog/\u003C/code>, meaning you couldn’t organize them into subdirectories.\u003C/p>\n\u003C/blockquote>\n\u003Cp>Starting from AstroPaper v5.1.0, you can now organize blog posts into subdirectories, making it easier to manage your content.\u003C/p>\n\u003Cp>For example, if you want to group posts under \u003Ccode>2025\u003C/code>, you can place them in \u003Ccode>src/data/blog/2025/\u003C/code>. This also affects the post URL, so \u003Ccode>src/data/blog/2025/example-post.md\u003C/code> will be available at \u003Ccode>/posts/2025/example-post\u003C/code>.\u003C/p>\n\u003Cp>If you don’t want subdirectories to affect the post URL, just prefix the folder name with an underscore \u003Ccode>_\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># Example: blog post structure and URLs\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">src/data/blog/very-first-post.md\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          -\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">>\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> mysite.com/posts/very-first-post\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">src/data/blog/2025/example-post.md\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        -\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">>\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> mysite.com/posts/2025/example-post\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">src/data/blog/_2026/another-post.md\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">       -\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">>\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> mysite.com/posts/another-post\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">src/data/blog/docs/_legacy/how-to.md\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      -\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">>\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> mysite.com/posts/docs/how-to\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">src/data/blog/Example\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> Dir/Dummy\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> Post.md\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">   -\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">>\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> mysite.com/posts/example-dir/dummy-post\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cblockquote>\n\u003Cp>💡 Tip: You can override a blog post’s slug in the frontmatter as well. See the next section for more details.\u003C/p>\n\u003C/blockquote>\n\u003Cp>If the subdirectory URL doesn’t appear in the build output, remove node_modules, reinstall packages, and then rebuild.\u003C/p>\n\u003Ch2 id=\"frontmatter\">Frontmatter\u003C/h2>\n\u003Cp>Frontmatter is the main place to store some important information about the blog post (article). Frontmatter lies at the top of the article and is written in YAML format. Read more about frontmatter and its usage in \u003Ca href=\"https://docs.astro.build/en/guides/markdown-content/\">astro documentation\u003C/a>.\u003C/p>\n\u003Cp>Here is the list of frontmatter property for each post.\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Property\u003C/th>\u003Cth>Description\u003C/th>\u003Cth>Remark\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>title\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Title of the post. (h1)\u003C/td>\u003Ctd>required\u003Csup>*\u003C/sup>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>description\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Description of the post. Used in post excerpt and site description of the post.\u003C/td>\u003Ctd>required\u003Csup>*\u003C/sup>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>pubDatetime\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Published datetime in ISO 8601 format.\u003C/td>\u003Ctd>required\u003Csup>*\u003C/sup>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>modDatetime\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Modified datetime in ISO 8601 format. (only add this property when a blog post is modified)\u003C/td>\u003Ctd>optional\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>author\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Author of the post.\u003C/td>\u003Ctd>default = SITE.author\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>slug\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Slug for the post. This field is optional.\u003C/td>\u003Ctd>default = slugified file name\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>featured\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Whether or not display this post in featured section of home page\u003C/td>\u003Ctd>default = false\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>draft\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Mark this post ‘unpublished’.\u003C/td>\u003Ctd>default = false\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>tags\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Related keywords for this post. Written in array yaml format.\u003C/td>\u003Ctd>default = others\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>ogImage\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>OG image of the post. Useful for social media sharing and SEO. This can be a remote URL or an image path relative to current folder.\u003C/td>\u003Ctd>default = \u003Ccode>SITE.ogImage\u003C/code> or generated OG image\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>canonicalURL\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Canonical URL (absolute), in case the article already exists on other source.\u003C/td>\u003Ctd>default = \u003Ccode>Astro.site\u003C/code> + \u003Ccode>Astro.url.pathname\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>hideEditPost\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Hide editPost button under blog title. This applies only to the current blog post.\u003C/td>\u003Ctd>default = false\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>\u003Cem>timezone\u003C/em>\u003C/strong>\u003C/td>\u003Ctd>Specify a timezone in IANA format for the current blog post. This will override the \u003Ccode>SITE.timezone\u003C/code> config for the current blog post.\u003C/td>\u003Ctd>default = \u003Ccode>SITE.timezone\u003C/code>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cblockquote>\n\u003Cp>Tip! You can get ISO 8601 datetime by running \u003Ccode>new Date().toISOString()\u003C/code> in the console. Make sure you remove quotes though.\u003C/p>\n\u003C/blockquote>\n\u003Cp>Only \u003Ccode>title\u003C/code>, \u003Ccode>description\u003C/code> and \u003Ccode>pubDatetime\u003C/code> fields in frontmatter must be specified.\u003C/p>\n\u003Cp>Title and description (excerpt) are important for search engine optimization (SEO) and thus AstroPaper encourages to include these in blog posts.\u003C/p>\n\u003Cp>\u003Ccode>slug\u003C/code> is the unique identifier of the url. Thus, \u003Ccode>slug\u003C/code> must be unique and different from other posts. The whitespace of \u003Ccode>slug\u003C/code> should to be separated with \u003Ccode>-\u003C/code> or \u003Ccode>_\u003C/code> but \u003Ccode>-\u003C/code> is recommended. Slug is automatically generated using the blog post file name. However, you can define your \u003Ccode>slug\u003C/code> as a frontmatter in your blog post.\u003C/p>\n\u003Cp>For example, if the blog file name is \u003Ccode>adding-new-post.md\u003C/code> and you don’t specify the slug in your frontmatter, Astro will automatically create a slug for the blog post using the file name. Thus, the slug will be \u003Ccode>adding-new-post\u003C/code>. But if you specify the \u003Ccode>slug\u003C/code> in the frontmatter, this will override the default slug. You can read more about this in \u003Ca href=\"https://docs.astro.build/en/guides/content-collections/#defining-custom-slugs\">Astro Docs\u003C/a>.\u003C/p>\n\u003Cp>If you omit \u003Ccode>tags\u003C/code> in a blog post (in other words, if no tag is specified), the default tag \u003Ccode>others\u003C/code> will be used as a tag for that post. You can set the default tag in the \u003Ccode>content.config.ts\u003C/code> file.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-highlighted mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> blogSchema\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">object\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  draft\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">boolean\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">optional\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line highlighted\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  tags\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">array\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">default\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">others\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">])\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // replace \"others\" with whatever you want\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/content.config.ts\u003C/span>\u003C/pre>\n\u003Ch3 id=\"sample-frontmatter\">Sample Frontmatter\u003C/h3>\n\u003Cp>Here is the sample frontmatter for a post.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"yaml\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">title\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\"> The title of the post\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">author\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\"> your name\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">pubDatetime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\"> 2022-09-21T05:17:19Z\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">slug\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\"> the-title-of-the-post\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">featured\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">draft\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">tags\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  - \u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">some\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  - \u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">example\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  - \u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">tags\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">ogImage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\"> ../../assets/images/example.png\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> # src/assets/images/example.png\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># ogImage: \"https://example.org/remote-image.png\" # remote URL\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">description\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\"> This is the example description of the example post.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">canonicalURL\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\"> https://example.org/my-article-was-already-posted-here\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">---\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">src/data/blog/sample-post.md\u003C/span>\u003C/pre>\n\u003Ch2 id=\"adding-table-of-contents\">Adding table of contents\u003C/h2>\n\u003Cp>By default, a post (article) does not include any table of contents (toc). To include toc, you have to specify it in a specific way.\u003C/p>\n\u003Cp>Write \u003Ccode>Table of contents\u003C/code> in h2 format (## in markdown) and place it where you want it to be appeared on the post.\u003C/p>\n\u003Cp>For instance, if you want to place your table of contents just under the intro paragraph (like I usually do), you can do that in the following way.\u003C/p>\n\u003C!-- prettier-ignore-start -->\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-diff\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"md\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># frontmatter\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">Here are some recommendations, tips &#x26; ticks for creating new posts in AstroPaper blog theme.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## Table of contents\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">&#x3C;!-- the rest of the post -->\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C!-- prettier-ignore-end -->\n\u003Ch2 id=\"headings\">Headings\u003C/h2>\n\u003Cp>There’s one thing to note about headings. The AstroPaper blog posts use title (title in the frontmatter) as the main heading of the post. Therefore, the rest of the heading in the post should be using h2 ~ h6.\u003C/p>\n\u003Cp>This rule is not mandatory, but highly recommended for visual, accessibility and SEO purposes.\u003C/p>\n\u003Ch2 id=\"syntax-highlighting\">Syntax Highlighting\u003C/h2>\n\u003Cp>AstroPaper uses \u003Ca href=\"https://shiki.style/\">Shiki\u003C/a> as the default syntax highlighting. Starting from AstroPaper v5.4, \u003Ca href=\"https://shiki.style/packages/transformers\">@shikijs/transformers\u003C/a> is used to enhance better fenced code blocks. If you don’t want to use it, you can simply remove it like this\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">pnpm\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> remove\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> @shikijs/transformers\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-diff mt-8\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff remove\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff remove\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  transformerNotationDiff\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff remove\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  transformerNotationHighlight\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff remove\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  transformerNotationWordHighlight\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff remove\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">} \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@shikijs/transformers\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> default\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> defineConfig\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  markdown\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    remarkPlugins\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">remarkToc\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">remarkCollapse\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { test\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Table of contents\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }]]\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    shikiConfig\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">      // For more themes, visit https://shiki.style/themes\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      themes\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { light\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">min-light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> dark\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">night-owl\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      defaultColor\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      wrap\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      transformers\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        transformerFileName\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff remove\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        transformerNotationHighlight\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff remove\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        transformerNotationWordHighlight\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff remove\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        transformerNotationDiff\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ matchAlgorithm\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">v3\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> })\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      ]\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003Cspan class=\"absolute py-1 text-foreground text-xs font-medium leading-4 pl-4 pr-2 before:inline-block before:size-1 before:bg-green-500 before:rounded-full before:absolute before:top-[45%] before:left-2 left-2 top-(--file-name-offset) border rounded-md bg-background\">astro.config.ts\u003C/span>\u003C/pre>\n\u003Ch2 id=\"storing-images-for-blog-content\">Storing Images for Blog Content\u003C/h2>\n\u003Cp>Here are two methods for storing images and displaying them inside a markdown file.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Note! If it’s a requirement to style optimized images in markdown you should \u003Ca href=\"https://docs.astro.build/en/guides/images/#images-in-mdx-files\">use MDX\u003C/a>.\u003C/p>\n\u003C/blockquote>\n\u003Ch3 id=\"inside-srcassets-directory-recommended\">Inside \u003Ccode>src/assets/\u003C/code> directory (recommended)\u003C/h3>\n\u003Cp>You can store images inside \u003Ccode>src/assets/\u003C/code> directory. These images will be automatically optimized by Astro through \u003Ca href=\"https://docs.astro.build/en/reference/image-service-reference/\">Image Service API\u003C/a>.\u003C/p>\n\u003Cp>You can use relative path or alias path (\u003Ccode>@/assets/\u003C/code>) to serve these images.\u003C/p>\n\u003Cp>Example: Suppose you want to display \u003Ccode>example.jpg\u003C/code> whose path is \u003Ccode>/src/assets/images/example.jpg\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"md\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">![\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">something\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#7FDBCA\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-light-text-decoration:inherit;--shiki-dark:#FF869A;--shiki-dark-text-decoration:underline\">@/assets/images/example.jpg\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#7FDBCA\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">&#x3C;!-- OR -->\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">![\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">something\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#7FDBCA\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-light-text-decoration:inherit;--shiki-dark:#FF869A;--shiki-dark-text-decoration:underline\">../../assets/images/example.jpg\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#7FDBCA\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">&#x3C;!-- Using img tag or Image component won't work ❌ -->\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;img src=\"@/assets/images/example.jpg\" alt=\"something\">\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">&#x3C;!-- ^^ This is wrong -->\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cblockquote>\n\u003Cp>Technically, you can store images inside any directory under \u003Ccode>src\u003C/code>. In here, \u003Ccode>src/assets\u003C/code> is just a recommendation.\u003C/p>\n\u003C/blockquote>\n\u003Ch3 id=\"inside-public-directory\">Inside \u003Ccode>public\u003C/code> directory\u003C/h3>\n\u003Cp>You can store images inside the \u003Ccode>public\u003C/code> directory. Keep in mind that images stored in the \u003Ccode>public\u003C/code> directory remain untouched by Astro, meaning they will be unoptimized and you need to handle image optimization by yourself.\u003C/p>\n\u003Cp>For these images, you should use an absolute path; and these images can be displayed using \u003Ca href=\"https://www.markdownguide.org/basic-syntax/#images-1\">markdown annotation\u003C/a> or \u003Ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img\">HTML img tag\u003C/a>.\u003C/p>\n\u003Cp>Example: Assume \u003Ccode>example.jpg\u003C/code> is located at \u003Ccode>/public/assets/images/example.jpg\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"md\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">![\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">something\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#7FDBCA\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-light-text-decoration:inherit;--shiki-dark:#FF869A;--shiki-dark-text-decoration:underline\">/assets/images/example.jpg\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#7FDBCA\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">&#x3C;!-- OR -->\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;img src=\"/assets/images/example.jpg\" alt=\"something\">\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"bonus\">Bonus\u003C/h2>\n\u003Ch3 id=\"image-compression\">Image compression\u003C/h3>\n\u003Cp>When you put images in the blog post (especially for images under \u003Ccode>public\u003C/code> directory), it is recommended that the image is compressed. This will affect the overall performance of the website.\u003C/p>\n\u003Cp>My recommendation for image compression sites.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"https://tinypng.com/\">TinyPng\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"https://tinyjpg.com/\">TinyJPG\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"og-image\">OG Image\u003C/h3>\n\u003Cp>The default OG image will be placed if a post does not specify the OG image. Though not required, OG image related to the post should be specify in the frontmatter. The recommended size for OG image is \u003Cstrong>\u003Cem>1200 X 640\u003C/em>\u003C/strong> px.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Since AstroPaper v1.4.0, OG images will be generated automatically if not specified. Check out \u003Ca href=\"https://astro-paper.pages.dev/posts/dynamic-og-image-generation-in-astropaper-blog-posts/\">the announcement\u003C/a>.\u003C/p>\n\u003C/blockquote>",{"headings":635,"localImagePaths":673,"remoteImagePaths":674,"frontmatter":675,"imagePaths":679},[636,637,640,643,646,649,652,655,658,661,664,667,670],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":638,"text":639},"creating-a-blog-post","Creating a Blog Post",{"depth":31,"slug":641,"text":642},"frontmatter","Frontmatter",{"depth":47,"slug":644,"text":645},"sample-frontmatter","Sample Frontmatter",{"depth":31,"slug":647,"text":648},"adding-table-of-contents","Adding table of contents",{"depth":31,"slug":650,"text":651},"headings","Headings",{"depth":31,"slug":653,"text":654},"syntax-highlighting","Syntax Highlighting",{"depth":31,"slug":656,"text":657},"storing-images-for-blog-content","Storing Images for Blog Content",{"depth":47,"slug":659,"text":660},"inside-srcassets-directory-recommended","Inside src/assets/ directory (recommended)",{"depth":47,"slug":662,"text":663},"inside-public-directory","Inside public directory",{"depth":31,"slug":665,"text":666},"bonus","Bonus",{"depth":47,"slug":668,"text":669},"image-compression","Image compression",{"depth":47,"slug":671,"text":672},"og-image","OG Image",[],[],{"author":14,"pubDatetime":676,"modDatetime":677,"title":626,"slug":621,"featured":179,"draft":18,"tags":678,"description":628},["Date","2022-09-23T15:22:00.000Z"],["Date","2025-06-13T16:52:45.934Z"],[20],[],"setting-dates-via-git-hooks",{"id":680,"data":682,"body":690,"filePath":691,"digest":692,"rendered":693},{"author":683,"pubDatetime":684,"modDatetime":685,"title":686,"featured":18,"draft":18,"tags":687,"description":688,"canonicalURL":689},"Simon Smale",["Date","2024-01-03T20:40:08.000Z"],["Date","2024-01-08T18:59:05.000Z"],"How to use Git Hooks to set Created and Modified Dates",[20,102],"How to use Git Hooks to set your Created and Modified Dates on AstroPaper","https://smale.codes/posts/setting-dates-via-git-hooks/","In this post I will explain how to use the pre-commit Git hook to automate the input of the created (`pubDatetime`) and modified (`modDatetime`) in the AstroPaper blog theme frontmatter\n\n## Table of contents\n\n## Have them Everywhere\n\n[Git hooks](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks) are great for automating tasks like [adding](https://gist.github.com/SSmale/3b380e5bbed3233159fb7031451726ea) or [checking](https://itnext.io/using-git-hooks-to-enforce-branch-naming-policy-ffd81fa01e5e) the branch name to your commit messages or [stopping you committing plain text secrets](https://gist.github.com/SSmale/367deee757a9b2e119d241e120249000). Their biggest flaw is that client-side hooks are per machine.\n\nYou can get around this by having a `hooks` directory and manually copy them to the `.git/hooks` directory or set up a symlink, but this all requires you to remember to set it up, and that is not something I am good at doing.\n\nAs this project uses npm, we are able to make use of a package called [Husky](https://typicode.github.io/husky/) (this is already installed in AstroPaper) to automatically install the hooks for us.\n\n> Update! In AstroPaper [v4.3.0](https://github.com/satnaing/astro-paper/releases/tag/v4.3.0), the pre-commit hook has been removed in favor of GitHub Actions. However, you can easily [install Husky](https://typicode.github.io/husky/get-started.html) yourself.\n\n## The Hook\n\nAs we want this hook to run as we commit the code to update the dates and then have that as part of our change we are going to use the `pre-commit` hook. This has already been set up by this AstroPaper project, but if it hadn't, you would run `npx husky add .husky/pre-commit 'echo \"This is our new pre-commit hook\"'`.\n\nNavigating to the `hooks/pre-commit` file, we are going to add one or both of the following snippets.\n\n### Updating the modified date when a file is edited\n\n---\n\nUPDATE:\n\nThis section has been updated with a new version of the hook that is smarter. It will now not increment the `modDatetime` until the post is published. On the first publish, set the draft status to `first` and watch the magic happen.\n\n---\n\n```shell\n# Modified files, update the modDatetime\ngit diff --cached --name-status |\ngrep -i '^M.*\\.md$' |\nwhile read _ file; do\n  filecontent=$(cat \"$file\")\n  frontmatter=$(echo \"$filecontent\" | awk -v RS='---' 'NR==2{print}')\n  draft=$(echo \"$frontmatter\" | awk '/^draft: /{print $2}')\n  if [ \"$draft\" = \"false\" ]; then\n    echo \"$file modDateTime updated\"\n    cat $file | sed \"/---.*/,/---.*/s/^modDatetime:.*$/modDatetime: $(date -u \"+%Y-%m-%dT%H:%M:%SZ\")/\" > tmp\n    mv tmp $file\n    git add $file\n  fi\n  if [ \"$draft\" = \"first\" ]; then\n    echo \"First release of $file, draft set to false and modDateTime removed\"\n    cat $file | sed \"/---.*/,/---.*/s/^modDatetime:.*$/modDatetime:/\" | sed \"/---.*/,/---.*/s/^draft:.*$/draft: false/\" > tmp\n    mv tmp $file\n    git add $file\n  fi\ndone\n```\n\n`git diff --cached --name-status` gets the files from git that have been staged for committing. The output looks like:\n\n```shell\nA       src/content/blog/setting-dates-via-git-hooks.md\n```\n\nThe letter at the start denotes what action has been taken, in the above example the file has been added. Modified files have `M`\n\nWe pipe that output into the grep command where we are looking at each line to find that have been modified. The line needs to start with `M` (`^(M)`), have any number of characters after that (`.*`) and end with the `.md` file extension (`.(md)$`).This is going to filter out the lines that are not modified markdown files `egrep -i \"^(M).*\\.(md)$\"`.\n\n---\n\n#### Improvement - More Explicit\n\nThis could be added to only look for files that we markdown files in the `blog` directory, as these are the only ones that will have the right frontmatter\n\n---\n\nThe regex will capture the two parts, the letter and the file path. We are going to pipe this list into a while loop to iterate over the matching lines and assign the letter to `a` and the path to `b`. We are going to ignore `a` for now.\n\nTo know the draft status of the file, we need its frontmatter. In the following code we are using `cat` to get the content of the file, then using `awk` to split the file on the frontmatter separator (`---`) and taking the second block (the fonmtmatter, the bit between the `---`). From here we are using `awk` again to find the draft key and print is value.\n\n```shell\n  filecontent=$(cat \"$file\")\n  frontmatter=$(echo \"$filecontent\" | awk -v RS='---' 'NR==2{print}')\n  draft=$(echo \"$frontmatter\" | awk '/^draft: /{print $2}')\n```\n\nNow we have the value for `draft` we are going to do 1 of 3 things, set the modDatetime to now (when draft is false `if [ \"$draft\" = \"false\" ]; then`), clear the modDatetime and set draft to false (when draft is set to first `if [ \"$draft\" = \"first\" ]; then`), or nothing (in any other case).\n\nThe next part with the sed command is a bit magical to me as I don't often use it, it was copied from [another blog post on doing something similar](https://mademistakes.com/notes/adding-last-modified-timestamps-with-git/). In essence, it is looking inside the frontmatter tags (`---`) of the file to find the `pubDatetime:` key, getting the full line and replacing it with the `pubDatetime: $(date -u \"+%Y-%m-%dT%H:%M:%SZ\")/\"` same key again and the current datetime formatted correctly.\n\nThis replacement is in the context of the whole file so we put that into a temporary file (`> tmp`), then we move (`mv`) the new file into the location of the old file, overwriting it. This is then added to git ready to be committed as if we made the change ourselves.\n\n---\n\n#### NOTE\n\nFor the `sed` to work the frontmatter needs to already have the `modDatetime` key in the frontmatter. There are some other changes you will need to make for the app to build with a blank date, see [further down](#empty-moddatetime-changes)\n\n---\n\n### Adding the Date for new files\n\nAdding the date for a new file is the same process as above, but this time we are looking for lines that have been added (`A`) and we are going to replace the `pubDatetime` value.\n\n```shell\n# New files, add/update the pubDatetime\ngit diff --cached --name-status | egrep -i \"^(A).*\\.(md)$\" | while read a b; do\n  cat $b | sed \"/---.*/,/---.*/s/^pubDatetime:.*$/pubDatetime: $(date -u \"+%Y-%m-%dT%H:%M:%SZ\")/\" > tmp\n  mv tmp $b\n  git add $b\ndone\n```\n\n---\n\n#### Improvement - Only Loop Once\n\nWe could use the `a` variable to switch inside the loop and either update the `modDatetime` or add the `pubDatetime` in one loop.\n\n---\n\n## Populating the frontmatter\n\nIf your IDE supports snippets then there is the option to create a custom snippet to populate the frontmatter.[In AstroPaper v4 will come with one for VSCode by default.](https://github.com/satnaing/astro-paper/pull/206)\n\n\u003Cvideo autoplay muted=\"muted\" controls plays-inline=\"true\" class=\"border border-skin-line\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/17761689/e13babbc-2d78-405d-8758-ca31915e41b0\" type=\"video/mp4\">\n\u003C/video>\n\n## Empty `modDatetime` changes\n\nTo allow Astro to compile the markdown and do its thing, it needs to know what is expected in the frontmatter. It does this via the config in `src/content/config.ts`\n\nTo allow the key to be there with no value we need to edit line 10 to add the `.nullable()` function.\n\n```ts\nconst blog = defineCollection({\n  type: \"content\",\n  schema: ({ image }) =>\n    z.object({\n      author: z.string().default(SITE.author),\n      pubDatetime: z.date(),\n      modDatetime: z.date().optional(), // [!code --]\n      modDatetime: z.date().optional().nullable(), // [!code ++]\n      title: z.string(),\n      featured: z.boolean().optional(),\n      draft: z.boolean().optional(),\n      tags: z.array(z.string()).default([\"others\"]),\n      ogImage: image().or(z.string()).optional(),\n      description: z.string(),\n      canonicalURL: z.string().optional(),\n      readingTime: z.string().optional(),\n    }),\n});\n```\n\nTo stop the IDE complaining in the blog engine files I have also done the following:\n\n1. added `| null` to line 15 in `src/layouts/Layout.astro` so that it looks like\n\n   ```typescript\n   export interface Props {\n     title?: string;\n     author?: string;\n     description?: string;\n     ogImage?: string;\n     canonicalURL?: string;\n     pubDatetime?: Date;\n     modDatetime?: Date | null;\n   }\n   ```\n\n2. added `| null` to line 5 in `src/components/Datetime.tsx` so that it looks like\n\n   ```typescript\n   interface DatetimesProps {\n     pubDatetime: string | Date;\n     modDatetime: string | Date | undefined | null;\n   }\n   ```","src/data/blog/setting-dates-via-git-hooks.md","7e1f6367f8bd3de8",{"html":694,"metadata":695},"\u003Cp>In this post I will explain how to use the pre-commit Git hook to automate the input of the created (\u003Ccode>pubDatetime\u003C/code>) and modified (\u003Ccode>modDatetime\u003C/code>) in the AstroPaper blog theme frontmatter\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#have-them-everywhere\">Have them Everywhere\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#the-hook\">The Hook\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#updating-the-modified-date-when-a-file-is-edited\">Updating the modified date when a file is edited\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#improvement---more-explicit\">Improvement - More Explicit\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#note\">NOTE\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#adding-the-date-for-new-files\">Adding the Date for new files\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#improvement---only-loop-once\">Improvement - Only Loop Once\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#populating-the-frontmatter\">Populating the frontmatter\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#empty-moddatetime-changes\">Empty \u003Ccode>modDatetime\u003C/code> changes\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"have-them-everywhere\">Have them Everywhere\u003C/h2>\n\u003Cp>\u003Ca href=\"https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks\">Git hooks\u003C/a> are great for automating tasks like \u003Ca href=\"https://gist.github.com/SSmale/3b380e5bbed3233159fb7031451726ea\">adding\u003C/a> or \u003Ca href=\"https://itnext.io/using-git-hooks-to-enforce-branch-naming-policy-ffd81fa01e5e\">checking\u003C/a> the branch name to your commit messages or \u003Ca href=\"https://gist.github.com/SSmale/367deee757a9b2e119d241e120249000\">stopping you committing plain text secrets\u003C/a>. Their biggest flaw is that client-side hooks are per machine.\u003C/p>\n\u003Cp>You can get around this by having a \u003Ccode>hooks\u003C/code> directory and manually copy them to the \u003Ccode>.git/hooks\u003C/code> directory or set up a symlink, but this all requires you to remember to set it up, and that is not something I am good at doing.\u003C/p>\n\u003Cp>As this project uses npm, we are able to make use of a package called \u003Ca href=\"https://typicode.github.io/husky/\">Husky\u003C/a> (this is already installed in AstroPaper) to automatically install the hooks for us.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Update! In AstroPaper \u003Ca href=\"https://github.com/satnaing/astro-paper/releases/tag/v4.3.0\">v4.3.0\u003C/a>, the pre-commit hook has been removed in favor of GitHub Actions. However, you can easily \u003Ca href=\"https://typicode.github.io/husky/get-started.html\">install Husky\u003C/a> yourself.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"the-hook\">The Hook\u003C/h2>\n\u003Cp>As we want this hook to run as we commit the code to update the dates and then have that as part of our change we are going to use the \u003Ccode>pre-commit\u003C/code> hook. This has already been set up by this AstroPaper project, but if it hadn’t, you would run \u003Ccode>npx husky add .husky/pre-commit 'echo \"This is our new pre-commit hook\"'\u003C/code>.\u003C/p>\n\u003Cp>Navigating to the \u003Ccode>hooks/pre-commit\u003C/code> file, we are going to add one or both of the following snippets.\u003C/p>\n\u003Ch3 id=\"updating-the-modified-date-when-a-file-is-edited\">Updating the modified date when a file is edited\u003C/h3>\n\u003Chr>\n\u003Cp>UPDATE:\u003C/p>\n\u003Cp>This section has been updated with a new version of the hook that is smarter. It will now not increment the \u003Ccode>modDatetime\u003C/code> until the post is published. On the first publish, set the draft status to \u003Ccode>first\u003C/code> and watch the magic happen.\u003C/p>\n\u003Chr>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"shell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># Modified files, update the modDatetime\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> diff\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --cached\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --name-status\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">grep\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -i\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">^M.*\\.md$\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">while\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> read\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> _\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> file\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">do\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  filecontent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">$(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">cat\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$file\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  frontmatter\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">$(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">echo\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$filecontent\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> awk\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -v\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> RS=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">---\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">NR==2{print}\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  draft\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">$(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">echo\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$frontmatter\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> awk\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/^draft: /{print $2}\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [ \u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$draft\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">false\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ]; \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">then\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">    echo\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$file\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\"> modDateTime updated\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    cat\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> $file\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sed\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/---.*/,/---.*/s/^modDatetime:.*$/modDatetime: $(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">date\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -u\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">+%Y-%m-%dT%H:%M:%SZ\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">)/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> >\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> tmp\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    mv\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> tmp\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> $file\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    git\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> add\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> $file\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  fi\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [ \u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$draft\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">first\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ]; \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">then\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">    echo\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">First release of \u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$file\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">, draft set to false and modDateTime removed\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    cat\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> $file\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sed\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/---.*/,/---.*/s/^modDatetime:.*$/modDatetime:/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sed\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/---.*/,/---.*/s/^draft:.*$/draft: false/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> >\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> tmp\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    mv\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> tmp\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> $file\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    git\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> add\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> $file\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  fi\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">done\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Ccode>git diff --cached --name-status\u003C/code> gets the files from git that have been staged for committing. The output looks like:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"shell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">A\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">       src/content/blog/setting-dates-via-git-hooks.md\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The letter at the start denotes what action has been taken, in the above example the file has been added. Modified files have \u003Ccode>M\u003C/code>\u003C/p>\n\u003Cp>We pipe that output into the grep command where we are looking at each line to find that have been modified. The line needs to start with \u003Ccode>M\u003C/code> (\u003Ccode>^(M)\u003C/code>), have any number of characters after that (\u003Ccode>.*\u003C/code>) and end with the \u003Ccode>.md\u003C/code> file extension (\u003Ccode>.(md)$\u003C/code>).This is going to filter out the lines that are not modified markdown files \u003Ccode>egrep -i \"^(M).*\\.(md)$\"\u003C/code>.\u003C/p>\n\u003Chr>\n\u003Ch4 id=\"improvement---more-explicit\">Improvement - More Explicit\u003C/h4>\n\u003Cp>This could be added to only look for files that we markdown files in the \u003Ccode>blog\u003C/code> directory, as these are the only ones that will have the right frontmatter\u003C/p>\n\u003Chr>\n\u003Cp>The regex will capture the two parts, the letter and the file path. We are going to pipe this list into a while loop to iterate over the matching lines and assign the letter to \u003Ccode>a\u003C/code> and the path to \u003Ccode>b\u003C/code>. We are going to ignore \u003Ccode>a\u003C/code> for now.\u003C/p>\n\u003Cp>To know the draft status of the file, we need its frontmatter. In the following code we are using \u003Ccode>cat\u003C/code> to get the content of the file, then using \u003Ccode>awk\u003C/code> to split the file on the frontmatter separator (\u003Ccode>---\u003C/code>) and taking the second block (the fonmtmatter, the bit between the \u003Ccode>---\u003C/code>). From here we are using \u003Ccode>awk\u003C/code> again to find the draft key and print is value.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"shell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  filecontent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">$(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">cat\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$file\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  frontmatter\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">$(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">echo\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$filecontent\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> awk\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -v\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> RS=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">---\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">NR==2{print}\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  draft\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">$(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">echo\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$frontmatter\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> awk\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/^draft: /{print $2}\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now we have the value for \u003Ccode>draft\u003C/code> we are going to do 1 of 3 things, set the modDatetime to now (when draft is false \u003Ccode>if [ \"$draft\" = \"false\" ]; then\u003C/code>), clear the modDatetime and set draft to false (when draft is set to first \u003Ccode>if [ \"$draft\" = \"first\" ]; then\u003C/code>), or nothing (in any other case).\u003C/p>\n\u003Cp>The next part with the sed command is a bit magical to me as I don’t often use it, it was copied from \u003Ca href=\"https://mademistakes.com/notes/adding-last-modified-timestamps-with-git/\">another blog post on doing something similar\u003C/a>. In essence, it is looking inside the frontmatter tags (\u003Ccode>---\u003C/code>) of the file to find the \u003Ccode>pubDatetime:\u003C/code> key, getting the full line and replacing it with the \u003Ccode>pubDatetime: $(date -u \"+%Y-%m-%dT%H:%M:%SZ\")/\"\u003C/code> same key again and the current datetime formatted correctly.\u003C/p>\n\u003Cp>This replacement is in the context of the whole file so we put that into a temporary file (\u003Ccode>> tmp\u003C/code>), then we move (\u003Ccode>mv\u003C/code>) the new file into the location of the old file, overwriting it. This is then added to git ready to be committed as if we made the change ourselves.\u003C/p>\n\u003Chr>\n\u003Ch4 id=\"note\">NOTE\u003C/h4>\n\u003Cp>For the \u003Ccode>sed\u003C/code> to work the frontmatter needs to already have the \u003Ccode>modDatetime\u003C/code> key in the frontmatter. There are some other changes you will need to make for the app to build with a blank date, see \u003Ca href=\"#empty-moddatetime-changes\">further down\u003C/a>\u003C/p>\n\u003Chr>\n\u003Ch3 id=\"adding-the-date-for-new-files\">Adding the Date for new files\u003C/h3>\n\u003Cp>Adding the date for a new file is the same process as above, but this time we are looking for lines that have been added (\u003Ccode>A\u003C/code>) and we are going to replace the \u003Ccode>pubDatetime\u003C/code> value.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"shell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># New files, add/update the pubDatetime\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> diff\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --cached\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --name-status\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> egrep\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -i\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">^(A).*\\.(md)$\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> while\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> read\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> a\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">do\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  cat\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> $b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sed\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/---.*/,/---.*/s/^pubDatetime:.*$/pubDatetime: $(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">date\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -u\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">+%Y-%m-%dT%H:%M:%SZ\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">)/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> >\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> tmp\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  mv\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> tmp\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> $b\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  git\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> add\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> $b\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">done\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Chr>\n\u003Ch4 id=\"improvement---only-loop-once\">Improvement - Only Loop Once\u003C/h4>\n\u003Cp>We could use the \u003Ccode>a\u003C/code> variable to switch inside the loop and either update the \u003Ccode>modDatetime\u003C/code> or add the \u003Ccode>pubDatetime\u003C/code> in one loop.\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"populating-the-frontmatter\">Populating the frontmatter\u003C/h2>\n\u003Cp>If your IDE supports snippets then there is the option to create a custom snippet to populate the frontmatter.\u003Ca href=\"https://github.com/satnaing/astro-paper/pull/206\">In AstroPaper v4 will come with one for VSCode by default.\u003C/a>\u003C/p>\n\u003Cvideo autoplay muted controls plays-inline=\"true\" class=\"border border-skin-line\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/17761689/e13babbc-2d78-405d-8758-ca31915e41b0\" type=\"video/mp4\">\n\u003C/video>\n\u003Ch2 id=\"empty-moddatetime-changes\">Empty \u003Ccode>modDatetime\u003C/code> changes\u003C/h2>\n\u003Cp>To allow Astro to compile the markdown and do its thing, it needs to know what is expected in the frontmatter. It does this via the config in \u003Ccode>src/content/config.ts\u003C/code>\u003C/p>\n\u003Cp>To allow the key to be there with no value we need to edit line 10 to add the \u003Ccode>.nullable()\u003C/code> function.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl has-diff\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> blog\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> defineCollection\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  type\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">content\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  schema\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\"> image\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">object\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      author\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">default\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">SITE\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">author\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      pubDatetime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">date\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff remove\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      modDatetime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">date\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">optional\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line diff add\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      modDatetime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">date\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">optional\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">nullable\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      title\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      featured\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">boolean\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">optional\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      draft\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">boolean\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">optional\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      tags\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">array\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">default\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">others\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">])\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      ogImage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> image\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">or\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">optional\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      description\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      canonicalURL\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">optional\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      readingTime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">optional\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">    }\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>To stop the IDE complaining in the blog engine files I have also done the following:\u003C/p>\n\u003Col>\n\u003Cli>\n\u003Cp>added \u003Ccode>| null\u003C/code> to line 15 in \u003Ccode>src/layouts/Layout.astro\u003C/code> so that it looks like\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> interface\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Props\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  title\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  author\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  description\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  ogImage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  canonicalURL\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  pubDatetime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Date\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  modDatetime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Date\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> null\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003Cli>\n\u003Cp>added \u003Ccode>| null\u003C/code> to line 5 in \u003Ccode>src/components/Datetime.tsx\u003C/code> so that it looks like\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">interface\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> DatetimesProps\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  pubDatetime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Date\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  modDatetime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Date\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> undefined\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> null\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003C/li>\n\u003C/ol>",{"headings":696,"localImagePaths":726,"remoteImagePaths":727,"frontmatter":728,"imagePaths":732},[697,698,701,704,707,711,714,717,720,723],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":699,"text":700},"have-them-everywhere","Have them Everywhere",{"depth":31,"slug":702,"text":703},"the-hook","The Hook",{"depth":47,"slug":705,"text":706},"updating-the-modified-date-when-a-file-is-edited","Updating the modified date when a file is edited",{"depth":708,"slug":709,"text":710},4,"improvement---more-explicit","Improvement - More Explicit",{"depth":708,"slug":712,"text":713},"note","NOTE",{"depth":47,"slug":715,"text":716},"adding-the-date-for-new-files","Adding the Date for new files",{"depth":708,"slug":718,"text":719},"improvement---only-loop-once","Improvement - Only Loop Once",{"depth":31,"slug":721,"text":722},"populating-the-frontmatter","Populating the frontmatter",{"depth":31,"slug":724,"text":725},"empty-moddatetime-changes","Empty modDatetime changes",[],[],{"author":683,"pubDatetime":729,"modDatetime":730,"title":686,"featured":18,"draft":18,"tags":731,"canonicalURL":689,"description":688},["Date","2024-01-03T20:40:08.000Z"],["Date","2024-01-08T18:59:05.000Z"],[20,102],[],"thread-safe-fixedvec",{"id":733,"data":735,"body":741,"filePath":742,"digest":743,"rendered":744},{"author":269,"pubDatetime":736,"title":737,"featured":179,"draft":179,"tags":738,"description":740},["Date","2025-09-16T00:00:00.000Z"],"Building a Thread-Safe, Bit-Packed Atomic Vector in Rust",[273,274,739],"HPC","Engineering a thread-safe, bit-packed integer vector in Rust, using a hybrid model of lock-free and lock-based concurrency to handle operations that span hardware word boundaries.","This is the second post of a series on how to build a memory-efficient vector in Rust. All this work is open source and is currently being used for research projects in succinct data structures.\n\n* All the code can be found on github: [compressed-intvec](https://github.com/lukefleed/compressed-intvec)\n* This is also published as a crate on crates.io: [compressed-intvec](https://crates.io/crates/compressed-intvec)\n\nIn the [first post]([link-to-part-1](https://lukefleed.xyz/posts/compressed-fixedvec/)), we built `FixedVec`, a bit-packed integer vector that gives us O(1) random access while using a fraction of the memory of a standard `Vec\u003CT>`. We worked through the core problem of reading bit-packed data, and saw how a single unaligned memory read could let us efficiently handle values that span across 64-bit word boundaries. We ended up with a solid, fast data structure complete with a clean, ergonomic API.\n\nSo, we have a great single-threaded vector. But what happens when we need to share it between threads? The natural next step is to build an `AtomicFixedVec` with an API that feels like Rust's standard atomics: `load`, `store`, `fetch_add`, and so on.\n\nAs soon as we try, we hit a wall. The atomic instructions our CPUs give us work on nicely aligned, word-sized chunks of memory. But our data doesn't live like that. A 10-bit integer in our vector is just a virtual concept, a sequence of bits that might start in the middle of one `u64` and end in another.\n\nThis leads to the fundamental problem: how can we possibly implement an atomic `fetch_add` on a value that's physically split across two different `AtomicU64`s? There's no single hardware instruction that can atomically modify two memory locations at once. A naive attempt would create torn writes and all sorts of nasty data races.\n\nIn this post, we're going to walk through the engineering behind `AtomicFixedVec` and solve this problem. The solution is a hybrid model that combines lock-free, high-performance CAS loops for the common case with a fine-grained locking mechanism to correctly and safely handle the values that span word boundaries.\n\n# Structure\n\nTo make `FixedVec` support concurrency, we have to make some changes in its internal design. The first step is to change the backing storage. A `Vec\u003CT>` is not thread-safe for concurrent writes. We can replace it with a `Vec\u003CAtomicU64>`. This ensures that every individual read and write to a 64-bit word is, at a minimum, atomic.\n\nHowever, as we've established, a logical element can span two of these atomic words. A simple `Vec\u003CAtomicU64>` does not solve the problem of atomically updating a value that crosses a word boundary. To handle this, we can add a second component to our struct: a striped lock pool. This is a vector of `parking_lot::Mutex` instances, where the number of locks is a power of two. Each lock protects a subset of the `AtomicU64` words in our storage. When an operation needs to modify two adjacent words, it will acquire the appropriate locks to ensure exclusive access.\n\nWe can then define the `AtomicFixedVec` struct as follows:\n\n```rust\npub struct AtomicFixedVec\u003CT>\nwhere\n    T: Storable\u003Cu64>,\n{\n    // The backing store is now composed of atomic words.\n    storage: Vec\u003CAtomicU64>,\n    // A pool of fine-grained locks to protect spanning-word operations.\n    locks: Vec\u003CMutex\u003C()>>,\n    bit_width: usize,\n    mask: u64,\n    len: usize,\n}\n```\n\n This lock pool is the mechanism we will use to enforce atomicity for operations that must modify two adjacent words simultaneously.\n\nWith this structure in place, we can now design a hybrid concurrency model. Every operation must first determine if the target element is fully contained within a single `AtomicU64` or if it spans two. Based on this, it will dispatch to one of two paths: a high-performance, lock-free path for in-word elements, or a lock-based path that uses our striped lock pool for spanning elements.\n\n## Lock-Free path for In-Word Elements\n\nThe high-throughput path in our hybrid model is for elements that are fully contained within a single `AtomicU64`. This condition, `bit_offset + bit_width \u003C= 64`, is always met if the `bit_width` is a power of two (e.g., 2, 4, 8, 16, 32), making `BitWidth::PowerOfTwo` an explicit performance choice for write-heavy concurrent workloads. When this condition holds, we can perform a true lock-free atomic update using a **Compare-and-Swap (CAS) loop**.\n\nA CAS operation is an atomic instruction provided by the hardware (e.g., `CMPXCHG` on x86-64) that attempts to write a new value to a memory location only if the current value at that location matches a given expected value. This provides the primitive for building more complex atomic operations without locks.\n\nLet's try to implement an atomic `store` on a sub-word element. We cannot simply write the new value, as that would non-atomically overwrite adjacent elements in the same word. The operation must be a read-modify-write on the entire `AtomicU64`, where the \"modify\" step only alters the bits corresponding to our target element.\n\nWe begin by calculating the `word_index` and `bit_offset`.\n\n```rust\nlet bit_pos = index * self.bit_width;\nlet word_index = bit_pos / u64::BITS as usize;\nlet bit_offset = bit_pos % u64::BITS as usize;\n```\n\nWe then prepare a `store_mask` to isolate the target bit range and a `store_value` with the new value already shifted into position.\n\n```rust\nlet store_mask = self.mask \u003C\u003C bit_offset;\nlet store_value = value \u003C\u003C bit_offset;\n```\n\nThe core of the operation is the loop. We first perform a relaxed load to get the current state of the entire 64-bit word. Inside the loop, we compute `new_word` by using the mask to clear the target bits in our local copy (`old_word`) and then OR in the new value.\n\n```rust\nlet atomic_word_ref = &self.storage[word_index];\nlet mut old_word = atomic_word_ref.load(Ordering::Relaxed);\nloop {\n    let new_word = (old_word & !store_mask) | store_value;\n    match atomic_word_ref.compare_exchange_weak(\n        old_word,\n        new_word,\n        order,\n        Ordering::Relaxed,\n    ) {\n        Ok(_) => break,\n        Err(x) => old_word = x,\n    }\n}\n```\n\nThe critical instruction is `compare_exchange_weak`. It attempts to atomically replace the value at `atomic_word_ref` with `new_word`, but only if its current value is still equal to `old_word`. If another thread has modified the word in the meantime, the operation fails, returns the now-current value, and our loop continues with the updated `old_word`. We use the `weak` variant because it can be more performant on some architectures and is perfectly suitable within a retry loop. Putting everything together, we obtain the following `atomic_store` implementation for the lock-free path:\n\n```rust\nfn atomic_store(&self, index: usize, value: u64, order: Ordering) {\n    let bit_pos = index * self.bit_width;\n    let word_index = bit_pos / u64::BITS as usize;\n    let bit_offset = bit_pos % u64::BITS as usize;\n\n    // Lock-free path for single-word values.\n    let atomic_word_ref = &self.storage[word_index];\n    let store_mask = self.mask \u003C\u003C bit_offset;\n    let store_value = value \u003C\u003C bit_offset;\n    let mut old_word = atomic_word_ref.load(Ordering::Relaxed);\n    loop {\n        let new_word = (old_word & !store_mask) | store_value;\n        match atomic_word_ref.compare_exchange_weak(\n            old_word,\n            new_word,\n            order,\n            Ordering::Relaxed,\n        ) {\n            Ok(_) => break,\n            Err(x) => old_word = x,\n        }\n    }\n```\n\nThis entire path is lock-free. Contention is managed at the hardware level by the CPU's cache coherency protocol, which ensures that only one core can successfully commit a CAS operation to a given cache line at a time.\n\nIn the same way, we can implement other atomic operations like `atomic_rmw` (for `fetch_add`, `fetch_sub`, etc.) and `atomic_load` using similar CAS loops or direct atomic loads.\n\n## Lock-Based Path for Spanning Elements\n\nNow let's move to the more complex case when an element spans two `AtomicU64` words. Here the lock-free CAS loop is no longer enough. An atomic update would require to modify two separate `AtomicU64` words, and no single hardware instruction can do this as one indivisible transaction. To ensure atomicity, we must use a lock.\n\nA single, global `Mutex` would serialize all concurrent writes, becoming an unacceptable performance bottleneck.  We can instead employ **lock striping**, a concurrency pattern that partitions the data structure to reduce the scope of contention. The core idea is to maintain an array of locks, and map different regions of our data to different locks. We can add to our `AtomicFixedVec` a `Vec\u003Cparking_lot::Mutex\u003C()>>`. To perform an operation on a spanning element that touches `word_index` and `word_index + 1`, a thread first acquires a specific lock from this pool. The mapping is done by hashing the word index to a lock index. Since the number of locks is a power of two, we can use a fast bitwise AND for this mapping instead of a slower modulo operation: `let lock_index = word_index & (self.locks.len() - 1)`.\n\nIn this way we are partitioning the vector into a set of independent regions. A locked write to words `(i, i+1)` will not block a simultaneous locked write to words `(j, j+1)` or a lock-free write to word `k`, provided they map to different locks in the stripe. We now need a heuristic to determine, at construction time, how many locks to create. Ideally we would like to balance contention reduction against memory overhead. This could be a valuable option:\n\n```rust\n// Heuristic to determine the number of locks for striping.\nlet num_cores = std::thread::available_parallelism().map_or(MIN_LOCKS, |n| n.get());\nlet target_locks = (num_words / WORDS_PER_LOCK).max(1);\nlet num_locks = (target_locks.max(num_cores) * 2)\n    .next_power_of_two()\n    .min(MAX_LOCKS);\n```\n\nThe logic aims to create enough locks to service the available hardware threads (`num_cores`) and to cover the data with a reasonable density (one lock per 64 words, `WORDS_PER_LOCK`). We take the maximum of these two, multiply by two as a simple overprovisioning factor, and round up to the next power of two to enable fast mapping via bitwise AND. The total number of locks is capped to prevent excessive memory consumption for the lock vector itself.\n\n> **In this the best way?** I don't know, probably not. For instance, a *seqlock* could theoretically offer higher performance for read-heavy workloads. A writer would increment a version counter, perform the non-atomic two-word write, and increment it again. Readers would check for a consistent version number to validate that their read was not interrupted. However, this pattern is fundamentally incompatible with Rust's safety guarantees. A reader in a seqlock might observe a \"torn read\" (a state where one word has been updated but the other has not). This constitutes a data race, which safe Rust's memory model is designed to prevent. A correct seqlock implementation requires a ton of `unsafe` code, volatile reads, and careful memory fencing. Given this constrains (and that I am not an expert in lock-free programming), we can stick to the simpler yet performant implementation bases on `Mutex`. At least, power of two `bit_width` values can avoid the spanning case entirely.\n\nWith the lock striping mechanism cleared, we can now complete the implementation for our `atomic_store` method. The first step is to acquire the correct lock.\n\n```rust\nlet lock_index = word_index & (self.locks.len() - 1);\nlet _guard = self.locks[lock_index].lock();\n```\n\nOnce the lock is acquired, we have exclusive access for this two-word transaction. However, it's critical that we continue to use atomic operations to modify the words themselves. This is because another thread might be concurrently executing a *lock-free* operation on an adjacent, non-spanning element that happens to reside in `word_index` or `word_index + 1`. Using non-atomic writes inside the lock would create a data race with those lock-free operations.\n\nWe therefore use `fetch_update`, another CAS-based atomic, to modify each of the two words. For the lower word, we clear the high bits starting from our `bit_offset` and OR in the low bits of our new value.\n\n```rust\nlet low_word_ref = &self.storage[word_index];\nlet high_word_ref = &self.storage[word_index + 1];\n\n// Modify the lower word.\nlow_word_ref\n    .fetch_update(order, Ordering::Relaxed, |mut w| {\n        w &= !(u64::MAX \u003C\u003C bit_offset);\n        w |= value \u003C\u003C bit_offset;\n        Some(w)\n    })\n    .unwrap(); // This unwrap is safe: with the lock held, there is no contention.\n```\n\nNext, we do the same for the higher word, calculating a `high_mask` to clear the low bits and writing the remaining high bits of our value.\n\n```rust\nlet bits_in_high = (bit_offset + self.bit_width) - u64::BITS as usize;\nlet high_mask = (1u64 \u003C\u003C bits_in_high).wrapping_sub(1);\nhigh_word_ref\n    .fetch_update(order, Ordering::Relaxed, |mut w| {\n        w &= !high_mask;\n        w |= value >> (u64::BITS as usize - bit_offset);\n        Some(w)\n    })\n    .unwrap(); // Also safe.\n```\n\nThe lock provides the mutual exclusion that makes the two-word update appear atomic as a whole. The continued use of atomics with the user-specified `Ordering` ensures that the final result is correctly propagated through the memory system and becomes visible to other threads according to the Rust memory model.\n\nPutting it all together, the final, complete `atomic_store` method handles both the lock-free and locked paths.\n\n```rust\nfn atomic_store(&self, index: usize, value: u64, order: Ordering) {\n    let bit_pos = index * self.bit_width;\n    let word_index = bit_pos / u64::BITS as usize;\n    let bit_offset = bit_pos % u64::BITS as usize;\n\n    if bit_offset + self.bit_width \u003C= u64::BITS as usize {\n        // Lock-free path for single-word values.\n        let atomic_word_ref = &self.storage[word_index];\n        let store_mask = self.mask \u003C\u003C bit_offset;\n        let store_value = value \u003C\u003C bit_offset;\n        let mut old_word = atomic_word_ref.load(Ordering::Relaxed);\n        loop {\n            let new_word = (old_word & !store_mask) | store_value;\n            match atomic_word_ref.compare_exchange_weak(\n                old_word,\n                new_word,\n                order,\n                Ordering::Relaxed,\n            ) {\n                Ok(_) => break,\n                Err(x) => old_word = x,\n            }\n        }\n    } else {\n        // Locked path for values spanning two words.\n        let lock_index = word_index & (self.locks.len() - 1);\n        let _guard = self.locks[lock_index].lock();\n        // The lock guarantees exclusive access to this multi-word operation.\n        // We still use atomic operations inside to prevent races with the\n        // lock-free path, which might be concurrently accessing one of\n        // these words.\n        let low_word_ref = &self.storage[word_index];\n        let high_word_ref = &self.storage[word_index + 1];\n\n        // Modify the lower word.\n        low_word_ref\n            .fetch_update(order, Ordering::Relaxed, |mut w| {\n                w &= !(u64::MAX \u003C\u003C bit_offset);\n                w |= value \u003C\u003C bit_offset;\n                Some(w)\n            })\n            .unwrap(); // Should not fail under lock.\n\n        // Modify the higher word.\n        let bits_in_high = (bit_offset + self.bit_width) - u64::BITS as usize;\n        let high_mask = (1u64 \u003C\u003C bits_in_high).wrapping_sub(1);\n        high_word_ref\n            .fetch_update(order, Ordering::Relaxed, |mut w| {\n                w &= !high_mask;\n                w |= value >> (u64::BITS as usize - bit_offset);\n                Some(w)\n            })\n            .unwrap(); // Should not fail under lock.\n    }\n}\n```\n\nThe branching logic `if bit_offset + self.bit_width \u003C= 64` is a simple, constant-time check that determines which path to take. The condition is highly predictable for the CPU's branch predictor, as the `bit_offset` follows a simple arithmetic progression based on the index. This minimizes pipeline stalls. More importantly, this structure enables significant compiler optimization. When we use `AtomicFixedVec` with a `bit_width` that is a power of two, the branch condition can often be resolved at compile time. With Link-Time Optimization (LTO), the compiler can prove that the `else` branch for the locked path is unreachable. This allows for dead code elimination, producing a specialized function containing *only* the lock-free CAS loop.\n\n# Benchmarking the `store` operation\n\nWe now want to measure the performance of our `atomic_store` implementation under concurred load. We want to know how the throughput of the `store` operation scales as we increase thread count and contention. We can create two benchmark scenarios, one with a bit-width that is a power of two, and one with a non-power-of-two bit-width. Both simulate \"diffuse contention\": a pool of threads performs a high volume of atomic `store` operations to random indices within a shared vector of 10k 64-bit elements. Each thread is assigned 100k operations. This randomness ensures that while direct contention on the same element is rare, there will be frequent collisions on the same `AtomicU64` words, especially as thread count increases.\n\nIn the benchmark, each thread with `thread_id` simply writes its own ID to the vector for each operation:\n\n```rust\nvec[index].store(thread_id, Ordering::SeqCst);\n```\n\nWe compare our `AtomicFixedVec` against two other implementations:\n1.  A `Vec\u003CAtomicU16>`: This serves as our \"ideal\" baseline.\n2.  [`sux::AtomicBitFieldVec`]: A similar implementation of another library. This comparison however is not perfectly equivalent for bit-widths that are not powers of two. As per their documentation, `sux` does not guarantee atomicity for values that span word boundaries, which can lead to \"torn writes.\" Our `AtomicFixedVec` is designed to prevent this class of data race through its lock striping mechanism. The performance cost of this correctness guarantee is precisely what we aim to measure.\n\nThe first benchmark measure the performance of our **lock-free path**. We configure all vectors with a `bit_width` of 16. Because 16 is a power of two and evenly divides the 64-bit word size, every element is guaranteed to be fully contained within a single `u64` word. This is the best-case scenario for bit-packed atomics. It ensures that all `store` operations can be performed with lock-free CAS loops.\n\n\u003Ciframe src=\"/bench-intvec/atomic_scaling_lock_free_diffuse.html\" width=\"100%\" height=\"550px\" style=\"border: none;\">\u003C/iframe>\n\nAs we can see, all three implementations scale well with increasing thread count. The throughput of `AtomicFixedVec` is very close to that of `sux::AtomicBitFieldVec`, which is expected since both are using similar lock-free CAS loops for this scenario. Both bit-packed vectors have a noticeable dip at two threads, likely due to initial cache coherency overhead, but then scale up effectively with the core count.\n\nThe second benchmark tries to stress the **locked path**. We configure the vectors with a `bit_width` of 15. This non-power-of-two width guarantees that a predictable fraction of writes will cross word boundaries. In our case, `(15 + 63) % 64` spanning cases out of 64 offsets, so roughly `14/64` or ~22% will require locking. This forces our `AtomicFixedVec` to use its lock striping mechanism for those spanning writes. In contrast, `sux` will proceed without locking, risking data races but avoiding locking overhead.\n\n\u003Ciframe src=\"/bench-intvec/atomic_scaling_locked_path_diffuse.html\" width=\"100%\" height=\"550px\" style=\"border: none;\">\u003C/iframe>\n\nThis benchmark shows the real cost of correctness. Our `AtomicFixedVec` now shows lower throughput and poorer scaling compared to both the baseline and `sux`. Every write operation that crosses a word boundary (approximately 22% of them in this test) must acquire a lock, execute its two atomic updates, and release the lock. While with lock striping we prevent a single point of serialization, the overhead of the locking protocol itself, especially under contention from multiple threads, is non-trivial. In contrast, `sux` maintains higher throughput by avoiding locks entirely, but at the cost of potentially observing torn writes.\n\n[`sux::AtomicBitFieldVec`]: https://docs.rs/sux/latest/sux/bits/bit_field_vec/struct.AtomicBitFieldVec.html\n\n# Read-Modify-Write Operations\n\nWith the hybrid atomicity model defined, the next step is to build a robust API. Instead of re-implementing the complex hybrid logic for every atomic operation, we can implement it once in a single, powerful primitive: `compare_exchange`. All other Read-Modify-Write (RMW) operations can then be built on top of this primitive.\n\n`compare_exchange` attempts to store a `new` value into a location if and only if the value currently at that location matches an expected `current` value. This operation is the fundamental building block for lock-free algorithms.\n\n## The Lock-Free Path: A CAS Loop on a Sub-Word\n\nFor elements that are fully contained within a single `AtomicU64`, we can implement `compare_exchange` with a CAS loop. However, the logic is more complex than a simple store. We aren't comparing the entire 64-bit word; we are comparing a specific `bit_width` slice within it.\n\nThe process is as follows. First, we load the entire 64-bit word. Then, we extract the specific bits that correspond to our logical element and compare them against the user-provided `current` value.\n\n```rust\n// Inside the lock-free path of atomic_compare_exchange\nlet mut old_word = atomic_word_ref.load(failure);\nloop {\n    let old_val_extracted = (old_word >> bit_offset) & self.mask;\n    if old_val_extracted != current {\n        return Err(old_val_extracted);\n    }\n    // ...\n```\n\nIf this check fails, it means another thread has modified the element since our initial load. We can immediately return an `Err` with the value we just read, satisfying the contract of `compare_exchange`.\n\nIf the check succeeds, we proceed to the atomic write phase. We prepare a `new_word` by masking and ORing in the `new` value, just as we did for `atomic_store`. Then we attempt the hardware-level `compare_exchange_weak`.\n\n```rust\n// ... continuing the loop ...\nlet new_word = (old_word & !store_mask) | new_value_shifted;\nmatch atomic_word_ref.compare_exchange_weak(old_word, new_word, success, failure) {\n    Ok(_) => return Ok(current),\n    Err(x) => old_word = x,\n}\n```\n\nIf the `compare_exchange_weak` succeeds, it means no other thread modified the 64-bit word between our initial `load` and this instruction. Our update is successful. If it fails, another thread (possibly operating on an *adjacent* element in the same word) has modified the word. We update our local `old_word` with the new value from memory and retry the entire loop.\n\n## The Locked Path\n\nFor elements that span two words, we need to use the lock striping mechanism to ensure the operation is transactional. First, we must acquire the appropriate lock, giving us exclusive access to the two-word region.\n\nOnce the lock is held, the logic is straightforward:\n\n1.  **Read:** We perform an atomic read of the spanning value. This is itself a locked operation to ensure we get a consistent view.\n2.  **Compare:** We compare this value against the user-provided `current`. If they don't match, we release the lock and immediately return `Err`.\n3.  **Write:** If they do match, we call our existing `atomic_store` method to write the `new` value. `atomic_store` will re-acquire the same lock to perform its two-word write.\n4.  **Return:** We release the lock and return `Ok`.\n\nBecause the entire read-compare-write sequence is protected by the same mutex, we guarantee that no other thread can interfere. Combining these two paths gives us the complete `atomic_compare_exchange` method, which can then be used to implement all other atomic operations in terms of it.\n\n```rust\nfn atomic_compare_exchange(\n    &self,\n    index: usize,\n    current: u64,\n    new: u64,\n    success: Ordering,\n    failure: Ordering,\n) -> Result\u003Cu64, u64> {\n    let bit_pos = index * self.bit_width;\n    let word_index = bit_pos / u64::BITS as usize;\n    let bit_offset = bit_pos % u64::BITS as usize;\n\n    if bit_offset + self.bit_width \u003C= u64::BITS as usize {\n        // Lock-free path\n        let atomic_word_ref = &self.storage[word_index];\n        let store_mask = self.mask \u003C\u003C bit_offset;\n        let new_value_shifted = new \u003C\u003C bit_offset;\n        let mut old_word = atomic_word_ref.load(failure);\n        loop {\n            let old_val_extracted = (old_word >> bit_offset) & self.mask;\n            if old_val_extracted != current {\n                return Err(old_val_extracted);\n            }\n            let new_word = (old_word & !store_mask) | new_value_shifted;\n            match atomic_word_ref.compare_exchange_weak(old_word, new_word, success, failure) {\n                Ok(_) => return Ok(current),\n                Err(x) => old_word = x,\n            }\n        }\n    } else {\n        // Locked path\n        let lock_index = word_index & (self.locks.len() - 1);\n        let _guard = self.locks[lock_index].lock();\n        let old_val = self.atomic_load(index, failure);\n        if old_val != current {\n            return Err(old_val);\n        }\n        self.atomic_store(index, new, success);\n        Ok(current)\n    }\n}\n```\nWith `atomic_compare_exchange` providing the core atomicity primitive, we can now construct the high-level Read-Modify-Write (RMW) API. All RMW operations, such as `fetch_add` or `fetch_max`, share an identical algorithmic structure: a loop that repeatedly reads a value, computes a new value, and attempts to commit it with `compare_exchange`. Re-implementing this loop for every operation would be redundant.\n\nInstead, we can abstract this pattern into a single generic method, `atomic_rmw`, that is parameterized not just over values, but over the *operation itself*. This is where Rust generics and closures come into play. The signature of `atomic_rmw` can be defined as follows:\n\n```rust\nfn atomic_rmw\u003CF>(&self, index: usize, val: T, order: Ordering, op: F) -> T\nwhere\n    F: Fn(T, T) -> T\n{\n    // ... implementation ...\n}\n```\n*Note: The actual implementation uses `impl Fn(...)` for a more ergonomic syntax, but the principle is the same.*\n\nThe `op` parameter is a generic type `F` constrained by the `Fn(T, T) -> T` trait. This means `op` can be any closure (or function pointer) that takes two values of our logical type `T` and returns a new `T`. This allows us to inject any binary operation—addition, bitwise AND, max, etc. directly into the RMW logic.\n\nTo implement `atomic_rmw`, we begin with a relaxed load to get an initial `current` value. Inside the loop, it invokes the `op` closure with the `current` value and the user-provided `val` to compute the `new` value.\n\n```rust\nlet mut current = self.load(index, Ordering::Relaxed);\nloop {\n    let new = op(current, val);\n    // ...\n```\n\nThe core of the loop is the call to `atomic_compare_exchange`. This attempts to commit the transaction.\n\n```rust\nmatch self.compare_exchange(index, current, new, order, Ordering::Relaxed) {\n    Ok(old) => return old,\n    Err(actual) => current = actual,\n}\n```\n\nIf the operation succeeds, we return the old value, satisfying the RMW contract. If it fails due to contention, `compare_exchange` returns the `actual` value now in memory. We update our local `current` and the loop repeats, re-applying the `op` closure on the newer value. The complete `atomic_rmw` method looks like this:\n\n```rust\nfn atomic_rmw(&self, index: usize, val: T, order: Ordering, op: impl Fn(T, T) -> T) -> T {\n    let mut current = self.load(index, Ordering::Relaxed);\n    loop {\n        let new = op(current, val);\n        match self.compare_exchange(index, current, new, order, Ordering::Relaxed) {\n            Ok(old) => return old,\n            Err(actual) => current = actual,\n        }\n    }\n}\n```\n\nBy parameterizing over the operation, we have completely decoupled the complex, low-level concurrency logic from the simple arithmetic or bitwise logic of each specific RMW operation. This allows the compiler to monomorphize and inline the `op` closure for each call site, resulting in specialized and efficient machine code for each RMW variant, giving us a zero-cost abstraction.\n\nNow implementing specific RMW methods becomes a straightforward exercise in composition. Each specific operation is now a simple non-looping wrapper that calls `atomic_rmw` and provides a closure defining the desired computation. For example, `fetch_add` is implemented by passing a closure that performs a wrapping addition.\n\n```rust\npub fn fetch_add(&self, index: usize, val: T, order: Ordering) -> T {\n    self.atomic_rmw(index, val, order, |a, b| a.wrapping_add(&b))\n}\n```\n\nThe same pattern applies to all other RMW operations. A bitwise `fetch_and` provides a closure with the `&` operator, and `fetch_max` provides one that calls the `max` method.\n\n```rust\npub fn fetch_sub(&self, index: usize, val: T, order: Ordering) -> T {\n    self.atomic_rmw(index, val, order, |a, b| a.wrapping_sub(&b))\n}\n\npub fn fetch_and(&self, index: usize, val: T, order: Ordering) -> T {\n    self.atomic_rmw(index, val, order, |a, b| a & b)\n}\n\npub fn fetch_or(&self, index: usize, val: T, order: Ordering) -> T {\n    self.atomic_rmw(index, val, order, |a, b| a | b)\n}\n\npub fn fetch_xor(&self, index: usize, val: T, order: Ordering) -> T {\n    self.atomic_rmw(index, val, order, |a, b| a ^ b)\n}\n\npub fn fetch_max(&self, index: usize, val: T, order: Ordering) -> T {\n    self.atomic_rmw(index, val, order, |a, b| a.max(b))\n}\n\npub fn fetch_min(&self, index: usize, val: T, order: Ordering) -> T {\n    self.atomic_rmw(index, val, order, |a, b| a.min(b))\n}\n```","src/data/blog/thread-safe-fixedvec.md","44af669920173742",{"html":745,"metadata":746},"\u003Cp>This is the second post of a series on how to build a memory-efficient vector in Rust. All this work is open source and is currently being used for research projects in succinct data structures.\u003C/p>\n\u003Cul>\n\u003Cli>All the code can be found on github: \u003Ca href=\"https://github.com/lukefleed/compressed-intvec\">compressed-intvec\u003C/a>\u003C/li>\n\u003Cli>This is also published as a crate on crates.io: \u003Ca href=\"https://crates.io/crates/compressed-intvec\">compressed-intvec\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>In the \u003Ca href=\"%5Blink-to-part-1%5D(https://lukefleed.xyz/posts/compressed-fixedvec/)\">first post\u003C/a>, we built \u003Ccode>FixedVec\u003C/code>, a bit-packed integer vector that gives us O(1) random access while using a fraction of the memory of a standard \u003Ccode>Vec&#x3C;T>\u003C/code>. We worked through the core problem of reading bit-packed data, and saw how a single unaligned memory read could let us efficiently handle values that span across 64-bit word boundaries. We ended up with a solid, fast data structure complete with a clean, ergonomic API.\u003C/p>\n\u003Cp>So, we have a great single-threaded vector. But what happens when we need to share it between threads? The natural next step is to build an \u003Ccode>AtomicFixedVec\u003C/code> with an API that feels like Rust’s standard atomics: \u003Ccode>load\u003C/code>, \u003Ccode>store\u003C/code>, \u003Ccode>fetch_add\u003C/code>, and so on.\u003C/p>\n\u003Cp>As soon as we try, we hit a wall. The atomic instructions our CPUs give us work on nicely aligned, word-sized chunks of memory. But our data doesn’t live like that. A 10-bit integer in our vector is just a virtual concept, a sequence of bits that might start in the middle of one \u003Ccode>u64\u003C/code> and end in another.\u003C/p>\n\u003Cp>This leads to the fundamental problem: how can we possibly implement an atomic \u003Ccode>fetch_add\u003C/code> on a value that’s physically split across two different \u003Ccode>AtomicU64\u003C/code>s? There’s no single hardware instruction that can atomically modify two memory locations at once. A naive attempt would create torn writes and all sorts of nasty data races.\u003C/p>\n\u003Cp>In this post, we’re going to walk through the engineering behind \u003Ccode>AtomicFixedVec\u003C/code> and solve this problem. The solution is a hybrid model that combines lock-free, high-performance CAS loops for the common case with a fine-grained locking mechanism to correctly and safely handle the values that span word boundaries.\u003C/p>\n\u003Ch1 id=\"structure\">Structure\u003C/h1>\n\u003Cp>To make \u003Ccode>FixedVec\u003C/code> support concurrency, we have to make some changes in its internal design. The first step is to change the backing storage. A \u003Ccode>Vec&#x3C;T>\u003C/code> is not thread-safe for concurrent writes. We can replace it with a \u003Ccode>Vec&#x3C;AtomicU64>\u003C/code>. This ensures that every individual read and write to a 64-bit word is, at a minimum, atomic.\u003C/p>\n\u003Cp>However, as we’ve established, a logical element can span two of these atomic words. A simple \u003Ccode>Vec&#x3C;AtomicU64>\u003C/code> does not solve the problem of atomically updating a value that crosses a word boundary. To handle this, we can add a second component to our struct: a striped lock pool. This is a vector of \u003Ccode>parking_lot::Mutex\u003C/code> instances, where the number of locks is a power of two. Each lock protects a subset of the \u003Ccode>AtomicU64\u003C/code> words in our storage. When an operation needs to modify two adjacent words, it will acquire the appropriate locks to ensure exclusive access.\u003C/p>\n\u003Cp>We can then define the \u003Ccode>AtomicFixedVec\u003C/code> struct as follows:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> struct\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> AtomicFixedVec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">where\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Storable\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // The backing store is now composed of atomic words.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    storage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Vec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">AtomicU64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // A pool of fine-grained locks to protect spanning-word operations.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    locks\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Vec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Mutex\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;()>>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    bit_width\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    len\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This lock pool is the mechanism we will use to enforce atomicity for operations that must modify two adjacent words simultaneously.\u003C/p>\n\u003Cp>With this structure in place, we can now design a hybrid concurrency model. Every operation must first determine if the target element is fully contained within a single \u003Ccode>AtomicU64\u003C/code> or if it spans two. Based on this, it will dispatch to one of two paths: a high-performance, lock-free path for in-word elements, or a lock-based path that uses our striped lock pool for spanning elements.\u003C/p>\n\u003Ch2 id=\"lock-free-path-for-in-word-elements\">Lock-Free path for In-Word Elements\u003C/h2>\n\u003Cp>The high-throughput path in our hybrid model is for elements that are fully contained within a single \u003Ccode>AtomicU64\u003C/code>. This condition, \u003Ccode>bit_offset + bit_width &#x3C;= 64\u003C/code>, is always met if the \u003Ccode>bit_width\u003C/code> is a power of two (e.g., 2, 4, 8, 16, 32), making \u003Ccode>BitWidth::PowerOfTwo\u003C/code> an explicit performance choice for write-heavy concurrent workloads. When this condition holds, we can perform a true lock-free atomic update using a \u003Cstrong>Compare-and-Swap (CAS) loop\u003C/strong>.\u003C/p>\n\u003Cp>A CAS operation is an atomic instruction provided by the hardware (e.g., \u003Ccode>CMPXCHG\u003C/code> on x86-64) that attempts to write a new value to a memory location only if the current value at that location matches a given expected value. This provides the primitive for building more complex atomic operations without locks.\u003C/p>\n\u003Cp>Let’s try to implement an atomic \u003Ccode>store\u003C/code> on a sub-word element. We cannot simply write the new value, as that would non-atomically overwrite adjacent elements in the same word. The operation must be a read-modify-write on the entire \u003Ccode>AtomicU64\u003C/code>, where the “modify” step only alters the bits corresponding to our target element.\u003C/p>\n\u003Cp>We begin by calculating the \u003Ccode>word_index\u003C/code> and \u003Ccode>bit_offset\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> /\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> %\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>We then prepare a \u003Ccode>store_mask\u003C/code> to isolate the target bit range and a \u003Ccode>store_value\u003C/code> with the new value already shifted into position.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> store_mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> store_value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The core of the operation is the loop. We first perform a relaxed load to get the current state of the entire 64-bit word. Inside the loop, we compute \u003Ccode>new_word\u003C/code> by using the mask to clear the target bits in our local copy (\u003Ccode>old_word\u003C/code>) and then OR in the new value.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">storage[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">load\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">loop\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">store_mask\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> store_value\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    match\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">compare_exchange_weak\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        old_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        new_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">        Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> break\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">        Err\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The critical instruction is \u003Ccode>compare_exchange_weak\u003C/code>. It attempts to atomically replace the value at \u003Ccode>atomic_word_ref\u003C/code> with \u003Ccode>new_word\u003C/code>, but only if its current value is still equal to \u003Ccode>old_word\u003C/code>. If another thread has modified the word in the meantime, the operation fails, returns the now-current value, and our loop continues with the updated \u003Ccode>old_word\u003C/code>. We use the \u003Ccode>weak\u003C/code> variant because it can be more performant on some architectures and is perfectly suitable within a retry loop. Putting everything together, we obtain the following \u003Ccode>atomic_store\u003C/code> implementation for the lock-free path:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> atomic_store\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> /\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> %\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // Lock-free path for single-word values.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">storage[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> store_mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> store_value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">load\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    loop\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">store_mask\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> store_value\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        match\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">compare_exchange_weak\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">            old_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">            new_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">            order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        ) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">            Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> break\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">            Err\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This entire path is lock-free. Contention is managed at the hardware level by the CPU’s cache coherency protocol, which ensures that only one core can successfully commit a CAS operation to a given cache line at a time.\u003C/p>\n\u003Cp>In the same way, we can implement other atomic operations like \u003Ccode>atomic_rmw\u003C/code> (for \u003Ccode>fetch_add\u003C/code>, \u003Ccode>fetch_sub\u003C/code>, etc.) and \u003Ccode>atomic_load\u003C/code> using similar CAS loops or direct atomic loads.\u003C/p>\n\u003Ch2 id=\"lock-based-path-for-spanning-elements\">Lock-Based Path for Spanning Elements\u003C/h2>\n\u003Cp>Now let’s move to the more complex case when an element spans two \u003Ccode>AtomicU64\u003C/code> words. Here the lock-free CAS loop is no longer enough. An atomic update would require to modify two separate \u003Ccode>AtomicU64\u003C/code> words, and no single hardware instruction can do this as one indivisible transaction. To ensure atomicity, we must use a lock.\u003C/p>\n\u003Cp>A single, global \u003Ccode>Mutex\u003C/code> would serialize all concurrent writes, becoming an unacceptable performance bottleneck.  We can instead employ \u003Cstrong>lock striping\u003C/strong>, a concurrency pattern that partitions the data structure to reduce the scope of contention. The core idea is to maintain an array of locks, and map different regions of our data to different locks. We can add to our \u003Ccode>AtomicFixedVec\u003C/code> a \u003Ccode>Vec&#x3C;parking_lot::Mutex&#x3C;()>>\u003C/code>. To perform an operation on a spanning element that touches \u003Ccode>word_index\u003C/code> and \u003Ccode>word_index + 1\u003C/code>, a thread first acquires a specific lock from this pool. The mapping is done by hashing the word index to a lock index. Since the number of locks is a power of two, we can use a fast bitwise AND for this mapping instead of a slower modulo operation: \u003Ccode>let lock_index = word_index &#x26; (self.locks.len() - 1)\u003C/code>.\u003C/p>\n\u003Cp>In this way we are partitioning the vector into a set of independent regions. A locked write to words \u003Ccode>(i, i+1)\u003C/code> will not block a simultaneous locked write to words \u003Ccode>(j, j+1)\u003C/code> or a lock-free write to word \u003Ccode>k\u003C/code>, provided they map to different locks in the stripe. We now need a heuristic to determine, at construction time, how many locks to create. Ideally we would like to balance contention reduction against memory overhead. This could be a valuable option:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Heuristic to determine the number of locks for striping.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> num_cores\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> std\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">thread\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">available_parallelism\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">map_or\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">MIN_LOCKS\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">n\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> n\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> target_locks\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">num_words\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> /\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\"> WORDS_PER_LOCK\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">max\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> num_locks\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">target_locks\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">max\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">num_cores\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">next_power_of_two\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">min\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">MAX_LOCKS\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The logic aims to create enough locks to service the available hardware threads (\u003Ccode>num_cores\u003C/code>) and to cover the data with a reasonable density (one lock per 64 words, \u003Ccode>WORDS_PER_LOCK\u003C/code>). We take the maximum of these two, multiply by two as a simple overprovisioning factor, and round up to the next power of two to enable fast mapping via bitwise AND. The total number of locks is capped to prevent excessive memory consumption for the lock vector itself.\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>In this the best way?\u003C/strong> I don’t know, probably not. For instance, a \u003Cem>seqlock\u003C/em> could theoretically offer higher performance for read-heavy workloads. A writer would increment a version counter, perform the non-atomic two-word write, and increment it again. Readers would check for a consistent version number to validate that their read was not interrupted. However, this pattern is fundamentally incompatible with Rust’s safety guarantees. A reader in a seqlock might observe a “torn read” (a state where one word has been updated but the other has not). This constitutes a data race, which safe Rust’s memory model is designed to prevent. A correct seqlock implementation requires a ton of \u003Ccode>unsafe\u003C/code> code, volatile reads, and careful memory fencing. Given this constrains (and that I am not an expert in lock-free programming), we can stick to the simpler yet performant implementation bases on \u003Ccode>Mutex\u003C/code>. At least, power of two \u003Ccode>bit_width\u003C/code> values can avoid the spanning case entirely.\u003C/p>\n\u003C/blockquote>\n\u003Cp>With the lock striping mechanism cleared, we can now complete the implementation for our \u003Ccode>atomic_store\u003C/code> method. The first step is to acquire the correct lock.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> lock_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">locks\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">len\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> _guard\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">locks[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">lock_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">lock\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Once the lock is acquired, we have exclusive access for this two-word transaction. However, it’s critical that we continue to use atomic operations to modify the words themselves. This is because another thread might be concurrently executing a \u003Cem>lock-free\u003C/em> operation on an adjacent, non-spanning element that happens to reside in \u003Ccode>word_index\u003C/code> or \u003Ccode>word_index + 1\u003C/code>. Using non-atomic writes inside the lock would create a data race with those lock-free operations.\u003C/p>\n\u003Cp>We therefore use \u003Ccode>fetch_update\u003C/code>, another CAS-based atomic, to modify each of the two words. For the lower word, we clear the high bits starting from our \u003Ccode>bit_offset\u003C/code> and OR in the low bits of our new value.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> low_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">storage[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> high_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">storage[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Modify the lower word.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">low_word_ref\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fetch_update\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x26;=\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">MAX\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">        Some\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unwrap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(); \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// This unwrap is safe: with the lock held, there is no contention.\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Next, we do the same for the higher word, calculating a \u003Ccode>high_mask\u003C/code> to clear the low bits and writing the remaining high bits of our value.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bits_in_high\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> high_mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#F78C6C\">u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bits_in_high\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">wrapping_sub\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">high_word_ref\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fetch_update\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x26;=\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">high_mask\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">        Some\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unwrap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(); \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Also safe.\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The lock provides the mutual exclusion that makes the two-word update appear atomic as a whole. The continued use of atomics with the user-specified \u003Ccode>Ordering\u003C/code> ensures that the final result is correctly propagated through the memory system and becomes visible to other threads according to the Rust memory model.\u003C/p>\n\u003Cp>Putting it all together, the final, complete \u003Ccode>atomic_store\u003C/code> method handles both the lock-free and locked paths.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> atomic_store\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> /\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> %\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // Lock-free path for single-word values.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">storage[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> store_mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> store_value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">load\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        loop\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">            let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">store_mask\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> store_value\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            match\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">compare_exchange_weak\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">                old_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">                new_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">                order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">                Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            ) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">                Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> break\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">                Err\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">else\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // Locked path for values spanning two words.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> lock_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">locks\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">len\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> _guard\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">locks[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">lock_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">lock\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // The lock guarantees exclusive access to this multi-word operation.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // We still use atomic operations inside to prevent races with the\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // lock-free path, which might be concurrently accessing one of\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // these words.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> low_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">storage[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> high_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">storage[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // Modify the lower word.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        low_word_ref\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">            .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fetch_update\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">                w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x26;=\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">MAX\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">                w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">                Some\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">            .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unwrap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(); \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Should not fail under lock.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // Modify the higher word.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bits_in_high\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> high_mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#F78C6C\">u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bits_in_high\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">wrapping_sub\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        high_word_ref\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">            .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fetch_update\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">                w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x26;=\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">high_mask\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">                w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">                Some\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">            .\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unwrap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(); \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Should not fail under lock.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The branching logic \u003Ccode>if bit_offset + self.bit_width &#x3C;= 64\u003C/code> is a simple, constant-time check that determines which path to take. The condition is highly predictable for the CPU’s branch predictor, as the \u003Ccode>bit_offset\u003C/code> follows a simple arithmetic progression based on the index. This minimizes pipeline stalls. More importantly, this structure enables significant compiler optimization. When we use \u003Ccode>AtomicFixedVec\u003C/code> with a \u003Ccode>bit_width\u003C/code> that is a power of two, the branch condition can often be resolved at compile time. With Link-Time Optimization (LTO), the compiler can prove that the \u003Ccode>else\u003C/code> branch for the locked path is unreachable. This allows for dead code elimination, producing a specialized function containing \u003Cem>only\u003C/em> the lock-free CAS loop.\u003C/p>\n\u003Ch1 id=\"benchmarking-the-store-operation\">Benchmarking the \u003Ccode>store\u003C/code> operation\u003C/h1>\n\u003Cp>We now want to measure the performance of our \u003Ccode>atomic_store\u003C/code> implementation under concurred load. We want to know how the throughput of the \u003Ccode>store\u003C/code> operation scales as we increase thread count and contention. We can create two benchmark scenarios, one with a bit-width that is a power of two, and one with a non-power-of-two bit-width. Both simulate “diffuse contention”: a pool of threads performs a high volume of atomic \u003Ccode>store\u003C/code> operations to random indices within a shared vector of 10k 64-bit elements. Each thread is assigned 100k operations. This randomness ensures that while direct contention on the same element is rare, there will be frequent collisions on the same \u003Ccode>AtomicU64\u003C/code> words, especially as thread count increases.\u003C/p>\n\u003Cp>In the benchmark, each thread with \u003Ccode>thread_id\u003C/code> simply writes its own ID to the vector for each operation:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">vec\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">store\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">thread_id\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">SeqCst\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>We compare our \u003Ccode>AtomicFixedVec\u003C/code> against two other implementations:\u003C/p>\n\u003Col>\n\u003Cli>A \u003Ccode>Vec&#x3C;AtomicU16>\u003C/code>: This serves as our “ideal” baseline.\u003C/li>\n\u003Cli>\u003Ca href=\"https://docs.rs/sux/latest/sux/bits/bit_field_vec/struct.AtomicBitFieldVec.html\">\u003Ccode>sux::AtomicBitFieldVec\u003C/code>\u003C/a>: A similar implementation of another library. This comparison however is not perfectly equivalent for bit-widths that are not powers of two. As per their documentation, \u003Ccode>sux\u003C/code> does not guarantee atomicity for values that span word boundaries, which can lead to “torn writes.” Our \u003Ccode>AtomicFixedVec\u003C/code> is designed to prevent this class of data race through its lock striping mechanism. The performance cost of this correctness guarantee is precisely what we aim to measure.\u003C/li>\n\u003C/ol>\n\u003Cp>The first benchmark measure the performance of our \u003Cstrong>lock-free path\u003C/strong>. We configure all vectors with a \u003Ccode>bit_width\u003C/code> of 16. Because 16 is a power of two and evenly divides the 64-bit word size, every element is guaranteed to be fully contained within a single \u003Ccode>u64\u003C/code> word. This is the best-case scenario for bit-packed atomics. It ensures that all \u003Ccode>store\u003C/code> operations can be performed with lock-free CAS loops.\u003C/p>\n\u003Ciframe src=\"/bench-intvec/atomic_scaling_lock_free_diffuse.html\" width=\"100%\" height=\"550px\" style=\"border: none;\">\u003C/iframe>\n\u003Cp>As we can see, all three implementations scale well with increasing thread count. The throughput of \u003Ccode>AtomicFixedVec\u003C/code> is very close to that of \u003Ccode>sux::AtomicBitFieldVec\u003C/code>, which is expected since both are using similar lock-free CAS loops for this scenario. Both bit-packed vectors have a noticeable dip at two threads, likely due to initial cache coherency overhead, but then scale up effectively with the core count.\u003C/p>\n\u003Cp>The second benchmark tries to stress the \u003Cstrong>locked path\u003C/strong>. We configure the vectors with a \u003Ccode>bit_width\u003C/code> of 15. This non-power-of-two width guarantees that a predictable fraction of writes will cross word boundaries. In our case, \u003Ccode>(15 + 63) % 64\u003C/code> spanning cases out of 64 offsets, so roughly \u003Ccode>14/64\u003C/code> or ~22% will require locking. This forces our \u003Ccode>AtomicFixedVec\u003C/code> to use its lock striping mechanism for those spanning writes. In contrast, \u003Ccode>sux\u003C/code> will proceed without locking, risking data races but avoiding locking overhead.\u003C/p>\n\u003Ciframe src=\"/bench-intvec/atomic_scaling_locked_path_diffuse.html\" width=\"100%\" height=\"550px\" style=\"border: none;\">\u003C/iframe>\n\u003Cp>This benchmark shows the real cost of correctness. Our \u003Ccode>AtomicFixedVec\u003C/code> now shows lower throughput and poorer scaling compared to both the baseline and \u003Ccode>sux\u003C/code>. Every write operation that crosses a word boundary (approximately 22% of them in this test) must acquire a lock, execute its two atomic updates, and release the lock. While with lock striping we prevent a single point of serialization, the overhead of the locking protocol itself, especially under contention from multiple threads, is non-trivial. In contrast, \u003Ccode>sux\u003C/code> maintains higher throughput by avoiding locks entirely, but at the cost of potentially observing torn writes.\u003C/p>\n\u003Ch1 id=\"read-modify-write-operations\">Read-Modify-Write Operations\u003C/h1>\n\u003Cp>With the hybrid atomicity model defined, the next step is to build a robust API. Instead of re-implementing the complex hybrid logic for every atomic operation, we can implement it once in a single, powerful primitive: \u003Ccode>compare_exchange\u003C/code>. All other Read-Modify-Write (RMW) operations can then be built on top of this primitive.\u003C/p>\n\u003Cp>\u003Ccode>compare_exchange\u003C/code> attempts to store a \u003Ccode>new\u003C/code> value into a location if and only if the value currently at that location matches an expected \u003Ccode>current\u003C/code> value. This operation is the fundamental building block for lock-free algorithms.\u003C/p>\n\u003Ch2 id=\"the-lock-free-path-a-cas-loop-on-a-sub-word\">The Lock-Free Path: A CAS Loop on a Sub-Word\u003C/h2>\n\u003Cp>For elements that are fully contained within a single \u003Ccode>AtomicU64\u003C/code>, we can implement \u003Ccode>compare_exchange\u003C/code> with a CAS loop. However, the logic is more complex than a simple store. We aren’t comparing the entire 64-bit word; we are comparing a specific \u003Ccode>bit_width\u003C/code> slice within it.\u003C/p>\n\u003Cp>The process is as follows. First, we load the entire 64-bit word. Then, we extract the specific bits that correspond to our logical element and compare them against the user-provided \u003Ccode>current\u003C/code> value.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Inside the lock-free path of atomic_compare_exchange\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">load\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">failure\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">loop\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_val_extracted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_val_extracted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> current\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Err\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_val_extracted\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ...\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>If this check fails, it means another thread has modified the element since our initial load. We can immediately return an \u003Ccode>Err\u003C/code> with the value we just read, satisfying the contract of \u003Ccode>compare_exchange\u003C/code>.\u003C/p>\n\u003Cp>If the check succeeds, we proceed to the atomic write phase. We prepare a \u003Ccode>new_word\u003C/code> by masking and ORing in the \u003Ccode>new\u003C/code> value, just as we did for \u003Ccode>atomic_store\u003C/code>. Then we attempt the hardware-level \u003Ccode>compare_exchange_weak\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ... continuing the loop ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">store_mask\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new_value_shifted\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">match\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">compare_exchange_weak\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">new_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">success\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">failure\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">current\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    Err\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>If the \u003Ccode>compare_exchange_weak\u003C/code> succeeds, it means no other thread modified the 64-bit word between our initial \u003Ccode>load\u003C/code> and this instruction. Our update is successful. If it fails, another thread (possibly operating on an \u003Cem>adjacent\u003C/em> element in the same word) has modified the word. We update our local \u003Ccode>old_word\u003C/code> with the new value from memory and retry the entire loop.\u003C/p>\n\u003Ch2 id=\"the-locked-path\">The Locked Path\u003C/h2>\n\u003Cp>For elements that span two words, we need to use the lock striping mechanism to ensure the operation is transactional. First, we must acquire the appropriate lock, giving us exclusive access to the two-word region.\u003C/p>\n\u003Cp>Once the lock is held, the logic is straightforward:\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Read:\u003C/strong> We perform an atomic read of the spanning value. This is itself a locked operation to ensure we get a consistent view.\u003C/li>\n\u003Cli>\u003Cstrong>Compare:\u003C/strong> We compare this value against the user-provided \u003Ccode>current\u003C/code>. If they don’t match, we release the lock and immediately return \u003Ccode>Err\u003C/code>.\u003C/li>\n\u003Cli>\u003Cstrong>Write:\u003C/strong> If they do match, we call our existing \u003Ccode>atomic_store\u003C/code> method to write the \u003Ccode>new\u003C/code> value. \u003Ccode>atomic_store\u003C/code> will re-acquire the same lock to perform its two-word write.\u003C/li>\n\u003Cli>\u003Cstrong>Return:\u003C/strong> We release the lock and return \u003Ccode>Ok\u003C/code>.\u003C/li>\n\u003C/ol>\n\u003Cp>Because the entire read-compare-write sequence is protected by the same mutex, we guarantee that no other thread can interfere. Combining these two paths gives us the complete \u003Ccode>atomic_compare_exchange\u003C/code> method, which can then be used to implement all other atomic operations in terms of it.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> atomic_compare_exchange\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    current\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    new\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    success\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    failure\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Result\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">u64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> /\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_pos\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> %\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bit_width \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> u64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">BITS\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // Lock-free path\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">storage[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">word_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> store_mask\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new_value_shifted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">load\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">failure\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        loop\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">            let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_val_extracted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> bit_offset\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mask;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_val_extracted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> current\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">                return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Err\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_val_extracted\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">            let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">store_mask\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new_value_shifted\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            match\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> atomic_word_ref\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">compare_exchange_weak\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">new_word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">success\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">failure\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">                Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">current\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">                Err\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_word\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> x\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">else\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // Locked path\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> lock_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> word_index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">locks\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">len\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> _guard\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">locks[\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">lock_index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">lock\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">atomic_load\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">failure\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old_val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> current\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Err\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old_val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">        self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">atomic_store\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">new\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">success\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">        Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">current\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>With \u003Ccode>atomic_compare_exchange\u003C/code> providing the core atomicity primitive, we can now construct the high-level Read-Modify-Write (RMW) API. All RMW operations, such as \u003Ccode>fetch_add\u003C/code> or \u003Ccode>fetch_max\u003C/code>, share an identical algorithmic structure: a loop that repeatedly reads a value, computes a new value, and attempts to commit it with \u003Ccode>compare_exchange\u003C/code>. Re-implementing this loop for every operation would be redundant.\u003C/p>\n\u003Cp>Instead, we can abstract this pattern into a single generic method, \u003Ccode>atomic_rmw\u003C/code>, that is parameterized not just over values, but over the \u003Cem>operation itself\u003C/em>. This is where Rust generics and closures come into play. The signature of \u003Ccode>atomic_rmw\u003C/code> can be defined as follows:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> atomic_rmw\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">F\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">op\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> F\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">where\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    F\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Fn\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ... implementation ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cem>Note: The actual implementation uses \u003Ccode>impl Fn(...)\u003C/code> for a more ergonomic syntax, but the principle is the same.\u003C/em>\u003C/p>\n\u003Cp>The \u003Ccode>op\u003C/code> parameter is a generic type \u003Ccode>F\u003C/code> constrained by the \u003Ccode>Fn(T, T) -> T\u003C/code> trait. This means \u003Ccode>op\u003C/code> can be any closure (or function pointer) that takes two values of our logical type \u003Ccode>T\u003C/code> and returns a new \u003Ccode>T\u003C/code>. This allows us to inject any binary operation—addition, bitwise AND, max, etc. directly into the RMW logic.\u003C/p>\n\u003Cp>To implement \u003Ccode>atomic_rmw\u003C/code>, we begin with a relaxed load to get an initial \u003Ccode>current\u003C/code> value. Inside the loop, it invokes the \u003Ccode>op\u003C/code> closure with the \u003Ccode>current\u003C/code> value and the user-provided \u003Ccode>val\u003C/code> to compute the \u003Ccode>new\u003C/code> value.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> current\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">load\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">loop\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> op\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">current\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ...\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The core of the loop is the call to \u003Ccode>atomic_compare_exchange\u003C/code>. This attempts to commit the transaction.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">match\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">compare_exchange\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">current\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">new\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    Err\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">actual\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> current\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> actual\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>If the operation succeeds, we return the old value, satisfying the RMW contract. If it fails due to contention, \u003Ccode>compare_exchange\u003C/code> returns the \u003Ccode>actual\u003C/code> value now in memory. We update our local \u003Ccode>current\u003C/code> and the loop repeats, re-applying the \u003Ccode>op\u003C/code> closure on the newer value. The complete \u003Ccode>atomic_rmw\u003C/code> method looks like this:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> atomic_rmw\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">op\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> impl\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Fn\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> current\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">load\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    loop\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> op\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">current\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        match\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">compare_exchange\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">current\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">new\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Relaxed\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">            Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">old\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> return\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> old\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">            Err\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">actual\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> current\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> actual\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>By parameterizing over the operation, we have completely decoupled the complex, low-level concurrency logic from the simple arithmetic or bitwise logic of each specific RMW operation. This allows the compiler to monomorphize and inline the \u003Ccode>op\u003C/code> closure for each call site, resulting in specialized and efficient machine code for each RMW variant, giving us a zero-cost abstraction.\u003C/p>\n\u003Cp>Now implementing specific RMW methods becomes a straightforward exercise in composition. Each specific operation is now a simple non-looping wrapper that calls \u003Ccode>atomic_rmw\u003C/code> and provides a closure defining the desired computation. For example, \u003Ccode>fetch_add\u003C/code> is implemented by passing a closure that performs a wrapping addition.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fetch_add\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">atomic_rmw\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> a\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">wrapping_add\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The same pattern applies to all other RMW operations. A bitwise \u003Ccode>fetch_and\u003C/code> provides a closure with the \u003Ccode>&#x26;\u003C/code> operator, and \u003Ccode>fetch_max\u003C/code> provides one that calls the \u003Ccode>max\u003C/code> method.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fetch_sub\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">atomic_rmw\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> a\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">wrapping_sub\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fetch_and\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">atomic_rmw\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> a\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fetch_or\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">atomic_rmw\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> a\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fetch_xor\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">atomic_rmw\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> a\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ^\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fetch_max\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">atomic_rmw\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> a\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">max\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fetch_min\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">self\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ordering\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">atomic_rmw\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">index\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> a\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">min\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>",{"headings":747,"localImagePaths":769,"remoteImagePaths":770,"frontmatter":771,"imagePaths":774},[748,751,754,757,760,763,766],{"depth":284,"slug":749,"text":750},"structure","Structure",{"depth":31,"slug":752,"text":753},"lock-free-path-for-in-word-elements","Lock-Free path for In-Word Elements",{"depth":31,"slug":755,"text":756},"lock-based-path-for-spanning-elements","Lock-Based Path for Spanning Elements",{"depth":284,"slug":758,"text":759},"benchmarking-the-store-operation","Benchmarking the store operation",{"depth":284,"slug":761,"text":762},"read-modify-write-operations","Read-Modify-Write Operations",{"depth":31,"slug":764,"text":765},"the-lock-free-path-a-cas-loop-on-a-sub-word","The Lock-Free Path: A CAS Loop on a Sub-Word",{"depth":31,"slug":767,"text":768},"the-locked-path","The Locked Path",[],[],{"author":269,"pubDatetime":772,"title":737,"slug":733,"featured":179,"draft":179,"tags":773,"description":740},["Date","2025-09-16T00:00:00.000Z"],[273,274,739],[],"cache-friendly-low-memory-lanczos",{"id":775,"data":777,"body":783,"filePath":784,"digest":785,"rendered":786},{"author":269,"pubDatetime":778,"title":779,"featured":179,"draft":18,"tags":780,"description":782},["Date","2025-09-16T00:00:00.000Z"],"Cache-Friendly, Low-Memory Lanczos Algorithm in Rust",[273,781],"numerical-analysis","Implementing a cache-friendly, low-memory two-pass Lanczos algorithm in Rust, focusing on efficient memory access patterns and minimal allocations.","The standard Lanczos method for computing matrix functions has a brutal memory requirement: storing an $n \\times k$ basis matrix that grows with every iteration. For a 500,000-variable problem needing 1,000 iterations, that's ~4 GB just for the basis. In this post we will explore one of the most straightforward solutions to this problem: a two-pass variant of the Lanczos algorithm that only requires O(n) memory at the cost of doubling the number of matrix-vector products. The surprising part? When implemented carefully, the two-pass version isn't just memory-efficient, it can be faster for certain problems. In this post we will try to do some algorithm engineering to understand why.\n\n- All code is available on GitHub: [two-pass-lanczos](https://github.com/lukefleed/two-pass-lanczos)\n- The full technical report with proofs and additional experiments: [report.pdf](/two-pass-lanczos/tex/report.pdf)\n\n---\n\n# Computing Matrix Functions\n\nLet's consider the problem of computing the action of matrix functions on a vector:\n\n$$\n\\mathbf{x} = f(\\mathbf{A})\\mathbf{b}\n$$\n\nwhere $\\mathbf{A}$ is a large sparse Hermitian matrix and $f$ is a matrix function defined on the spectrum of $\\mathbf{A}$. This is a problem that appears pretty often in scientific computing: solving linear systems corresponds to $f(z) = z^{-1}$, exponential integrators for PDEs use $f(z) = \\exp(tz)$, and many other problems require functions like $f(z) = z^{-1/2}$ or $f(z) = \\text{sign}(z)$.\n\nIndeed, there are a lot problems with computing $f(\\mathbf{A})$ directly. First of all, even if $\\mathbf{A}$ is sparse, $f(\\mathbf{A})$ is generally dense. Storing it explicitly is out of the question for large problems. Even if we could store it, computing it directly would require algorithms like the Schur-Parlett method that scale as $O(n^3)$, which is impractical for large $n$.\n\nHowever we know that given any matrix function $f$ defined on the spectrum of $\\mathbf{A}$, we can express $f(\\mathbf{A})$ as a polynomial in $\\mathbf{A}$ of degree at most $n$ (the size of the matrix) such that $f(\\mathbf{A}) = p_{n}(\\mathbf{A})$ (this is a consequence of the Cayley-Hamilton theorem). This polynomial interpolates $f$ and its derivatives in the Hermitian sense at the eigenvalues of $\\mathbf{A}$.\n\nThis gives a good and a bad news: the good news is that, well, we can express $f(\\mathbf{A})$ as a polynomial in $\\mathbf{A}$. The bad news is that the degree of this polynomial can be as high as $n$, which is huge for large problems. The idea is then to find a low-degree polynomial approximation to $f$ that is \"good enough\" for our purposes. If we can find a polynomial $p_k$ of degree $k \\ll n$ such that $p_k(\\mathbf{A}) \\approx f(\\mathbf{A})$, then we can approximate the solution as:\n\n$$\nf(\\mathbf{A})\\mathbf{b} \\approx p_k(\\mathbf{A})\\mathbf{b} = \\sum_{i=0}^k c_i \\mathbf{A}^i \\mathbf{b}\n$$\n\n## Krylov Projection\n\nWe notice that the polynomial approximation only involves vectors that lie in the following space, called the Krylov subspace of order $k$:\n\n$$\n\\mathcal{K}_k(\\mathbf{A}, \\mathbf{b}) = \\text{span}\\{\\mathbf{b}, \\mathbf{Ab}, \\mathbf{A}^2\\mathbf{b}, \\ldots, \\mathbf{A}^{k-1}\\mathbf{b}\\}\n$$\n\nWe can then search the approximate solution $\\mathbf{x}_k$ in this subspace by just doing matrix-vector products with $\\mathbf{A}$. This is great because it's the only operation we can do efficiently for large sparse matrices.\n\n> Note that we don't need to construct and keep in memory $\\mathbf{A}^j$ for any $j$. We can just compute it iteratively as $\\mathbf{A}(\\mathbf{A}^{j-1}\\mathbf{b})$.\n\n### Finding a basis\n\nTechnically, we already have a basis for this space. The raw vectors $\\{\\mathbf{A}^j\\mathbf{b}\\}$ form a basis, but it's a terrible one for computation since they quickly become nearly parallel. We need a stable, orthonormal basis. The standard way to build one is the Arnoldi process. It's essentially a Gram-Schmidt procedure tailored for Krylov subspaces.\n\nWe start by normalizing our initial vector, $\\mathbf{v}_1 = \\mathbf{b} / \\|\\mathbf{b}\\|_2$. The process is iterative. At each step $j$, we first create a new candidate vector by applying the operator, $\\mathbf{w}_j = \\mathbf{A}\\mathbf{v}_j$. Next, we make it orthogonal to our existing basis vectors $\\mathbf{v}_1, \\ldots, \\mathbf{v}_j$ using the Gram-Schmidt procedure. This involves subtracting the projections:\n\n$$\n\\tilde{\\mathbf{v}}_j = \\mathbf{w}_j - \\sum_{i=1}^j (\\mathbf{v}_i^H \\mathbf{w}_j) \\mathbf{v}_i\n$$\n\nThe coefficients we compute here, $h_{ij} = \\mathbf{v}_i^H \\mathbf{w}_j = \\mathbf{v}_i^H \\mathbf{A} \\mathbf{v}_j$, become the entries of our projected matrix. Finally, we normalize the new vector to get the next basis vector, where $h_{j+1, j} = \\|\\tilde{\\mathbf{v}}_j\\|_2$ and $\\mathbf{v}_{j+1} = \\tilde{\\mathbf{v}}_j / h_{j+1, j}$.\n\nAfter $k$ steps, we end up with\n\n- $\\mathbf{V}_k \\in \\mathbb{C}^{n \\times k} = [\\mathbf{v}_1, \\ldots, \\mathbf{v}_k]$, an orthonormal basis for $\\mathcal{K}_k(\\mathbf{A}, \\mathbf{b})$.\n- $\\mathbf{H}_k \\in \\mathbb{C}^{k \\times k}$, an upper Hessenberg matrix with entries $h_{ij}$. This matrix represents the projection of $\\mathbf{A}$ onto the Krylov subspace.\n\n> Why $\\mathbf{H}_k$ is upper Hessenberg? Because in the Arnoldi process, each new vector $\\mathbf{v}_{j+1}$ is orthogonalized against all previous vectors $\\mathbf{v}_1, \\ldots, \\mathbf{v}_j$. This means that when we compute the projections $\\mathbf{v}_i^H \\mathbf{A} \\mathbf{v}_j$, only the first $j+1$ basis vectors contribute to the new vector. Therefore, $h_{ij} = 0$ for all $i > j + 1$, resulting in an upper Hessenberg structure.\n\nWe can summarize the whole process with the matrix formulation known as the Arnoldi decomposition:\n\n$$\n\\mathbf{A}\\mathbf{V}_k = \\mathbf{V}_k \\mathbf{H}_k + h_{k+1,k} \\mathbf{v}_{k+1} \\mathbf{e}_k^T\n$$\n\nHow do we use this to approximate our original problem? Well it depends on what we consider a \"good\" approximation. For this blog post we'll just consider Full Orthogonal Method (FOM), which enforce that the residual $\\mathbf{r}_k = f(\\mathbf{A})\\mathbf{b} - \\mathbf{x}_k$ is orthogonal to the Krylov subspace. Therefore, we can express the approximate solution as:\n\n$$\n\\mathbf{x}_k = \\mathbf{V}_k \\mathbf{y}_k\n$$\n\nwhere $\\mathbf{y}_k$ is a small $k$-dimensional vector that we need to compute as\n\n$$\n\\mathbf{y}_k = f(\\mathbf{H}_k) \\mathbf{e}_1 \\|\\mathbf{b}\\|_2\n$$\n\n> The term $\\mathbf{e}_1 \\|\\mathbf{b}\\|_2$ comes from the fact that our initial vector $\\mathbf{v}_1$ is $\\mathbf{b}$ normalized. In the Krylov subspace, this corresponds to the first basis vector scaled by the norm of $\\mathbf{b}$. This is just the projection of $\\mathbf{b}$ onto the Krylov subspace.\n\nThis problems is now reduced to computing $f(\\mathbf{H}_k)$, which is a small $k \\times k$ matrix. This is relatively cheap since $k \\ll n$ and we can use direct methods like the Schur-Parlett method that require $O(k^3)$ operations.\n\n> If we choose $f(z) = z^{-1}$, then is reduces to solving the linear system $\\mathbf{H}_k \\mathbf{y}_k = \\mathbf{e}_1 \\|\\mathbf{b}\\|_2$, which can be done efficiently with direct methods like LU decomposition.\n\n\u003C!--\nIf we left-multiply by $\\mathbf{V}_k^H$, we see that $\\mathbf{H}_k = \\mathbf{V}_k^H \\mathbf{A} \\mathbf{V}_k$. This is the key: $\\mathbf{H}_k$ is the projection of the huge operator $\\mathbf{A}$ onto our small Krylov subspace. We can now approximate our original problem by solving it in this small space:\n\n$$\n\\mathbf{x}_k = \\|\\mathbf{b}\\|_2 \\mathbf{V}_k f(\\mathbf{H}_k) \\mathbf{e}_1\n$$\n\nThis is a huge win. We've turned a problem of dimension $n$ into one of dimension $k$, which is cheap to solve.\n\nBut we can do even better. Our problem states that $\\mathbf{A}$ is Hermitian. This imposes a special structure on the projection. Since $\\mathbf{A} = \\mathbf{A}^H$, the projection $\\mathbf{H}_k$ must also be Hermitian. A matrix that is both upper Hessenberg and Hermitian has to be real, symmetric, and tridiagonal. This simplification is what turns the general Arnoldi process into the much more efficient symmetric Lanczos process. -->\n\n# Lanczos Iterations\n\nAt the beginning of this post we said that $\\mathbf{A}$ is Hermitian. This means that, in the real case, $\\mathbf{A}$ is symmetric: $\\mathbf{A} = \\mathbf{A}^T$. In the complex case, it means $\\mathbf{A} = \\mathbf{A}^H$, where $\\mathbf{A}^H$ is the conjugate transpose. This special property has huge implications for the Krylov projection.\n\nWe can prove that $\\mathbf{H}_k = \\mathbf{V}_k^H \\mathbf{A} \\mathbf{V}_k$. This means that if $\\mathbf{A}$ is Hermitian, then $\\mathbf{H}_k$ must also be Hermitian. A matrix that is both upper Hessenberg and Hermitian has to be real, symmetric, and tridiagonal.\n\nIn the literature we refer to this projected matrix as $\\mathbf{T}_k$ instead of $\\mathbf{H}_k$ to highlight its special tridiagonal structure. Where $\\alpha_j \\in \\mathbb{R}$ (reals since $h_{ij} = \\overline{h_{ji}}$) are the diagonal elements and $\\beta_j = h_{j+1,j} \\in \\mathbb{R}$ are the off-diagonal elements.\n\nLet's re-write the Arnoldi decomposition for this case:\n\n$$\n\\mathbf{A}\\mathbf{V}_k = \\mathbf{V}_k \\mathbf{T}_k + \\beta_k \\mathbf{v}_{k+1} \\mathbf{e}_k^T\n$$\n\nWe can extract the $j$-th column from this matrix equation. On the left, we have $\\mathbf{A}\\mathbf{v}_j$. On the right, we need the $j$-th column of the whole expression. The second term, $\\beta_k \\mathbf{v}_{k+1} \\mathbf{e}_k^T$, only affects the final column ($j=k$), so for now let's assume $j \u003C k$. For the right-end-side for the equation we can exploit the tridiagonal structure of $\\mathbf{T}_k$ to simplify the expression:\n\n$$\n\\mathbf{V}_k (\\mathbf{T}_k \\mathbf{e}_j) = \\beta_{j-1} \\mathbf{v}_{j-1} + \\alpha_j \\mathbf{v}_j + \\beta_j \\mathbf{v}_{j+1}\n$$\n\nThus, we get the famous **Lanczos three-term recurrence**:\n\n$$\n\\mathbf{A}\\mathbf{v}_j = \\beta_{j-1}\\mathbf{v}_{j-1} + \\alpha_j \\mathbf{v}_j + \\beta_j \\mathbf{v}_{j+1}\n$$\n\nThe crucial detail to notice here is that to generate the next basis vector $\\mathbf{v}_{j+1}$, we only need the two previous vectors, $\\mathbf{v}_j$ and $\\mathbf{v}_{j-1}$. We don't need to orthogonalize against the entire history of the basis, because the Hermitian nature of $\\mathbf{A}$ guarantees that the new vector is already orthogonal to all vectors $\\mathbf{v}_1, \\ldots, \\mathbf{v}_{j-2}$.\n\nSo as before, we can determine the coefficients directly from this recurrence. By rearranging it, we get an expression for the unnormalized next vector:\n\n$$\nw_{j+1} = \\mathbf{A}\\mathbf{v}_j\n$$\n\nThen we compute the first component along $v_j$:\n\n$$\n\\alpha_j = \\mathbf{v}_j^H w_{j+1}\n$$\n\nThis will be the diagonal element of the matrix. Now we subtract the component along $v_j$ and $v_{j-1}$ (that we know from the previous step):\n\n$$\n\\tilde{\\mathbf{v}}_{j+1} = w_{j+1} - \\alpha_j \\mathbf{v}_j - \\beta_{j-1}\\mathbf{v}_{j-1}\n$$\n\nThis vector is orthogonal to both $\\mathbf{v}_j$ and $\\mathbf{v}_{j-1}$ for construction, and the tridiagonal property guarantees it's orthogonal to all previous vectors. Finally, we normalize it to get the next basis vector:\n\n$$\n\\beta_j = \\|\\tilde{\\mathbf{v}}_{j+1}\\|_2 \\qquad \\mathbf{v}_{j+1} = \\frac{\\tilde{\\mathbf{v}}_{j+1}}{\\beta_j}\n$$\n\n## The Memory Bottleneck\n\nAfter $k$ iterations of this process, we end up with as before with two matrices: $\\mathbf{V}_k \\in \\mathbb{C}^{n \\times k}$ and the tridiagonal matrix $\\mathbf{T}_k \\in \\mathbb{R}^{k \\times k}$. The approximate solution is still given by:\n\n$$\n\\mathbf{x}_k = \\mathbf{V}_k \\mathbf{y}_k = \\sum_{j=1}^k (\\mathbf{y}_k)_j \\mathbf{v}_j\n$$\n\nwhere\n\n$$\n\\mathbf{y}_k = f(\\mathbf{T}_k) \\mathbf{e}_1 \\|\\mathbf{b}\\|_2\n$$\n\nThis sum requires that all basis vectors $\\mathbf{v}_j$ are stored in memory. There is a clear timing problem here: the coefficients $\\mathbf{y}_k$ depends on the full $\\mathbf{T}_k$, which only becomes available after $k$ iterations. Therefore, we cannot accumulate the solution $\\mathbf{x}_k$ as we go. We have to wait until the end, when all basis vectors are already computed and stored.\n\nThe memory complexity is $O(nk)$, which can be prohibitive for large $n$ and moderate $k$. For example, with $n = 500,000$ and $k = 1,000$, storing $\\mathbf{V}_k$ alone requires about 4 GB of memory (assuming double-precision complex numbers). This can be a serious limitation in practice, this is why there is a lot of interest in reducing the memory footprint of Krylov methods.\n\nLet's see how we can do better in terms of memory usage.\n\n# Two-Pass Algorithm\n\nTo avoid storing the full basis $\\mathbf{V}_k$, we can divide the Lanczos process into two separate passes over the data. The idea is to first run the Lanczos iterations to compute and store only the tridiagonal matrix $\\mathbf{T}_k$ (i.e., the scalars $\\alpha_j$ and $\\beta_j$), and then in a second pass, regenerate the basis vectors $\\mathbf{v}_j$ one at a time to accumulate the final solution $\\mathbf{x}_k$.\n\nThis takes the memory complexity down to $O(n)$, since at any point in time we only need to keep a few vectors in memory. However, it comes at the cost of doubling the number of matrix-vector products with $\\mathbf{A}$, since we need to apply $\\mathbf{A}$ once in each pass.\n\n## First pass\n\nWe begin with $\\beta_0 = 0$ and $\\mathbf{v}_0 = \\mathbf{0}$. As before, we initialize $\\mathbf{v}_1 = \\mathbf{b} / \\|\\mathbf{b}\\|_2$. The Lanczos recurrence proceeds as usual for $k$ steps, computing the scalars $\\alpha_j$ and $\\beta_j$ at each iteration. However, instead of storing the basis vectors $\\mathbf{v}_j$, we discard them after use. This means that at any point in time, we only need to keep in memory the two most recent basis vectors, $\\mathbf{v}_j$ and $\\mathbf{v}_{j-1}$, along with a work vector for the matrix-vector product.\n\nAt the end of the first pass, we have the tridiagonal matrix $\\mathbf{T}_k$ defined by the stored scalars $\\{\\alpha_j, \\beta_j\\}$. We can then compute the small problem:\n\n$$\n\\mathbf{y}_k = f(\\mathbf{T}_k) \\mathbf{e}_1 \\|\\mathbf{b}\\|_2\n$$\n\n## Second pass\n\nWith the coefficients $\\mathbf{y}_k$ computed, we proceed to the second pass. Here, we regenerate the basis vectors $\\mathbf{v}_j$ one at a time using the stored scalars $\\{\\alpha_j, \\beta_j\\}$ and the Lanczos recurrence relation that we derived earlier. While regenerating each basis vector, we immediately accumulate its contribution to the solution $\\mathbf{x}_k$:\n\n$$\n\\mathbf{x}_k \\gets \\mathbf{x}_k + (\\mathbf{y}_k)_j \\mathbf{v}_j\n$$\n\nThen, we discard $\\mathbf{v}_j$ and move on to the next one. This way, we never need to store the full basis in memory. There are two important details to note:\n\n- The basis vectors are generated in the same order as in the first pass, since floating-point arithmetic is deterministic, this ensures that the basis is bitwise identical to the one that would have been computed in a single pass.\n- The solution, however, will change slightly due to the different order of operations in floating-point arithmetic. In the standard Lanczos, the solution is built as matrix-vector product $\\mathbf{V}_k \\mathbf{y}_k$, while in the two-pass method, it's built as a sum of scaled vectors. This is compiles to two different BLAS calls (`gemv` vs `axpy`), which have different rounding errors. However, in practice, the difference is in the order of machine epsilon and doesn't affect convergence.\n\nOf course. Here is the content as a Markdown snippet.\n\n# Implementation\n\nLet's build this in Rust. The performance of the two-pass algorithm depends entirely on controlling memory access patterns, and Rust's ownership model and zero-cost abstractions give us the tools to reason about where data lives and how it moves through the cache hierarchy.\n\nFor the linear algebra primitives, we'll use [`faer`](https://github.com/sarah-ek/faer-rs), a modern pure-Rust numerical library. Three features are particularly important for what we're about to build:\n\n- **Stack allocation:** `MemStack` provides a pre-allocated scratch buffer that we can reuse, making the hot path of the algorithm allocation-free.\n- **Matrix-free operators:** The `LinOp` trait lets us define operators by their action (`apply`) without needing to materialize a matrix. This is essential for large-scale problems.\n- **SIMD-optimized kernels:** The `zip!` macro generates vectorized loops that compile down to packed SIMD instructions for core vector operations.\n\n## Building the Core Recurrence\n\nThe foundation of our algorithm is the Lanczos three-term recurrence:\n\n$\\beta_j \\mathbf{v}_{j+1} = \\mathbf{A}\\mathbf{v}_j - \\alpha_j \\mathbf{v}_j - \\beta_{j-1}\\mathbf{v}_{j-1}$\n\nLet's start by translating this directly into a Rust function. The signature should look something like this:\n\n```rust\nfn lanczos_recurrence_step\u003CT: ComplexField, O: LinOp\u003CT>>(\n    operator: &O,\n    mut w: MatMut\u003C'_, T>,\n    v_curr: MatRef\u003C'_, T>,\n    v_prev: MatRef\u003C'_, T>,\n    beta_prev: T::Real,\n    stack: &mut MemStack,\n) -> (T::Real, Option\u003CT::Real>)\n```\n\nThis way, the function is generic over the field type `T` (`f64`, `c64`, etc.) and the operator type `O`. It operates on `faer`'s matrix views (`MatMut` and `MatRef`) to avoid unnecessary data copies. The return type `(T::Real, Option\u003CT::Real>)` gives us the diagonal element $\\alpha_j$ and, if the process hasn't broken down, the off-diagonal $\\beta_j$.\n\nNow let's implement the body by following the math step-by-step. First, we handle the operator application, which is the most computationally expensive part:\n\n```rust\n// 1. Apply operator: w = A * v_curr\noperator.apply(w.rb_mut(), v_curr, Par::Seq, stack);\n```\n\nNext, we orthogonalize against the previous vector $\\mathbf{v}_{j-1}$. This is a perfect use case for `faer`'s `zip!` macro, which the compiler can turn into efficient SIMD instructions.\n\n```rust\n// 2. Orthogonalize against v_{j-1}: w -= β_{j-1} * v_{j-1}\nlet beta_prev_scaled = T::from_real_impl(&beta_prev);\nzip!(w.rb_mut(), v_prev).for_each(|unzip!(w_i, v_prev_i)| {\n    *w_i = sub(w_i, &mul(&beta_prev_scaled, v_prev_i));\n});\n```\n\nWith the vector partially orthogonalized, we can compute the diagonal coefficient $\\alpha_j$ via an inner product. Since $\\mathbf{A}$ is Hermitian, this value is guaranteed to be real.\n\n```rust\n// 3. Compute α_j = v_j^H * w\nlet alpha = T::real_part_impl(&(v_curr.adjoint() * w.rb())[(0, 0)]);\n```\n\nThen we complete the orthogonalization against the current vector $\\mathbf{v}_j$.\n\n```rust\n// 4. Orthogonalize against v_j: w -= α_j * v_j\nlet alpha_scaled = T::from_real_impl(&alpha);\nzip!(w.rb_mut(), v_curr).for_each(|unzip!(w_i, v_curr_i)| {\n    *w_i = sub(w_i, &mul(&alpha_scaled, v_curr_i));\n});\n```\n\nThe vector `w` now holds the unnormalized next Lanczos vector. We can compute its norm to get our off-diagonal coefficient, $\\beta_j$. If this norm is numerically zero, it signals that the Krylov subspace is invariant, and the iteration must stop. This is known as breakdown.\n\n```rust\n// 5. Compute β_j = ||w||_2 and check for breakdown\nlet beta = w.rb().norm_l2();\nlet tolerance = T::Real::from_f64_impl(f64::EPSILON * 1000.0);\n\nif beta \u003C= tolerance {\n    (alpha, None)\n} else {\n    (alpha, Some(beta))\n}\n```\n\n## An Iterator for the Recurrence\n\nThe recurrence step is a pure function. If we just call it in a simple loop, it would be correct but inefficient. We need a stateful object to manage the vectors between steps, which is a classic use case for the iterator pattern. Let's create a struct, `LanczosIteration`, to encapsulate the state:\n\n```rust\nstruct LanczosIteration\u003C'a, T: ComplexField, O: LinOp\u003CT>> {\n    operator: &'a O,\n    v_prev: Mat\u003CT>,       // v_{j-1}\n    v_curr: Mat\u003CT>,       // v_j\n    work: Mat\u003CT>,         // Workspace for Av_j\n    beta_prev: T::Real,   // β_{j-1}\n    // ... iteration counters\n}\n```\n\nA key insight here is that the vectors are _owned_ (`Mat\u003CT>`), not borrowed. This allows for a critical optimization inside the `next_step` method. After computing the next vector and normalizing it into the `work` buffer, we can cycle the state for the next iteration without any memory copies.\n\n```rust\n// Inside next_step, after normalization...\n// Cycle vectors: v_prev \u003C- v_curr \u003C- work\ncore::mem::swap(&mut self.v_prev, &mut self.v_curr);\ncore::mem::swap(&mut self.v_curr, &mut self.work);\n```\n\nThese `mem::swap` calls are zero-cost. On x86-64, swapping two `Mat\u003CT>` structures (which are fat pointers) compiles to just three `mov` instructions. No data is moved. The logical flow is: `v_prev` gets `v_curr`'s data, `v_curr` gets the new vector from `work`, and `work` gets the old `v_prev`'s allocation to be reused.\n\nThis keeps a fixed working set of three n-dimensional vectors in play. The same memory gets reused, which is great for cache locality.\n\n## First Pass: Collecting the Scalars\n\nNow let's build the first pass. Its job is to run the iteration and compute the coefficients $\\{\\alpha_j, \\beta_j\\}$ while discarding the basis vectors. We can implement this pass to directly consume our `LanczosIteration`. The function signature will look like this:\n\n```rust\npub fn lanczos_pass_one\u003CT: ComplexField>(\n    operator: &impl LinOp\u003CT>,\n    b: MatRef\u003C'_, T>,\n    k: usize,\n    stack: &mut MemStack,\n) -> Result\u003CLanczosDecomposition\u003CT::Real>, LanczosError> {\n    // ...\n}\n```\n\nWe start by initializing storage for the scalars, using a capacity hint to prevent reallocations.\n\n```rust\nlet mut alphas = Vec::with_capacity(k);\nlet mut betas = Vec::with_capacity(k - 1);\n```\n\nThen, we create the iterator, which allocates its three internal work vectors. After this point, the hot path is allocation-free. The main loop just drives the iterator and collects the results.\n\n```rust\nlet mut lanczos_iter = LanczosIteration::new(operator, b, k, b_norm)?;\n\nfor i in 0..k {\n    if let Some(step) = lanczos_iter.next_step(stack) {\n        alphas.push(step.alpha);\n\n        if step.beta \u003C= tolerance { break; }\n\n        if i \u003C k - 1 {\n            betas.push(step.beta);\n        }\n    } else {\n        break;\n    }\n}\n```\n\nAt the end, we move the scalar vectors into a `LanczosDecomposition` struct. The memory high-water mark for this whole pass is constant: three n-dimensional vectors plus the two small, growing scalar arrays. This gives us the desired $O(n)$ memory complexity.\n\n## Second Pass: Reconstructing the Solution\n\nNow for the second pass. We need to take the computed coefficients and reconstruct the solution $\\mathbf{x}_k = \\sum_{j=1}^k (\\mathbf{y}_k)_j \\mathbf{v}_j$ without storing the full basis. The core of this pass is a slightly different recurrence step. Since we already have the coefficients, we don't need to compute inner products or norms.\n\n```rust\nfn lanczos_reconstruction_step\u003CT: ComplexField, O: LinOp\u003CT>>(\n    // ... same arguments as before, plus alpha_j and beta_prev\n) {\n    // Apply operator\n    operator.apply(w.rb_mut(), v_curr, Par::Seq, stack);\n\n    // Orthogonalize using the pre-computed coefficients\n    // ... (same zip! calls as before, no inner products)\n}\n```\n\nThis reconstruction is slightly cheaper than the generation step. The main function `lanczos_pass_two` orchestrates the process. Here, we initialize the same three work vectors (`v_prev`, `v_curr`, `work`) and an accumulator for the final solution, `x_k`.\n\nWe can start building the solution with the first term of the sum:\n\n```rust\n// v_curr is initialized to v_1\nlet mut x_k = &v_curr * Scale(T::copy_impl(&y_k[(0, 0)]));\n```\n\nOur main loop then regenerates each subsequent basis vector, normalizes it using the stored $\\beta_j$, and immediately accumulates its contribution to the solution.\n\n```rust\n// Inside the main loop...\n\n// 1. Regenerate the unnormalized next vector into `work`\nlanczos_reconstruction_step(...);\n\n// 2. Normalize it using the stored β_j\nlet inv_beta = T::from_real_impl(&T::Real::recip_impl(&beta_j));\nzip!(work.as_mut()).for_each(|unzip!(w_i)| {\n    *w_i = mul(w_i, &inv_beta);\n});\n\n// 3. Accumulate: x_k += y_{j+1} * v_{j+1}\nlet coeff = T::copy_impl(&y_k[(j + 1, 0)]);\nzip!(x_k.as_mut(), work.as_ref()).for_each(|unzip!(x_i, v_i)| {\n    *x_i = add(x_i, &mul(&coeff, v_i));\n});\n\n// 4. Cycle the vectors for the next iteration\ncore::mem::swap(&mut v_prev, &mut v_curr);\ncore::mem::swap(&mut v_curr, &mut work);\n```\n\nThe accumulation step `x_k += ...` uses another `zip!` loop that compiles to a fused multiply-add on hardware that supports it. We cycle the same three vectors (`v_prev`, `v_curr`, `work`), keeping the working set small and hot in the cache. This is a stark contrast to the standard method's final step, which involves a large matrix-vector product that streams through the entire $n \\times k$ basis, likely from main memory.\n\n## A Clean Public API\n\nFinally, let's wrap these low-level components in a high-level solver function to present a clean interface to the user.\n\n```rust\npub fn lanczos_two_pass\u003CT, O, F>(\n    operator: &O,\n    b: MatRef\u003C'_, T>,\n    k: usize,\n    stack: &mut MemStack,\n    mut f_tk_solver: F,\n) -> Result\u003CMat\u003CT>, LanczosError>\nwhere\n    // ... generic bounds\n    F: FnMut(&[T::Real], &[T::Real]) -> Result\u003CMat\u003CT>, anyhow::Error>,\n{\n    // First pass: compute T_k coefficients\n    let decomposition = lanczos_pass_one(operator, b, k, stack)?;\n\n    if decomposition.steps_taken == 0 {\n        return Ok(Mat::zeros(b.nrows(), 1));\n    }\n\n    // Solve projected problem: y_k' = f(T_k) * e_1\n    let y_k_prime = f_tk_solver(&decomposition.alphas, &decomposition.betas)?;\n\n    // Scale by ||b||\n    let y_k = &y_k_prime * Scale(T::from_real_impl(&decomposition.b_norm));\n\n    // Second pass: reconstruct solution\n    lanczos_pass_two(operator, b, &decomposition, y_k.as_ref(), stack)\n}\n```\n\nThe key piece of this API is the `f_tk_solver` closure. We designed it this way to decouple the Lanczos iteration from the specific matrix function $f$. We require the user to provide a solver for the small $k \\times k$ projected problem, and our main function orchestrates the two passes around it. This approach makes our implementation flexible enough to handle linear solves, matrix exponentials, or any other function without changing the core algorithm.\n\n### Example: The Solver for a Linear System\n\nLet's see what this solver closure looks like in a real-world scenario. If we want to solve a linear system $\\mathbf{Ax} = \\mathbf{b}$, we are computing the action of the inverse function, $f(z) = z^{-1}$. This means our `f_tk_solver` needs to solve the small, tridiagonal linear system $\\mathbf{T}_k \\mathbf{y}' = \\mathbf{e}_1$.\n\nSince $\\mathbf{T}_k$ is tridiagonal, we can solve this system very efficiently. A sparse LU decomposition is an excellent choice, as its complexity for a tridiagonal system is only $O(k)$. Here's how we can implement the solver:\n\n```rust\nlet f_tk_solver = |alphas: &[f64], betas: &[f64]| -> Result\u003CMat\u003Cf64>, anyhow::Error> {\n    let steps = alphas.len();\n    if steps == 0 {\n        return Ok(Mat::zeros(0, 1));\n    }\n\n    // 1. Assemble the sparse tridiagonal matrix T_k from coefficients.\n    // We use a triplet format for efficient construction.\n    let mut triplets = Vec::with_capacity(3 * steps - 2);\n    for (i, &alpha) in alphas.iter().enumerate() {\n        triplets.push(Triplet { row: i, col: i, val: alpha });\n    }\n    for (i, &beta) in betas.iter().enumerate() {\n        triplets.push(Triplet { row: i, col: i + 1, val: beta });\n        triplets.push(Triplet { row: i + 1, col: i, val: beta });\n    }\n    let t_k_sparse = SparseColMat::try_new_from_triplets(steps, steps, &triplets)?;\n\n    // 2. Create the right-hand side vector, e_1.\n    let mut e1 = Mat::zeros(steps, 1);\n    e1.as_mut()[(0, 0)] = 1.0;\n\n    // 3. Solve the system using a sparse LU factorization.\n    Ok(t_k_sparse.as_ref().sp_lu()?.solve(e1.as_ref()))\n};\n```\n\nThis closure takes the raw `alphas` and `betas` from the Lanczos process, constructs the `faer` sparse matrix, and then uses its built-in LU solver. This is the exact approach we used in our experimental binaries.\n\n# Some interesting results\n\nNow that we have a working implementation we can run some tests. The core idea of what we have done is simple: trade flops for better memory access. But does this trade actually pay off on real hardware? To find out, we need a reliable way to benchmark it.\n\nFor the data, we know that the performance of any Krylov method is tied to the operator's spectral properties. We need a way to generate a family of test problems where we can precisely control the size, sparsity, and numerical difficulty. A great way to do this is with Karush-Kuhn-Tucker (KKT) systems, which are sparse, symmetric, and have a specific block structure.\n\n$$\nA =\n\\begin{pmatrix}\n    D & E^T \\\\\n    E & 0\n\\end{pmatrix}\n$$\n\nThis structure gives us two critical knobs to turn. First, with the [netgen](https://commalab.di.unipi.it/files/Data/MCF/netgen.tgz) utility, we can control the E matrix, which lets us dial in the problem dimension, $n$. Second, we build the diagonal block D with random entries from a range $[1, C_D]$. This parameter, $C_D$, gives us direct control over the numerical difficulty of the problem.Let's look at how. For a symmetric matrix like $D$, the 2-norm condition number, $\\kappa_2(D)$, is the ratio of its largest to its smallest eigenvalue: $\\kappa_2(D) = \\lambda_{\\max}(D) / \\lambda_{\\min}(D)$. Since $D$ is diagonal, its eigenvalues are simply its diagonal entries. We are drawing these entries from a uniform distribution $U[1, C_D]$, so we have $\\lambda_{\\max}(D) \\approx C_D$ and $\\lambda_{\\min}(D) \\approx 1$. This means we get direct control: $\\kappa_2(D) \\approx C_D$.The spectral properties of this block heavily influence the spectrum of the entire matrix $A$. A large condition number in $D$ leads to a more ill-conditioned system for $A$. The convergence rate of Krylov methods like Lanczos is fundamentally governed by the distribution of the operator's eigenvalues. An ill-conditioned matrix, with a wide spread of eigenvalues, will require more iterations, $k$, to reach the desired accuracy. By simply adjusting the $C_D$ parameter, we can generate everything from well-conditioned problems that converge quickly to ill-conditioned ones that force us to run a large number of iterations. This is exactly what we need to rigorously test our implementation.\n\n## The Memory and Computation Trade-off\n\nLet's put this to the test. We'll start by fixing the problem size to a large $n=500,000$ and then vary the number of iterations, $k$. We have two clear hypotheses based on a standard complexity analysis.\n\nFirst, regarding memory, the one-pass method has a complexity of $O(nk)$ due to storing the basis $\\mathbf{V}_k$. We expect its memory usage to grow linearly with $k$. Our two-pass method, with its $O(n)$ complexity, should have a flat memory footprint.\n\nSecond, for wall-clock time, the analysis seems just as simple. The two-pass method performs twice the number of matrix-vector products, which is the most expensive operation. Therefore, we should expect it to be about twice as slow.\n\nLet's see what the data says. First, memory usage.\n\n![Memory vs Iterations](/public/assets/lanczos/tradeoff_arcs500k_rho3_memory.png)\n\nThe results confirm our memory model perfectly. The standard algorithm's memory footprint grows in a perfectly straight line, a direct consequence of storing the basis $\\mathbf{V}_k$. Our two-pass method is a flat line, using only the constant $O(n)$ memory for its small working set of vectors. No surprises here.\n\nNow for the wall-clock time. This is where the simple model starts to fall apart.\n\n![Runtime vs Iterations](/public/assets/lanczos/tradeoff_arcs500k_rho3_time.png)\n\nThe two-pass method is always slower, as expected, but the difference is nowhere near a factor of two. For a small number of iterations, the gap is very narrow, and as we increase $k$, the two-pass method's runtime starts becoming _slightly_ slower than the one-pass method.\n\nSo what's going on? This behavior is governed by the memory access patterns during the solution reconstruction phase. We can model the total execution time as the sum for matrix-vector products and vector operations. For the standard method, the final solution is computed via a single dense matrix-vector product, $\\mathbf{x}_k = \\mathbf{V}_k \\mathbf{y}_k$. When $n$ and $k$ are large, the basis matrix $\\mathbf{V}_k$ becomes too large to fit in any level of the CPU cache. Consequently, this operation becomes _memory-bandwidth-bound_: its performance is limited by the speed at which data can be streamed from main memory, leading to high latency. In contrast, the two-pass method reconstructs the solution incrementally, operating on a small working set of vectors at each step ($\\mathbf{v}_{\\text{prev}}$, $\\mathbf{v}_{\\text{curr}}$, and $\\mathbf{x}_k$).\n\nThis allows the processor's cache hierarchy to manage the data effectively and maintain a high cache-hit rate. This high data locality means the processor is constantly fed data. The cost of re-computing the basis vectors turns out to be less than the cost of the memory latency paid by the standard method.\n\nThis effect isn't just for large-scale problems. On a medium-scale instance ($n=50,000$), we find an equilibrium point where the performance is nearly identical. Here, the penalty the standard method pays for increasing cache misses almost perfectly balances the cost of the extra matrix-vector products in our two-pass implementation.\n\n![Medium Scale Runtime vs Iterations](/public/assets/lanczos/tradeoff_arcs50k_rho3_time.png)\n![Medium Scale Memory Usage vs Iterations](/public/assets/lanczos/tradeoff_arcs50k_rho3_memory.png)\n\n### The Final Proof: A Dense Matrix\n\nTo confirm our hypothesis that this is all about memory access, we can run one final test. What happens if we use a dense matrix? Here, the matrix-vector product is an $O(n^2)$ operation, making it so computationally expensive that it should dominate all other costs, including memory latency. In this compute-bound regime, our cache efficiency advantage should become negligible.\n\nWe can run an experiment with a dense random matrix of size $n=10,000$. Let's see the results.\n\n![Dense Matrix Runtime vs Iterations](/public/assets/lanczos/dense-tradeoff.png)\n\nThe runtime of the two-pass method is almost exactly twice that of the standard one. The slopes of the lines confirm it. This proves our analysis: the surprisingly strong performance of our two-pass method on sparse problems is a direct result of its superior cache efficiency. It's a textbook example of how modern hardware architecture can turn a seemingly worse algorithm into a winner.\n\n## Scalbility\n\nFinally, let's look at how our implementation scales with increasing problem size. We'll fix the number of iterations to $k=500$ and vary $n$ from $50,000$ to $500,000$.\n\n> Using netget allows us to generate a variety of problem sizes while keeping the sparsity pattern realistic.\n\nBased on what we've seen so far, we expect the two-pass method memory usage to scale linearly with $n$, but with a very small slope. The standard method should also scale linearly, but with a much steeper slope due to the $O(nk)$ memory for storing the basis. We can see that this is exactly what happens:\n\n![Scalability Memory Usage](/public/assets/lanczos/scalability_k500_rho3_memory.png)\n\n> I had to use a logarithmic scale on the y-axis in order to make visible the very small memory usage increase of the two-pass method.\n\nThe runtime scaling also scales linearly with $n$ for both methods, as expected. For dimensions that are smaller then $n=150,000$, the two algorithms have very similar performance. As we increase $n$ further, the cost of the matrix-vector products starts to dominate, and the two-pass method's runtime becomes to diverge, becoming progressively slower then the standard method.\n\n![Scalability Runtime](/public/assets/lanczos/scalability_k500_rho3_time.png)","src/data/blog/two-pass-lanczos.md","b31e35eb1a812c94",{"html":787,"metadata":788},"\u003Cp>The standard Lanczos method for computing matrix functions has a brutal memory requirement: storing an \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>×\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n \\times k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">×\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span> basis matrix that grows with every iteration. For a 500,000-variable problem needing 1,000 iterations, that’s ~4 GB just for the basis. In this post we will explore one of the most straightforward solutions to this problem: a two-pass variant of the Lanczos algorithm that only requires O(n) memory at the cost of doubling the number of matrix-vector products. The surprising part? When implemented carefully, the two-pass version isn’t just memory-efficient, it can be faster for certain problems. In this post we will try to do some algorithm engineering to understand why.\u003C/p>\n\u003Cul>\n\u003Cli>All code is available on GitHub: \u003Ca href=\"https://github.com/lukefleed/two-pass-lanczos\">two-pass-lanczos\u003C/a>\u003C/li>\n\u003Cli>The full technical report with proofs and additional experiments: \u003Ca href=\"/two-pass-lanczos/tex/report.pdf\">report.pdf\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Chr>\n\u003Ch1 id=\"computing-matrix-functions\">Computing Matrix Functions\u003C/h1>\n\u003Cp>Let’s consider the problem of computing the action of matrix functions on a vector:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x} = f(\\mathbf{A})\\mathbf{b}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4444em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>where \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span> is a large sparse Hermitian matrix and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003C/span>\u003C/span>\u003C/span> is a matrix function defined on the spectrum of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span>. This is a problem that appears pretty often in scientific computing: solving linear systems corresponds to \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>z\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmsup>\u003Cmi>z\u003C/mi>\u003Cmrow>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(z) = z^{-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8141em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, exponential integrators for PDEs use \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>z\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmi>exp\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>t\u003C/mi>\u003Cmi>z\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(z) = \\exp(tz)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mop\">exp\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">t\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, and many other problems require functions like \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>z\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmsup>\u003Cmi>z\u003C/mi>\u003Cmrow>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmi mathvariant=\"normal\">/\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/mrow>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(z) = z^{-1/2}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.888em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.888em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1/2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> or \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>z\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmtext>sign\u003C/mtext>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>z\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(z) = \\text{sign}(z)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord text\">\u003Cspan class=\"mord\">sign\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cp>Indeed, there are a lot problems with computing \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(\\mathbf{A})\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> directly. First of all, even if \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span> is sparse, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(\\mathbf{A})\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> is generally dense. Storing it explicitly is out of the question for large problems. Even if we could store it, computing it directly would require algorithms like the Schur-Parlett method that scale as \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsup>\u003Cmi>n\u003C/mi>\u003Cmn>3\u003C/mn>\u003C/msup>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n^3)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">3\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, which is impractical for large \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cp>However we know that given any matrix function \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003C/span>\u003C/span>\u003C/span> defined on the spectrum of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span>, we can express \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(\\mathbf{A})\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> as a polynomial in \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span> of degree at most \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span> (the size of the matrix) such that \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi>p\u003C/mi>\u003Cmi>n\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(\\mathbf{A}) = p_{n}(\\mathbf{A})\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">p\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1514em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> (this is a consequence of the Cayley-Hamilton theorem). This polynomial interpolates \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003C/span>\u003C/span>\u003C/span> and its derivatives in the Hermitian sense at the eigenvalues of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cp>This gives a good and a bad news: the good news is that, well, we can express \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(\\mathbf{A})\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> as a polynomial in \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span>. The bad news is that the degree of this polynomial can be as high as \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span>, which is huge for large problems. The idea is then to find a low-degree polynomial approximation to \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003C/span>\u003C/span>\u003C/span> that is “good enough” for our purposes. If we can find a polynomial \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>p\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">p_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">p\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> of degree \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>≪\u003C/mo>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k \\ll n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">≪\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span> such that \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>p\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>≈\u003C/mo>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">p_k(\\mathbf{A}) \\approx f(\\mathbf{A})\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">p\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">≈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, then we can approximate the solution as:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmo>≈\u003C/mo>\u003Cmsub>\u003Cmi>p\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmunderover>\u003Cmo>∑\u003C/mo>\u003Cmrow>\u003Cmi>i\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>0\u003C/mn>\u003C/mrow>\u003Cmi>k\u003C/mi>\u003C/munderover>\u003Cmsub>\u003Cmi>c\u003C/mi>\u003Cmi>i\u003C/mi>\u003C/msub>\u003Cmsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmi>i\u003C/mi>\u003C/msup>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(\\mathbf{A})\\mathbf{b} \\approx p_k(\\mathbf{A})\\mathbf{b} = \\sum_{i=0}^k c_i \\mathbf{A}^i \\mathbf{b}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">≈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">p\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:3.1138em;vertical-align:-1.2777em;\">\u003C/span>\u003Cspan class=\"mop op-limits\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.8361em;\">\u003Cspan style=\"top:-1.8723em;margin-left:0em;\">\u003Cspan class=\"pstrut\" style=\"height:3.05em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003Cspan class=\"mrel mtight\">=\u003C/span>\u003Cspan class=\"mord mtight\">0\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.05em;\">\u003Cspan class=\"pstrut\" style=\"height:3.05em;\">\u003C/span>\u003Cspan>\u003Cspan class=\"mop op-symbol large-op\">∑\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-4.3em;margin-left:0em;\">\u003Cspan class=\"pstrut\" style=\"height:3.05em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.2777em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">c\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8747em;\">\u003Cspan style=\"top:-3.113em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Ch2 id=\"krylov-projection\">Krylov Projection\u003C/h2>\n\u003Cp>We notice that the polynomial approximation only involves vectors that lie in the following space, called the Krylov subspace of order \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"script\">K\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmtext>span\u003C/mtext>\u003Cmo stretchy=\"false\">{\u003C/mo>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003C/mrow>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msup>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmo>…\u003C/mo>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msup>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmo stretchy=\"false\">}\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathcal{K}_k(\\mathbf{A}, \\mathbf{b}) = \\text{span}\\{\\mathbf{b}, \\mathbf{Ab}, \\mathbf{A}^2\\mathbf{b}, \\ldots, \\mathbf{A}^{k-1}\\mathbf{b}\\}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathcal\" style=\"margin-right:0.01445em;\">K\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0144em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.1491em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord text\">\u003Cspan class=\"mord\">span\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">{\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">Ab\u003C/span>\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8641em;\">\u003Cspan style=\"top:-3.113em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"minner\">…\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8991em;\">\u003Cspan style=\"top:-3.113em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mclose\">}\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>We can then search the approximate solution \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> in this subspace by just doing matrix-vector products with \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span>. This is great because it’s the only operation we can do efficiently for large sparse matrices.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Note that we don’t need to construct and keep in memory \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}^j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8247em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8247em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> for any \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>. We can just compute it iteratively as \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msup>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}(\\mathbf{A}^{j-1}\\mathbf{b})\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0747em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8247em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003C/blockquote>\n\u003Ch3 id=\"finding-a-basis\">Finding a basis\u003C/h3>\n\u003Cp>Technically, we already have a basis for this space. The raw vectors \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmo stretchy=\"false\">{\u003C/mo>\u003Cmsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msup>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmo stretchy=\"false\">}\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\{\\mathbf{A}^j\\mathbf{b}\\}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0747em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mopen\">{\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8247em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mclose\">}\u003C/span>\u003C/span>\u003C/span>\u003C/span> form a basis, but it’s a terrible one for computation since they quickly become nearly parallel. We need a stable, orthonormal basis. The standard way to build one is the Arnoldi process. It’s essentially a Gram-Schmidt procedure tailored for Krylov subspaces.\u003C/p>\n\u003Cp>We start by normalizing our initial vector, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmi mathvariant=\"normal\">/\u003C/mi>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_1 = \\mathbf{b} / \\|\\mathbf{b}\\|_2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mord\">/∥\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. The process is iterative. At each step \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>, we first create a new candidate vector by applying the operator, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">w\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{w}_j = \\mathbf{A}\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">w\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9722em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. Next, we make it orthogonal to our existing basis vectors \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmo>…\u003C/mo>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_1, \\ldots, \\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"minner\">…\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> using the Gram-Schmidt procedure. This involves subtracting the projections:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmover accent=\"true\">\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmo>~\u003C/mo>\u003C/mover>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">w\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>−\u003C/mo>\u003Cmunderover>\u003Cmo>∑\u003C/mo>\u003Cmrow>\u003Cmi>i\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003Cmi>j\u003C/mi>\u003C/munderover>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsubsup>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>i\u003C/mi>\u003Cmi>H\u003C/mi>\u003C/msubsup>\u003Cmsub>\u003Cmi mathvariant=\"bold\">w\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>i\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\tilde{\\mathbf{v}}_j = \\mathbf{w}_j - \\sum_{i=1}^j (\\mathbf{v}_i^H \\mathbf{w}_j) \\mathbf{v}_i\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9674em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord accent\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.6813em;\">\u003Cspan style=\"top:-3em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.3634em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"accent-body\" style=\"left:-0.2222em;\">\u003Cspan class=\"mord\">~\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8694em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">w\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:3.1364em;vertical-align:-1.2777em;\">\u003C/span>\u003Cspan class=\"mop op-limits\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.8588em;\">\u003Cspan style=\"top:-1.8723em;margin-left:0em;\">\u003Cspan class=\"pstrut\" style=\"height:3.05em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003Cspan class=\"mrel mtight\">=\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.05em;\">\u003Cspan class=\"pstrut\" style=\"height:3.05em;\">\u003C/span>\u003Cspan>\u003Cspan class=\"mop op-symbol large-op\">∑\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-4.3471em;margin-left:0em;\">\u003Cspan class=\"pstrut\" style=\"height:3.05em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.2777em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8913em;\">\u003Cspan style=\"top:-2.453em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.113em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.247em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">w\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>The coefficients we compute here, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>h\u003C/mi>\u003Cmrow>\u003Cmi>i\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsubsup>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>i\u003C/mi>\u003Cmi>H\u003C/mi>\u003C/msubsup>\u003Cmsub>\u003Cmi mathvariant=\"bold\">w\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsubsup>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>i\u003C/mi>\u003Cmi>H\u003C/mi>\u003C/msubsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">h_{ij} = \\mathbf{v}_i^H \\mathbf{w}_j = \\mathbf{v}_i^H \\mathbf{A} \\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">h\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">ij\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.1274em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8413em;\">\u003Cspan style=\"top:-2.4413em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2587em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">w\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.1274em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8413em;\">\u003Cspan style=\"top:-2.4413em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2587em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, become the entries of our projected matrix. Finally, we normalize the new vector to get the next basis vector, where \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>h\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmsub>\u003Cmover accent=\"true\">\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmo>~\u003C/mo>\u003C/mover>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">h_{j+1, j} = \\|\\tilde{\\mathbf{v}}_j\\|_2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">h\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003Cspan class=\"mpunct mtight\">,\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord accent\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.6813em;\">\u003Cspan style=\"top:-3em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.3634em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"accent-body\" style=\"left:-0.2222em;\">\u003Cspan class=\"mord\">~\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmover accent=\"true\">\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmo>~\u003C/mo>\u003C/mover>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmi mathvariant=\"normal\">/\u003C/mi>\u003Cmsub>\u003Cmi>h\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_{j+1} = \\tilde{\\mathbf{v}}_j / h_{j+1, j}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord accent\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.6813em;\">\u003Cspan style=\"top:-3em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.3634em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"accent-body\" style=\"left:-0.2222em;\">\u003Cspan class=\"mord\">~\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">/\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">h\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003Cspan class=\"mpunct mtight\">,\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cp>After \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span> steps, we end up with\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>∈\u003C/mo>\u003Cmsup>\u003Cmi mathvariant=\"double-struck\">C\u003C/mi>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>×\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003C/msup>\u003Cmo>=\u003C/mo>\u003Cmo stretchy=\"false\">[\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmo>…\u003C/mo>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">]\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{V}_k \\in \\mathbb{C}^{n \\times k} = [\\mathbf{v}_1, \\ldots, \\mathbf{v}_k]\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">∈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8491em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbb\">C\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8491em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">n\u003C/span>\u003Cspan class=\"mbin mtight\">×\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mopen\">[\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"minner\">…\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">]\u003C/span>\u003C/span>\u003C/span>\u003C/span>, an orthonormal basis for \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"script\">K\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathcal{K}_k(\\mathbf{A}, \\mathbf{b})\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathcal\" style=\"margin-right:0.01445em;\">K\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0144em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/li>\n\u003Cli>\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">H\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>∈\u003C/mo>\u003Cmsup>\u003Cmi mathvariant=\"double-struck\">C\u003C/mi>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>×\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{H}_k \\in \\mathbb{C}^{k \\times k}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">H\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">∈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8491em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbb\">C\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8491em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mbin mtight\">×\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, an upper Hessenberg matrix with entries \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>h\u003C/mi>\u003Cmrow>\u003Cmi>i\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">h_{ij}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">h\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">ij\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. This matrix represents the projection of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span> onto the Krylov subspace.\u003C/li>\n\u003C/ul>\n\u003Cblockquote>\n\u003Cp>Why \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">H\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{H}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">H\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> is upper Hessenberg? Because in the Arnoldi process, each new vector \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_{j+1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> is orthogonalized against all previous vectors \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmo>…\u003C/mo>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_1, \\ldots, \\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"minner\">…\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. This means that when we compute the projections \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsubsup>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>i\u003C/mi>\u003Cmi>H\u003C/mi>\u003C/msubsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_i^H \\mathbf{A} \\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.1274em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8413em;\">\u003Cspan style=\"top:-2.4413em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\">i\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2587em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, only the first \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">j+1\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span> basis vectors contribute to the new vector. Therefore, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>h\u003C/mi>\u003Cmrow>\u003Cmi>i\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmn>0\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">h_{ij} = 0\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">h\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">ij\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">0\u003C/span>\u003C/span>\u003C/span>\u003C/span> for all \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>i\u003C/mi>\u003Cmo>>\u003C/mo>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">i > j + 1\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6986em;vertical-align:-0.0391em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">i\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>, resulting in an upper Hessenberg structure.\u003C/p>\n\u003C/blockquote>\n\u003Cp>We can summarize the whole process with the matrix formulation known as the Arnoldi decomposition:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">H\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>+\u003C/mo>\u003Cmsub>\u003Cmi>h\u003C/mi>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmsubsup>\u003Cmi mathvariant=\"bold\">e\u003C/mi>\u003Cmi>k\u003C/mi>\u003Cmi>T\u003C/mi>\u003C/msubsup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\\mathbf{V}_k = \\mathbf{V}_k \\mathbf{H}_k + h_{k+1,k} \\mathbf{v}_{k+1} \\mathbf{e}_k^T\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">H\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.1774em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">h\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003Cspan class=\"mpunct mtight\">,\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2083em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">e\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8913em;\">\u003Cspan style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.113em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.247em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>How do we use this to approximate our original problem? Well it depends on what we consider a “good” approximation. For this blog post we’ll just consider Full Orthogonal Method (FOM), which enforce that the residual \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">r\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{r}_k = f(\\mathbf{A})\\mathbf{b} - \\mathbf{x}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">r\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> is orthogonal to the Krylov subspace. Therefore, we can express the approximate solution as:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x}_k = \\mathbf{V}_k \\mathbf{y}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8805em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>where \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{y}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> is a small \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>-dimensional vector that we need to compute as\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">H\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">e\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{y}_k = f(\\mathbf{H}_k) \\mathbf{e}_1 \\|\\mathbf{b}\\|_2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">H\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">e\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cblockquote>\n\u003Cp>The term \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">e\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{e}_1 \\|\\mathbf{b}\\|_2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">e\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> comes from the fact that our initial vector \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_1\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> is \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{b}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003C/span>\u003C/span>\u003C/span> normalized. In the Krylov subspace, this corresponds to the first basis vector scaled by the norm of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{b}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003C/span>\u003C/span>\u003C/span>. This is just the projection of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{b}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003C/span>\u003C/span>\u003C/span> onto the Krylov subspace.\u003C/p>\n\u003C/blockquote>\n\u003Cp>This problems is now reduced to computing \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">H\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(\\mathbf{H}_k)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">H\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, which is a small \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>×\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k \\times k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">×\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span> matrix. This is relatively cheap since \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>≪\u003C/mo>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k \\ll n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">≪\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span> and we can use direct methods like the Schur-Parlett method that require \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsup>\u003Cmi>k\u003C/mi>\u003Cmn>3\u003C/mn>\u003C/msup>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(k^3)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">3\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> operations.\u003C/p>\n\u003Cblockquote>\n\u003Cp>If we choose \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>z\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmsup>\u003Cmi>z\u003C/mi>\u003Cmrow>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(z) = z^{-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8141em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, then is reduces to solving the linear system \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">H\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">e\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{H}_k \\mathbf{y}_k = \\mathbf{e}_1 \\|\\mathbf{b}\\|_2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8805em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">H\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">e\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, which can be done efficiently with direct methods like LU decomposition.\u003C/p>\n\u003C/blockquote>\n\u003C!--\nIf we left-multiply by $\\mathbf{V}_k^H$, we see that $\\mathbf{H}_k = \\mathbf{V}_k^H \\mathbf{A} \\mathbf{V}_k$. This is the key: $\\mathbf{H}_k$ is the projection of the huge operator $\\mathbf{A}$ onto our small Krylov subspace. We can now approximate our original problem by solving it in this small space:\n\n$$\n\\mathbf{x}_k = \\|\\mathbf{b}\\|_2 \\mathbf{V}_k f(\\mathbf{H}_k) \\mathbf{e}_1\n$$\n\nThis is a huge win. We've turned a problem of dimension $n$ into one of dimension $k$, which is cheap to solve.\n\nBut we can do even better. Our problem states that $\\mathbf{A}$ is Hermitian. This imposes a special structure on the projection. Since $\\mathbf{A} = \\mathbf{A}^H$, the projection $\\mathbf{H}_k$ must also be Hermitian. A matrix that is both upper Hessenberg and Hermitian has to be real, symmetric, and tridiagonal. This simplification is what turns the general Arnoldi process into the much more efficient symmetric Lanczos process. -->\n\u003Ch1 id=\"lanczos-iterations\">Lanczos Iterations\u003C/h1>\n\u003Cp>At the beginning of this post we said that \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span> is Hermitian. This means that, in the real case, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span> is symmetric: \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmi>T\u003C/mi>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A} = \\mathbf{A}^T\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8413em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8413em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. In the complex case, it means \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmi>H\u003C/mi>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A} = \\mathbf{A}^H\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8413em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8413em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, where \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmi>H\u003C/mi>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}^H\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8413em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8413em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> is the conjugate transpose. This special property has huge implications for the Krylov projection.\u003C/p>\n\u003Cp>We can prove that \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">H\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsubsup>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003Cmi>H\u003C/mi>\u003C/msubsup>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{H}_k = \\mathbf{V}_k^H \\mathbf{A} \\mathbf{V}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">H\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.1244em;vertical-align:-0.2831em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8413em;\">\u003Cspan style=\"top:-2.4169em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2831em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. This means that if \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span> is Hermitian, then \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">H\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{H}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">H\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> must also be Hermitian. A matrix that is both upper Hessenberg and Hermitian has to be real, symmetric, and tridiagonal.\u003C/p>\n\u003Cp>In the literature we refer to this projected matrix as \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{T}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> instead of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">H\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{H}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">H\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> to highlight its special tridiagonal structure. Where \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>∈\u003C/mo>\u003Cmi mathvariant=\"double-struck\">R\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\alpha_j \\in \\mathbb{R}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8252em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">∈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6889em;\">\u003C/span>\u003Cspan class=\"mord mathbb\">R\u003C/span>\u003C/span>\u003C/span>\u003C/span> (reals since \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>h\u003C/mi>\u003Cmrow>\u003Cmi>i\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmover accent=\"true\">\u003Cmsub>\u003Cmi>h\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmi>i\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo stretchy=\"true\">‾\u003C/mo>\u003C/mover>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">h_{ij} = \\overline{h_{ji}}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">h\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">ij\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.1805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord overline\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8944em;\">\u003Cspan style=\"top:-3em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">h\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">ji\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.8144em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"overline-line\" style=\"border-bottom-width:0.04em;\">\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>) are the diagonal elements and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi>h\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo>∈\u003C/mo>\u003Cmi mathvariant=\"double-struck\">R\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\beta_j = h_{j+1,j} \\in \\mathbb{R}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">h\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003Cspan class=\"mpunct mtight\">,\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">∈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6889em;\">\u003C/span>\u003Cspan class=\"mord mathbb\">R\u003C/span>\u003C/span>\u003C/span>\u003C/span> are the off-diagonal elements.\u003C/p>\n\u003Cp>Let’s re-write the Arnoldi decomposition for this case:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>+\u003C/mo>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmsubsup>\u003Cmi mathvariant=\"bold\">e\u003C/mi>\u003Cmi>k\u003C/mi>\u003Cmi>T\u003C/mi>\u003C/msubsup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\\mathbf{V}_k = \\mathbf{V}_k \\mathbf{T}_k + \\beta_k \\mathbf{v}_{k+1} \\mathbf{e}_k^T\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.1383em;vertical-align:-0.247em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2083em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">e\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8913em;\">\u003Cspan style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.113em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.247em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>We can extract the \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>-th column from this matrix equation. On the left, we have \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9722em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. On the right, we need the \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>-th column of the whole expression. The second term, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmsubsup>\u003Cmi mathvariant=\"bold\">e\u003C/mi>\u003Cmi>k\u003C/mi>\u003Cmi>T\u003C/mi>\u003C/msubsup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\beta_k \\mathbf{v}_{k+1} \\mathbf{e}_k^T\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.1244em;vertical-align:-0.2831em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2083em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">e\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8413em;\">\u003Cspan style=\"top:-2.4169em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2831em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, only affects the final column (\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">j=k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>), so for now let’s assume \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>&#x3C;\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">j &#x3C; k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">&#x3C;\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>. For the right-end-side for the equation we can exploit the tridiagonal structure of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{T}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> to simplify the expression:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">e\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmo>+\u003C/mo>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>+\u003C/mo>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{V}_k (\\mathbf{T}_k \\mathbf{e}_j) = \\beta_{j-1} \\mathbf{v}_{j-1} + \\alpha_j \\mathbf{v}_j + \\beta_j \\mathbf{v}_{j+1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">e\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8694em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>Thus, we get the famous \u003Cstrong>Lanczos three-term recurrence\u003C/strong>:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmo>+\u003C/mo>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>+\u003C/mo>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\\mathbf{v}_j = \\beta_{j-1}\\mathbf{v}_{j-1} + \\alpha_j \\mathbf{v}_j + \\beta_j \\mathbf{v}_{j+1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9722em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8694em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>The crucial detail to notice here is that to generate the next basis vector \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_{j+1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, we only need the two previous vectors, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_{j-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. We don’t need to orthogonalize against the entire history of the basis, because the Hermitian nature of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span> guarantees that the new vector is already orthogonal to all vectors \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmo>…\u003C/mo>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>2\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_1, \\ldots, \\mathbf{v}_{j-2}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"minner\">…\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cp>So as before, we can determine the coefficients directly from this recurrence. By rearranging it, we get an expression for the unnormalized next vector:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>w\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">w_{j+1} = \\mathbf{A}\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9722em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>Then we compute the first component along \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">v_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsubsup>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003Cmi>H\u003C/mi>\u003C/msubsup>\u003Cmsub>\u003Cmi>w\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\alpha_j = \\mathbf{v}_j^H w_{j+1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.2744em;vertical-align:-0.3831em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8913em;\">\u003Cspan style=\"top:-2.453em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.113em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3831em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>This will be the diagonal element of the matrix. Now we subtract the component along \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">v_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">v_{j-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> (that we know from the previous step):\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmover accent=\"true\">\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmo>~\u003C/mo>\u003C/mover>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi>w\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmo>−\u003C/mo>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>−\u003C/mo>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\tilde{\\mathbf{v}}_{j+1} = w_{j+1} - \\alpha_j \\mathbf{v}_j - \\beta_{j-1}\\mathbf{v}_{j-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9674em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord accent\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.6813em;\">\u003Cspan style=\"top:-3em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.3634em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"accent-body\" style=\"left:-0.2222em;\">\u003Cspan class=\"mord\">~\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8694em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8694em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>This vector is orthogonal to both \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_{j-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> for construction, and the tridiagonal property guarantees it’s orthogonal to all previous vectors. Finally, we normalize it to get the next basis vector:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmsub>\u003Cmover accent=\"true\">\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmo>~\u003C/mo>\u003C/mover>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003Cmspace width=\"2em\">\u003C/mspace>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmfrac>\u003Cmsub>\u003Cmover accent=\"true\">\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmo>~\u003C/mo>\u003C/mover>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mfrac>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\beta_j = \\|\\tilde{\\mathbf{v}}_{j+1}\\|_2 \\qquad \\mathbf{v}_{j+1} = \\frac{\\tilde{\\mathbf{v}}_{j+1}}{\\beta_j}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord accent\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.6813em;\">\u003Cspan style=\"top:-3em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.3634em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"accent-body\" style=\"left:-0.2222em;\">\u003Cspan class=\"mord\">~\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:2em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:2.3304em;vertical-align:-0.9721em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mopen nulldelimiter\">\u003C/span>\u003Cspan class=\"mfrac\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.3583em;\">\u003Cspan style=\"top:-2.314em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.23em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\">\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.677em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">\u003Cspan class=\"mord accent\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.6813em;\">\u003Cspan style=\"top:-3em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.3634em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"accent-body\" style=\"left:-0.2222em;\">\u003Cspan class=\"mord\">~\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.9721em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose nulldelimiter\">\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Ch2 id=\"the-memory-bottleneck\">The Memory Bottleneck\u003C/h2>\n\u003Cp>After \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span> iterations of this process, we end up with as before with two matrices: \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>∈\u003C/mo>\u003Cmsup>\u003Cmi mathvariant=\"double-struck\">C\u003C/mi>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>×\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{V}_k \\in \\mathbb{C}^{n \\times k}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">∈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8491em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbb\">C\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8491em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">n\u003C/span>\u003Cspan class=\"mbin mtight\">×\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and the tridiagonal matrix \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>∈\u003C/mo>\u003Cmsup>\u003Cmi mathvariant=\"double-struck\">R\u003C/mi>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>×\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{T}_k \\in \\mathbb{R}^{k \\times k}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">∈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8491em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbb\">R\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8491em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mbin mtight\">×\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. The approximate solution is still given by:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmunderover>\u003Cmo>∑\u003C/mo>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003Cmi>k\u003C/mi>\u003C/munderover>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x}_k = \\mathbf{V}_k \\mathbf{y}_k = \\sum_{j=1}^k (\\mathbf{y}_k)_j \\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8805em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:3.2499em;vertical-align:-1.4138em;\">\u003C/span>\u003Cspan class=\"mop op-limits\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.8361em;\">\u003Cspan style=\"top:-1.8723em;margin-left:0em;\">\u003Cspan class=\"pstrut\" style=\"height:3.05em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mrel mtight\">=\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.05em;\">\u003Cspan class=\"pstrut\" style=\"height:3.05em;\">\u003C/span>\u003Cspan>\u003Cspan class=\"mop op-symbol large-op\">∑\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-4.3em;margin-left:0em;\">\u003Cspan class=\"pstrut\" style=\"height:3.05em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.4138em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>where\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">e\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{y}_k = f(\\mathbf{T}_k) \\mathbf{e}_1 \\|\\mathbf{b}\\|_2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">e\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>This sum requires that all basis vectors \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> are stored in memory. There is a clear timing problem here: the coefficients \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{y}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> depends on the full \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{T}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, which only becomes available after \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span> iterations. Therefore, we cannot accumulate the solution \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> as we go. We have to wait until the end, when all basis vectors are already computed and stored.\u003C/p>\n\u003Cp>The memory complexity is \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmi>k\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(nk)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">nk\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, which can be prohibitive for large \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span> and moderate \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>. For example, with \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>500\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmn>000\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n = 500,000\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">500\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">000\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmn>000\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k = 1,000\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">000\u003C/span>\u003C/span>\u003C/span>\u003C/span>, storing \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{V}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> alone requires about 4 GB of memory (assuming double-precision complex numbers). This can be a serious limitation in practice, this is why there is a lot of interest in reducing the memory footprint of Krylov methods.\u003C/p>\n\u003Cp>Let’s see how we can do better in terms of memory usage.\u003C/p>\n\u003Ch1 id=\"two-pass-algorithm\">Two-Pass Algorithm\u003C/h1>\n\u003Cp>To avoid storing the full basis \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{V}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, we can divide the Lanczos process into two separate passes over the data. The idea is to first run the Lanczos iterations to compute and store only the tridiagonal matrix \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{T}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> (i.e., the scalars \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\alpha_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\beta_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>), and then in a second pass, regenerate the basis vectors \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> one at a time to accumulate the final solution \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cp>This takes the memory complexity down to \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, since at any point in time we only need to keep a few vectors in memory. However, it comes at the cost of doubling the number of matrix-vector products with \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span>, since we need to apply \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span> once in each pass.\u003C/p>\n\u003Ch2 id=\"first-pass\">First pass\u003C/h2>\n\u003Cp>We begin with \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmn>0\u003C/mn>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmn>0\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\beta_0 = 0\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">0\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">0\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmn>0\u003C/mn>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmn mathvariant=\"bold\">0\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_0 = \\mathbf{0}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">0\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">0\u003C/span>\u003C/span>\u003C/span>\u003C/span>. As before, we initialize \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmi mathvariant=\"normal\">/\u003C/mi>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_1 = \\mathbf{b} / \\|\\mathbf{b}\\|_2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mord\">/∥\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. The Lanczos recurrence proceeds as usual for \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span> steps, computing the scalars \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\alpha_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\beta_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> at each iteration. However, instead of storing the basis vectors \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, we discard them after use. This means that at any point in time, we only need to keep in memory the two most recent basis vectors, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_{j-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, along with a work vector for the matrix-vector product.\u003C/p>\n\u003Cp>At the end of the first pass, we have the tridiagonal matrix \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{T}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> defined by the stored scalars \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmo stretchy=\"false\">{\u003C/mo>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">}\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\{\\alpha_j, \\beta_j\\}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mopen\">{\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">}\u003C/span>\u003C/span>\u003C/span>\u003C/span>. We can then compute the small problem:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">e\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"normal\">∥\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{y}_k = f(\\mathbf{T}_k) \\mathbf{e}_1 \\|\\mathbf{b}\\|_2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">e\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">∥\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Ch2 id=\"second-pass\">Second pass\u003C/h2>\n\u003Cp>With the coefficients \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{y}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> computed, we proceed to the second pass. Here, we regenerate the basis vectors \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> one at a time using the stored scalars \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmo stretchy=\"false\">{\u003C/mo>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">}\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\{\\alpha_j, \\beta_j\\}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mopen\">{\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">}\u003C/span>\u003C/span>\u003C/span>\u003C/span> and the Lanczos recurrence relation that we derived earlier. While regenerating each basis vector, we immediately accumulate its contribution to the solution \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>:\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>←\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>+\u003C/mo>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x}_k \\gets \\mathbf{x}_k + (\\mathbf{y}_k)_j \\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">←\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7333em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">+\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>Then, we discard \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and move on to the next one. This way, we never need to store the full basis in memory. There are two important details to note:\u003C/p>\n\u003Cul>\n\u003Cli>The basis vectors are generated in the same order as in the first pass, since floating-point arithmetic is deterministic, this ensures that the basis is bitwise identical to the one that would have been computed in a single pass.\u003C/li>\n\u003Cli>The solution, however, will change slightly due to the different order of operations in floating-point arithmetic. In the standard Lanczos, the solution is built as matrix-vector product \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{V}_k \\mathbf{y}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8805em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, while in the two-pass method, it’s built as a sum of scaled vectors. This is compiles to two different BLAS calls (\u003Ccode>gemv\u003C/code> vs \u003Ccode>axpy\u003C/code>), which have different rounding errors. However, in practice, the difference is in the order of machine epsilon and doesn’t affect convergence.\u003C/li>\n\u003C/ul>\n\u003Cp>Of course. Here is the content as a Markdown snippet.\u003C/p>\n\u003Ch1 id=\"implementation\">Implementation\u003C/h1>\n\u003Cp>Let’s build this in Rust. The performance of the two-pass algorithm depends entirely on controlling memory access patterns, and Rust’s ownership model and zero-cost abstractions give us the tools to reason about where data lives and how it moves through the cache hierarchy.\u003C/p>\n\u003Cp>For the linear algebra primitives, we’ll use \u003Ca href=\"https://github.com/sarah-ek/faer-rs\">\u003Ccode>faer\u003C/code>\u003C/a>, a modern pure-Rust numerical library. Three features are particularly important for what we’re about to build:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Stack allocation:\u003C/strong> \u003Ccode>MemStack\u003C/code> provides a pre-allocated scratch buffer that we can reuse, making the hot path of the algorithm allocation-free.\u003C/li>\n\u003Cli>\u003Cstrong>Matrix-free operators:\u003C/strong> The \u003Ccode>LinOp\u003C/code> trait lets us define operators by their action (\u003Ccode>apply\u003C/code>) without needing to materialize a matrix. This is essential for large-scale problems.\u003C/li>\n\u003Cli>\u003Cstrong>SIMD-optimized kernels:\u003C/strong> The \u003Ccode>zip!\u003C/code> macro generates vectorized loops that compile down to packed SIMD instructions for core vector operations.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"building-the-core-recurrence\">Building the Core Recurrence\u003C/h2>\n\u003Cp>The foundation of our algorithm is the Lanczos three-term recurrence:\u003C/p>\n\u003Cp>\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>+\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>−\u003C/mo>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo>−\u003C/mo>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\beta_j \\mathbf{v}_{j+1} = \\mathbf{A}\\mathbf{v}_j - \\alpha_j \\mathbf{v}_j - \\beta_{j-1}\\mathbf{v}_{j-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">+\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9722em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8694em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/p>\n\u003Cp>Let’s start by translating this directly into a Rust function. The signature should look something like this:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> lanczos_recurrence_step\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> ComplexField\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">O\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> LinOp\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>>(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    operator\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">O\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> MatMut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    v_curr\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> MatRef\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    v_prev\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> MatRef\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    beta_prev\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Real\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    stack\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> MemStack\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Real\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Option\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Real\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This way, the function is generic over the field type \u003Ccode>T\u003C/code> (\u003Ccode>f64\u003C/code>, \u003Ccode>c64\u003C/code>, etc.) and the operator type \u003Ccode>O\u003C/code>. It operates on \u003Ccode>faer\u003C/code>’s matrix views (\u003Ccode>MatMut\u003C/code> and \u003Ccode>MatRef\u003C/code>) to avoid unnecessary data copies. The return type \u003Ccode>(T::Real, Option&#x3C;T::Real>)\u003C/code> gives us the diagonal element \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\alpha_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and, if the process hasn’t broken down, the off-diagonal \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\beta_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cp>Now let’s implement the body by following the math step-by-step. First, we handle the operator application, which is the most computationally expensive part:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 1. Apply operator: w = A * v_curr\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">operator\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">apply\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">rb_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(), \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_curr\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Par\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Seq\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">stack\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Next, we orthogonalize against the previous vector \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_{j-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mbin mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. This is a perfect use case for \u003Ccode>faer\u003C/code>’s \u003Ccode>zip!\u003C/code> macro, which the compiler can turn into efficient SIMD instructions.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 2. Orthogonalize against v_{j-1}: w -= β_{j-1} * v_{j-1}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> beta_prev_scaled\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">from_real_impl\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">beta_prev\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">zip!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">rb_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(), \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_prev\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">for_each\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unzip!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_prev_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w_i\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sub\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mul\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">beta_prev_scaled\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_prev_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>With the vector partially orthogonalized, we can compute the diagonal coefficient \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\alpha_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> via an inner product. Since \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{A}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span> is Hermitian, this value is guaranteed to be real.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 3. Compute α_j = v_j^H * w\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> alpha\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">real_part_impl\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_curr\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">adjoint\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">rb\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">())[(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)]);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Then we complete the orthogonalization against the current vector \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 4. Orthogonalize against v_j: w -= α_j * v_j\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> alpha_scaled\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">from_real_impl\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">alpha\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">zip!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">rb_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(), \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_curr\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">for_each\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unzip!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_curr_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w_i\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sub\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mul\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">alpha_scaled\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_curr_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The vector \u003Ccode>w\u003C/code> now holds the unnormalized next Lanczos vector. We can compute its norm to get our off-diagonal coefficient, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\beta_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. If this norm is numerically zero, it signals that the Krylov subspace is invariant, and the iteration must stop. This is known as breakdown.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 5. Compute β_j = ||w||_2 and check for breakdown\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> beta\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">rb\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">norm_l2\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> tolerance\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Real\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">from_f64_impl\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(f64\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#82AAFF\">EPSILON\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1000\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#F78C6C\">.\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> beta\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> tolerance\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">alpha\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">None\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">} \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">else\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">alpha\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Some\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">beta\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"an-iterator-for-the-recurrence\">An Iterator for the Recurrence\u003C/h2>\n\u003Cp>The recurrence step is a pure function. If we just call it in a simple loop, it would be correct but inefficient. We need a stateful object to manage the vectors between steps, which is a classic use case for the iterator pattern. Let’s create a struct, \u003Ccode>LanczosIteration\u003C/code>, to encapsulate the state:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">struct\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> LanczosIteration\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">a\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> ComplexField\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">O\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> LinOp\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    operator\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">a\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> O\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    v_prev\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Mat\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,       \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// v_{j-1}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    v_curr\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Mat\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,       \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// v_j\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    work\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Mat\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,         \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Workspace for Av_j\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    beta_prev\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Real\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,   \u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// β_{j-1}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ... iteration counters\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>A key insight here is that the vectors are \u003Cem>owned\u003C/em> (\u003Ccode>Mat&#x3C;T>\u003C/code>), not borrowed. This allows for a critical optimization inside the \u003Ccode>next_step\u003C/code> method. After computing the next vector and normalizing it into the \u003Ccode>work\u003C/code> buffer, we can cycle the state for the next iteration without any memory copies.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Inside next_step, after normalization...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Cycle vectors: v_prev &#x3C;- v_curr &#x3C;- work\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">core\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mem\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">swap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v_prev, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v_curr);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">core\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mem\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">swap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">v_curr, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> self\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">work);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>These \u003Ccode>mem::swap\u003C/code> calls are zero-cost. On x86-64, swapping two \u003Ccode>Mat&#x3C;T>\u003C/code> structures (which are fat pointers) compiles to just three \u003Ccode>mov\u003C/code> instructions. No data is moved. The logical flow is: \u003Ccode>v_prev\u003C/code> gets \u003Ccode>v_curr\u003C/code>’s data, \u003Ccode>v_curr\u003C/code> gets the new vector from \u003Ccode>work\u003C/code>, and \u003Ccode>work\u003C/code> gets the old \u003Ccode>v_prev\u003C/code>’s allocation to be reused.\u003C/p>\n\u003Cp>This keeps a fixed working set of three n-dimensional vectors in play. The same memory gets reused, which is great for cache locality.\u003C/p>\n\u003Ch2 id=\"first-pass-collecting-the-scalars\">First Pass: Collecting the Scalars\u003C/h2>\n\u003Cp>Now let’s build the first pass. Its job is to run the iteration and compute the coefficients \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmo stretchy=\"false\">{\u003C/mo>\u003Cmsub>\u003Cmi>α\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">}\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\{\\alpha_j, \\beta_j\\}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mopen\">{\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">}\u003C/span>\u003C/span>\u003C/span>\u003C/span> while discarding the basis vectors. We can implement this pass to directly consume our \u003Ccode>LanczosIteration\u003C/code>. The function signature will look like this:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> lanczos_pass_one\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> ComplexField\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    operator\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">impl\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> LinOp\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> MatRef\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    k\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    stack\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> MemStack\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Result\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">LanczosDecomposition\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Real\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">LanczosError\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>We start by initializing storage for the scalars, using a capacity hint to prevent reallocations.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> alphas\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Vec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">with_capacity\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">k\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> betas\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Vec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">with_capacity\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">k\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Then, we create the iterator, which allocates its three internal work vectors. After this point, the hot path is allocation-free. The main loop just drives the iterator and collects the results.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> lanczos_iter\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> LanczosIteration\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">new\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">operator\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">k\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b_norm\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> in\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">..\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">k\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> let\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Some\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">step\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> lanczos_iter\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">next_step\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">stack\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        alphas\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">step\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">alpha);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">beta \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> tolerance\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">break\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> k\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">            betas\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">step\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">beta);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">else\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        break\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>At the end, we move the scalar vectors into a \u003Ccode>LanczosDecomposition\u003C/code> struct. The memory high-water mark for this whole pass is constant: three n-dimensional vectors plus the two small, growing scalar arrays. This gives us the desired \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> memory complexity.\u003C/p>\n\u003Ch2 id=\"second-pass-reconstructing-the-solution\">Second Pass: Reconstructing the Solution\u003C/h2>\n\u003Cp>Now for the second pass. We need to take the computed coefficients and reconstruct the solution \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsubsup>\u003Cmo>∑\u003C/mo>\u003Cmrow>\u003Cmi>j\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003Cmi>k\u003C/mi>\u003C/msubsup>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmi>j\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x}_k = \\sum_{j=1}^k (\\mathbf{y}_k)_j \\mathbf{v}_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.4248em;vertical-align:-0.4358em;\">\u003C/span>\u003Cspan class=\"mop\">\u003Cspan class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.989em;\">\u003Cspan style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003Cspan class=\"mrel mtight\">=\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.2029em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.4358em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> without storing the full basis. The core of this pass is a slightly different recurrence step. Since we already have the coefficients, we don’t need to compute inner products or norms.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> lanczos_reconstruction_step\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> ComplexField\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">O\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> LinOp\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>>(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ... same arguments as before, plus alpha_j and beta_prev\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // Apply operator\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    operator\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">apply\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">rb_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(), \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_curr\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, Par\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Seq\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">stack\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // Orthogonalize using the pre-computed coefficients\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ... (same zip! calls as before, no inner products)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This reconstruction is slightly cheaper than the generation step. The main function \u003Ccode>lanczos_pass_two\u003C/code> orchestrates the process. Here, we initialize the same three work vectors (\u003Ccode>v_prev\u003C/code>, \u003Ccode>v_curr\u003C/code>, \u003Ccode>work\u003C/code>) and an accumulator for the final solution, \u003Ccode>x_k\u003C/code>.\u003C/p>\n\u003Cp>We can start building the solution with the first term of the sum:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// v_curr is initialized to v_1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> x_k\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_curr\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Scale\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">copy_impl\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">y_k\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)]));\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Our main loop then regenerates each subsequent basis vector, normalizes it using the stored \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>β\u003C/mi>\u003Cmi>j\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\beta_j\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3117em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, and immediately accumulates its contribution to the solution.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Inside the main loop...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 1. Regenerate the unnormalized next vector into `work`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">lanczos_reconstruction_step\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">...\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 2. Normalize it using the stored β_j\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> inv_beta\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">from_real_impl\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">Real\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">recip_impl\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">beta_j\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">zip!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">work\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">for_each\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unzip!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w_i\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> mul\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">w_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">inv_beta\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 3. Accumulate: x_k += y_{j+1} * v_{j+1}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> coeff\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">copy_impl\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">y_k\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">j\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">zip!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">x_k\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(), \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">work\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_ref\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">for_each\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unzip!\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">x_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">x_i\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> add\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">x_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mul\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">coeff\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v_i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 4. Cycle the vectors for the next iteration\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">core\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mem\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">swap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> v_prev\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> v_curr\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">core\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">mem\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">swap\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> v_curr\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> work\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The accumulation step \u003Ccode>x_k += ...\u003C/code> uses another \u003Ccode>zip!\u003C/code> loop that compiles to a fused multiply-add on hardware that supports it. We cycle the same three vectors (\u003Ccode>v_prev\u003C/code>, \u003Ccode>v_curr\u003C/code>, \u003Ccode>work\u003C/code>), keeping the working set small and hot in the cache. This is a stark contrast to the standard method’s final step, which involves a large matrix-vector product that streams through the entire \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>×\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n \\times k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">×\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span> basis, likely from main memory.\u003C/p>\n\u003Ch2 id=\"a-clean-public-api\">A Clean Public API\u003C/h2>\n\u003Cp>Finally, let’s wrap these low-level components in a high-level solver function to present a clean interface to the user.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">pub\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> fn\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> lanczos_two_pass\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">O\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">F\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    operator\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">O\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> MatRef\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;'\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">_\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    k\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> usize\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    stack\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">mut\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> MemStack\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> f_tk_solver\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> F\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Result\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Mat\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>, \u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">LanczosError\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">where\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // ... generic bounds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    F\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> FnMut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Real\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">], \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Real\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Result\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Mat\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">T\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">anyhow\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Error\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // First pass: compute T_k coefficients\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> decomposition\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> lanczos_pass_one\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">operator\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">k\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">stack\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> decomposition\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">steps_taken \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Mat\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">zeros\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">nrows\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(), \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // Solve projected problem: y_k' = f(T_k) * e_1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> y_k_prime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> f_tk_solver\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">decomposition\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">alphas, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">decomposition\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">betas)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // Scale by ||b||\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> y_k\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">y_k_prime\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Scale\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(T\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">from_real_impl\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">decomposition\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">b_norm));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // Second pass: reconstruct solution\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    lanczos_pass_two\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">operator\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">decomposition\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">y_k\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_ref\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(), \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">stack\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The key piece of this API is the \u003Ccode>f_tk_solver\u003C/code> closure. We designed it this way to decouple the Lanczos iteration from the specific matrix function \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003C/span>\u003C/span>\u003C/span>. We require the user to provide a solver for the small \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>×\u003C/mo>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k \\times k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">×\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span> projected problem, and our main function orchestrates the two passes around it. This approach makes our implementation flexible enough to handle linear solves, matrix exponentials, or any other function without changing the core algorithm.\u003C/p>\n\u003Ch3 id=\"example-the-solver-for-a-linear-system\">Example: The Solver for a Linear System\u003C/h3>\n\u003Cp>Let’s see what this solver closure looks like in a real-world scenario. If we want to solve a linear system \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmrow>\u003Cmi mathvariant=\"bold\">A\u003C/mi>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003C/mrow>\u003Cmo>=\u003C/mo>\u003Cmi mathvariant=\"bold\">b\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{Ax} = \\mathbf{b}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">Ax\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathbf\">b\u003C/span>\u003C/span>\u003C/span>\u003C/span>, we are computing the action of the inverse function, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>f\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>z\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmsup>\u003Cmi>z\u003C/mi>\u003Cmrow>\u003Cmo>−\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003C/msup>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">f(z) = z^{-1}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8141em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">−\u003C/span>\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. This means our \u003Ccode>f_tk_solver\u003C/code> needs to solve the small, tridiagonal linear system \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsup>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′\u003C/mo>\u003C/msup>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">e\u003C/mi>\u003Cmn>1\u003C/mn>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{T}_k \\mathbf{y}' = \\mathbf{e}_1\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.9463em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.7519em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">′\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">e\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cp>Since \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">T\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{T}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">T\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> is tridiagonal, we can solve this system very efficiently. A sparse LU decomposition is an excellent choice, as its complexity for a tridiagonal system is only \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>k\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(k)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>. Here’s how we can implement the solver:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"rust\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> f_tk_solver\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">alphas\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">f64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">], \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">betas\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">f64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> ->\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Result\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Mat\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">f64\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">anyhow\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Error\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> steps\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> alphas\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">len\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> steps\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Mat\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">zeros\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 1. Assemble the sparse tridiagonal matrix T_k from coefficients.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // We use a triplet format for efficient construction.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> triplets\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Vec\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">with_capacity\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">3\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> steps\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">alpha\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> alphas\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">iter\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">enumerate\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        triplets\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Triplet\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">row\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">col\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> alpha\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">beta\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">in\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> betas\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">iter\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">enumerate\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        triplets\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Triplet\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">row\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">col\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> beta\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        triplets\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">Triplet\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">row\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">col\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">val\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> beta\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> t_k_sparse\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> SparseColMat\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">try_new_from_triplets\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">steps\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">steps\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">triplets\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 2. Create the right-hand side vector, e_1.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> e1\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Mat\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">zeros\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">steps\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    e1\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_mut\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()[(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)] \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#F78C6C\">.\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 3. Solve the system using a sparse LU factorization.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\">    Ok\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">t_k_sparse\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_ref\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">sp_lu\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">solve\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">e1\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">as_ref\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This closure takes the raw \u003Ccode>alphas\u003C/code> and \u003Ccode>betas\u003C/code> from the Lanczos process, constructs the \u003Ccode>faer\u003C/code> sparse matrix, and then uses its built-in LU solver. This is the exact approach we used in our experimental binaries.\u003C/p>\n\u003Ch1 id=\"some-interesting-results\">Some interesting results\u003C/h1>\n\u003Cp>Now that we have a working implementation we can run some tests. The core idea of what we have done is simple: trade flops for better memory access. But does this trade actually pay off on real hardware? To find out, we need a reliable way to benchmark it.\u003C/p>\n\u003Cp>For the data, we know that the performance of any Krylov method is tied to the operator’s spectral properties. We need a way to generate a family of test problems where we can precisely control the size, sparsity, and numerical difficulty. A great way to do this is with Karush-Kuhn-Tucker (KKT) systems, which are sparse, symmetric, and have a specific block structure.\u003C/p>\n\u003Cspan class=\"katex-display\">\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\">\u003Csemantics>\u003Cmrow>\u003Cmi>A\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmrow>\u003Cmo fence=\"true\">(\u003C/mo>\u003Cmtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\">\u003Cmtr>\u003Cmtd>\u003Cmstyle scriptlevel=\"0\" displaystyle=\"false\">\u003Cmi>D\u003C/mi>\u003C/mstyle>\u003C/mtd>\u003Cmtd>\u003Cmstyle scriptlevel=\"0\" displaystyle=\"false\">\u003Cmsup>\u003Cmi>E\u003C/mi>\u003Cmi>T\u003C/mi>\u003C/msup>\u003C/mstyle>\u003C/mtd>\u003C/mtr>\u003Cmtr>\u003Cmtd>\u003Cmstyle scriptlevel=\"0\" displaystyle=\"false\">\u003Cmi>E\u003C/mi>\u003C/mstyle>\u003C/mtd>\u003Cmtd>\u003Cmstyle scriptlevel=\"0\" displaystyle=\"false\">\u003Cmn>0\u003C/mn>\u003C/mstyle>\u003C/mtd>\u003C/mtr>\u003C/mtable>\u003Cmo fence=\"true\">)\u003C/mo>\u003C/mrow>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">A =\n\\begin{pmatrix}\n    D &#x26; E^T \\\\\n    E &#x26; 0\n\\end{pmatrix}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6833em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">A\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:2.4013em;vertical-align:-0.9507em;\">\u003C/span>\u003Cspan class=\"minner\">\u003Cspan class=\"mopen delimcenter\" style=\"top:0em;\">\u003Cspan class=\"delimsizing size3\">(\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mtable\">\u003Cspan class=\"col-align-c\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.4507em;\">\u003Cspan style=\"top:-3.6093em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-2.4093em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.9507em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"arraycolsep\" style=\"width:0.5em;\">\u003C/span>\u003Cspan class=\"arraycolsep\" style=\"width:0.5em;\">\u003C/span>\u003Cspan class=\"col-align-c\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.4507em;\">\u003Cspan style=\"top:-3.6093em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8413em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-2.4093em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord\">0\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.9507em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose delimcenter\" style=\"top:0em;\">\u003Cspan class=\"delimsizing size3\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\n\u003Cp>This structure gives us two critical knobs to turn. First, with the \u003Ca href=\"https://commalab.di.unipi.it/files/Data/MCF/netgen.tgz\">netgen\u003C/a> utility, we can control the E matrix, which lets us dial in the problem dimension, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span>. Second, we build the diagonal block D with random entries from a range \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmo stretchy=\"false\">[\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi>C\u003C/mi>\u003Cmi>D\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">]\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">[1, C_D]\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mopen\">[\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3283em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">]\u003C/span>\u003C/span>\u003C/span>\u003C/span>. This parameter, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>C\u003C/mi>\u003Cmi>D\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">C_D\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3283em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, gives us direct control over the numerical difficulty of the problem.Let’s look at how. For a symmetric matrix like \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>D\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">D\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6833em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003C/span>, the 2-norm condition number, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>κ\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>D\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\kappa_2(D)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">κ\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>, is the ratio of its largest to its smallest eigenvalue: \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>κ\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>D\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi>λ\u003C/mi>\u003Cmi>max\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>D\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmi mathvariant=\"normal\">/\u003C/mi>\u003Cmsub>\u003Cmi>λ\u003C/mi>\u003Cmi>min\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>D\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\kappa_2(D) = \\lambda_{\\max}(D) / \\lambda_{\\min}(D)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">κ\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">λ\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1514em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mop mtight\">\u003Cspan class=\"mtight\">m\u003C/span>\u003Cspan class=\"mtight\">a\u003C/span>\u003Cspan class=\"mtight\">x\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mord\">/\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">λ\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3175em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mop mtight\">\u003Cspan class=\"mtight\">m\u003C/span>\u003Cspan class=\"mtight\">i\u003C/span>\u003Cspan class=\"mtight\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>. Since \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>D\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">D\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6833em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003C/span> is diagonal, its eigenvalues are simply its diagonal entries. We are drawing these entries from a uniform distribution \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>U\u003C/mi>\u003Cmo stretchy=\"false\">[\u003C/mo>\u003Cmn>1\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi>C\u003C/mi>\u003Cmi>D\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">]\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">U[1, C_D]\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U\u003C/span>\u003Cspan class=\"mopen\">[\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3283em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">]\u003C/span>\u003C/span>\u003C/span>\u003C/span>, so we have \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>λ\u003C/mi>\u003Cmi>max\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>D\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>≈\u003C/mo>\u003Cmsub>\u003Cmi>C\u003C/mi>\u003Cmi>D\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\lambda_{\\max}(D) \\approx C_D\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">λ\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1514em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mop mtight\">\u003Cspan class=\"mtight\">m\u003C/span>\u003Cspan class=\"mtight\">a\u003C/span>\u003Cspan class=\"mtight\">x\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">≈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3283em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>λ\u003C/mi>\u003Cmi>min\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>D\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>≈\u003C/mo>\u003Cmn>1\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\lambda_{\\min}(D) \\approx 1\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">λ\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3175em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mop mtight\">\u003Cspan class=\"mtight\">m\u003C/span>\u003Cspan class=\"mtight\">i\u003C/span>\u003Cspan class=\"mtight\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">≈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">1\u003C/span>\u003C/span>\u003C/span>\u003C/span>. This means we get direct control: \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>κ\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>D\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>≈\u003C/mo>\u003Cmsub>\u003Cmi>C\u003C/mi>\u003Cmi>D\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\kappa_2(D) \\approx C_D\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">κ\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3011em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">≈\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3283em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>.The spectral properties of this block heavily influence the spectrum of the entire matrix \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">A\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6833em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span>. A large condition number in \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>D\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">D\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6833em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003C/span> leads to a more ill-conditioned system for \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>A\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">A\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6833em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">A\u003C/span>\u003C/span>\u003C/span>\u003C/span>. The convergence rate of Krylov methods like Lanczos is fundamentally governed by the distribution of the operator’s eigenvalues. An ill-conditioned matrix, with a wide spread of eigenvalues, will require more iterations, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>, to reach the desired accuracy. By simply adjusting the \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>C\u003C/mi>\u003Cmi>D\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">C_D\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3283em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> parameter, we can generate everything from well-conditioned problems that converge quickly to ill-conditioned ones that force us to run a large number of iterations. This is exactly what we need to rigorously test our implementation.\u003C/p>\n\u003Ch2 id=\"the-memory-and-computation-trade-off\">The Memory and Computation Trade-off\u003C/h2>\n\u003Cp>Let’s put this to the test. We’ll start by fixing the problem size to a large \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>500\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmn>000\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n=500,000\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">500\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">000\u003C/span>\u003C/span>\u003C/span>\u003C/span> and then vary the number of iterations, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>. We have two clear hypotheses based on a standard complexity analysis.\u003C/p>\n\u003Cp>First, regarding memory, the one-pass method has a complexity of \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmi>k\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(nk)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">nk\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> due to storing the basis \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{V}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. We expect its memory usage to grow linearly with \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>. Our two-pass method, with its \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> complexity, should have a flat memory footprint.\u003C/p>\n\u003Cp>Second, for wall-clock time, the analysis seems just as simple. The two-pass method performs twice the number of matrix-vector products, which is the most expensive operation. Therefore, we should expect it to be about twice as slow.\u003C/p>\n\u003Cp>Let’s see what the data says. First, memory usage.\u003C/p>\n\u003Cp>\u003Cimg src=\"/public/assets/lanczos/tradeoff_arcs500k_rho3_memory.png\" alt=\"Memory vs Iterations\">\u003C/p>\n\u003Cp>The results confirm our memory model perfectly. The standard algorithm’s memory footprint grows in a perfectly straight line, a direct consequence of storing the basis \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{V}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. Our two-pass method is a flat line, using only the constant \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> memory for its small working set of vectors. No surprises here.\u003C/p>\n\u003Cp>Now for the wall-clock time. This is where the simple model starts to fall apart.\u003C/p>\n\u003Cp>\u003Cimg src=\"/public/assets/lanczos/tradeoff_arcs500k_rho3_time.png\" alt=\"Runtime vs Iterations\">\u003C/p>\n\u003Cp>The two-pass method is always slower, as expected, but the difference is nowhere near a factor of two. For a small number of iterations, the gap is very narrow, and as we increase \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>, the two-pass method’s runtime starts becoming \u003Cem>slightly\u003C/em> slower than the one-pass method.\u003C/p>\n\u003Cp>So what’s going on? This behavior is governed by the memory access patterns during the solution reconstruction phase. We can model the total execution time as the sum for matrix-vector products and vector operations. For the standard method, the final solution is computed via a single dense matrix-vector product, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmo>=\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003Cmsub>\u003Cmi mathvariant=\"bold\">y\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x}_k = \\mathbf{V}_k \\mathbf{y}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8805em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>. When \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span> and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span> are large, the basis matrix \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">V\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{V}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">V\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> becomes too large to fit in any level of the CPU cache. Consequently, this operation becomes \u003Cem>memory-bandwidth-bound\u003C/em>: its performance is limited by the speed at which data can be streamed from main memory, leading to high latency. In contrast, the two-pass method reconstructs the solution incrementally, operating on a small working set of vectors at each step (\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmtext>prev\u003C/mtext>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_{\\text{prev}}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1514em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord text mtight\">\u003Cspan class=\"mord mtight\">prev\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">v\u003C/mi>\u003Cmtext>curr\u003C/mtext>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{v}_{\\text{curr}}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\" style=\"margin-right:0.01597em;\">v\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1514em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.016em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord text mtight\">\u003Cspan class=\"mord mtight\">curr\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>, and \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi mathvariant=\"bold\">x\u003C/mi>\u003Cmi>k\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\mathbf{x}_k\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5944em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbf\">x\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>).\u003C/p>\n\u003Cp>This allows the processor’s cache hierarchy to manage the data effectively and maintain a high cache-hit rate. This high data locality means the processor is constantly fed data. The cost of re-computing the basis vectors turns out to be less than the cost of the memory latency paid by the standard method.\u003C/p>\n\u003Cp>This effect isn’t just for large-scale problems. On a medium-scale instance (\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>50\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmn>000\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n=50,000\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">50\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">000\u003C/span>\u003C/span>\u003C/span>\u003C/span>), we find an equilibrium point where the performance is nearly identical. Here, the penalty the standard method pays for increasing cache misses almost perfectly balances the cost of the extra matrix-vector products in our two-pass implementation.\u003C/p>\n\u003Cp>\u003Cimg src=\"/public/assets/lanczos/tradeoff_arcs50k_rho3_time.png\" alt=\"Medium Scale Runtime vs Iterations\">\n\u003Cimg src=\"/public/assets/lanczos/tradeoff_arcs50k_rho3_memory.png\" alt=\"Medium Scale Memory Usage vs Iterations\">\u003C/p>\n\u003Ch3 id=\"the-final-proof-a-dense-matrix\">The Final Proof: A Dense Matrix\u003C/h3>\n\u003Cp>To confirm our hypothesis that this is all about memory access, we can run one final test. What happens if we use a dense matrix? Here, the matrix-vector product is an \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsup>\u003Cmi>n\u003C/mi>\u003Cmn>2\u003C/mn>\u003C/msup>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(n^2)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.8141em;\">\u003Cspan style=\"top:-3.063em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">2\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> operation, making it so computationally expensive that it should dominate all other costs, including memory latency. In this compute-bound regime, our cache efficiency advantage should become negligible.\u003C/p>\n\u003Cp>We can run an experiment with a dense random matrix of size \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>10\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmn>000\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n=10,000\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">10\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">000\u003C/span>\u003C/span>\u003C/span>\u003C/span>. Let’s see the results.\u003C/p>\n\u003Cp>\u003Cimg src=\"/public/assets/lanczos/dense-tradeoff.png\" alt=\"Dense Matrix Runtime vs Iterations\">\u003C/p>\n\u003Cp>The runtime of the two-pass method is almost exactly twice that of the standard one. The slopes of the lines confirm it. This proves our analysis: the surprisingly strong performance of our two-pass method on sparse problems is a direct result of its superior cache efficiency. It’s a textbook example of how modern hardware architecture can turn a seemingly worse algorithm into a winner.\u003C/p>\n\u003Ch2 id=\"scalbility\">Scalbility\u003C/h2>\n\u003Cp>Finally, let’s look at how our implementation scales with increasing problem size. We’ll fix the number of iterations to \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>k\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>500\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">k=500\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6944em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">500\u003C/span>\u003C/span>\u003C/span>\u003C/span> and vary \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span> from \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmn>50\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmn>000\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">50,000\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">50\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">000\u003C/span>\u003C/span>\u003C/span>\u003C/span> to \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmn>500\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmn>000\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">500,000\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">500\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">000\u003C/span>\u003C/span>\u003C/span>\u003C/span>.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Using netget allows us to generate a variety of problem sizes while keeping the sparsity pattern realistic.\u003C/p>\n\u003C/blockquote>\n\u003Cp>Based on what we’ve seen so far, we expect the two-pass method memory usage to scale linearly with \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span>, but with a very small slope. The standard method should also scale linearly, but with a much steeper slope due to the \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>O\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>n\u003C/mi>\u003Cmi>k\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">O(nk)\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">nk\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span> memory for storing the basis. We can see that this is exactly what happens:\u003C/p>\n\u003Cp>\u003Cimg src=\"/public/assets/lanczos/scalability_k500_rho3_memory.png\" alt=\"Scalability Memory Usage\">\u003C/p>\n\u003Cblockquote>\n\u003Cp>I had to use a logarithmic scale on the y-axis in order to make visible the very small memory usage increase of the two-pass method.\u003C/p>\n\u003C/blockquote>\n\u003Cp>The runtime scaling also scales linearly with \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span> for both methods, as expected. For dimensions that are smaller then \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>150\u003C/mn>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmn>000\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n=150,000\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">150\u003C/span>\u003Cspan class=\"mpunct\">,\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">000\u003C/span>\u003C/span>\u003C/span>\u003C/span>, the two algorithms have very similar performance. As we increase \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>n\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">n\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">n\u003C/span>\u003C/span>\u003C/span>\u003C/span> further, the cost of the matrix-vector products starts to dominate, and the two-pass method’s runtime becomes to diverge, becoming progressively slower then the standard method.\u003C/p>\n\u003Cp>\u003Cimg src=\"/public/assets/lanczos/scalability_k500_rho3_time.png\" alt=\"Scalability Runtime\">\u003C/p>",{"headings":789,"localImagePaths":847,"remoteImagePaths":848,"frontmatter":849,"imagePaths":852},[790,793,796,799,802,805,808,811,814,817,820,823,826,829,832,835,838,841,844],{"depth":284,"slug":791,"text":792},"computing-matrix-functions","Computing Matrix Functions",{"depth":31,"slug":794,"text":795},"krylov-projection","Krylov Projection",{"depth":47,"slug":797,"text":798},"finding-a-basis","Finding a basis",{"depth":284,"slug":800,"text":801},"lanczos-iterations","Lanczos Iterations",{"depth":31,"slug":803,"text":804},"the-memory-bottleneck","The Memory Bottleneck",{"depth":284,"slug":806,"text":807},"two-pass-algorithm","Two-Pass Algorithm",{"depth":31,"slug":809,"text":810},"first-pass","First pass",{"depth":31,"slug":812,"text":813},"second-pass","Second pass",{"depth":284,"slug":815,"text":816},"implementation","Implementation",{"depth":31,"slug":818,"text":819},"building-the-core-recurrence","Building the Core Recurrence",{"depth":31,"slug":821,"text":822},"an-iterator-for-the-recurrence","An Iterator for the Recurrence",{"depth":31,"slug":824,"text":825},"first-pass-collecting-the-scalars","First Pass: Collecting the Scalars",{"depth":31,"slug":827,"text":828},"second-pass-reconstructing-the-solution","Second Pass: Reconstructing the Solution",{"depth":31,"slug":830,"text":831},"a-clean-public-api","A Clean Public API",{"depth":47,"slug":833,"text":834},"example-the-solver-for-a-linear-system","Example: The Solver for a Linear System",{"depth":284,"slug":836,"text":837},"some-interesting-results","Some interesting results",{"depth":31,"slug":839,"text":840},"the-memory-and-computation-trade-off","The Memory and Computation Trade-off",{"depth":47,"slug":842,"text":843},"the-final-proof-a-dense-matrix","The Final Proof: A Dense Matrix",{"depth":31,"slug":845,"text":846},"scalbility","Scalbility",[],[],{"author":269,"pubDatetime":850,"title":779,"slug":775,"featured":179,"draft":18,"tags":851,"description":782},["Date","2025-09-16T00:00:00.000Z"],[273,781],[],"astro-paper-2",{"id":853,"data":855,"body":861,"filePath":862,"assetImports":863,"digest":865,"rendered":866},{"author":14,"pubDatetime":856,"title":857,"featured":18,"tags":858,"ogImage":859,"description":860},["Date","2023-01-30T15:57:52.737Z"],"AstroPaper 2.0",[21],"__ASTRO_IMAGE_https://user-images.githubusercontent.com/53733092/215771435-25408246-2309-4f8b-a781-1f3d93bdf0ec.png","AstroPaper with the enhancements of Astro v2. Type-safe markdown contents, bug fixes and better dev experience etc.","Astro 2.0 has been released with some cool features, breaking changes, DX improvements, better error overlay and so on. AstroPaper takes advantage of those cool features, especially Content Collections API.\n\n\u003C!-- ![Introducing AstroPaper 2.0](https://user-images.githubusercontent.com/53733092/215683840-dc2502f5-8c5a-44f0-a26c-4e7180455056.png) -->\n\n![Introducing AstroPaper 2.0](https://user-images.githubusercontent.com/53733092/215771435-25408246-2309-4f8b-a781-1f3d93bdf0ec.png)\n\n## Table of contents\n\n## Features & Changes\n\n### Type-safe Frontmatters and Redefined Blog Schema\n\nFrontmatter of AstroPaper 2.0 markdown contents are now type-safe thanks to Astro’s Content Collections. Blog schema is defined inside the `src/content/_schemas.ts` file.\n\n### New Home for Blog contents\n\nAll the blog posts were moved from `src/contents` to `src/content/blog` directory.\n\n### New Fetch API\n\nContents are now fetched with `getCollection` function. No relative path to the content needs to be specified anymore.\n\n```ts\n// old content fetching method\n- const postImportResult = import.meta.glob\u003CMarkdownInstance\u003CFrontmatter>>(\n  \"../contents/**/**/*.md\",);\n\n// new content fetching method\n+ const postImportResult = await getCollection(\"blog\");\n```\n\n### Modified Search Logic for better Search Result\n\nIn the older version of AstroPaper, when someone search some article, the search criteria keys that will be searched are `title`, `description` and `headings` (heading means all the headings h1 ~ h6 of the blog post). In AstroPaper v2, only `title` and `description` will be searched as the user types.\n\n### Renamed Frontmatter Properties\n\nThe following frontmatter properties are renamed.\n\n| Old Names | New Names   |\n| --------- | ----------- |\n| datetime  | pubDatetime |\n| slug      | postSlug    |\n\n### Default Tag for blog post\n\nIf a blog post doesn't have any tag (in other words, frontmatter property `tags` is not specified), the default tag `others` will be used for that blog post. But you can set the default tag in the `/src/content/_schemas.ts` file.\n\n```ts\n// src/contents/_schemas.ts\nexport const blogSchema = z.object({\n  // ---\n  // replace \"others\" with whatever you want\n  tags: z.array(z.string()).default([\"others\"]),\n  ogImage: z.string().optional(),\n  description: z.string(),\n});\n```\n\n### New Predefined Dark Color Scheme\n\nAstroPaper v2 has a new dark color scheme (high contrast & low contrast) which is based on Astro's dark logo. Check out [this link](https://astro-paper.pages.dev/posts/predefined-color-schemes#astro-dark) for more info.\n\n![New Predefined Dark Color Scheme](https://user-images.githubusercontent.com/53733092/215680520-59427bb0-f4cb-48c0-bccc-f182a428d72d.svg)\n\n### Automatic Class Sorting\n\nAstroPaper 2.0 includes automatic class sorting with [TailwindCSS Prettier plugin](https://tailwindcss.com/blog/automatic-class-sorting-with-prettier)\n\n### Updated Docs & README\n\nAll the [#docs](https://astro-paper.pages.dev/tags/docs/) blog posts and [README](https://github.com/satnaing/astro-paper#readme) are updated for this AstroPaper v2.\n\n## Bug Fixes\n\n- fix broken tags in the Blog Post page\n- in a tag page, the last part of the breadcrumb is now updated to lower-case for consistency\n- exclude draft posts in a tag page\n- fix 'onChange value not updating issue' after a page reload","src/data/blog/_releases/astro-paper-2.md",[864],"https://user-images.githubusercontent.com/53733092/215771435-25408246-2309-4f8b-a781-1f3d93bdf0ec.png","c33285ceb5aea3b2",{"html":867,"metadata":868},"\u003Cp>Astro 2.0 has been released with some cool features, breaking changes, DX improvements, better error overlay and so on. AstroPaper takes advantage of those cool features, especially Content Collections API.\u003C/p>\n\u003C!-- ![Introducing AstroPaper 2.0](https://user-images.githubusercontent.com/53733092/215683840-dc2502f5-8c5a-44f0-a26c-4e7180455056.png) -->\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/215771435-25408246-2309-4f8b-a781-1f3d93bdf0ec.png\" alt=\"Introducing AstroPaper 2.0\">\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#features--changes\">Features &#x26; Changes\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#type-safe-frontmatters-and-redefined-blog-schema\">Type-safe Frontmatters and Redefined Blog Schema\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#new-home-for-blog-contents\">New Home for Blog contents\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#new-fetch-api\">New Fetch API\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#modified-search-logic-for-better-search-result\">Modified Search Logic for better Search Result\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#renamed-frontmatter-properties\">Renamed Frontmatter Properties\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#default-tag-for-blog-post\">Default Tag for blog post\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#new-predefined-dark-color-scheme\">New Predefined Dark Color Scheme\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#automatic-class-sorting\">Automatic Class Sorting\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#updated-docs--readme\">Updated Docs &#x26; README\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#bug-fixes\">Bug Fixes\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"features--changes\">Features &#x26; Changes\u003C/h2>\n\u003Ch3 id=\"type-safe-frontmatters-and-redefined-blog-schema\">Type-safe Frontmatters and Redefined Blog Schema\u003C/h3>\n\u003Cp>Frontmatter of AstroPaper 2.0 markdown contents are now type-safe thanks to Astro’s Content Collections. Blog schema is defined inside the \u003Ccode>src/content/_schemas.ts\u003C/code> file.\u003C/p>\n\u003Ch3 id=\"new-home-for-blog-contents\">New Home for Blog contents\u003C/h3>\n\u003Cp>All the blog posts were moved from \u003Ccode>src/contents\u003C/code> to \u003Ccode>src/content/blog\u003C/code> directory.\u003C/p>\n\u003Ch3 id=\"new-fetch-api\">New Fetch API\u003C/h3>\n\u003Cp>Contents are now fetched with \u003Ccode>getCollection\u003C/code> function. No relative path to the content needs to be specified anymore.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// old content fetching method\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> postImportResult\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> import\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">meta\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">glob\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic\">MarkdownInstance\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic\">Frontmatter\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">>>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">  \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">../contents/**/**/*.md\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// new content fetching method\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> postImportResult\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> getCollection\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">blog\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"modified-search-logic-for-better-search-result\">Modified Search Logic for better Search Result\u003C/h3>\n\u003Cp>In the older version of AstroPaper, when someone search some article, the search criteria keys that will be searched are \u003Ccode>title\u003C/code>, \u003Ccode>description\u003C/code> and \u003Ccode>headings\u003C/code> (heading means all the headings h1 ~ h6 of the blog post). In AstroPaper v2, only \u003Ccode>title\u003C/code> and \u003Ccode>description\u003C/code> will be searched as the user types.\u003C/p>\n\u003Ch3 id=\"renamed-frontmatter-properties\">Renamed Frontmatter Properties\u003C/h3>\n\u003Cp>The following frontmatter properties are renamed.\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Old Names\u003C/th>\u003Cth>New Names\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>datetime\u003C/td>\u003Ctd>pubDatetime\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>slug\u003C/td>\u003Ctd>postSlug\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch3 id=\"default-tag-for-blog-post\">Default Tag for blog post\u003C/h3>\n\u003Cp>If a blog post doesn’t have any tag (in other words, frontmatter property \u003Ccode>tags\u003C/code> is not specified), the default tag \u003Ccode>others\u003C/code> will be used for that blog post. But you can set the default tag in the \u003Ccode>/src/content/_schemas.ts\u003C/code> file.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// src/contents/_schemas.ts\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> blogSchema\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">object\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // ---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // replace \"others\" with whatever you want\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  tags\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">array\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">default\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">others\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">])\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  ogImage\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">optional\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  description\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> z\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"new-predefined-dark-color-scheme\">New Predefined Dark Color Scheme\u003C/h3>\n\u003Cp>AstroPaper v2 has a new dark color scheme (high contrast &#x26; low contrast) which is based on Astro’s dark logo. Check out \u003Ca href=\"https://astro-paper.pages.dev/posts/predefined-color-schemes#astro-dark\">this link\u003C/a> for more info.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/215680520-59427bb0-f4cb-48c0-bccc-f182a428d72d.svg\" alt=\"New Predefined Dark Color Scheme\">\u003C/p>\n\u003Ch3 id=\"automatic-class-sorting\">Automatic Class Sorting\u003C/h3>\n\u003Cp>AstroPaper 2.0 includes automatic class sorting with \u003Ca href=\"https://tailwindcss.com/blog/automatic-class-sorting-with-prettier\">TailwindCSS Prettier plugin\u003C/a>\u003C/p>\n\u003Ch3 id=\"updated-docs--readme\">Updated Docs &#x26; README\u003C/h3>\n\u003Cp>All the \u003Ca href=\"https://astro-paper.pages.dev/tags/docs/\">#docs\u003C/a> blog posts and \u003Ca href=\"https://github.com/satnaing/astro-paper#readme\">README\u003C/a> are updated for this AstroPaper v2.\u003C/p>\n\u003Ch2 id=\"bug-fixes\">Bug Fixes\u003C/h2>\n\u003Cul>\n\u003Cli>fix broken tags in the Blog Post page\u003C/li>\n\u003Cli>in a tag page, the last part of the breadcrumb is now updated to lower-case for consistency\u003C/li>\n\u003Cli>exclude draft posts in a tag page\u003C/li>\n\u003Cli>fix ‘onChange value not updating issue’ after a page reload\u003C/li>\n\u003C/ul>",{"headings":869,"localImagePaths":904,"remoteImagePaths":905,"frontmatter":906,"imagePaths":909},[870,871,874,877,880,883,886,889,892,895,898,901],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":872,"text":873},"features--changes","Features & Changes",{"depth":47,"slug":875,"text":876},"type-safe-frontmatters-and-redefined-blog-schema","Type-safe Frontmatters and Redefined Blog Schema",{"depth":47,"slug":878,"text":879},"new-home-for-blog-contents","New Home for Blog contents",{"depth":47,"slug":881,"text":882},"new-fetch-api","New Fetch API",{"depth":47,"slug":884,"text":885},"modified-search-logic-for-better-search-result","Modified Search Logic for better Search Result",{"depth":47,"slug":887,"text":888},"renamed-frontmatter-properties","Renamed Frontmatter Properties",{"depth":47,"slug":890,"text":891},"default-tag-for-blog-post","Default Tag for blog post",{"depth":47,"slug":893,"text":894},"new-predefined-dark-color-scheme","New Predefined Dark Color Scheme",{"depth":47,"slug":896,"text":897},"automatic-class-sorting","Automatic Class Sorting",{"depth":47,"slug":899,"text":900},"updated-docs--readme","Updated Docs & README",{"depth":31,"slug":902,"text":903},"bug-fixes","Bug Fixes",[],[],{"author":14,"pubDatetime":907,"title":857,"slug":853,"featured":18,"ogImage":864,"tags":908,"description":860},["Date","2023-01-30T15:57:52.737Z"],[21],[],"astro-paper-v3",{"id":910,"data":912,"body":918,"filePath":919,"assetImports":920,"digest":923,"rendered":924},{"author":14,"pubDatetime":913,"title":914,"featured":18,"tags":915,"ogImage":916,"description":917},["Date","2023-09-25T10:25:54.547Z"],"AstroPaper 3.0",[21],"__ASTRO_IMAGE_https://github.com/satnaing/astro-paper/assets/53733092/1ef0cf03-8137-4d67-ac81-84a032119e3a","AstroPaper Version 3: Elevating Your Web Experience with Astro v3 and Seamless View Transitions","We're excited to announce the release of AstroPaper v3, packed with new features, enhancements, and bug fixes to elevate your web development experience. Let's dive into the highlights of this release:\n\n![AstroPaper v3](@/assets/images/AstroPaper-v3.png)\n\n## Table of contents\n\n## Features & Changes\n\n### Astro v3 Integration\n\n\u003Cvideo autoplay loop=\"loop\" muted=\"muted\" plays-inline=\"true\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/53733092/18fdb604-1ca3-41a0-8372-1367759091ff\" type=\"video/mp4\">\n  \u003C!-- \u003Csource src=\"/assets/docs/astro-paper-v3-view-transitions-demo.mp4\" type=\"video/mp4\"> -->\n\u003C/video>\n\nAstroPaper now fully supports [Astro v3](https://astro.build/blog/astro-3/), offering improved performance and rendering speed.\n\nBesides, we've added support for Astro's [ViewTransitions API](https://docs.astro.build/en/guides/view-transitions/), allowing you to create captivating and dynamic transitions between views.\n\nIn the \"Recent Section\", only non-featured posts will be displayed to avoid duplications and better support for ViewTransitions API.\n\n### Update OG Image Generation Logic\n\n![Example OG Image](https://user-images.githubusercontent.com/40914272/269252964-a0dc6735-80f7-41ed-8e74-4d4d70f96891.png)\n\nWe've updated the logic for automatic OG image generation, making it even more reliable and efficient. Besides, it now supports special characters in post titles, ensuring accurate, flexible and eye-catching social media previews.\n\n`SITE.ogImage` is now optional. If it is not specified, AstroPaper will automatically generate an OG image using `SITE.title`, `SITE.desc` and `SITE.website`\n\n### Theme meta tag\n\nThe theme-color meta tag has been added to dynamically adapt to theme switches, ensuring a seamless user experience.\n\n> Notice the difference at the top\n\n**_AstroPaper v2 theme switch_**\n\n\u003Cvideo autoplay loop=\"loop\" muted=\"muted\" plays-inline=\"true\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/53733092/3ab5a1e8-1891-4264-a5bb-0ded69143c1a\" type=\"video/mp4\">\n\u003C/video>\n\n**_AstroPaper v3 theme switch_**\n\n\u003Cvideo autoplay loop=\"loop\" muted=\"muted\" plays-inline=\"true\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/53733092/8ac9deb8-d1f8-4029-86bd-6aa0def380b4\" type=\"video/mp4\">\n\u003C/video>\n\n## Other Changes\n\n### Astro Prettier Plugin\n\nAstro Prettier Plugin is installed out-of-the-box in order to keep the project tidy and organized.\n\n### Minor Style Changes\n\nThe single-line code block wrapping issue has been solved, making your code snippets look pristine.\n\nUpdate nav style CSS to allow adding more nav links to the navigation.\n\n## Upgrade to AstroPaper v3\n\n> This section is only for those who want to upgrade AstroPaper v3 from the older versions.\n\nThis section will help you migrate from AstroPaper v2 to AstroPaper v3.\n\nBefore reading the rest of the section, you might also want to check [this article](https://astro-paper.pages.dev/posts/how-to-update-dependencies/) for upgrading dependencies and AstroPaper.\n\n## Option 1: Fresh Restart (recommended)\n\nIn this release, a lot of changes have been made\\_ replacing old Astro APIs with newer APIs, bug fixes, new features etc. Thus, if you are someone who didn't make customization very much, you should follow this approach.\n\n**_Step 1: Keep all your updated files_**\n\nIt's important to keep all the files which have been already updated. These files include\n\n- `/src/config.ts` (didn't touch in v3)\n- `/src/styles/base.css` (minor changes in v3; mentioned below)\n- `/src/assets/` (didn't touch in v3)\n- `/public/assets/` (didn't touch in v3)\n- `/content/blog/` (it's your blog content directory 🤷🏻‍♂️)\n- Any other customizations you've made.\n\n```css\n/* file: /src/styles/base.css */\n@layer base {\n  /* Other Codes */\n  ::-webkit-scrollbar-thumb:hover {\n    @apply bg-skin-card-muted;\n  }\n\n  /* Old code\n  code {\n    white-space: pre;\n    overflow: scroll;\n  } \n  */\n\n  /* New code */\n  code,\n  blockquote {\n    word-wrap: break-word;\n  }\n  pre > code {\n    white-space: pre;\n  }\n}\n\n@layer components {\n  /* other codes */\n}\n```\n\n**_Step 1: Replace everything else with AstroPaper v3_**\n\nIn this step, replace everything\\_ except above files/directories (plus your customized files/directories)\\_ with AstroPaper v3.\n\n**_Step 3: Schema Updates_**\n\nKeep in mind that `/src/content/_schemas.ts` has been replaced with `/src/content/config.ts`.\n\nBesides, there is no longer `BlogFrontmatter` type exported from `/src/content/config.ts`.\n\nTherefore, all the `BlogFrontmatter` type inside files need to be updated with `CollectionEntry\u003C\"blog\">[\"data\"]`.\n\nFor example: `src/components/Card.tsx`\n\n```ts\n// AstroPaper v2\nimport type { BlogFrontmatter } from \"@content/_schemas\";\n\nexport interface Props {\n  href?: string;\n  frontmatter: BlogFrontmatter;\n  secHeading?: boolean;\n}\n```\n\n```ts\n// AstroPaper v3\nimport type { CollectionEntry } from \"astro:content\";\n\nexport interface Props {\n  href?: string;\n  frontmatter: CollectionEntry\u003C\"blog\">[\"data\"];\n  secHeading?: boolean;\n}\n```\n\n## Option 2: Upgrade using Git\n\nThis approach is not recommended for most users. You should do the \"Option 1\" if you can. Only do this if you know how to resolve merge conflicts and you know what you're doing.\n\nActually, I've already written a blog post for this case and you can check out [here](https://astro-paper.pages.dev/posts/how-to-update-dependencies/#updating-astropaper-using-git).\n\n## Outro\n\nReady to explore the exciting new features and improvements in AstroPaper v3? Start [using AstroPaper](https://github.com/satnaing/astro-paper) now.\n\nFor other bug fixes and integration updates, check out the [release notes](https://github.com/satnaing/astro-paper/releases/tag/v3.0.0) to learn more.\n\nIf you encounter any bugs or face difficulties during the upgrade process, please feel free to open an issue or start a discussion on [GitHub](https://github.com/satnaing/astro-paper).","src/data/blog/_releases/astro-paper-3.md",[921,922],"@/assets/images/AstroPaper-v3.png","https://github.com/satnaing/astro-paper/assets/53733092/1ef0cf03-8137-4d67-ac81-84a032119e3a","e788234d29e1c779",{"html":925,"metadata":926},"\u003Cp>We’re excited to announce the release of AstroPaper v3, packed with new features, enhancements, and bug fixes to elevate your web development experience. Let’s dive into the highlights of this release:\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;@/assets/images/AstroPaper-v3.png&#x22;,&#x22;alt&#x22;:&#x22;AstroPaper v3&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#features--changes\">Features &#x26; Changes\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#astro-v3-integration\">Astro v3 Integration\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#update-og-image-generation-logic\">Update OG Image Generation Logic\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#theme-meta-tag\">Theme meta tag\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#other-changes\">Other Changes\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#astro-prettier-plugin\">Astro Prettier Plugin\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#minor-style-changes\">Minor Style Changes\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#upgrade-to-astropaper-v3\">Upgrade to AstroPaper v3\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#option-1-fresh-restart-recommended\">Option 1: Fresh Restart (recommended)\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#option-2-upgrade-using-git\">Option 2: Upgrade using Git\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#outro\">Outro\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"features--changes\">Features &#x26; Changes\u003C/h2>\n\u003Ch3 id=\"astro-v3-integration\">Astro v3 Integration\u003C/h3>\n\u003Cvideo autoplay loop muted plays-inline=\"true\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/53733092/18fdb604-1ca3-41a0-8372-1367759091ff\" type=\"video/mp4\">\n  \u003C!-- \u003Csource src=\"/assets/docs/astro-paper-v3-view-transitions-demo.mp4\" type=\"video/mp4\"> -->\n\u003C/video>\n\u003Cp>AstroPaper now fully supports \u003Ca href=\"https://astro.build/blog/astro-3/\">Astro v3\u003C/a>, offering improved performance and rendering speed.\u003C/p>\n\u003Cp>Besides, we’ve added support for Astro’s \u003Ca href=\"https://docs.astro.build/en/guides/view-transitions/\">ViewTransitions API\u003C/a>, allowing you to create captivating and dynamic transitions between views.\u003C/p>\n\u003Cp>In the “Recent Section”, only non-featured posts will be displayed to avoid duplications and better support for ViewTransitions API.\u003C/p>\n\u003Ch3 id=\"update-og-image-generation-logic\">Update OG Image Generation Logic\u003C/h3>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/40914272/269252964-a0dc6735-80f7-41ed-8e74-4d4d70f96891.png\" alt=\"Example OG Image\">\u003C/p>\n\u003Cp>We’ve updated the logic for automatic OG image generation, making it even more reliable and efficient. Besides, it now supports special characters in post titles, ensuring accurate, flexible and eye-catching social media previews.\u003C/p>\n\u003Cp>\u003Ccode>SITE.ogImage\u003C/code> is now optional. If it is not specified, AstroPaper will automatically generate an OG image using \u003Ccode>SITE.title\u003C/code>, \u003Ccode>SITE.desc\u003C/code> and \u003Ccode>SITE.website\u003C/code>\u003C/p>\n\u003Ch3 id=\"theme-meta-tag\">Theme meta tag\u003C/h3>\n\u003Cp>The theme-color meta tag has been added to dynamically adapt to theme switches, ensuring a seamless user experience.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Notice the difference at the top\u003C/p>\n\u003C/blockquote>\n\u003Cp>\u003Cstrong>\u003Cem>AstroPaper v2 theme switch\u003C/em>\u003C/strong>\u003C/p>\n\u003Cvideo autoplay loop muted plays-inline=\"true\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/53733092/3ab5a1e8-1891-4264-a5bb-0ded69143c1a\" type=\"video/mp4\">\n\u003C/video>\n\u003Cp>\u003Cstrong>\u003Cem>AstroPaper v3 theme switch\u003C/em>\u003C/strong>\u003C/p>\n\u003Cvideo autoplay loop muted plays-inline=\"true\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/53733092/8ac9deb8-d1f8-4029-86bd-6aa0def380b4\" type=\"video/mp4\">\n\u003C/video>\n\u003Ch2 id=\"other-changes\">Other Changes\u003C/h2>\n\u003Ch3 id=\"astro-prettier-plugin\">Astro Prettier Plugin\u003C/h3>\n\u003Cp>Astro Prettier Plugin is installed out-of-the-box in order to keep the project tidy and organized.\u003C/p>\n\u003Ch3 id=\"minor-style-changes\">Minor Style Changes\u003C/h3>\n\u003Cp>The single-line code block wrapping issue has been solved, making your code snippets look pristine.\u003C/p>\n\u003Cp>Update nav style CSS to allow adding more nav links to the navigation.\u003C/p>\n\u003Ch2 id=\"upgrade-to-astropaper-v3\">Upgrade to AstroPaper v3\u003C/h2>\n\u003Cblockquote>\n\u003Cp>This section is only for those who want to upgrade AstroPaper v3 from the older versions.\u003C/p>\n\u003C/blockquote>\n\u003Cp>This section will help you migrate from AstroPaper v2 to AstroPaper v3.\u003C/p>\n\u003Cp>Before reading the rest of the section, you might also want to check \u003Ca href=\"https://astro-paper.pages.dev/posts/how-to-update-dependencies/\">this article\u003C/a> for upgrading dependencies and AstroPaper.\u003C/p>\n\u003Ch2 id=\"option-1-fresh-restart-recommended\">Option 1: Fresh Restart (recommended)\u003C/h2>\n\u003Cp>In this release, a lot of changes have been made_ replacing old Astro APIs with newer APIs, bug fixes, new features etc. Thus, if you are someone who didn’t make customization very much, you should follow this approach.\u003C/p>\n\u003Cp>\u003Cstrong>\u003Cem>Step 1: Keep all your updated files\u003C/em>\u003C/strong>\u003C/p>\n\u003Cp>It’s important to keep all the files which have been already updated. These files include\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ccode>/src/config.ts\u003C/code> (didn’t touch in v3)\u003C/li>\n\u003Cli>\u003Ccode>/src/styles/base.css\u003C/code> (minor changes in v3; mentioned below)\u003C/li>\n\u003Cli>\u003Ccode>/src/assets/\u003C/code> (didn’t touch in v3)\u003C/li>\n\u003Cli>\u003Ccode>/public/assets/\u003C/code> (didn’t touch in v3)\u003C/li>\n\u003Cli>\u003Ccode>/content/blog/\u003C/code> (it’s your blog content directory 🤷🏻‍♂️)\u003C/li>\n\u003Cli>Any other customizations you’ve made.\u003C/li>\n\u003C/ul>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/* file: /src/styles/base.css */\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">@\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">layer\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> base {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /* Other Codes */\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">  ::\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">-webkit-scrollbar-thumb\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">hover\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    @\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#80CBC4\">apply\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#80CBC4\"> bg-skin-card-muted\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /* Old code\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  code {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    white-space: pre;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    overflow: scroll;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  } \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  */\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /* New code */\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">  code\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">  blockquote\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#80CBC4\">    word-wrap\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF6363\"> break-word\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">  pre\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> >\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\"> code\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#80CBC4\">    white-space\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FF6363\"> pre\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">@\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">layer\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> components {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /* other codes */\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>\u003Cem>Step 1: Replace everything else with AstroPaper v3\u003C/em>\u003C/strong>\u003C/p>\n\u003Cp>In this step, replace everything_ except above files/directories (plus your customized files/directories)_ with AstroPaper v3.\u003C/p>\n\u003Cp>\u003Cstrong>\u003Cem>Step 3: Schema Updates\u003C/em>\u003C/strong>\u003C/p>\n\u003Cp>Keep in mind that \u003Ccode>/src/content/_schemas.ts\u003C/code> has been replaced with \u003Ccode>/src/content/config.ts\u003C/code>.\u003C/p>\n\u003Cp>Besides, there is no longer \u003Ccode>BlogFrontmatter\u003C/code> type exported from \u003Ccode>/src/content/config.ts\u003C/code>.\u003C/p>\n\u003Cp>Therefore, all the \u003Ccode>BlogFrontmatter\u003C/code> type inside files need to be updated with \u003Ccode>CollectionEntry&#x3C;\"blog\">[\"data\"]\u003C/code>.\u003C/p>\n\u003Cp>For example: \u003Ccode>src/components/Card.tsx\u003C/code>\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// AstroPaper v2\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> type\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { BlogFrontmatter } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@content/_schemas\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> interface\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Props\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  href\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  frontmatter\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> BlogFrontmatter\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  secHeading\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> boolean\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// AstroPaper v3\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> type\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { CollectionEntry } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">astro:content\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> interface\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Props\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  href\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  frontmatter\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> CollectionEntry\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">blog\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">>[\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">data\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  secHeading\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> boolean\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"option-2-upgrade-using-git\">Option 2: Upgrade using Git\u003C/h2>\n\u003Cp>This approach is not recommended for most users. You should do the “Option 1” if you can. Only do this if you know how to resolve merge conflicts and you know what you’re doing.\u003C/p>\n\u003Cp>Actually, I’ve already written a blog post for this case and you can check out \u003Ca href=\"https://astro-paper.pages.dev/posts/how-to-update-dependencies/#updating-astropaper-using-git\">here\u003C/a>.\u003C/p>\n\u003Ch2 id=\"outro\">Outro\u003C/h2>\n\u003Cp>Ready to explore the exciting new features and improvements in AstroPaper v3? Start \u003Ca href=\"https://github.com/satnaing/astro-paper\">using AstroPaper\u003C/a> now.\u003C/p>\n\u003Cp>For other bug fixes and integration updates, check out the \u003Ca href=\"https://github.com/satnaing/astro-paper/releases/tag/v3.0.0\">release notes\u003C/a> to learn more.\u003C/p>\n\u003Cp>If you encounter any bugs or face difficulties during the upgrade process, please feel free to open an issue or start a discussion on \u003Ca href=\"https://github.com/satnaing/astro-paper\">GitHub\u003C/a>.\u003C/p>",{"headings":927,"localImagePaths":960,"remoteImagePaths":961,"frontmatter":962,"imagePaths":965},[928,929,930,933,936,939,942,945,948,951,954,957],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":872,"text":873},{"depth":47,"slug":931,"text":932},"astro-v3-integration","Astro v3 Integration",{"depth":47,"slug":934,"text":935},"update-og-image-generation-logic","Update OG Image Generation Logic",{"depth":47,"slug":937,"text":938},"theme-meta-tag","Theme meta tag",{"depth":31,"slug":940,"text":941},"other-changes","Other Changes",{"depth":47,"slug":943,"text":944},"astro-prettier-plugin","Astro Prettier Plugin",{"depth":47,"slug":946,"text":947},"minor-style-changes","Minor Style Changes",{"depth":31,"slug":949,"text":950},"upgrade-to-astropaper-v3","Upgrade to AstroPaper v3",{"depth":31,"slug":952,"text":953},"option-1-fresh-restart-recommended","Option 1: Fresh Restart (recommended)",{"depth":31,"slug":955,"text":956},"option-2-upgrade-using-git","Option 2: Upgrade using Git",{"depth":31,"slug":958,"text":959},"outro","Outro",[921],[],{"author":14,"pubDatetime":963,"title":914,"slug":910,"featured":18,"ogImage":922,"tags":964,"description":917},["Date","2023-09-25T10:25:54.547Z"],[21],[921],"astro-paper-v4",{"id":966,"data":968,"body":974,"filePath":975,"assetImports":976,"digest":979,"rendered":980},{"author":14,"pubDatetime":969,"title":970,"featured":18,"tags":971,"ogImage":972,"description":973},["Date","2024-01-04T09:30:41.816Z"],"AstroPaper 4.0",[21],"__ASTRO_IMAGE_../../../assets/images/AstroPaper-v4.png","AstroPaper v4: ensuring a smoother and more feature-rich blogging experience.","Hello everyone! Wishing you a happy New Year 🎉 and all the best for 2024! We're excited to announce the release of AstroPaper v4, a significant update that introduces a range of new features, improvements, and bug fixes to elevate your blogging experience. A big thank you to all the contributors for their valuable input and efforts in making version 4 possible!\n\n![AstroPaper v4](@/assets/images/AstroPaper-v4.png)\n\n## Table of contents\n\n## Major Changes\n\n### Upgrade to Astro v4 [#202](https://github.com/satnaing/astro-paper/pull/202)\n\nAstroPaper now leverages the power and capabilities of Astro v4. However, it’s a subtle upgrade and won’t break most Astro users.\n\n![Astro v4](https://astro.build/_astro/header-astro-4.YunweN9V_OmV0l.webp)\n\n### Replace `postSlug` with Astro Content `slug` [#197](https://github.com/satnaing/astro-paper/pull/197)\n\nThe `postSlug` in the blog content schema is no longer available in AstroPaper v4. Initially Astro doesn't have a `slug` mechanism and thus we have to figure it out on our own. Since Astro v3, it supports content collection and slug features. Now, we believe it's time to adopt Astro's out-of-the-box `slug` feature.\n\n**_file: src/content/blog/astro-paper-4.md_**\n\n```bash\n---\nauthor: Sat Naing\npubDatetime: 2024-01-01T04:35:33.428Z\ntitle: AstroPaper 4.0\nslug: \"astro-paper-v4\" # if slug is not specified, it will be 'astro-paper-4' (file name).\n# slug: \"\" ❌ cannot be an empty string\n---\n```\n\nThe behavior of the `slug` is slightly different now. In the previous versions of AstroPaper, if the `postSlug` is not specified in a blog post (markdown file), the title of that blog post would be slugified and used as the `slug`. However, in AstroPaper v4, if the `slug` field is not specified, the markdown file name will be used as the `slug`. One thing to keep in mind is that the `slug` field can be omitted, but it cannot be an empty string (slug: \"\" ❌).\n\nIf you're upgrading AstroPaper from v3 to v4, make sure to replace `postSlug` in your `src/content/blog/*.md` files with `slug`.\n\n## New Features\n\n### Add code-snippets for content creation [#206](https://github.com/satnaing/astro-paper/pull/206)\n\nAstroPaper now includes VSCode snippets for new blog posts, eliminating the need for manual copy/pasting of the frontmatter and content structure (table of contents, heading, excerpt, etc.).\n\nRead more about VSCode Snippets [here](https://code.visualstudio.com/docs/editor/userdefinedsnippets#:~:text=In%20Visual%20Studio%20Code%2C%20snippets,Snippet%20in%20the%20Command%20Palette).\n\n\u003Cvideo autoplay muted=\"muted\" controls plays-inline=\"true\" class=\"border border-skin-line\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/53733092/136f1903-bade-40a2-b6bb-285a3c726350\" type=\"video/mp4\">\n\u003C/video>\n\n### Add Modified Datetime in Blog Posts [#195](https://github.com/satnaing/astro-paper/pull/195)\n\nKeep readers informed about the latest updates by displaying the modified datetime in blog posts. This not only instills user trust in the freshness of the articles but also contributes to improved SEO for the blog.\n\n![Last Modified Date feature in AstroPaper](https://github.com/satnaing/astro-paper/assets/53733092/cc89585e-148e-444d-9da1-0d496e867175)\n\nYou can add a `modDatetime` to your blog post if you've made modifications. Now, the sorting behavior of the posts is slightly different. All posts are sorted by both `pubDatetime` and `modDatetime`. If a post has both a `pubDatetime` and `modDatetime`, its sorting position will be determined by the `modDatetime`. If not, only `pubDatetime` will be considered to determine the post's sorting order.\n\n### Implement Back-to-Top Button [#188](https://github.com/satnaing/astro-paper/pull/188)\n\nEnhance user navigation on your blog detail post with the newly implemented back-to-top button.\n\n![Back to top button in AstroPaper](https://github.com/satnaing/astro-paper/assets/53733092/79854957-7877-4f19-936e-ad994b772074)\n\n### Add Pagination in Tag Posts [#201](https://github.com/satnaing/astro-paper/pull/201)\n\nImprove content organization and navigation with the addition of pagination in tag posts, making it easier for users to explore related content. This ensures that if a tag has many posts, readers won't be overwhelmed by all the tag-related posts.\n\n\u003Cvideo autoplay loop=\"loop\" muted=\"muted\" plays-inline=\"true\" class=\"border border-skin-line\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/53733092/9bad87f5-dcf5-4b79-b67a-d6c7244cd616\" type=\"video/mp4\">\n\u003C/video>\n\n### Dynamically Generate robots.txt [#130](https://github.com/satnaing/astro-paper/pull/130)\n\nAstroPaper v4 now dynamically generates the robots.txt file, giving you more control over search engine indexing and web crawling. Besides, sitemap URL will also be added inside `robot.txt` file.\n\n### Add Docker-Compose File [#174](https://github.com/satnaing/astro-paper/pull/174)\n\nManaging your AstroPaper environment is now easier than ever with the addition of a Docker-Compose file, simplifying deployment and configuration.\n\n## Refactoring & Bug Fixes\n\n### Replace Slugified Title with Unslugified Tag Name [#198](https://github.com/satnaing/astro-paper/pull/198)\n\nTo improve clarity, user experience and SEO, titles (`Tag: some-tag`) in tag page are no longer slugified (`Tag: Some Tag`).\n\n![Unslugified Tag Names](https://github.com/satnaing/astro-paper/assets/53733092/2fe90d6e-ec52-467b-9c44-95009b3ae0b7)\n\n### Implement 100svh for Min-Height ([79d569d](https://github.com/satnaing/astro-paper/commit/79d569d053036f2113519f41b0d257523d035b76))\n\nWe've updated the min-height on the body to use 100svh, offering a better UX for mobile users.\n\n### Update Site URL as Single Source of Truth [#143](https://github.com/satnaing/astro-paper/pull/143)\n\nThe site URL is now a single source of truth, streamlining configuration and avoiding inconsistencies. Read more at this [PR](https://github.com/satnaing/astro-paper/pull/143) and its related issue(s).\n\n### Solve Invisible Text Code Block Issue in Light Mode [#163](https://github.com/satnaing/astro-paper/pull/163)\n\nWe've fixed the invisible text code block issue in light mode.\n\n### Decode Unicode Tag Characters in Breadcrumb [#175](https://github.com/satnaing/astro-paper/pull/175)\n\nThe last part of Tag in the breadcrumb is now decoded, making non-English Unicode characters display better.\n\n### Update LOCALE Config to Cover Overall Locales ([cd02b04](https://github.com/satnaing/astro-paper/commit/cd02b047d2b5e3b4a2940c0ff30568cdebcec0b8))\n\nThe LOCALE configuration has been updated to cover a broader range of locales, catering to a more diverse audience.\n\n## Outtro\n\nWe believe these updates will significantly elevate your AstroPaper experience. Thank you to everyone who contributed, solved issues, and gave stars to AstroPaper. We look forward to seeing the amazing content you create with AstroPaper v4!\n\nHappy Blogging!\n\n[Sat Naing](https://satnaing.dev) \u003Cbr/>\nCreator of AstroPaper","src/data/blog/_releases/astro-paper-4.md",[977,978],"@/assets/images/AstroPaper-v4.png","../../../assets/images/AstroPaper-v4.png","50501d95070a77d3",{"html":981,"metadata":982},"\u003Cp>Hello everyone! Wishing you a happy New Year 🎉 and all the best for 2024! We’re excited to announce the release of AstroPaper v4, a significant update that introduces a range of new features, improvements, and bug fixes to elevate your blogging experience. A big thank you to all the contributors for their valuable input and efforts in making version 4 possible!\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;@/assets/images/AstroPaper-v4.png&#x22;,&#x22;alt&#x22;:&#x22;AstroPaper v4&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#major-changes\">Major Changes\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#upgrade-to-astro-v4-202\">Upgrade to Astro v4 #202\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#replace-postslug-with-astro-content-slug-197\">Replace \u003Ccode>postSlug\u003C/code> with Astro Content \u003Ccode>slug\u003C/code> #197\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#new-features\">New Features\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#add-code-snippets-for-content-creation-206\">Add code-snippets for content creation #206\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#add-modified-datetime-in-blog-posts-195\">Add Modified Datetime in Blog Posts #195\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#implement-back-to-top-button-188\">Implement Back-to-Top Button #188\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#add-pagination-in-tag-posts-201\">Add Pagination in Tag Posts #201\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#dynamically-generate-robotstxt-130\">Dynamically Generate robots.txt #130\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#add-docker-compose-file-174\">Add Docker-Compose File #174\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#refactoring--bug-fixes\">Refactoring &#x26; Bug Fixes\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#replace-slugified-title-with-unslugified-tag-name-198\">Replace Slugified Title with Unslugified Tag Name #198\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#implement-100svh-for-min-height-79d569d\">Implement 100svh for Min-Height (79d569d)\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#update-site-url-as-single-source-of-truth-143\">Update Site URL as Single Source of Truth #143\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#solve-invisible-text-code-block-issue-in-light-mode-163\">Solve Invisible Text Code Block Issue in Light Mode #163\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#decode-unicode-tag-characters-in-breadcrumb-175\">Decode Unicode Tag Characters in Breadcrumb #175\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#update-locale-config-to-cover-overall-locales-cd02b04\">Update LOCALE Config to Cover Overall Locales (cd02b04)\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#outtro\">Outtro\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"major-changes\">Major Changes\u003C/h2>\n\u003Ch3 id=\"upgrade-to-astro-v4-202\">Upgrade to Astro v4 \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/202\">#202\u003C/a>\u003C/h3>\n\u003Cp>AstroPaper now leverages the power and capabilities of Astro v4. However, it’s a subtle upgrade and won’t break most Astro users.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://astro.build/_astro/header-astro-4.YunweN9V_OmV0l.webp\" alt=\"Astro v4\">\u003C/p>\n\u003Ch3 id=\"replace-postslug-with-astro-content-slug-197\">Replace \u003Ccode>postSlug\u003C/code> with Astro Content \u003Ccode>slug\u003C/code> \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/197\">#197\u003C/a>\u003C/h3>\n\u003Cp>The \u003Ccode>postSlug\u003C/code> in the blog content schema is no longer available in AstroPaper v4. Initially Astro doesn’t have a \u003Ccode>slug\u003C/code> mechanism and thus we have to figure it out on our own. Since Astro v3, it supports content collection and slug features. Now, we believe it’s time to adopt Astro’s out-of-the-box \u003Ccode>slug\u003C/code> feature.\u003C/p>\n\u003Cp>\u003Cstrong>\u003Cem>file: src/content/blog/astro-paper-4.md\u003C/em>\u003C/strong>\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">author:\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> Sat\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> Naing\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">pubDatetime:\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 2024-01-01T04:35:33.428Z\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">title:\u003C/span>\u003Cspan style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> AstroPaper\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4.0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">slug:\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">astro-paper-v4\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> # if slug is not specified, it will be 'astro-paper-4' (file name).\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># slug: \"\" ❌ cannot be an empty string\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The behavior of the \u003Ccode>slug\u003C/code> is slightly different now. In the previous versions of AstroPaper, if the \u003Ccode>postSlug\u003C/code> is not specified in a blog post (markdown file), the title of that blog post would be slugified and used as the \u003Ccode>slug\u003C/code>. However, in AstroPaper v4, if the \u003Ccode>slug\u003C/code> field is not specified, the markdown file name will be used as the \u003Ccode>slug\u003C/code>. One thing to keep in mind is that the \u003Ccode>slug\u003C/code> field can be omitted, but it cannot be an empty string (slug: \"\" ❌).\u003C/p>\n\u003Cp>If you’re upgrading AstroPaper from v3 to v4, make sure to replace \u003Ccode>postSlug\u003C/code> in your \u003Ccode>src/content/blog/*.md\u003C/code> files with \u003Ccode>slug\u003C/code>.\u003C/p>\n\u003Ch2 id=\"new-features\">New Features\u003C/h2>\n\u003Ch3 id=\"add-code-snippets-for-content-creation-206\">Add code-snippets for content creation \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/206\">#206\u003C/a>\u003C/h3>\n\u003Cp>AstroPaper now includes VSCode snippets for new blog posts, eliminating the need for manual copy/pasting of the frontmatter and content structure (table of contents, heading, excerpt, etc.).\u003C/p>\n\u003Cp>Read more about VSCode Snippets \u003Ca href=\"https://code.visualstudio.com/docs/editor/userdefinedsnippets#:~:text=In%20Visual%20Studio%20Code%2C%20snippets,Snippet%20in%20the%20Command%20Palette\">here\u003C/a>.\u003C/p>\n\u003Cvideo autoplay muted controls plays-inline=\"true\" class=\"border border-skin-line\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/53733092/136f1903-bade-40a2-b6bb-285a3c726350\" type=\"video/mp4\">\n\u003C/video>\n\u003Ch3 id=\"add-modified-datetime-in-blog-posts-195\">Add Modified Datetime in Blog Posts \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/195\">#195\u003C/a>\u003C/h3>\n\u003Cp>Keep readers informed about the latest updates by displaying the modified datetime in blog posts. This not only instills user trust in the freshness of the articles but also contributes to improved SEO for the blog.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://github.com/satnaing/astro-paper/assets/53733092/cc89585e-148e-444d-9da1-0d496e867175\" alt=\"Last Modified Date feature in AstroPaper\">\u003C/p>\n\u003Cp>You can add a \u003Ccode>modDatetime\u003C/code> to your blog post if you’ve made modifications. Now, the sorting behavior of the posts is slightly different. All posts are sorted by both \u003Ccode>pubDatetime\u003C/code> and \u003Ccode>modDatetime\u003C/code>. If a post has both a \u003Ccode>pubDatetime\u003C/code> and \u003Ccode>modDatetime\u003C/code>, its sorting position will be determined by the \u003Ccode>modDatetime\u003C/code>. If not, only \u003Ccode>pubDatetime\u003C/code> will be considered to determine the post’s sorting order.\u003C/p>\n\u003Ch3 id=\"implement-back-to-top-button-188\">Implement Back-to-Top Button \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/188\">#188\u003C/a>\u003C/h3>\n\u003Cp>Enhance user navigation on your blog detail post with the newly implemented back-to-top button.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://github.com/satnaing/astro-paper/assets/53733092/79854957-7877-4f19-936e-ad994b772074\" alt=\"Back to top button in AstroPaper\">\u003C/p>\n\u003Ch3 id=\"add-pagination-in-tag-posts-201\">Add Pagination in Tag Posts \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/201\">#201\u003C/a>\u003C/h3>\n\u003Cp>Improve content organization and navigation with the addition of pagination in tag posts, making it easier for users to explore related content. This ensures that if a tag has many posts, readers won’t be overwhelmed by all the tag-related posts.\u003C/p>\n\u003Cvideo autoplay loop muted plays-inline=\"true\" class=\"border border-skin-line\">\n  \u003Csource src=\"https://github.com/satnaing/astro-paper/assets/53733092/9bad87f5-dcf5-4b79-b67a-d6c7244cd616\" type=\"video/mp4\">\n\u003C/video>\n\u003Ch3 id=\"dynamically-generate-robotstxt-130\">Dynamically Generate robots.txt \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/130\">#130\u003C/a>\u003C/h3>\n\u003Cp>AstroPaper v4 now dynamically generates the robots.txt file, giving you more control over search engine indexing and web crawling. Besides, sitemap URL will also be added inside \u003Ccode>robot.txt\u003C/code> file.\u003C/p>\n\u003Ch3 id=\"add-docker-compose-file-174\">Add Docker-Compose File \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/174\">#174\u003C/a>\u003C/h3>\n\u003Cp>Managing your AstroPaper environment is now easier than ever with the addition of a Docker-Compose file, simplifying deployment and configuration.\u003C/p>\n\u003Ch2 id=\"refactoring--bug-fixes\">Refactoring &#x26; Bug Fixes\u003C/h2>\n\u003Ch3 id=\"replace-slugified-title-with-unslugified-tag-name-198\">Replace Slugified Title with Unslugified Tag Name \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/198\">#198\u003C/a>\u003C/h3>\n\u003Cp>To improve clarity, user experience and SEO, titles (\u003Ccode>Tag: some-tag\u003C/code>) in tag page are no longer slugified (\u003Ccode>Tag: Some Tag\u003C/code>).\u003C/p>\n\u003Cp>\u003Cimg src=\"https://github.com/satnaing/astro-paper/assets/53733092/2fe90d6e-ec52-467b-9c44-95009b3ae0b7\" alt=\"Unslugified Tag Names\">\u003C/p>\n\u003Ch3 id=\"implement-100svh-for-min-height-79d569d\">Implement 100svh for Min-Height (\u003Ca href=\"https://github.com/satnaing/astro-paper/commit/79d569d053036f2113519f41b0d257523d035b76\">79d569d\u003C/a>)\u003C/h3>\n\u003Cp>We’ve updated the min-height on the body to use 100svh, offering a better UX for mobile users.\u003C/p>\n\u003Ch3 id=\"update-site-url-as-single-source-of-truth-143\">Update Site URL as Single Source of Truth \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/143\">#143\u003C/a>\u003C/h3>\n\u003Cp>The site URL is now a single source of truth, streamlining configuration and avoiding inconsistencies. Read more at this \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/143\">PR\u003C/a> and its related issue(s).\u003C/p>\n\u003Ch3 id=\"solve-invisible-text-code-block-issue-in-light-mode-163\">Solve Invisible Text Code Block Issue in Light Mode \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/163\">#163\u003C/a>\u003C/h3>\n\u003Cp>We’ve fixed the invisible text code block issue in light mode.\u003C/p>\n\u003Ch3 id=\"decode-unicode-tag-characters-in-breadcrumb-175\">Decode Unicode Tag Characters in Breadcrumb \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/175\">#175\u003C/a>\u003C/h3>\n\u003Cp>The last part of Tag in the breadcrumb is now decoded, making non-English Unicode characters display better.\u003C/p>\n\u003Ch3 id=\"update-locale-config-to-cover-overall-locales-cd02b04\">Update LOCALE Config to Cover Overall Locales (\u003Ca href=\"https://github.com/satnaing/astro-paper/commit/cd02b047d2b5e3b4a2940c0ff30568cdebcec0b8\">cd02b04\u003C/a>)\u003C/h3>\n\u003Cp>The LOCALE configuration has been updated to cover a broader range of locales, catering to a more diverse audience.\u003C/p>\n\u003Ch2 id=\"outtro\">Outtro\u003C/h2>\n\u003Cp>We believe these updates will significantly elevate your AstroPaper experience. Thank you to everyone who contributed, solved issues, and gave stars to AstroPaper. We look forward to seeing the amazing content you create with AstroPaper v4!\u003C/p>\n\u003Cp>Happy Blogging!\u003C/p>\n\u003Cp>\u003Ca href=\"https://satnaing.dev\">Sat Naing\u003C/a> \u003Cbr>\nCreator of AstroPaper\u003C/p>",{"headings":983,"localImagePaths":1039,"remoteImagePaths":1040,"frontmatter":1041,"imagePaths":1044},[984,985,988,991,994,997,1000,1003,1006,1009,1012,1015,1018,1021,1024,1027,1030,1033,1036],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":986,"text":987},"major-changes","Major Changes",{"depth":47,"slug":989,"text":990},"upgrade-to-astro-v4-202","Upgrade to Astro v4 #202",{"depth":47,"slug":992,"text":993},"replace-postslug-with-astro-content-slug-197","Replace postSlug with Astro Content slug #197",{"depth":31,"slug":995,"text":996},"new-features","New Features",{"depth":47,"slug":998,"text":999},"add-code-snippets-for-content-creation-206","Add code-snippets for content creation #206",{"depth":47,"slug":1001,"text":1002},"add-modified-datetime-in-blog-posts-195","Add Modified Datetime in Blog Posts #195",{"depth":47,"slug":1004,"text":1005},"implement-back-to-top-button-188","Implement Back-to-Top Button #188",{"depth":47,"slug":1007,"text":1008},"add-pagination-in-tag-posts-201","Add Pagination in Tag Posts #201",{"depth":47,"slug":1010,"text":1011},"dynamically-generate-robotstxt-130","Dynamically Generate robots.txt #130",{"depth":47,"slug":1013,"text":1014},"add-docker-compose-file-174","Add Docker-Compose File #174",{"depth":31,"slug":1016,"text":1017},"refactoring--bug-fixes","Refactoring & Bug Fixes",{"depth":47,"slug":1019,"text":1020},"replace-slugified-title-with-unslugified-tag-name-198","Replace Slugified Title with Unslugified Tag Name #198",{"depth":47,"slug":1022,"text":1023},"implement-100svh-for-min-height-79d569d","Implement 100svh for Min-Height (79d569d)",{"depth":47,"slug":1025,"text":1026},"update-site-url-as-single-source-of-truth-143","Update Site URL as Single Source of Truth #143",{"depth":47,"slug":1028,"text":1029},"solve-invisible-text-code-block-issue-in-light-mode-163","Solve Invisible Text Code Block Issue in Light Mode #163",{"depth":47,"slug":1031,"text":1032},"decode-unicode-tag-characters-in-breadcrumb-175","Decode Unicode Tag Characters in Breadcrumb #175",{"depth":47,"slug":1034,"text":1035},"update-locale-config-to-cover-overall-locales-cd02b04","Update LOCALE Config to Cover Overall Locales (cd02b04)",{"depth":31,"slug":1037,"text":1038},"outtro","Outtro",[977],[],{"author":14,"pubDatetime":1042,"title":970,"slug":966,"featured":18,"ogImage":978,"tags":1043,"description":973},["Date","2024-01-04T09:30:41.816Z"],[21],[977],"astro-paper-v5",{"id":1045,"data":1047,"body":1053,"filePath":1054,"assetImports":1055,"digest":1058,"rendered":1059},{"author":14,"pubDatetime":1048,"title":1049,"featured":179,"tags":1050,"ogImage":1051,"description":1052},["Date","2025-03-08T08:18:19.693Z"],"AstroPaper 5.0",[21],"__ASTRO_IMAGE_../../../assets/images/AstroPaper-v5.png","AstroPaper v5: keep the clean look, updates under the hood.","At last, the long-awaited AstroPaper v5 is finally here. AstroPaper v5 keeps the same minimal & clean look, but comes with significant updates under the hood.\n\n![AstroPaper v5](@/assets/images/AstroPaper-v5.png)\n\n## Table of contents\n\n## Major Changes\n\n### Upgrade to Astro v5 [#455](https://github.com/satnaing/astro-paper/pull/455)\n\nAstroPaper now comes with Astro v5, bringing all the new features and improvements that come with it.\n\n### Tailwind v4\n\nAstroPaper has been upgraded to Tailwind v4, which includes many style changes under the hood. The `tailwind.config.js` file has been removed, and now all the configuration is located within the `src/styles/global.css` file. Typography-related styles have been extracted and moved to `src/styles/typography.css`.\n\nDue to the new behavior in TailwindCSS v4, styles inside `\u003Cstyle>` blocks within components have been removed and replaced with inline Tailwind classes.\n\nAdditionally, the color palette across the UI has been updated. The new palette now consists of only five colors:\n\n```css\n:root,\nhtml[data-theme=\"light\"] {\n  --background: #fdfdfd;\n  --foreground: #282728;\n  --accent: #006cac;\n  --muted: #e6e6e6;\n  --border: #ece9e9;\n}\n\nhtml[data-theme=\"dark\"] {\n  --background: #212737;\n  --foreground: #eaedf3;\n  --accent: #ff6b01;\n  --muted: #343f60bf;\n  --border: #ab4b08;\n}\n```\n\n### Remove React + Fuse.js in favor of Pagefind search\n\nIn previous versions, React.js and Fuse.js were used for search functionality and OG image generation. In AstroPaper v5, React.js has been removed and replaced with [Pagefind](https://pagefind.app/), a static site search tool.\n\nThe search experience is almost identical to previous versions, but now all contents, not just titles and descriptions, are indexed and searchable, thanks to Pagefind.\n\nThe idea of using Pagefind in dev mode was inspired by [this blog post](https://chrispennington.blog/blog/pagefind-static-search-for-astro-sites/).\n\n### Updated import alias\n\nThe import alias has been updated from `@directory` to `@/directory`, which means you now have to import like this:\n\n```astro\n---\nimport { slugifyStr } from \"@/utils/slugify\";\nimport IconHash from \"@/assets/icons/IconHash.svg\";\n---\n```\n\n### Move to `pnpm`\n\nAstroPaper has switched from `npm` to `pnpm`, which offers faster and more efficient package management.\n\n### Replace icons/svg with Astro's Svg Component\n\nAstroPaper v5 replaces inline SVGs with Astro’s experimental [SVG Component](https://docs.astro.build/en/reference/experimental-flags/svg/). This update reduces the need for predefined SVG code in the `socialIcons` object, making the codebase cleaner and more maintainable.\n\n### Separate Constants and Config\n\nThe project structure has been reorganized. The `src/config.ts` file now only contains the `SITE` object, which holds the main configuration for the project. All constants, such as `LOCALE`, `SOCIALS`, and `SHARE_LINKS`, have been moved to the `src/constants.ts` file.\n\n## Other notable changes\n\n- The blog posts directory has been updated from `src/content/blog/` to `src/data/blog/`.\n- Collection definitions file (`src/content/config.ts`) is now replaced with `src/content.config.ts`.\n- Various dependencies have been upgraded for improved performance and security.\n- Removed `IBM Plex Mono` font and switched to the default system mono font.\n- The `Go back` button logic has been updated. Now, instead of triggering the browser's history API, AstroPaper v5 uses the browser session to temporarily store the back URL. If no back URL exists in the session, it will redirect to the homepage.\n- There are some minor styles and layout changes as well.\n\n## Outtro\n\nAstroPaper v5 brings many changes, but the core experience remains the same. Enjoy a smoother, more efficient blogging platform while keeping the clean and minimal design that AstroPaper is known for!\n\nFeel free to explore the changes and share your thoughts. As always, thank you for your support!\n\nIf you enjoy this theme, please consider starring the repo. You can also support me via GitHub Sponsors or you can buy me a coffee if you'd like. However, of course, these actions are entirely optional and not required.\n\nEnjoy!\n\n[Sat Naing](https://satnaing.dev/)","src/data/blog/_releases/astro-paper-5.md",[1056,1057],"@/assets/images/AstroPaper-v5.png","../../../assets/images/AstroPaper-v5.png","1ecefba3d3735d6c",{"html":1060,"metadata":1061},"\u003Cp>At last, the long-awaited AstroPaper v5 is finally here. AstroPaper v5 keeps the same minimal &#x26; clean look, but comes with significant updates under the hood.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;@/assets/images/AstroPaper-v5.png&#x22;,&#x22;alt&#x22;:&#x22;AstroPaper v5&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#major-changes\">Major Changes\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#upgrade-to-astro-v5-455\">Upgrade to Astro v5 #455\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#tailwind-v4\">Tailwind v4\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#remove-react--fusejs-in-favor-of-pagefind-search\">Remove React + Fuse.js in favor of Pagefind search\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#updated-import-alias\">Updated import alias\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#move-to-pnpm\">Move to \u003Ccode>pnpm\u003C/code>\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#replace-iconssvg-with-astros-svg-component\">Replace icons/svg with Astro’s Svg Component\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#separate-constants-and-config\">Separate Constants and Config\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#other-notable-changes\">Other notable changes\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#outtro\">Outtro\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"major-changes\">Major Changes\u003C/h2>\n\u003Ch3 id=\"upgrade-to-astro-v5-455\">Upgrade to Astro v5 \u003Ca href=\"https://github.com/satnaing/astro-paper/pull/455\">#455\u003C/a>\u003C/h3>\n\u003Cp>AstroPaper now comes with Astro v5, bringing all the new features and improvements that come with it.\u003C/p>\n\u003Ch3 id=\"tailwind-v4\">Tailwind v4\u003C/h3>\n\u003Cp>AstroPaper has been upgraded to Tailwind v4, which includes many style changes under the hood. The \u003Ccode>tailwind.config.js\u003C/code> file has been removed, and now all the configuration is located within the \u003Ccode>src/styles/global.css\u003C/code> file. Typography-related styles have been extracted and moved to \u003Ccode>src/styles/typography.css\u003C/code>.\u003C/p>\n\u003Cp>Due to the new behavior in TailwindCSS v4, styles inside \u003Ccode>&#x3C;style>\u003C/code> blocks within components have been removed and replaced with inline Tailwind classes.\u003C/p>\n\u003Cp>Additionally, the color palette across the UI has been updated. The new palette now consists of only five colors:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"css\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-dark:#C5E478\">:\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">root\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">light\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">fdfdfd\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">282728\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">006cac\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">e6e6e6\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ece9e9\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#FF6363\">html\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">[\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">data-theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">dark\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --background\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">212737\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --foreground\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">eaedf3\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --accent\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ff6b01\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --muted\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">343f60bf\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">  --border\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> #\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#FFEB95\">ab4b08\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"remove-react--fusejs-in-favor-of-pagefind-search\">Remove React + Fuse.js in favor of Pagefind search\u003C/h3>\n\u003Cp>In previous versions, React.js and Fuse.js were used for search functionality and OG image generation. In AstroPaper v5, React.js has been removed and replaced with \u003Ca href=\"https://pagefind.app/\">Pagefind\u003C/a>, a static site search tool.\u003C/p>\n\u003Cp>The search experience is almost identical to previous versions, but now all contents, not just titles and descriptions, are indexed and searchable, thanks to Pagefind.\u003C/p>\n\u003Cp>The idea of using Pagefind in dev mode was inspired by \u003Ca href=\"https://chrispennington.blog/blog/pagefind-static-search-for-astro-sites/\">this blog post\u003C/a>.\u003C/p>\n\u003Ch3 id=\"updated-import-alias\">Updated import alias\u003C/h3>\n\u003Cp>The import alias has been updated from \u003Ccode>@directory\u003C/code> to \u003Ccode>@/directory\u003C/code>, which means you now have to import like this:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"astro\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { slugifyStr } \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@/utils/slugify\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> IconHash \u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@/assets/icons/IconHash.svg\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"move-to-pnpm\">Move to \u003Ccode>pnpm\u003C/code>\u003C/h3>\n\u003Cp>AstroPaper has switched from \u003Ccode>npm\u003C/code> to \u003Ccode>pnpm\u003C/code>, which offers faster and more efficient package management.\u003C/p>\n\u003Ch3 id=\"replace-iconssvg-with-astros-svg-component\">Replace icons/svg with Astro’s Svg Component\u003C/h3>\n\u003Cp>AstroPaper v5 replaces inline SVGs with Astro’s experimental \u003Ca href=\"https://docs.astro.build/en/reference/experimental-flags/svg/\">SVG Component\u003C/a>. This update reduces the need for predefined SVG code in the \u003Ccode>socialIcons\u003C/code> object, making the codebase cleaner and more maintainable.\u003C/p>\n\u003Ch3 id=\"separate-constants-and-config\">Separate Constants and Config\u003C/h3>\n\u003Cp>The project structure has been reorganized. The \u003Ccode>src/config.ts\u003C/code> file now only contains the \u003Ccode>SITE\u003C/code> object, which holds the main configuration for the project. All constants, such as \u003Ccode>LOCALE\u003C/code>, \u003Ccode>SOCIALS\u003C/code>, and \u003Ccode>SHARE_LINKS\u003C/code>, have been moved to the \u003Ccode>src/constants.ts\u003C/code> file.\u003C/p>\n\u003Ch2 id=\"other-notable-changes\">Other notable changes\u003C/h2>\n\u003Cul>\n\u003Cli>The blog posts directory has been updated from \u003Ccode>src/content/blog/\u003C/code> to \u003Ccode>src/data/blog/\u003C/code>.\u003C/li>\n\u003Cli>Collection definitions file (\u003Ccode>src/content/config.ts\u003C/code>) is now replaced with \u003Ccode>src/content.config.ts\u003C/code>.\u003C/li>\n\u003Cli>Various dependencies have been upgraded for improved performance and security.\u003C/li>\n\u003Cli>Removed \u003Ccode>IBM Plex Mono\u003C/code> font and switched to the default system mono font.\u003C/li>\n\u003Cli>The \u003Ccode>Go back\u003C/code> button logic has been updated. Now, instead of triggering the browser’s history API, AstroPaper v5 uses the browser session to temporarily store the back URL. If no back URL exists in the session, it will redirect to the homepage.\u003C/li>\n\u003Cli>There are some minor styles and layout changes as well.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"outtro\">Outtro\u003C/h2>\n\u003Cp>AstroPaper v5 brings many changes, but the core experience remains the same. Enjoy a smoother, more efficient blogging platform while keeping the clean and minimal design that AstroPaper is known for!\u003C/p>\n\u003Cp>Feel free to explore the changes and share your thoughts. As always, thank you for your support!\u003C/p>\n\u003Cp>If you enjoy this theme, please consider starring the repo. You can also support me via GitHub Sponsors or you can buy me a coffee if you’d like. However, of course, these actions are entirely optional and not required.\u003C/p>\n\u003Cp>Enjoy!\u003C/p>\n\u003Cp>\u003Ca href=\"https://satnaing.dev/\">Sat Naing\u003C/a>\u003C/p>",{"headings":1062,"localImagePaths":1090,"remoteImagePaths":1091,"frontmatter":1092,"imagePaths":1095},[1063,1064,1065,1068,1071,1074,1077,1080,1083,1086,1089],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":986,"text":987},{"depth":47,"slug":1066,"text":1067},"upgrade-to-astro-v5-455","Upgrade to Astro v5 #455",{"depth":47,"slug":1069,"text":1070},"tailwind-v4","Tailwind v4",{"depth":47,"slug":1072,"text":1073},"remove-react--fusejs-in-favor-of-pagefind-search","Remove React + Fuse.js in favor of Pagefind search",{"depth":47,"slug":1075,"text":1076},"updated-import-alias","Updated import alias",{"depth":47,"slug":1078,"text":1079},"move-to-pnpm","Move to pnpm",{"depth":47,"slug":1081,"text":1082},"replace-iconssvg-with-astros-svg-component","Replace icons/svg with Astro’s Svg Component",{"depth":47,"slug":1084,"text":1085},"separate-constants-and-config","Separate Constants and Config",{"depth":31,"slug":1087,"text":1088},"other-notable-changes","Other notable changes",{"depth":31,"slug":1037,"text":1038},[1056],[],{"pubDatetime":1093,"title":1049,"slug":1045,"featured":179,"ogImage":1057,"tags":1094,"description":1052},["Date","2025-03-08T08:18:19.693Z"],[21],[1056],"example-draft-post",{"id":1096,"data":1098,"body":1105,"filePath":1106,"digest":1107,"rendered":1108},{"author":14,"pubDatetime":1099,"title":1100,"featured":18,"draft":179,"tags":1101,"description":1104},["Date","2022-06-06T04:06:31.000Z"],"Example Draft Post",[1102,1103],"TypeScript","Astro","Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Praesent elementum facilisis leo vel fringilla est","Users cannot see this post because it is in draft.\n\n## Motivation\n\nrec 1","src/data/blog/examples/example-draft-post.md","3c3a7581174e0349",{"html":1109,"metadata":1110},"\u003Cp>Users cannot see this post because it is in draft.\u003C/p>\n\u003Ch2 id=\"motivation\">Motivation\u003C/h2>\n\u003Cp>rec 1\u003C/p>",{"headings":1111,"localImagePaths":1115,"remoteImagePaths":1116,"frontmatter":1117,"imagePaths":1120},[1112],{"depth":31,"slug":1113,"text":1114},"motivation","Motivation",[],[],{"title":1100,"author":14,"pubDatetime":1118,"slug":1096,"featured":18,"draft":179,"tags":1119,"description":1104},["Date","2022-06-06T04:06:31.000Z"],[1102,1103],[],"how-do-i-develop-my-portfolio-and-blog",{"id":1121,"data":1123,"body":1133,"filePath":1134,"digest":1135,"rendered":1136},{"author":14,"pubDatetime":1124,"title":1125,"featured":18,"draft":18,"tags":1126,"description":1131,"timezone":1132},["Date","2022-03-25T16:55:12.000Z"],"How Do I Develop My Portfolio Website & Blog",[1127,1128,1129,1130],"NextJS","TailwindCSS","HeadlessCMS","Blog","EXAMPLE POST: My experience about developing my first portfolio website and a blog using NextJS and a headless CMS.","Asia/Yangon","> This article is originally from my [blog post](https://satnaing.dev/blog/posts/how-do-i-develop-my-portfolio-and-blog). I put this article to demonstrate how you can write blog posts/articles using AstroPaper theme.\n\nMy experience about developing my first portfolio website and a blog using NextJS and a headless CMS.\n\n![Building portfolio](https://satnaing.dev/_ipx/w_2048,q_75/https%3A%2F%2Fres.cloudinary.com%2Fnoezectz%2Fimage%2Fupload%2Fv1653050141%2FSatNaing%2Fblog_at_cafe_ei1wf4.jpg?url=https%3A%2F%2Fres.cloudinary.com%2Fnoezectz%2Fimage%2Fupload%2Fv1653050141%2FSatNaing%2Fblog_at_cafe_ei1wf4.jpg&w=2048&q=75)\n\n## Motivation\n\nI've been always thinking about launching my own website with my custom domain name (**satnaing.dev**) since my college student life. But that never happened until this project. I've done several projects and works about web application development but I didn't make an effort to do this.\n\nSo, \"what about blog?\" you may ask. Yeah, blog also has been in my project list for some time. I always wanted to make a blog project using some of the latest technologies. However, I've been busy with my works and other projects so that blog project has never been started.\n\nIn these days, I tend to develop my own projects with the focus in good quality rather than quantity. After the project is done, I usually put a proper readme file in the GitHub repo. But GitHub repo readme is only suitable for technical aspects (this is just my thought). I want to write down my experiences and challenges. Thus, I decided to make my own blog. Plus, at this point, I have decent experiences and confidence to develop this project.\n\n## Tech Stack\n\nFor the front-end, I wanted to use [React](https://reactjs.org/ \"React Official Website\"). But React alone is not good enough for SEO; and I did have to consider many factors like routing, image optimization etc. So, I chose [NextJS](https://nextjs.org/ \"NextJS Official Website\") as my main front-end stack. And of course TypeScript for type checking. (It's said that you'll love TypeScript when you're used to it 😉)\n\nFor styling, I use [TailwindCSS](https://tailwindcss.com/ \"Tailwind CSS Official Website\"). This is because I love developer experience that Tailwind gives and it has a lot of flexibilities compared to other component UI libraries like MUI or React Bootstrap.\n\nAll contents of this project reside within the GitHub repository. All my blog posts (including this one) are written in Markdown file format since I'm very used to with this. But to write Markdown along with its frontmatter effortlessly, I use [Forestry](https://forestry.io/ \"Forestry Official Website\") headless CMS. It is a git-based CMS that can serve Markdown and other contents. Because of this, I can write my contents either using Markdown or wysiwyg editor. Besides, writing frontmatters with this is a breeze.\n\nImages and assets are uploaded and stored in [Cloudinary](https://cloudinary.com/ \"Cloudinary Official Website\"). I connect Cloudinary via Forestry and manage them directly in the dashboard.\n\nIn conclusion, these are the tech stack I've used for this project.\n\n- Front-end: NextJS (TypeScript)\n- Styling: TailwindCSS\n- Animations: GSAP\n- CMS: Forestry Headless CMS\n- Deployment: Vercel\n\n## Features\n\nThe following are certain features of my portfolio and blog\n\n### SEO Friendly\n\nThe entire project is developed with SEO focus in mind. I've used proper meta tags, descriptions and heading alignments. This website is now indexed by Google.\n\n> You can search this website on google by using keywords like 'sat naing dev'\n\n![searching satnaing.dev on google](https://res.cloudinary.com/noezectz/image/upload/v1648231400/SatNaing/satnaing-on-google_asflq6.png \"satnaing.dev is indexed\")\n\nMoreover, this website will be displayed well when shared to social media due to properly used meta tags.\n\n![satnaing.dev card layout when shared to Facebook](https://res.cloudinary.com/noezectz/image/upload/v1653106955/SatNaing/satnaing-dev-share-on-facebook_1_zjoehx.png \"Card layout when shared to Facebook\")\n\n### Dynamic Sitemap\n\nSitemap plays an important part in SEO. Because of this, every single page of this site should be included in sitemap.xml. I made an auto generated sitemap in my website whenever I create a new content or tags or categories.\n\n### Light & Dark Themes\n\nDue to dark theme trend in recent years, many websites include dark theme out of the box nowadays. Certainly, my website also supports light & dark themes.\n\n### Fully Accessible\n\nThis website is fully accessible. You can navigate around by only using keyboard. I put all a11y enhancement best practices like including alt text in all images, no skipping headings, using semantic HTML tags, using aria-attributes properly.\n\n### Search box, Categories & Tags\n\nAll blog contents can be searched by search box. Moreover, contents can be filtered by categories and tags. In this way, blog readers can search and read what they really want.\n\n### Performance and Lighthouse Score\n\nThis website got very good performance and lighthouse score thanks to proper development and best practices. Here's the lighthouse score for this website.\n\n![satnaing.dev Lighthouse score](https://user-images.githubusercontent.com/53733092/159957822-7082e459-11e9-4616-8f1e-49d0881f7cbb.png \"satnaing.dev Lighthouse score\")\n\n### Animations\n\nInitially I used [Framer Motion](https://www.framer.com/motion/ \"Framer Motion\") to add animations and micro interactions for this website. However, when I tried to use some complex animations and parallax effects, I found it inconvenient to integrate with Framer Motion (Maybe I'm not very good at and used to working with it). Hence, I decided to use [GSAP](https://greensock.com/ \"GSAP Animation Library\") for all of my animations. It is one of the most popular animation library and it is capable of doing complex and advanced animations. You can see animations and micro interactions on pretty much every page of this website.\n\n![animations at satnaing.dev](https://res.cloudinary.com/noezectz/image/upload/v1653108324/SatNaing/ezgif.com-gif-maker_2_hehtlm.gif \"satnaing.dev website\")\n\n## Outro\n\nIn conclusion, this project gives me a lot of experience and confidence about developing blog site (SSG). Now, I have gained knowledge of git-based CMS and how it interacts with NextJS. I've also learned about SEO, dynamic sitemap generation and indexing Google procedures. I will make better projects in the future. So, stay tuned! ✌🏻\n\nAnd... last but not least, I would like to say 'thanks' to my friend [Swann Fevian Kyaw](https://www.facebook.com/bon.zai.3910 \"Swann Fevian Kyaw's Facebook Account\") (@[ToonHa](https://www.facebook.com/ToonHa-102639465752883 \"ToonHa Facebook Page\")) who has drawn a beautiful illustration for my hero section of the website.\n\n## Project Links\n\n- Website: [https://satnaing.dev/](https://satnaing.dev/ \"https://satnaing.dev/\")\n- Blog: [https://satnaing.dev/blog](https://satnaing.dev/blog \"https://satnaing.dev/blog\")\n- Repo: [https://github.com/satnaing/my-portfolio](https://github.com/satnaing/my-portfolio \"https://github.com/satnaing/my-portfolio\")","src/data/blog/examples/portfolio-website-development.md","c082a1122cc71fa3",{"html":1137,"metadata":1138},"\u003Cblockquote>\n\u003Cp>This article is originally from my \u003Ca href=\"https://satnaing.dev/blog/posts/how-do-i-develop-my-portfolio-and-blog\">blog post\u003C/a>. I put this article to demonstrate how you can write blog posts/articles using AstroPaper theme.\u003C/p>\n\u003C/blockquote>\n\u003Cp>My experience about developing my first portfolio website and a blog using NextJS and a headless CMS.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://satnaing.dev/_ipx/w_2048,q_75/https%3A%2F%2Fres.cloudinary.com%2Fnoezectz%2Fimage%2Fupload%2Fv1653050141%2FSatNaing%2Fblog_at_cafe_ei1wf4.jpg?url=https%3A%2F%2Fres.cloudinary.com%2Fnoezectz%2Fimage%2Fupload%2Fv1653050141%2FSatNaing%2Fblog_at_cafe_ei1wf4.jpg&#x26;w=2048&#x26;q=75\" alt=\"Building portfolio\">\u003C/p>\n\u003Ch2 id=\"motivation\">Motivation\u003C/h2>\n\u003Cp>I’ve been always thinking about launching my own website with my custom domain name (\u003Cstrong>satnaing.dev\u003C/strong>) since my college student life. But that never happened until this project. I’ve done several projects and works about web application development but I didn’t make an effort to do this.\u003C/p>\n\u003Cp>So, “what about blog?” you may ask. Yeah, blog also has been in my project list for some time. I always wanted to make a blog project using some of the latest technologies. However, I’ve been busy with my works and other projects so that blog project has never been started.\u003C/p>\n\u003Cp>In these days, I tend to develop my own projects with the focus in good quality rather than quantity. After the project is done, I usually put a proper readme file in the GitHub repo. But GitHub repo readme is only suitable for technical aspects (this is just my thought). I want to write down my experiences and challenges. Thus, I decided to make my own blog. Plus, at this point, I have decent experiences and confidence to develop this project.\u003C/p>\n\u003Ch2 id=\"tech-stack\">Tech Stack\u003C/h2>\n\u003Cp>For the front-end, I wanted to use \u003Ca href=\"https://reactjs.org/\" title=\"React Official Website\">React\u003C/a>. But React alone is not good enough for SEO; and I did have to consider many factors like routing, image optimization etc. So, I chose \u003Ca href=\"https://nextjs.org/\" title=\"NextJS Official Website\">NextJS\u003C/a> as my main front-end stack. And of course TypeScript for type checking. (It’s said that you’ll love TypeScript when you’re used to it 😉)\u003C/p>\n\u003Cp>For styling, I use \u003Ca href=\"https://tailwindcss.com/\" title=\"Tailwind CSS Official Website\">TailwindCSS\u003C/a>. This is because I love developer experience that Tailwind gives and it has a lot of flexibilities compared to other component UI libraries like MUI or React Bootstrap.\u003C/p>\n\u003Cp>All contents of this project reside within the GitHub repository. All my blog posts (including this one) are written in Markdown file format since I’m very used to with this. But to write Markdown along with its frontmatter effortlessly, I use \u003Ca href=\"https://forestry.io/\" title=\"Forestry Official Website\">Forestry\u003C/a> headless CMS. It is a git-based CMS that can serve Markdown and other contents. Because of this, I can write my contents either using Markdown or wysiwyg editor. Besides, writing frontmatters with this is a breeze.\u003C/p>\n\u003Cp>Images and assets are uploaded and stored in \u003Ca href=\"https://cloudinary.com/\" title=\"Cloudinary Official Website\">Cloudinary\u003C/a>. I connect Cloudinary via Forestry and manage them directly in the dashboard.\u003C/p>\n\u003Cp>In conclusion, these are the tech stack I’ve used for this project.\u003C/p>\n\u003Cul>\n\u003Cli>Front-end: NextJS (TypeScript)\u003C/li>\n\u003Cli>Styling: TailwindCSS\u003C/li>\n\u003Cli>Animations: GSAP\u003C/li>\n\u003Cli>CMS: Forestry Headless CMS\u003C/li>\n\u003Cli>Deployment: Vercel\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"features\">Features\u003C/h2>\n\u003Cp>The following are certain features of my portfolio and blog\u003C/p>\n\u003Ch3 id=\"seo-friendly\">SEO Friendly\u003C/h3>\n\u003Cp>The entire project is developed with SEO focus in mind. I’ve used proper meta tags, descriptions and heading alignments. This website is now indexed by Google.\u003C/p>\n\u003Cblockquote>\n\u003Cp>You can search this website on google by using keywords like ‘sat naing dev’\u003C/p>\n\u003C/blockquote>\n\u003Cp>\u003Cimg src=\"https://res.cloudinary.com/noezectz/image/upload/v1648231400/SatNaing/satnaing-on-google_asflq6.png\" alt=\"searching satnaing.dev on google\" title=\"satnaing.dev is indexed\">\u003C/p>\n\u003Cp>Moreover, this website will be displayed well when shared to social media due to properly used meta tags.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://res.cloudinary.com/noezectz/image/upload/v1653106955/SatNaing/satnaing-dev-share-on-facebook_1_zjoehx.png\" alt=\"satnaing.dev card layout when shared to Facebook\" title=\"Card layout when shared to Facebook\">\u003C/p>\n\u003Ch3 id=\"dynamic-sitemap\">Dynamic Sitemap\u003C/h3>\n\u003Cp>Sitemap plays an important part in SEO. Because of this, every single page of this site should be included in sitemap.xml. I made an auto generated sitemap in my website whenever I create a new content or tags or categories.\u003C/p>\n\u003Ch3 id=\"light--dark-themes\">Light &#x26; Dark Themes\u003C/h3>\n\u003Cp>Due to dark theme trend in recent years, many websites include dark theme out of the box nowadays. Certainly, my website also supports light &#x26; dark themes.\u003C/p>\n\u003Ch3 id=\"fully-accessible\">Fully Accessible\u003C/h3>\n\u003Cp>This website is fully accessible. You can navigate around by only using keyboard. I put all a11y enhancement best practices like including alt text in all images, no skipping headings, using semantic HTML tags, using aria-attributes properly.\u003C/p>\n\u003Ch3 id=\"search-box-categories--tags\">Search box, Categories &#x26; Tags\u003C/h3>\n\u003Cp>All blog contents can be searched by search box. Moreover, contents can be filtered by categories and tags. In this way, blog readers can search and read what they really want.\u003C/p>\n\u003Ch3 id=\"performance-and-lighthouse-score\">Performance and Lighthouse Score\u003C/h3>\n\u003Cp>This website got very good performance and lighthouse score thanks to proper development and best practices. Here’s the lighthouse score for this website.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://user-images.githubusercontent.com/53733092/159957822-7082e459-11e9-4616-8f1e-49d0881f7cbb.png\" alt=\"satnaing.dev Lighthouse score\" title=\"satnaing.dev Lighthouse score\">\u003C/p>\n\u003Ch3 id=\"animations\">Animations\u003C/h3>\n\u003Cp>Initially I used \u003Ca href=\"https://www.framer.com/motion/\" title=\"Framer Motion\">Framer Motion\u003C/a> to add animations and micro interactions for this website. However, when I tried to use some complex animations and parallax effects, I found it inconvenient to integrate with Framer Motion (Maybe I’m not very good at and used to working with it). Hence, I decided to use \u003Ca href=\"https://greensock.com/\" title=\"GSAP Animation Library\">GSAP\u003C/a> for all of my animations. It is one of the most popular animation library and it is capable of doing complex and advanced animations. You can see animations and micro interactions on pretty much every page of this website.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://res.cloudinary.com/noezectz/image/upload/v1653108324/SatNaing/ezgif.com-gif-maker_2_hehtlm.gif\" alt=\"animations at satnaing.dev\" title=\"satnaing.dev website\">\u003C/p>\n\u003Ch2 id=\"outro\">Outro\u003C/h2>\n\u003Cp>In conclusion, this project gives me a lot of experience and confidence about developing blog site (SSG). Now, I have gained knowledge of git-based CMS and how it interacts with NextJS. I’ve also learned about SEO, dynamic sitemap generation and indexing Google procedures. I will make better projects in the future. So, stay tuned! ✌🏻\u003C/p>\n\u003Cp>And… last but not least, I would like to say ‘thanks’ to my friend \u003Ca href=\"https://www.facebook.com/bon.zai.3910\" title=\"Swann Fevian Kyaw&#x27;s Facebook Account\">Swann Fevian Kyaw\u003C/a> (@\u003Ca href=\"https://www.facebook.com/ToonHa-102639465752883\" title=\"ToonHa Facebook Page\">ToonHa\u003C/a>) who has drawn a beautiful illustration for my hero section of the website.\u003C/p>\n\u003Ch2 id=\"project-links\">Project Links\u003C/h2>\n\u003Cul>\n\u003Cli>Website: \u003Ca href=\"https://satnaing.dev/\" title=\"https://satnaing.dev/\">https://satnaing.dev/\u003C/a>\u003C/li>\n\u003Cli>Blog: \u003Ca href=\"https://satnaing.dev/blog\" title=\"https://satnaing.dev/blog\">https://satnaing.dev/blog\u003C/a>\u003C/li>\n\u003Cli>Repo: \u003Ca href=\"https://github.com/satnaing/my-portfolio\" title=\"https://github.com/satnaing/my-portfolio\">https://github.com/satnaing/my-portfolio\u003C/a>\u003C/li>\n\u003C/ul>",{"headings":1139,"localImagePaths":1172,"remoteImagePaths":1173,"frontmatter":1174,"imagePaths":1177},[1140,1141,1144,1147,1150,1153,1156,1159,1162,1165,1168,1169],{"depth":31,"slug":1113,"text":1114},{"depth":31,"slug":1142,"text":1143},"tech-stack","Tech Stack",{"depth":31,"slug":1145,"text":1146},"features","Features",{"depth":47,"slug":1148,"text":1149},"seo-friendly","SEO Friendly",{"depth":47,"slug":1151,"text":1152},"dynamic-sitemap","Dynamic Sitemap",{"depth":47,"slug":1154,"text":1155},"light--dark-themes","Light & Dark Themes",{"depth":47,"slug":1157,"text":1158},"fully-accessible","Fully Accessible",{"depth":47,"slug":1160,"text":1161},"search-box-categories--tags","Search box, Categories & Tags",{"depth":47,"slug":1163,"text":1164},"performance-and-lighthouse-score","Performance and Lighthouse Score",{"depth":47,"slug":1166,"text":1167},"animations","Animations",{"depth":31,"slug":958,"text":959},{"depth":31,"slug":1170,"text":1171},"project-links","Project Links",[],[],{"title":1125,"author":14,"pubDatetime":1175,"slug":1121,"featured":18,"draft":18,"tags":1176,"description":1131,"timezone":1132},["Date","2022-03-25T16:55:12.000Z"],[1127,1128,1129,1130],[],"examples/tailwind-typography",{"id":1178,"data":1180,"body":1185,"filePath":1186,"digest":1187,"rendered":1188},{"author":14,"pubDatetime":1181,"title":1182,"featured":18,"draft":18,"tags":1183,"description":1184},["Date","2022-07-05T02:05:51.000Z"],"Tailwind Typography Plugin",[1102,1103],"EXAMPLE POST: About Tailwind Typography Plugin and how you can use it effectively.","> This article is from [TailwindLabs](https://tailwindcss-typography.vercel.app/). I put this article to demonstrate how you can write blog posts/articles using AstroPaper theme.\n\nBy default, Tailwind removes all of the default browser styling from paragraphs, headings, lists and more. This ends up being really useful for building application UIs because you spend less time undoing user-agent styles, but when you _really are_ just trying to style some content that came from a rich-text editor in a CMS or a markdown file, it can be surprising and unintuitive.\n\nWe get lots of complaints about it actually, with people regularly asking us things like:\n\n> Why is Tailwind removing the default styles on my `h1` elements? How do I disable this? What do you mean I lose all the other base styles too?\n> We hear you, but we're not convinced that simply disabling our base styles is what you really want. You don't want to have to remove annoying margins every time you use a `p` element in a piece of your dashboard UI. And I doubt you really want your blog posts to use the user-agent styles either — you want them to look _awesome_, not awful.\n\nThe `@tailwindcss/typography` plugin is our attempt to give you what you _actually_ want, without any of the downsides of doing something stupid like disabling our base styles.\n\nIt adds a new `prose` class that you can slap on any block of vanilla HTML content and turn it into a beautiful, well-formatted document:\n\n```html\n\u003Carticle class=\"prose\">\n  \u003Ch1>Garlic bread with cheese: What the science tells us\u003C/h1>\n  \u003Cp>\n    For years parents have espoused the health benefits of eating garlic bread\n    with cheese to their children, with the food earning such an iconic status\n    in our culture that kids will often dress up as warm, cheesy loaf for\n    Halloween.\n  \u003C/p>\n  \u003Cp>\n    But a recent study shows that the celebrated appetizer may be linked to a\n    series of rabies cases springing up around the country.\n  \u003C/p>\n  \u003C!-- ... -->\n\u003C/article>\n```\n\nFor more information about how to use the plugin and the features it includes, [read the documentation](https://github.com/tailwindcss/typography/blob/master/README.md).\n\n---\n\n## What to expect from here on out\n\nWhat follows from here is just a bunch of absolute nonsense I've written to dogfood the plugin itself. It includes every sensible typographic element I could think of, like **bold text**, unordered lists, ordered lists, code blocks, block quotes, _and even italics_.\n\nIt's important to cover all of these use cases for a few reasons:\n\n1. We want everything to look good out of the box.\n2. Really just the first reason, that's the whole point of the plugin.\n3. Here's a third pretend reason though a list with three items looks more realistic than a list with two items.\n\nNow we're going to try out another header style.\n\n### Typography should be easy\n\nSo that's a header for you — with any luck if we've done our job correctly that will look pretty reasonable.\n\nSomething a wise person once told me about typography is:\n\n> Typography is pretty important if you don't want your stuff to look like trash. Make it good then it won't be bad.\n> It's probably important that images look okay here by default as well:\n\n\u003Cfigure>\n  \u003Cimg\n    src=\"https://images.unsplash.com/photo-1556740758-90de374c12ad?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1000&q=80\"\n    alt=\"\"\n  />\n  \u003Cfigcaption>\n    Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of\n    classical Latin literature from 45 BC, making it over 2000 years old.\n  \u003C/figcaption>\n\u003C/figure>\n\nNow I'm going to show you an example of an unordered list to make sure that looks good, too:\n\n- So here is the first item in this list.\n- In this example we're keeping the items short.\n- Later, we'll use longer, more complex list items.\n\nAnd that's the end of this section.\n\n## What if we stack headings?\n\n### We should make sure that looks good, too.\n\nSometimes you have headings directly underneath each other. In those cases you often have to undo the top margin on the second heading because it usually looks better for the headings to be closer together than a paragraph followed by a heading should be.\n\n### When a heading comes after a paragraph …\n\nWhen a heading comes after a paragraph, we need a bit more space, like I already mentioned above. Now let's see what a more complex list would look like.\n\n- **I often do this thing where list items have headings.**\n\n  For some reason I think this looks cool which is unfortunate because it's pretty annoying to get the styles right.\n\n  I often have two or three paragraphs in these list items, too, so the hard part is getting the spacing between the paragraphs, list item heading, and separate list items to all make sense. Pretty tough honestly, you could make a strong argument that you just shouldn't write this way.\n\n- **Since this is a list, I need at least two items.**\n\n  I explained what I'm doing already in the previous list item, but a list wouldn't be a list if it only had one item, and we really want this to look realistic. That's why I've added this second list item so I actually have something to look at when writing the styles.\n\n- **It's not a bad idea to add a third item either.**\n\n  I think it probably would've been fine to just use two items but three is definitely not worse, and since I seem to be having no trouble making up arbitrary things to type, I might as well include it.\n\nAfter this sort of list I usually have a closing statement or paragraph, because it kinda looks weird jumping right to a heading.\n\n## Code should look okay by default.\n\nI think most people are going to use [highlight.js](https://highlightjs.org/) or [Prism](https://prismjs.com/) or something if they want to style their code blocks but it wouldn't hurt to make them look _okay_ out of the box, even with no syntax highlighting.\n\nHere's what a default `tailwind.config.js` file looks like at the time of writing:\n\n```js\nmodule.exports = {\n  purge: [],\n  theme: {\n    extend: {},\n  },\n  variants: {},\n  plugins: [],\n};\n```\n\nHopefully that looks good enough to you.\n\n### What about nested lists?\n\nNested lists basically always look bad which is why editors like Medium don't even let you do it, but I guess since some of you goofballs are going to do it we have to carry the burden of at least making it work.\n\n1. **Nested lists are rarely a good idea.**\n   - You might feel like you are being really \"organized\" or something but you are just creating a gross shape on the screen that is hard to read.\n   - Nested navigation in UIs is a bad idea too, keep things as flat as possible.\n   - Nesting tons of folders in your source code is also not helpful.\n2. **Since we need to have more items, here's another one.**\n   - I'm not sure if we'll bother styling more than two levels deep.\n   - Two is already too much, three is guaranteed to be a bad idea.\n   - If you nest four levels deep you belong in prison.\n3. **Two items isn't really a list, three is good though.**\n   - Again please don't nest lists if you want people to actually read your content.\n   - Nobody wants to look at this.\n   - I'm upset that we even have to bother styling this.\n\nThe most annoying thing about lists in Markdown is that `\u003Cli>` elements aren't given a child `\u003Cp>` tag unless there are multiple paragraphs in the list item. That means I have to worry about styling that annoying situation too.\n\n- **For example, here's another nested list.**\n\n  But this time with a second paragraph.\n  - These list items won't have `\u003Cp>` tags\n  - Because they are only one line each\n\n- **But in this second top-level list item, they will.**\n\n  This is especially annoying because of the spacing on this paragraph.\n  - As you can see here, because I've added a second line, this list item now has a `\u003Cp>` tag.\n\n    This is the second line I'm talking about by the way.\n\n  - Finally here's another list item so it's more like a list.\n\n- A closing list item, but with no nested list, because why not?\n\nAnd finally a sentence to close off this section.\n\n## There are other elements we need to style\n\nI almost forgot to mention links, like [this link to the Tailwind CSS website](https://tailwindcss.com). We almost made them blue but that's so yesterday, so we went with dark gray, feels edgier.\n\nWe even included table styles, check it out:\n\n| Wrestler                | Origin       | Finisher           |\n| ----------------------- | ------------ | ------------------ |\n| Bret \"The Hitman\" Hart  | Calgary, AB  | Sharpshooter       |\n| Stone Cold Steve Austin | Austin, TX   | Stone Cold Stunner |\n| Randy Savage            | Sarasota, FL | Elbow Drop         |\n| Vader                   | Boulder, CO  | Vader Bomb         |\n| Razor Ramon             | Chuluota, FL | Razor's Edge       |\n\nWe also need to make sure inline code looks good, like if I wanted to talk about `\u003Cspan>` elements or tell you the good news about `@tailwindcss/typography`.\n\n### Sometimes I even use `code` in headings\n\nEven though it's probably a bad idea, and historically I've had a hard time making it look good. This _\"wrap the code blocks in backticks\"_ trick works pretty well though really.\n\nAnother thing I've done in the past is put a `code` tag inside of a link, like if I wanted to tell you about the [`tailwindcss/docs`](https://github.com/tailwindcss/docs) repository. I don't love that there is an underline below the backticks but it is absolutely not worth the madness it would require to avoid it.\n\n#### We haven't used an `h4` yet\n\nBut now we have. Please don't use `h5` or `h6` in your content, Medium only supports two heading levels for a reason, you animals. I honestly considered using a `before` pseudo-element to scream at you if you use an `h5` or `h6`.\n\nWe don't style them at all out of the box because `h4` elements are already so small that they are the same size as the body copy. What are we supposed to do with an `h5`, make it _smaller_ than the body copy? No thanks.\n\n### We still need to think about stacked headings though.\n\n#### Let's make sure we don't screw that up with `h4` elements, either.\n\nPhew, with any luck we have styled the headings above this text and they look pretty good.\n\nLet's add a closing paragraph here so things end with a decently sized block of text. I can't explain why I want things to end that way but I have to assume it's because I think things will look weird or unbalanced if there is a heading too close to the end of the document.\n\nWhat I've written here is probably long enough, but adding this final sentence can't hurt.","src/data/blog/examples/tailwind-typography.md","8a6bca464385862c",{"html":1189,"metadata":1190},"\u003Cblockquote>\n\u003Cp>This article is from \u003Ca href=\"https://tailwindcss-typography.vercel.app/\">TailwindLabs\u003C/a>. I put this article to demonstrate how you can write blog posts/articles using AstroPaper theme.\u003C/p>\n\u003C/blockquote>\n\u003Cp>By default, Tailwind removes all of the default browser styling from paragraphs, headings, lists and more. This ends up being really useful for building application UIs because you spend less time undoing user-agent styles, but when you \u003Cem>really are\u003C/em> just trying to style some content that came from a rich-text editor in a CMS or a markdown file, it can be surprising and unintuitive.\u003C/p>\n\u003Cp>We get lots of complaints about it actually, with people regularly asking us things like:\u003C/p>\n\u003Cblockquote>\n\u003Cp>Why is Tailwind removing the default styles on my \u003Ccode>h1\u003C/code> elements? How do I disable this? What do you mean I lose all the other base styles too?\nWe hear you, but we’re not convinced that simply disabling our base styles is what you really want. You don’t want to have to remove annoying margins every time you use a \u003Ccode>p\u003C/code> element in a piece of your dashboard UI. And I doubt you really want your blog posts to use the user-agent styles either — you want them to look \u003Cem>awesome\u003C/em>, not awful.\u003C/p>\n\u003C/blockquote>\n\u003Cp>The \u003Ccode>@tailwindcss/typography\u003C/code> plugin is our attempt to give you what you \u003Cem>actually\u003C/em> want, without any of the downsides of doing something stupid like disabling our base styles.\u003C/p>\n\u003Cp>It adds a new \u003Ccode>prose\u003C/code> class that you can slap on any block of vanilla HTML content and turn it into a beautiful, well-formatted document:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"html\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">article\u003C/span>\u003Cspan style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> class\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">prose\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">h1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">Garlic bread with cheese: What the science tells us\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">h1\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">p\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    For years parents have espoused the health benefits of eating garlic bread\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    with cheese to their children, with the food earning such an iconic status\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    in our culture that kids will often dress up as warm, cheesy loaf for\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    Halloween.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">p\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">p\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    But a recent study shows that the celebrated appetizer may be linked to a\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    series of rabies cases springing up around the country.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">p\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  &#x3C;!-- ... -->\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/\u003C/span>\u003Cspan style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">article\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>For more information about how to use the plugin and the features it includes, \u003Ca href=\"https://github.com/tailwindcss/typography/blob/master/README.md\">read the documentation\u003C/a>.\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"what-to-expect-from-here-on-out\">What to expect from here on out\u003C/h2>\n\u003Cp>What follows from here is just a bunch of absolute nonsense I’ve written to dogfood the plugin itself. It includes every sensible typographic element I could think of, like \u003Cstrong>bold text\u003C/strong>, unordered lists, ordered lists, code blocks, block quotes, \u003Cem>and even italics\u003C/em>.\u003C/p>\n\u003Cp>It’s important to cover all of these use cases for a few reasons:\u003C/p>\n\u003Col>\n\u003Cli>We want everything to look good out of the box.\u003C/li>\n\u003Cli>Really just the first reason, that’s the whole point of the plugin.\u003C/li>\n\u003Cli>Here’s a third pretend reason though a list with three items looks more realistic than a list with two items.\u003C/li>\n\u003C/ol>\n\u003Cp>Now we’re going to try out another header style.\u003C/p>\n\u003Ch3 id=\"typography-should-be-easy\">Typography should be easy\u003C/h3>\n\u003Cp>So that’s a header for you — with any luck if we’ve done our job correctly that will look pretty reasonable.\u003C/p>\n\u003Cp>Something a wise person once told me about typography is:\u003C/p>\n\u003Cblockquote>\n\u003Cp>Typography is pretty important if you don’t want your stuff to look like trash. Make it good then it won’t be bad.\nIt’s probably important that images look okay here by default as well:\u003C/p>\n\u003C/blockquote>\n\u003Cfigure>\n  \u003Cimg src=\"https://images.unsplash.com/photo-1556740758-90de374c12ad?ixlib=rb-1.2.1&#x26;ixid=eyJhcHBfaWQiOjEyMDd9&#x26;auto=format&#x26;fit=crop&#x26;w=1000&#x26;q=80\" alt=\"\">\n  \u003Cfigcaption>\n    Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of\n    classical Latin literature from 45 BC, making it over 2000 years old.\n  \u003C/figcaption>\n\u003C/figure>\n\u003Cp>Now I’m going to show you an example of an unordered list to make sure that looks good, too:\u003C/p>\n\u003Cul>\n\u003Cli>So here is the first item in this list.\u003C/li>\n\u003Cli>In this example we’re keeping the items short.\u003C/li>\n\u003Cli>Later, we’ll use longer, more complex list items.\u003C/li>\n\u003C/ul>\n\u003Cp>And that’s the end of this section.\u003C/p>\n\u003Ch2 id=\"what-if-we-stack-headings\">What if we stack headings?\u003C/h2>\n\u003Ch3 id=\"we-should-make-sure-that-looks-good-too\">We should make sure that looks good, too.\u003C/h3>\n\u003Cp>Sometimes you have headings directly underneath each other. In those cases you often have to undo the top margin on the second heading because it usually looks better for the headings to be closer together than a paragraph followed by a heading should be.\u003C/p>\n\u003Ch3 id=\"when-a-heading-comes-after-a-paragraph\">When a heading comes after a paragraph …\u003C/h3>\n\u003Cp>When a heading comes after a paragraph, we need a bit more space, like I already mentioned above. Now let’s see what a more complex list would look like.\u003C/p>\n\u003Cul>\n\u003Cli>\n\u003Cp>\u003Cstrong>I often do this thing where list items have headings.\u003C/strong>\u003C/p>\n\u003Cp>For some reason I think this looks cool which is unfortunate because it’s pretty annoying to get the styles right.\u003C/p>\n\u003Cp>I often have two or three paragraphs in these list items, too, so the hard part is getting the spacing between the paragraphs, list item heading, and separate list items to all make sense. Pretty tough honestly, you could make a strong argument that you just shouldn’t write this way.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>\u003Cstrong>Since this is a list, I need at least two items.\u003C/strong>\u003C/p>\n\u003Cp>I explained what I’m doing already in the previous list item, but a list wouldn’t be a list if it only had one item, and we really want this to look realistic. That’s why I’ve added this second list item so I actually have something to look at when writing the styles.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>\u003Cstrong>It’s not a bad idea to add a third item either.\u003C/strong>\u003C/p>\n\u003Cp>I think it probably would’ve been fine to just use two items but three is definitely not worse, and since I seem to be having no trouble making up arbitrary things to type, I might as well include it.\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003Cp>After this sort of list I usually have a closing statement or paragraph, because it kinda looks weird jumping right to a heading.\u003C/p>\n\u003Ch2 id=\"code-should-look-okay-by-default\">Code should look okay by default.\u003C/h2>\n\u003Cp>I think most people are going to use \u003Ca href=\"https://highlightjs.org/\">highlight.js\u003C/a> or \u003Ca href=\"https://prismjs.com/\">Prism\u003C/a> or something if they want to style their code blocks but it wouldn’t hurt to make them look \u003Cem>okay\u003C/em> out of the box, even with no syntax highlighting.\u003C/p>\n\u003Cp>Here’s what a default \u003Ccode>tailwind.config.js\u003C/code> file looks like at the time of writing:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">module\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.\u003C/span>\u003Cspan style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">exports\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  purge\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> []\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  theme\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    extend\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {}\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  variants\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {}\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  plugins\u003C/span>\u003Cspan style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> []\u003C/span>\u003Cspan style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Hopefully that looks good enough to you.\u003C/p>\n\u003Ch3 id=\"what-about-nested-lists\">What about nested lists?\u003C/h3>\n\u003Cp>Nested lists basically always look bad which is why editors like Medium don’t even let you do it, but I guess since some of you goofballs are going to do it we have to carry the burden of at least making it work.\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Nested lists are rarely a good idea.\u003C/strong>\n\u003Cul>\n\u003Cli>You might feel like you are being really “organized” or something but you are just creating a gross shape on the screen that is hard to read.\u003C/li>\n\u003Cli>Nested navigation in UIs is a bad idea too, keep things as flat as possible.\u003C/li>\n\u003Cli>Nesting tons of folders in your source code is also not helpful.\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Cstrong>Since we need to have more items, here’s another one.\u003C/strong>\n\u003Cul>\n\u003Cli>I’m not sure if we’ll bother styling more than two levels deep.\u003C/li>\n\u003Cli>Two is already too much, three is guaranteed to be a bad idea.\u003C/li>\n\u003Cli>If you nest four levels deep you belong in prison.\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Cstrong>Two items isn’t really a list, three is good though.\u003C/strong>\n\u003Cul>\n\u003Cli>Again please don’t nest lists if you want people to actually read your content.\u003C/li>\n\u003Cli>Nobody wants to look at this.\u003C/li>\n\u003Cli>I’m upset that we even have to bother styling this.\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ol>\n\u003Cp>The most annoying thing about lists in Markdown is that \u003Ccode>&#x3C;li>\u003C/code> elements aren’t given a child \u003Ccode>&#x3C;p>\u003C/code> tag unless there are multiple paragraphs in the list item. That means I have to worry about styling that annoying situation too.\u003C/p>\n\u003Cul>\n\u003Cli>\n\u003Cp>\u003Cstrong>For example, here’s another nested list.\u003C/strong>\u003C/p>\n\u003Cp>But this time with a second paragraph.\u003C/p>\n\u003Cul>\n\u003Cli>These list items won’t have \u003Ccode>&#x3C;p>\u003C/code> tags\u003C/li>\n\u003Cli>Because they are only one line each\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\n\u003Cp>\u003Cstrong>But in this second top-level list item, they will.\u003C/strong>\u003C/p>\n\u003Cp>This is especially annoying because of the spacing on this paragraph.\u003C/p>\n\u003Cul>\n\u003Cli>\n\u003Cp>As you can see here, because I’ve added a second line, this list item now has a \u003Ccode>&#x3C;p>\u003C/code> tag.\u003C/p>\n\u003Cp>This is the second line I’m talking about by the way.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Finally here’s another list item so it’s more like a list.\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\n\u003Cp>A closing list item, but with no nested list, because why not?\u003C/p>\n\u003C/li>\n\u003C/ul>\n\u003Cp>And finally a sentence to close off this section.\u003C/p>\n\u003Ch2 id=\"there-are-other-elements-we-need-to-style\">There are other elements we need to style\u003C/h2>\n\u003Cp>I almost forgot to mention links, like \u003Ca href=\"https://tailwindcss.com\">this link to the Tailwind CSS website\u003C/a>. We almost made them blue but that’s so yesterday, so we went with dark gray, feels edgier.\u003C/p>\n\u003Cp>We even included table styles, check it out:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Wrestler\u003C/th>\u003Cth>Origin\u003C/th>\u003Cth>Finisher\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Bret “The Hitman” Hart\u003C/td>\u003Ctd>Calgary, AB\u003C/td>\u003Ctd>Sharpshooter\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Stone Cold Steve Austin\u003C/td>\u003Ctd>Austin, TX\u003C/td>\u003Ctd>Stone Cold Stunner\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Randy Savage\u003C/td>\u003Ctd>Sarasota, FL\u003C/td>\u003Ctd>Elbow Drop\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Vader\u003C/td>\u003Ctd>Boulder, CO\u003C/td>\u003Ctd>Vader Bomb\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Razor Ramon\u003C/td>\u003Ctd>Chuluota, FL\u003C/td>\u003Ctd>Razor’s Edge\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>We also need to make sure inline code looks good, like if I wanted to talk about \u003Ccode>&#x3C;span>\u003C/code> elements or tell you the good news about \u003Ccode>@tailwindcss/typography\u003C/code>.\u003C/p>\n\u003Ch3 id=\"sometimes-i-even-use-code-in-headings\">Sometimes I even use \u003Ccode>code\u003C/code> in headings\u003C/h3>\n\u003Cp>Even though it’s probably a bad idea, and historically I’ve had a hard time making it look good. This \u003Cem>“wrap the code blocks in backticks”\u003C/em> trick works pretty well though really.\u003C/p>\n\u003Cp>Another thing I’ve done in the past is put a \u003Ccode>code\u003C/code> tag inside of a link, like if I wanted to tell you about the \u003Ca href=\"https://github.com/tailwindcss/docs\">\u003Ccode>tailwindcss/docs\u003C/code>\u003C/a> repository. I don’t love that there is an underline below the backticks but it is absolutely not worth the madness it would require to avoid it.\u003C/p>\n\u003Ch4 id=\"we-havent-used-an-h4-yet\">We haven’t used an \u003Ccode>h4\u003C/code> yet\u003C/h4>\n\u003Cp>But now we have. Please don’t use \u003Ccode>h5\u003C/code> or \u003Ccode>h6\u003C/code> in your content, Medium only supports two heading levels for a reason, you animals. I honestly considered using a \u003Ccode>before\u003C/code> pseudo-element to scream at you if you use an \u003Ccode>h5\u003C/code> or \u003Ccode>h6\u003C/code>.\u003C/p>\n\u003Cp>We don’t style them at all out of the box because \u003Ccode>h4\u003C/code> elements are already so small that they are the same size as the body copy. What are we supposed to do with an \u003Ccode>h5\u003C/code>, make it \u003Cem>smaller\u003C/em> than the body copy? No thanks.\u003C/p>\n\u003Ch3 id=\"we-still-need-to-think-about-stacked-headings-though\">We still need to think about stacked headings though.\u003C/h3>\n\u003Ch4 id=\"lets-make-sure-we-dont-screw-that-up-with-h4-elements-either\">Let’s make sure we don’t screw that up with \u003Ccode>h4\u003C/code> elements, either.\u003C/h4>\n\u003Cp>Phew, with any luck we have styled the headings above this text and they look pretty good.\u003C/p>\n\u003Cp>Let’s add a closing paragraph here so things end with a decently sized block of text. I can’t explain why I want things to end that way but I have to assume it’s because I think things will look weird or unbalanced if there is a heading too close to the end of the document.\u003C/p>\n\u003Cp>What I’ve written here is probably long enough, but adding this final sentence can’t hurt.\u003C/p>",{"headings":1191,"localImagePaths":1228,"remoteImagePaths":1229,"frontmatter":1230,"imagePaths":1233},[1192,1195,1198,1201,1204,1207,1210,1213,1216,1219,1222,1225],{"depth":31,"slug":1193,"text":1194},"what-to-expect-from-here-on-out","What to expect from here on out",{"depth":47,"slug":1196,"text":1197},"typography-should-be-easy","Typography should be easy",{"depth":31,"slug":1199,"text":1200},"what-if-we-stack-headings","What if we stack headings?",{"depth":47,"slug":1202,"text":1203},"we-should-make-sure-that-looks-good-too","We should make sure that looks good, too.",{"depth":47,"slug":1205,"text":1206},"when-a-heading-comes-after-a-paragraph","When a heading comes after a paragraph …",{"depth":31,"slug":1208,"text":1209},"code-should-look-okay-by-default","Code should look okay by default.",{"depth":47,"slug":1211,"text":1212},"what-about-nested-lists","What about nested lists?",{"depth":31,"slug":1214,"text":1215},"there-are-other-elements-we-need-to-style","There are other elements we need to style",{"depth":47,"slug":1217,"text":1218},"sometimes-i-even-use-code-in-headings","Sometimes I even use code in headings",{"depth":708,"slug":1220,"text":1221},"we-havent-used-an-h4-yet","We haven’t used an h4 yet",{"depth":47,"slug":1223,"text":1224},"we-still-need-to-think-about-stacked-headings-though","We still need to think about stacked headings though.",{"depth":708,"slug":1226,"text":1227},"lets-make-sure-we-dont-screw-that-up-with-h4-elements-either","Let’s make sure we don’t screw that up with h4 elements, either.",[],[],{"title":1182,"author":14,"pubDatetime":1231,"featured":18,"draft":18,"tags":1232,"description":1184},["Date","2022-07-05T02:05:51.000Z"],[1102,1103],[],"how-do-i-develop-my-terminal-portfolio-website-with-react",{"id":1234,"data":1236,"body":1245,"filePath":1246,"digest":1247,"rendered":1248},{"author":14,"pubDatetime":1237,"title":1238,"featured":18,"draft":18,"tags":1239,"description":1244,"timezone":1132},["Date","2022-06-09T03:42:51.000Z"],"How Do I Develop My Terminal Portfolio Website with React",[1240,1241,1242,1243,1102],"JavaScript","ReactJS","ContextAPI","Styled-Components","EXAMPLE POST: Developing a terminal-like website using ReactJS, TypeScript and Styled-Components. Includes features like autocomplete, multiple themes, command hints etc.","> This article is originally from my [blog post](https://satnaing.dev/blog/posts/how-do-i-develop-my-terminal-portfolio-website-with-react). I put this article to demonstrate how you can write blog posts/articles using AstroPaper theme.\n\nDeveloping a terminal-like website using ReactJS, TypeScript and Styled-Components. Includes features like autocomplete, multiple themes, command hints etc.\n\n![Sat Naing's Terminal Portfolio](https://satnaing.dev/_ipx/w_2048,q_75/https%3A%2F%2Fres.cloudinary.com%2Fnoezectz%2Fimage%2Fupload%2Fv1654754125%2FSatNaing%2Fterminal-screenshot_gu3kkc.png?url=https%3A%2F%2Fres.cloudinary.com%2Fnoezectz%2Fimage%2Fupload%2Fv1654754125%2FSatNaing%2Fterminal-screenshot_gu3kkc.png&w=2048&q=75)\n\n## Table of contents\n\n## Intro\n\nRecently, I've developed and published my portfolio + a blog. I’m glad I got some good feedback for it. Today, I want to introduce my new terminal-like portfolio website. It is developed using ReactJS, TypeScript. I got this idea from CodePen and YouTube.\n\n## Tech Stack\n\nThis project is a frontend project without any backend codes. The UI/UX part is designed in Figma. For the frontend user-interface, I chose React over pain JavaScript and NextJS. Why?\n\n- Firstly, I want to write declarative code. Managing HTML DOM using JavaScript imperatively is really tedious.\n- Secondly, because it is React!!! It is fast, and reliable.\n- Lastly, I don’t need much of the SEO features, routing and image optimization provided by NextJS.\n\nAnd of course there's TypeScript for type checking.\n\nFor styling, I took a different approach than what I usually do. Instead of choosing Pure CSS, Sass, or Utility CSS Framework like TailwindCSS, I chose the CSS-in-JS way (Styled-Components). Although I’ve known about Styled-Components for some time, I’ve never tried it out. So, the writing style and structures of Styled-Components in this project may not be very organized or very good.\n\nThis project doesn’t need very complex state management. I just use ContextAPI in this project for multiple theming and to avoid prop drilling.\n\nHere’s a quick recap for the tech stack.\n\n- Frontend: [ReactJS](https://reactjs.org/ \"React Website\"), [TypeScript](https://www.typescriptlang.org/ \"TypeScript Website\")\n- Styling: [Styled-Components](https://styled-components.com/ \"Styled-Components Website\")\n- UI/UX: [Figma](https://figma.com/ \"Figma Website\")\n- State Management: [ContextAPI](https://reactjs.org/docs/context.html \"React ContextAPI\")\n- Deployment: [Netlify](https://www.netlify.com/ \"Netlify Website\")\n\n## Features\n\nHere are some features of the project.\n\n### Multiple Themes\n\nUsers can change multiple themes. At the time of writing this post, there are 5 themes; and more themes will probably be added in the future. The selected theme is saved in local storage so that the theme won’t change on page refresh.\n\n![Setting different theme](https://i.ibb.co/fSTCnWB/terminal-portfolio-multiple-themes.gif)\n\n### Command-line Completion\n\nTo look and feel as close to the actual terminal as possible, I put a command-line completion feature which auto fills in partially typed commands by simply pressing ‘Tab’ or ‘Ctrl + i’.\n\n![Demonstrating command-line completion](https://i.ibb.co/CQTGGLF/terminal-autocomplete.gif)\n\n### Previous Commands\n\nUsers can go back to the previous commands or navigate the previously typed commands by pressing Up & Down Arrows.\n\n![Going back to previous commands with UP Arrow](https://i.ibb.co/vD1pSRv/terminal-up-down.gif)\n\n### View/Clear Command History\n\npreviously typed commands can be viewed by typing ‘history’ in the command line. All the command history and terminal screen can be wiped out by typing ‘clear’ or pressing ‘Ctrl + l’.\n\n![Clearing the terminal with 'clear' or 'Ctrl + L' command](https://i.ibb.co/SJBy8Rr/terminal-clear.gif)\n\n## Outro\n\nThis is a really fun project, and one special part of this project is I had to focus on logic rather than user-interface (even though this is kind of a frontend project).\n\n## Project Links\n\n- Website: [https://terminal.satnaing.dev/](https://terminal.satnaing.dev/ \"https://terminal.satnaing.dev/\")\n- Repo: [https://github.com/satnaing/terminal-portfolio](https://github.com/satnaing/terminal-portfolio \"https://github.com/satnaing/terminal-portfolio\")","src/data/blog/examples/terminal-development.md","1a50174c212d30cb",{"html":1249,"metadata":1250},"\u003Cblockquote>\n\u003Cp>This article is originally from my \u003Ca href=\"https://satnaing.dev/blog/posts/how-do-i-develop-my-terminal-portfolio-website-with-react\">blog post\u003C/a>. I put this article to demonstrate how you can write blog posts/articles using AstroPaper theme.\u003C/p>\n\u003C/blockquote>\n\u003Cp>Developing a terminal-like website using ReactJS, TypeScript and Styled-Components. Includes features like autocomplete, multiple themes, command hints etc.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://satnaing.dev/_ipx/w_2048,q_75/https%3A%2F%2Fres.cloudinary.com%2Fnoezectz%2Fimage%2Fupload%2Fv1654754125%2FSatNaing%2Fterminal-screenshot_gu3kkc.png?url=https%3A%2F%2Fres.cloudinary.com%2Fnoezectz%2Fimage%2Fupload%2Fv1654754125%2FSatNaing%2Fterminal-screenshot_gu3kkc.png&#x26;w=2048&#x26;q=75\" alt=\"Sat Naing&#x27;s Terminal Portfolio\">\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#intro\">Intro\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#tech-stack\">Tech Stack\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#features\">Features\u003C/a>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#multiple-themes\">Multiple Themes\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#command-line-completion\">Command-line Completion\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#previous-commands\">Previous Commands\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#viewclear-command-history\">View/Clear Command History\u003C/a>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\u003Ca href=\"#outro\">Outro\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#project-links\">Project Links\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"intro\">Intro\u003C/h2>\n\u003Cp>Recently, I’ve developed and published my portfolio + a blog. I’m glad I got some good feedback for it. Today, I want to introduce my new terminal-like portfolio website. It is developed using ReactJS, TypeScript. I got this idea from CodePen and YouTube.\u003C/p>\n\u003Ch2 id=\"tech-stack\">Tech Stack\u003C/h2>\n\u003Cp>This project is a frontend project without any backend codes. The UI/UX part is designed in Figma. For the frontend user-interface, I chose React over pain JavaScript and NextJS. Why?\u003C/p>\n\u003Cul>\n\u003Cli>Firstly, I want to write declarative code. Managing HTML DOM using JavaScript imperatively is really tedious.\u003C/li>\n\u003Cli>Secondly, because it is React!!! It is fast, and reliable.\u003C/li>\n\u003Cli>Lastly, I don’t need much of the SEO features, routing and image optimization provided by NextJS.\u003C/li>\n\u003C/ul>\n\u003Cp>And of course there’s TypeScript for type checking.\u003C/p>\n\u003Cp>For styling, I took a different approach than what I usually do. Instead of choosing Pure CSS, Sass, or Utility CSS Framework like TailwindCSS, I chose the CSS-in-JS way (Styled-Components). Although I’ve known about Styled-Components for some time, I’ve never tried it out. So, the writing style and structures of Styled-Components in this project may not be very organized or very good.\u003C/p>\n\u003Cp>This project doesn’t need very complex state management. I just use ContextAPI in this project for multiple theming and to avoid prop drilling.\u003C/p>\n\u003Cp>Here’s a quick recap for the tech stack.\u003C/p>\n\u003Cul>\n\u003Cli>Frontend: \u003Ca href=\"https://reactjs.org/\" title=\"React Website\">ReactJS\u003C/a>, \u003Ca href=\"https://www.typescriptlang.org/\" title=\"TypeScript Website\">TypeScript\u003C/a>\u003C/li>\n\u003Cli>Styling: \u003Ca href=\"https://styled-components.com/\" title=\"Styled-Components Website\">Styled-Components\u003C/a>\u003C/li>\n\u003Cli>UI/UX: \u003Ca href=\"https://figma.com/\" title=\"Figma Website\">Figma\u003C/a>\u003C/li>\n\u003Cli>State Management: \u003Ca href=\"https://reactjs.org/docs/context.html\" title=\"React ContextAPI\">ContextAPI\u003C/a>\u003C/li>\n\u003Cli>Deployment: \u003Ca href=\"https://www.netlify.com/\" title=\"Netlify Website\">Netlify\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"features\">Features\u003C/h2>\n\u003Cp>Here are some features of the project.\u003C/p>\n\u003Ch3 id=\"multiple-themes\">Multiple Themes\u003C/h3>\n\u003Cp>Users can change multiple themes. At the time of writing this post, there are 5 themes; and more themes will probably be added in the future. The selected theme is saved in local storage so that the theme won’t change on page refresh.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://i.ibb.co/fSTCnWB/terminal-portfolio-multiple-themes.gif\" alt=\"Setting different theme\">\u003C/p>\n\u003Ch3 id=\"command-line-completion\">Command-line Completion\u003C/h3>\n\u003Cp>To look and feel as close to the actual terminal as possible, I put a command-line completion feature which auto fills in partially typed commands by simply pressing ‘Tab’ or ‘Ctrl + i’.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://i.ibb.co/CQTGGLF/terminal-autocomplete.gif\" alt=\"Demonstrating command-line completion\">\u003C/p>\n\u003Ch3 id=\"previous-commands\">Previous Commands\u003C/h3>\n\u003Cp>Users can go back to the previous commands or navigate the previously typed commands by pressing Up &#x26; Down Arrows.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://i.ibb.co/vD1pSRv/terminal-up-down.gif\" alt=\"Going back to previous commands with UP Arrow\">\u003C/p>\n\u003Ch3 id=\"viewclear-command-history\">View/Clear Command History\u003C/h3>\n\u003Cp>previously typed commands can be viewed by typing ‘history’ in the command line. All the command history and terminal screen can be wiped out by typing ‘clear’ or pressing ‘Ctrl + l’.\u003C/p>\n\u003Cp>\u003Cimg src=\"https://i.ibb.co/SJBy8Rr/terminal-clear.gif\" alt=\"Clearing the terminal with &#x27;clear&#x27; or &#x27;Ctrl + L&#x27; command\">\u003C/p>\n\u003Ch2 id=\"outro\">Outro\u003C/h2>\n\u003Cp>This is a really fun project, and one special part of this project is I had to focus on logic rather than user-interface (even though this is kind of a frontend project).\u003C/p>\n\u003Ch2 id=\"project-links\">Project Links\u003C/h2>\n\u003Cul>\n\u003Cli>Website: \u003Ca href=\"https://terminal.satnaing.dev/\" title=\"https://terminal.satnaing.dev/\">https://terminal.satnaing.dev/\u003C/a>\u003C/li>\n\u003Cli>Repo: \u003Ca href=\"https://github.com/satnaing/terminal-portfolio\" title=\"https://github.com/satnaing/terminal-portfolio\">https://github.com/satnaing/terminal-portfolio\u003C/a>\u003C/li>\n\u003C/ul>",{"headings":1251,"localImagePaths":1270,"remoteImagePaths":1271,"frontmatter":1272,"imagePaths":1275},[1252,1253,1254,1255,1256,1259,1262,1265,1268,1269],{"depth":31,"slug":32,"text":33},{"depth":31,"slug":35,"text":36},{"depth":31,"slug":1142,"text":1143},{"depth":31,"slug":1145,"text":1146},{"depth":47,"slug":1257,"text":1258},"multiple-themes","Multiple Themes",{"depth":47,"slug":1260,"text":1261},"command-line-completion","Command-line Completion",{"depth":47,"slug":1263,"text":1264},"previous-commands","Previous Commands",{"depth":47,"slug":1266,"text":1267},"viewclear-command-history","View/Clear Command History",{"depth":31,"slug":958,"text":959},{"depth":31,"slug":1170,"text":1171},[],[],{"title":1238,"author":14,"pubDatetime":1273,"slug":1234,"featured":18,"draft":18,"tags":1274,"description":1244,"timezone":1132},["Date","2022-06-09T03:42:51.000Z"],[1240,1241,1242,1243,1102],[]]